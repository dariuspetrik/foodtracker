function KI(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const o=Object.getOwnPropertyDescriptor(s,r);o&&Object.defineProperty(n,r,o.get?o:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();function rw(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function hF(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),t}var Sx={exports:{}},Rc={},Nx={exports:{}},et={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ON;function pF(){if(ON)return et;ON=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),a=Symbol.for("react.context"),i=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;function f(M){return M===null||typeof M!="object"?null:(M=p&&M[p]||M["@@iterator"],typeof M=="function"?M:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,w={};function x(M,H,le){this.props=M,this.context=H,this.refs=w,this.updater=le||g}x.prototype.isReactComponent={},x.prototype.setState=function(M,H){if(typeof M!="object"&&typeof M!="function"&&M!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,M,H,"setState")},x.prototype.forceUpdate=function(M){this.updater.enqueueForceUpdate(this,M,"forceUpdate")};function v(){}v.prototype=x.prototype;function k(M,H,le){this.props=M,this.context=H,this.refs=w,this.updater=le||g}var I=k.prototype=new v;I.constructor=k,y(I,x.prototype),I.isPureReactComponent=!0;var N=Array.isArray,T=Object.prototype.hasOwnProperty,D={current:null},P={key:!0,ref:!0,__self:!0,__source:!0};function z(M,H,le){var he,pe={},ge=null,Se=null;if(H!=null)for(he in H.ref!==void 0&&(Se=H.ref),H.key!==void 0&&(ge=""+H.key),H)T.call(H,he)&&!P.hasOwnProperty(he)&&(pe[he]=H[he]);var Ne=arguments.length-2;if(Ne===1)pe.children=le;else if(1<Ne){for(var Ie=Array(Ne),Be=0;Be<Ne;Be++)Ie[Be]=arguments[Be+2];pe.children=Ie}if(M&&M.defaultProps)for(he in Ne=M.defaultProps,Ne)pe[he]===void 0&&(pe[he]=Ne[he]);return{$$typeof:n,type:M,key:ge,ref:Se,props:pe,_owner:D.current}}function F(M,H){return{$$typeof:n,type:M.type,key:H,ref:M.ref,props:M.props,_owner:M._owner}}function L(M){return typeof M=="object"&&M!==null&&M.$$typeof===n}function E(M){var H={"=":"=0",":":"=2"};return"$"+M.replace(/[=:]/g,function(le){return H[le]})}var j=/\/+/g;function Z(M,H){return typeof M=="object"&&M!==null&&M.key!=null?E(""+M.key):H.toString(36)}function ne(M,H,le,he,pe){var ge=typeof M;(ge==="undefined"||ge==="boolean")&&(M=null);var Se=!1;if(M===null)Se=!0;else switch(ge){case"string":case"number":Se=!0;break;case"object":switch(M.$$typeof){case n:case e:Se=!0}}if(Se)return Se=M,pe=pe(Se),M=he===""?"."+Z(Se,0):he,N(pe)?(le="",M!=null&&(le=M.replace(j,"$&/")+"/"),ne(pe,H,le,"",function(Be){return Be})):pe!=null&&(L(pe)&&(pe=F(pe,le+(!pe.key||Se&&Se.key===pe.key?"":(""+pe.key).replace(j,"$&/")+"/")+M)),H.push(pe)),1;if(Se=0,he=he===""?".":he+":",N(M))for(var Ne=0;Ne<M.length;Ne++){ge=M[Ne];var Ie=he+Z(ge,Ne);Se+=ne(ge,H,le,Ie,pe)}else if(Ie=f(M),typeof Ie=="function")for(M=Ie.call(M),Ne=0;!(ge=M.next()).done;)ge=ge.value,Ie=he+Z(ge,Ne++),Se+=ne(ge,H,le,Ie,pe);else if(ge==="object")throw H=String(M),Error("Objects are not valid as a React child (found: "+(H==="[object Object]"?"object with keys {"+Object.keys(M).join(", ")+"}":H)+"). If you meant to render a collection of children, use an array instead.");return Se}function te(M,H,le){if(M==null)return M;var he=[],pe=0;return ne(M,he,"","",function(ge){return H.call(le,ge,pe++)}),he}function se(M){if(M._status===-1){var H=M._result;H=H(),H.then(function(le){(M._status===0||M._status===-1)&&(M._status=1,M._result=le)},function(le){(M._status===0||M._status===-1)&&(M._status=2,M._result=le)}),M._status===-1&&(M._status=0,M._result=H)}if(M._status===1)return M._result.default;throw M._result}var K={current:null},B={transition:null},J={ReactCurrentDispatcher:K,ReactCurrentBatchConfig:B,ReactCurrentOwner:D};function X(){throw Error("act(...) is not supported in production builds of React.")}return et.Children={map:te,forEach:function(M,H,le){te(M,function(){H.apply(this,arguments)},le)},count:function(M){var H=0;return te(M,function(){H++}),H},toArray:function(M){return te(M,function(H){return H})||[]},only:function(M){if(!L(M))throw Error("React.Children.only expected to receive a single React element child.");return M}},et.Component=x,et.Fragment=t,et.Profiler=r,et.PureComponent=k,et.StrictMode=s,et.Suspense=l,et.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=J,et.act=X,et.cloneElement=function(M,H,le){if(M==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+M+".");var he=y({},M.props),pe=M.key,ge=M.ref,Se=M._owner;if(H!=null){if(H.ref!==void 0&&(ge=H.ref,Se=D.current),H.key!==void 0&&(pe=""+H.key),M.type&&M.type.defaultProps)var Ne=M.type.defaultProps;for(Ie in H)T.call(H,Ie)&&!P.hasOwnProperty(Ie)&&(he[Ie]=H[Ie]===void 0&&Ne!==void 0?Ne[Ie]:H[Ie])}var Ie=arguments.length-2;if(Ie===1)he.children=le;else if(1<Ie){Ne=Array(Ie);for(var Be=0;Be<Ie;Be++)Ne[Be]=arguments[Be+2];he.children=Ne}return{$$typeof:n,type:M.type,key:pe,ref:ge,props:he,_owner:Se}},et.createContext=function(M){return M={$$typeof:a,_currentValue:M,_currentValue2:M,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},M.Provider={$$typeof:o,_context:M},M.Consumer=M},et.createElement=z,et.createFactory=function(M){var H=z.bind(null,M);return H.type=M,H},et.createRef=function(){return{current:null}},et.forwardRef=function(M){return{$$typeof:i,render:M}},et.isValidElement=L,et.lazy=function(M){return{$$typeof:h,_payload:{_status:-1,_result:M},_init:se}},et.memo=function(M,H){return{$$typeof:c,type:M,compare:H===void 0?null:H}},et.startTransition=function(M){var H=B.transition;B.transition={};try{M()}finally{B.transition=H}},et.unstable_act=X,et.useCallback=function(M,H){return K.current.useCallback(M,H)},et.useContext=function(M){return K.current.useContext(M)},et.useDebugValue=function(){},et.useDeferredValue=function(M){return K.current.useDeferredValue(M)},et.useEffect=function(M,H){return K.current.useEffect(M,H)},et.useId=function(){return K.current.useId()},et.useImperativeHandle=function(M,H,le){return K.current.useImperativeHandle(M,H,le)},et.useInsertionEffect=function(M,H){return K.current.useInsertionEffect(M,H)},et.useLayoutEffect=function(M,H){return K.current.useLayoutEffect(M,H)},et.useMemo=function(M,H){return K.current.useMemo(M,H)},et.useReducer=function(M,H,le){return K.current.useReducer(M,H,le)},et.useRef=function(M){return K.current.useRef(M)},et.useState=function(M){return K.current.useState(M)},et.useSyncExternalStore=function(M,H,le){return K.current.useSyncExternalStore(M,H,le)},et.useTransition=function(){return K.current.useTransition()},et.version="18.3.1",et}var FN;function ow(){return FN||(FN=1,Nx.exports=pF()),Nx.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LN;function fF(){if(LN)return Rc;LN=1;var n=ow(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,r=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function a(i,l,c){var h,p={},f=null,g=null;c!==void 0&&(f=""+c),l.key!==void 0&&(f=""+l.key),l.ref!==void 0&&(g=l.ref);for(h in l)s.call(l,h)&&!o.hasOwnProperty(h)&&(p[h]=l[h]);if(i&&i.defaultProps)for(h in l=i.defaultProps,l)p[h]===void 0&&(p[h]=l[h]);return{$$typeof:e,type:i,key:f,ref:g,props:p,_owner:r.current}}return Rc.Fragment=t,Rc.jsx=a,Rc.jsxs=a,Rc}var PN;function mF(){return PN||(PN=1,Sx.exports=fF()),Sx.exports}var O=mF(),ve=ow();const aw=rw(ve),gF=KI({__proto__:null,default:aw},[ve]);var uf={},Cx={exports:{}},hs={},Ix={exports:{}},$x={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zN;function yF(){return zN||(zN=1,function(n){function e(B,J){var X=B.length;B.push(J);e:for(;0<X;){var M=X-1>>>1,H=B[M];if(0<r(H,J))B[M]=J,B[X]=H,X=M;else break e}}function t(B){return B.length===0?null:B[0]}function s(B){if(B.length===0)return null;var J=B[0],X=B.pop();if(X!==J){B[0]=X;e:for(var M=0,H=B.length,le=H>>>1;M<le;){var he=2*(M+1)-1,pe=B[he],ge=he+1,Se=B[ge];if(0>r(pe,X))ge<H&&0>r(Se,pe)?(B[M]=Se,B[ge]=X,M=ge):(B[M]=pe,B[he]=X,M=he);else if(ge<H&&0>r(Se,X))B[M]=Se,B[ge]=X,M=ge;else break e}}return J}function r(B,J){var X=B.sortIndex-J.sortIndex;return X!==0?X:B.id-J.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var a=Date,i=a.now();n.unstable_now=function(){return a.now()-i}}var l=[],c=[],h=1,p=null,f=3,g=!1,y=!1,w=!1,x=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,k=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function I(B){for(var J=t(c);J!==null;){if(J.callback===null)s(c);else if(J.startTime<=B)s(c),J.sortIndex=J.expirationTime,e(l,J);else break;J=t(c)}}function N(B){if(w=!1,I(B),!y)if(t(l)!==null)y=!0,se(T);else{var J=t(c);J!==null&&K(N,J.startTime-B)}}function T(B,J){y=!1,w&&(w=!1,v(z),z=-1),g=!0;var X=f;try{for(I(J),p=t(l);p!==null&&(!(p.expirationTime>J)||B&&!E());){var M=p.callback;if(typeof M=="function"){p.callback=null,f=p.priorityLevel;var H=M(p.expirationTime<=J);J=n.unstable_now(),typeof H=="function"?p.callback=H:p===t(l)&&s(l),I(J)}else s(l);p=t(l)}if(p!==null)var le=!0;else{var he=t(c);he!==null&&K(N,he.startTime-J),le=!1}return le}finally{p=null,f=X,g=!1}}var D=!1,P=null,z=-1,F=5,L=-1;function E(){return!(n.unstable_now()-L<F)}function j(){if(P!==null){var B=n.unstable_now();L=B;var J=!0;try{J=P(!0,B)}finally{J?Z():(D=!1,P=null)}}else D=!1}var Z;if(typeof k=="function")Z=function(){k(j)};else if(typeof MessageChannel<"u"){var ne=new MessageChannel,te=ne.port2;ne.port1.onmessage=j,Z=function(){te.postMessage(null)}}else Z=function(){x(j,0)};function se(B){P=B,D||(D=!0,Z())}function K(B,J){z=x(function(){B(n.unstable_now())},J)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(B){B.callback=null},n.unstable_continueExecution=function(){y||g||(y=!0,se(T))},n.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<B?Math.floor(1e3/B):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(B){switch(f){case 1:case 2:case 3:var J=3;break;default:J=f}var X=f;f=J;try{return B()}finally{f=X}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(B,J){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var X=f;f=B;try{return J()}finally{f=X}},n.unstable_scheduleCallback=function(B,J,X){var M=n.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?M+X:M):X=M,B){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=X+H,B={id:h++,callback:J,priorityLevel:B,startTime:X,expirationTime:H,sortIndex:-1},X>M?(B.sortIndex=X,e(c,B),t(l)===null&&B===t(c)&&(w?(v(z),z=-1):w=!0,K(N,X-M))):(B.sortIndex=H,e(l,B),y||g||(y=!0,se(T))),B},n.unstable_shouldYield=E,n.unstable_wrapCallback=function(B){var J=f;return function(){var X=f;f=J;try{return B.apply(this,arguments)}finally{f=X}}}}($x)),$x}var MN;function xF(){return MN||(MN=1,Ix.exports=yF()),Ix.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BN;function bF(){if(BN)return hs;BN=1;var n=ow(),e=xF();function t(u){for(var d="https://reactjs.org/docs/error-decoder.html?invariant="+u,m=1;m<arguments.length;m++)d+="&args[]="+encodeURIComponent(arguments[m]);return"Minified React error #"+u+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,r={};function o(u,d){a(u,d),a(u+"Capture",d)}function a(u,d){for(r[u]=d,u=0;u<d.length;u++)s.add(d[u])}var i=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},p={};function f(u){return l.call(p,u)?!0:l.call(h,u)?!1:c.test(u)?p[u]=!0:(h[u]=!0,!1)}function g(u,d,m,b){if(m!==null&&m.type===0)return!1;switch(typeof d){case"function":case"symbol":return!0;case"boolean":return b?!1:m!==null?!m.acceptsBooleans:(u=u.toLowerCase().slice(0,5),u!=="data-"&&u!=="aria-");default:return!1}}function y(u,d,m,b){if(d===null||typeof d>"u"||g(u,d,m,b))return!0;if(b)return!1;if(m!==null)switch(m.type){case 3:return!d;case 4:return d===!1;case 5:return isNaN(d);case 6:return isNaN(d)||1>d}return!1}function w(u,d,m,b,S,C,R){this.acceptsBooleans=d===2||d===3||d===4,this.attributeName=b,this.attributeNamespace=S,this.mustUseProperty=m,this.propertyName=u,this.type=d,this.sanitizeURL=C,this.removeEmptyString=R}var x={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(u){x[u]=new w(u,0,!1,u,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(u){var d=u[0];x[d]=new w(d,1,!1,u[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(u){x[u]=new w(u,2,!1,u.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(u){x[u]=new w(u,2,!1,u,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(u){x[u]=new w(u,3,!1,u.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(u){x[u]=new w(u,3,!0,u,null,!1,!1)}),["capture","download"].forEach(function(u){x[u]=new w(u,4,!1,u,null,!1,!1)}),["cols","rows","size","span"].forEach(function(u){x[u]=new w(u,6,!1,u,null,!1,!1)}),["rowSpan","start"].forEach(function(u){x[u]=new w(u,5,!1,u.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function k(u){return u[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(u){var d=u.replace(v,k);x[d]=new w(d,1,!1,u,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(u){var d=u.replace(v,k);x[d]=new w(d,1,!1,u,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(u){var d=u.replace(v,k);x[d]=new w(d,1,!1,u,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(u){x[u]=new w(u,1,!1,u.toLowerCase(),null,!1,!1)}),x.xlinkHref=new w("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(u){x[u]=new w(u,1,!1,u.toLowerCase(),null,!0,!0)});function I(u,d,m,b){var S=x.hasOwnProperty(d)?x[d]:null;(S!==null?S.type!==0:b||!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(y(d,m,S,b)&&(m=null),b||S===null?f(d)&&(m===null?u.removeAttribute(d):u.setAttribute(d,""+m)):S.mustUseProperty?u[S.propertyName]=m===null?S.type===3?!1:"":m:(d=S.attributeName,b=S.attributeNamespace,m===null?u.removeAttribute(d):(S=S.type,m=S===3||S===4&&m===!0?"":""+m,b?u.setAttributeNS(b,d,m):u.setAttribute(d,m))))}var N=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,T=Symbol.for("react.element"),D=Symbol.for("react.portal"),P=Symbol.for("react.fragment"),z=Symbol.for("react.strict_mode"),F=Symbol.for("react.profiler"),L=Symbol.for("react.provider"),E=Symbol.for("react.context"),j=Symbol.for("react.forward_ref"),Z=Symbol.for("react.suspense"),ne=Symbol.for("react.suspense_list"),te=Symbol.for("react.memo"),se=Symbol.for("react.lazy"),K=Symbol.for("react.offscreen"),B=Symbol.iterator;function J(u){return u===null||typeof u!="object"?null:(u=B&&u[B]||u["@@iterator"],typeof u=="function"?u:null)}var X=Object.assign,M;function H(u){if(M===void 0)try{throw Error()}catch(m){var d=m.stack.trim().match(/\n( *(at )?)/);M=d&&d[1]||""}return`
`+M+u}var le=!1;function he(u,d){if(!u||le)return"";le=!0;var m=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(d)if(d=function(){throw Error()},Object.defineProperty(d.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(d,[])}catch(ue){var b=ue}Reflect.construct(u,[],d)}else{try{d.call()}catch(ue){b=ue}u.call(d.prototype)}else{try{throw Error()}catch(ue){b=ue}u()}}catch(ue){if(ue&&b&&typeof ue.stack=="string"){for(var S=ue.stack.split(`
`),C=b.stack.split(`
`),R=S.length-1,V=C.length-1;1<=R&&0<=V&&S[R]!==C[V];)V--;for(;1<=R&&0<=V;R--,V--)if(S[R]!==C[V]){if(R!==1||V!==1)do if(R--,V--,0>V||S[R]!==C[V]){var Y=`
`+S[R].replace(" at new "," at ");return u.displayName&&Y.includes("<anonymous>")&&(Y=Y.replace("<anonymous>",u.displayName)),Y}while(1<=R&&0<=V);break}}}finally{le=!1,Error.prepareStackTrace=m}return(u=u?u.displayName||u.name:"")?H(u):""}function pe(u){switch(u.tag){case 5:return H(u.type);case 16:return H("Lazy");case 13:return H("Suspense");case 19:return H("SuspenseList");case 0:case 2:case 15:return u=he(u.type,!1),u;case 11:return u=he(u.type.render,!1),u;case 1:return u=he(u.type,!0),u;default:return""}}function ge(u){if(u==null)return null;if(typeof u=="function")return u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case P:return"Fragment";case D:return"Portal";case F:return"Profiler";case z:return"StrictMode";case Z:return"Suspense";case ne:return"SuspenseList"}if(typeof u=="object")switch(u.$$typeof){case E:return(u.displayName||"Context")+".Consumer";case L:return(u._context.displayName||"Context")+".Provider";case j:var d=u.render;return u=u.displayName,u||(u=d.displayName||d.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case te:return d=u.displayName||null,d!==null?d:ge(u.type)||"Memo";case se:d=u._payload,u=u._init;try{return ge(u(d))}catch{}}return null}function Se(u){var d=u.type;switch(u.tag){case 24:return"Cache";case 9:return(d.displayName||"Context")+".Consumer";case 10:return(d._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return u=d.render,u=u.displayName||u.name||"",d.displayName||(u!==""?"ForwardRef("+u+")":"ForwardRef");case 7:return"Fragment";case 5:return d;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ge(d);case 8:return d===z?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d}return null}function Ne(u){switch(typeof u){case"boolean":case"number":case"string":case"undefined":return u;case"object":return u;default:return""}}function Ie(u){var d=u.type;return(u=u.nodeName)&&u.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function Be(u){var d=Ie(u)?"checked":"value",m=Object.getOwnPropertyDescriptor(u.constructor.prototype,d),b=""+u[d];if(!u.hasOwnProperty(d)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var S=m.get,C=m.set;return Object.defineProperty(u,d,{configurable:!0,get:function(){return S.call(this)},set:function(R){b=""+R,C.call(this,R)}}),Object.defineProperty(u,d,{enumerable:m.enumerable}),{getValue:function(){return b},setValue:function(R){b=""+R},stopTracking:function(){u._valueTracker=null,delete u[d]}}}}function Ge(u){u._valueTracker||(u._valueTracker=Be(u))}function at(u){if(!u)return!1;var d=u._valueTracker;if(!d)return!0;var m=d.getValue(),b="";return u&&(b=Ie(u)?u.checked?"true":"false":u.value),u=b,u!==m?(d.setValue(u),!0):!1}function lt(u){if(u=u||(typeof document<"u"?document:void 0),typeof u>"u")return null;try{return u.activeElement||u.body}catch{return u.body}}function vt(u,d){var m=d.checked;return X({},d,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:m??u._wrapperState.initialChecked})}function ht(u,d){var m=d.defaultValue==null?"":d.defaultValue,b=d.checked!=null?d.checked:d.defaultChecked;m=Ne(d.value!=null?d.value:m),u._wrapperState={initialChecked:b,initialValue:m,controlled:d.type==="checkbox"||d.type==="radio"?d.checked!=null:d.value!=null}}function ut(u,d){d=d.checked,d!=null&&I(u,"checked",d,!1)}function xt(u,d){ut(u,d);var m=Ne(d.value),b=d.type;if(m!=null)b==="number"?(m===0&&u.value===""||u.value!=m)&&(u.value=""+m):u.value!==""+m&&(u.value=""+m);else if(b==="submit"||b==="reset"){u.removeAttribute("value");return}d.hasOwnProperty("value")?ks(u,d.type,m):d.hasOwnProperty("defaultValue")&&ks(u,d.type,Ne(d.defaultValue)),d.checked==null&&d.defaultChecked!=null&&(u.defaultChecked=!!d.defaultChecked)}function bt(u,d,m){if(d.hasOwnProperty("value")||d.hasOwnProperty("defaultValue")){var b=d.type;if(!(b!=="submit"&&b!=="reset"||d.value!==void 0&&d.value!==null))return;d=""+u._wrapperState.initialValue,m||d===u.value||(u.value=d),u.defaultValue=d}m=u.name,m!==""&&(u.name=""),u.defaultChecked=!!u._wrapperState.initialChecked,m!==""&&(u.name=m)}function ks(u,d,m){(d!=="number"||lt(u.ownerDocument)!==u)&&(m==null?u.defaultValue=""+u._wrapperState.initialValue:u.defaultValue!==""+m&&(u.defaultValue=""+m))}var Rt=Array.isArray;function qn(u,d,m,b){if(u=u.options,d){d={};for(var S=0;S<m.length;S++)d["$"+m[S]]=!0;for(m=0;m<u.length;m++)S=d.hasOwnProperty("$"+u[m].value),u[m].selected!==S&&(u[m].selected=S),S&&b&&(u[m].defaultSelected=!0)}else{for(m=""+Ne(m),d=null,S=0;S<u.length;S++){if(u[S].value===m){u[S].selected=!0,b&&(u[S].defaultSelected=!0);return}d!==null||u[S].disabled||(d=u[S])}d!==null&&(d.selected=!0)}}function Tn(u,d){if(d.dangerouslySetInnerHTML!=null)throw Error(t(91));return X({},d,{value:void 0,defaultValue:void 0,children:""+u._wrapperState.initialValue})}function $r(u,d){var m=d.value;if(m==null){if(m=d.children,d=d.defaultValue,m!=null){if(d!=null)throw Error(t(92));if(Rt(m)){if(1<m.length)throw Error(t(93));m=m[0]}d=m}d==null&&(d=""),m=d}u._wrapperState={initialValue:Ne(m)}}function as(u,d){var m=Ne(d.value),b=Ne(d.defaultValue);m!=null&&(m=""+m,m!==u.value&&(u.value=m),d.defaultValue==null&&u.defaultValue!==m&&(u.defaultValue=m)),b!=null&&(u.defaultValue=""+b)}function Ps(u){var d=u.textContent;d===u._wrapperState.initialValue&&d!==""&&d!==null&&(u.value=d)}function sr(u){switch(u){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function zs(u,d){return u==null||u==="http://www.w3.org/1999/xhtml"?sr(d):u==="http://www.w3.org/2000/svg"&&d==="foreignObject"?"http://www.w3.org/1999/xhtml":u}var Ss,Eo=function(u){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(d,m,b,S){MSApp.execUnsafeLocalFunction(function(){return u(d,m,b,S)})}:u}(function(u,d){if(u.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in u)u.innerHTML=d;else{for(Ss=Ss||document.createElement("div"),Ss.innerHTML="<svg>"+d.valueOf().toString()+"</svg>",d=Ss.firstChild;u.firstChild;)u.removeChild(u.firstChild);for(;d.firstChild;)u.appendChild(d.firstChild)}});function Qr(u,d){if(d){var m=u.firstChild;if(m&&m===u.lastChild&&m.nodeType===3){m.nodeValue=d;return}}u.textContent=d}var Zr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},_y=["Webkit","ms","Moz","O"];Object.keys(Zr).forEach(function(u){_y.forEach(function(d){d=d+u.charAt(0).toUpperCase()+u.substring(1),Zr[d]=Zr[u]})});function Ta(u,d,m){return d==null||typeof d=="boolean"||d===""?"":m||typeof d!="number"||d===0||Zr.hasOwnProperty(u)&&Zr[u]?(""+d).trim():d+"px"}function ep(u,d){u=u.style;for(var m in d)if(d.hasOwnProperty(m)){var b=m.indexOf("--")===0,S=Ta(m,d[m],b);m==="float"&&(m="cssFloat"),b?u.setProperty(m,S):u[m]=S}}var Oy=X({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Fy(u,d){if(d){if(Oy[u]&&(d.children!=null||d.dangerouslySetInnerHTML!=null))throw Error(t(137,u));if(d.dangerouslySetInnerHTML!=null){if(d.children!=null)throw Error(t(60));if(typeof d.dangerouslySetInnerHTML!="object"||!("__html"in d.dangerouslySetInnerHTML))throw Error(t(61))}if(d.style!=null&&typeof d.style!="object")throw Error(t(62))}}function Ly(u,d){if(u.indexOf("-")===-1)return typeof d.is=="string";switch(u){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Py=null;function zy(u){return u=u.target||u.srcElement||window,u.correspondingUseElement&&(u=u.correspondingUseElement),u.nodeType===3?u.parentNode:u}var My=null,zi=null,Mi=null;function Qv(u){if(u=mc(u)){if(typeof My!="function")throw Error(t(280));var d=u.stateNode;d&&(d=Sp(d),My(u.stateNode,u.type,d))}}function Zv(u){zi?Mi?Mi.push(u):Mi=[u]:zi=u}function Jv(){if(zi){var u=zi,d=Mi;if(Mi=zi=null,Qv(u),d)for(u=0;u<d.length;u++)Qv(d[u])}}function ek(u,d){return u(d)}function tk(){}var By=!1;function nk(u,d,m){if(By)return u(d,m);By=!0;try{return ek(u,d,m)}finally{By=!1,(zi!==null||Mi!==null)&&(tk(),Jv())}}function Ku(u,d){var m=u.stateNode;if(m===null)return null;var b=Sp(m);if(b===null)return null;m=b[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(b=!b.disabled)||(u=u.type,b=!(u==="button"||u==="input"||u==="select"||u==="textarea")),u=!b;break e;default:u=!1}if(u)return null;if(m&&typeof m!="function")throw Error(t(231,d,typeof m));return m}var Vy=!1;if(i)try{var Xu={};Object.defineProperty(Xu,"passive",{get:function(){Vy=!0}}),window.addEventListener("test",Xu,Xu),window.removeEventListener("test",Xu,Xu)}catch{Vy=!1}function x_(u,d,m,b,S,C,R,V,Y){var ue=Array.prototype.slice.call(arguments,3);try{d.apply(m,ue)}catch(xe){this.onError(xe)}}var Yu=!1,tp=null,np=!1,Wy=null,b_={onError:function(u){Yu=!0,tp=u}};function w_(u,d,m,b,S,C,R,V,Y){Yu=!1,tp=null,x_.apply(b_,arguments)}function v_(u,d,m,b,S,C,R,V,Y){if(w_.apply(this,arguments),Yu){if(Yu){var ue=tp;Yu=!1,tp=null}else throw Error(t(198));np||(np=!0,Wy=ue)}}function Ea(u){var d=u,m=u;if(u.alternate)for(;d.return;)d=d.return;else{u=d;do d=u,(d.flags&4098)!==0&&(m=d.return),u=d.return;while(u)}return d.tag===3?m:null}function sk(u){if(u.tag===13){var d=u.memoizedState;if(d===null&&(u=u.alternate,u!==null&&(d=u.memoizedState)),d!==null)return d.dehydrated}return null}function rk(u){if(Ea(u)!==u)throw Error(t(188))}function k_(u){var d=u.alternate;if(!d){if(d=Ea(u),d===null)throw Error(t(188));return d!==u?null:u}for(var m=u,b=d;;){var S=m.return;if(S===null)break;var C=S.alternate;if(C===null){if(b=S.return,b!==null){m=b;continue}break}if(S.child===C.child){for(C=S.child;C;){if(C===m)return rk(S),u;if(C===b)return rk(S),d;C=C.sibling}throw Error(t(188))}if(m.return!==b.return)m=S,b=C;else{for(var R=!1,V=S.child;V;){if(V===m){R=!0,m=S,b=C;break}if(V===b){R=!0,b=S,m=C;break}V=V.sibling}if(!R){for(V=C.child;V;){if(V===m){R=!0,m=C,b=S;break}if(V===b){R=!0,b=C,m=S;break}V=V.sibling}if(!R)throw Error(t(189))}}if(m.alternate!==b)throw Error(t(190))}if(m.tag!==3)throw Error(t(188));return m.stateNode.current===m?u:d}function ok(u){return u=k_(u),u!==null?ak(u):null}function ak(u){if(u.tag===5||u.tag===6)return u;for(u=u.child;u!==null;){var d=ak(u);if(d!==null)return d;u=u.sibling}return null}var ik=e.unstable_scheduleCallback,lk=e.unstable_cancelCallback,S_=e.unstable_shouldYield,N_=e.unstable_requestPaint,qt=e.unstable_now,C_=e.unstable_getCurrentPriorityLevel,Uy=e.unstable_ImmediatePriority,uk=e.unstable_UserBlockingPriority,sp=e.unstable_NormalPriority,I_=e.unstable_LowPriority,ck=e.unstable_IdlePriority,rp=null,Tr=null;function $_(u){if(Tr&&typeof Tr.onCommitFiberRoot=="function")try{Tr.onCommitFiberRoot(rp,u,void 0,(u.current.flags&128)===128)}catch{}}var rr=Math.clz32?Math.clz32:R_,T_=Math.log,E_=Math.LN2;function R_(u){return u>>>=0,u===0?32:31-(T_(u)/E_|0)|0}var op=64,ap=4194304;function Qu(u){switch(u&-u){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return u&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return u}}function ip(u,d){var m=u.pendingLanes;if(m===0)return 0;var b=0,S=u.suspendedLanes,C=u.pingedLanes,R=m&268435455;if(R!==0){var V=R&~S;V!==0?b=Qu(V):(C&=R,C!==0&&(b=Qu(C)))}else R=m&~S,R!==0?b=Qu(R):C!==0&&(b=Qu(C));if(b===0)return 0;if(d!==0&&d!==b&&(d&S)===0&&(S=b&-b,C=d&-d,S>=C||S===16&&(C&4194240)!==0))return d;if((b&4)!==0&&(b|=m&16),d=u.entangledLanes,d!==0)for(u=u.entanglements,d&=b;0<d;)m=31-rr(d),S=1<<m,b|=u[m],d&=~S;return b}function A_(u,d){switch(u){case 1:case 2:case 4:return d+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function D_(u,d){for(var m=u.suspendedLanes,b=u.pingedLanes,S=u.expirationTimes,C=u.pendingLanes;0<C;){var R=31-rr(C),V=1<<R,Y=S[R];Y===-1?((V&m)===0||(V&b)!==0)&&(S[R]=A_(V,d)):Y<=d&&(u.expiredLanes|=V),C&=~V}}function jy(u){return u=u.pendingLanes&-1073741825,u!==0?u:u&1073741824?1073741824:0}function dk(){var u=op;return op<<=1,(op&4194240)===0&&(op=64),u}function Gy(u){for(var d=[],m=0;31>m;m++)d.push(u);return d}function Zu(u,d,m){u.pendingLanes|=d,d!==536870912&&(u.suspendedLanes=0,u.pingedLanes=0),u=u.eventTimes,d=31-rr(d),u[d]=m}function __(u,d){var m=u.pendingLanes&~d;u.pendingLanes=d,u.suspendedLanes=0,u.pingedLanes=0,u.expiredLanes&=d,u.mutableReadLanes&=d,u.entangledLanes&=d,d=u.entanglements;var b=u.eventTimes;for(u=u.expirationTimes;0<m;){var S=31-rr(m),C=1<<S;d[S]=0,b[S]=-1,u[S]=-1,m&=~C}}function Hy(u,d){var m=u.entangledLanes|=d;for(u=u.entanglements;m;){var b=31-rr(m),S=1<<b;S&d|u[b]&d&&(u[b]|=d),m&=~S}}var mt=0;function hk(u){return u&=-u,1<u?4<u?(u&268435455)!==0?16:536870912:4:1}var pk,qy,fk,mk,gk,Ky=!1,lp=[],Ro=null,Ao=null,Do=null,Ju=new Map,ec=new Map,_o=[],O_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function yk(u,d){switch(u){case"focusin":case"focusout":Ro=null;break;case"dragenter":case"dragleave":Ao=null;break;case"mouseover":case"mouseout":Do=null;break;case"pointerover":case"pointerout":Ju.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":ec.delete(d.pointerId)}}function tc(u,d,m,b,S,C){return u===null||u.nativeEvent!==C?(u={blockedOn:d,domEventName:m,eventSystemFlags:b,nativeEvent:C,targetContainers:[S]},d!==null&&(d=mc(d),d!==null&&qy(d)),u):(u.eventSystemFlags|=b,d=u.targetContainers,S!==null&&d.indexOf(S)===-1&&d.push(S),u)}function F_(u,d,m,b,S){switch(d){case"focusin":return Ro=tc(Ro,u,d,m,b,S),!0;case"dragenter":return Ao=tc(Ao,u,d,m,b,S),!0;case"mouseover":return Do=tc(Do,u,d,m,b,S),!0;case"pointerover":var C=S.pointerId;return Ju.set(C,tc(Ju.get(C)||null,u,d,m,b,S)),!0;case"gotpointercapture":return C=S.pointerId,ec.set(C,tc(ec.get(C)||null,u,d,m,b,S)),!0}return!1}function xk(u){var d=Ra(u.target);if(d!==null){var m=Ea(d);if(m!==null){if(d=m.tag,d===13){if(d=sk(m),d!==null){u.blockedOn=d,gk(u.priority,function(){fk(m)});return}}else if(d===3&&m.stateNode.current.memoizedState.isDehydrated){u.blockedOn=m.tag===3?m.stateNode.containerInfo:null;return}}}u.blockedOn=null}function up(u){if(u.blockedOn!==null)return!1;for(var d=u.targetContainers;0<d.length;){var m=Yy(u.domEventName,u.eventSystemFlags,d[0],u.nativeEvent);if(m===null){m=u.nativeEvent;var b=new m.constructor(m.type,m);Py=b,m.target.dispatchEvent(b),Py=null}else return d=mc(m),d!==null&&qy(d),u.blockedOn=m,!1;d.shift()}return!0}function bk(u,d,m){up(u)&&m.delete(d)}function L_(){Ky=!1,Ro!==null&&up(Ro)&&(Ro=null),Ao!==null&&up(Ao)&&(Ao=null),Do!==null&&up(Do)&&(Do=null),Ju.forEach(bk),ec.forEach(bk)}function nc(u,d){u.blockedOn===d&&(u.blockedOn=null,Ky||(Ky=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,L_)))}function sc(u){function d(S){return nc(S,u)}if(0<lp.length){nc(lp[0],u);for(var m=1;m<lp.length;m++){var b=lp[m];b.blockedOn===u&&(b.blockedOn=null)}}for(Ro!==null&&nc(Ro,u),Ao!==null&&nc(Ao,u),Do!==null&&nc(Do,u),Ju.forEach(d),ec.forEach(d),m=0;m<_o.length;m++)b=_o[m],b.blockedOn===u&&(b.blockedOn=null);for(;0<_o.length&&(m=_o[0],m.blockedOn===null);)xk(m),m.blockedOn===null&&_o.shift()}var Bi=N.ReactCurrentBatchConfig,cp=!0;function P_(u,d,m,b){var S=mt,C=Bi.transition;Bi.transition=null;try{mt=1,Xy(u,d,m,b)}finally{mt=S,Bi.transition=C}}function z_(u,d,m,b){var S=mt,C=Bi.transition;Bi.transition=null;try{mt=4,Xy(u,d,m,b)}finally{mt=S,Bi.transition=C}}function Xy(u,d,m,b){if(cp){var S=Yy(u,d,m,b);if(S===null)p0(u,d,b,dp,m),yk(u,b);else if(F_(S,u,d,m,b))b.stopPropagation();else if(yk(u,b),d&4&&-1<O_.indexOf(u)){for(;S!==null;){var C=mc(S);if(C!==null&&pk(C),C=Yy(u,d,m,b),C===null&&p0(u,d,b,dp,m),C===S)break;S=C}S!==null&&b.stopPropagation()}else p0(u,d,b,null,m)}}var dp=null;function Yy(u,d,m,b){if(dp=null,u=zy(b),u=Ra(u),u!==null)if(d=Ea(u),d===null)u=null;else if(m=d.tag,m===13){if(u=sk(d),u!==null)return u;u=null}else if(m===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;u=null}else d!==u&&(u=null);return dp=u,null}function wk(u){switch(u){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(C_()){case Uy:return 1;case uk:return 4;case sp:case I_:return 16;case ck:return 536870912;default:return 16}default:return 16}}var Oo=null,Qy=null,hp=null;function vk(){if(hp)return hp;var u,d=Qy,m=d.length,b,S="value"in Oo?Oo.value:Oo.textContent,C=S.length;for(u=0;u<m&&d[u]===S[u];u++);var R=m-u;for(b=1;b<=R&&d[m-b]===S[C-b];b++);return hp=S.slice(u,1<b?1-b:void 0)}function pp(u){var d=u.keyCode;return"charCode"in u?(u=u.charCode,u===0&&d===13&&(u=13)):u=d,u===10&&(u=13),32<=u||u===13?u:0}function fp(){return!0}function kk(){return!1}function Ns(u){function d(m,b,S,C,R){this._reactName=m,this._targetInst=S,this.type=b,this.nativeEvent=C,this.target=R,this.currentTarget=null;for(var V in u)u.hasOwnProperty(V)&&(m=u[V],this[V]=m?m(C):C[V]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?fp:kk,this.isPropagationStopped=kk,this}return X(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var m=this.nativeEvent;m&&(m.preventDefault?m.preventDefault():typeof m.returnValue!="unknown"&&(m.returnValue=!1),this.isDefaultPrevented=fp)},stopPropagation:function(){var m=this.nativeEvent;m&&(m.stopPropagation?m.stopPropagation():typeof m.cancelBubble!="unknown"&&(m.cancelBubble=!0),this.isPropagationStopped=fp)},persist:function(){},isPersistent:fp}),d}var Vi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(u){return u.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zy=Ns(Vi),rc=X({},Vi,{view:0,detail:0}),M_=Ns(rc),Jy,e0,oc,mp=X({},rc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:n0,button:0,buttons:0,relatedTarget:function(u){return u.relatedTarget===void 0?u.fromElement===u.srcElement?u.toElement:u.fromElement:u.relatedTarget},movementX:function(u){return"movementX"in u?u.movementX:(u!==oc&&(oc&&u.type==="mousemove"?(Jy=u.screenX-oc.screenX,e0=u.screenY-oc.screenY):e0=Jy=0,oc=u),Jy)},movementY:function(u){return"movementY"in u?u.movementY:e0}}),Sk=Ns(mp),B_=X({},mp,{dataTransfer:0}),V_=Ns(B_),W_=X({},rc,{relatedTarget:0}),t0=Ns(W_),U_=X({},Vi,{animationName:0,elapsedTime:0,pseudoElement:0}),j_=Ns(U_),G_=X({},Vi,{clipboardData:function(u){return"clipboardData"in u?u.clipboardData:window.clipboardData}}),H_=Ns(G_),q_=X({},Vi,{data:0}),Nk=Ns(q_),K_={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},X_={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Y_={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Q_(u){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(u):(u=Y_[u])?!!d[u]:!1}function n0(){return Q_}var Z_=X({},rc,{key:function(u){if(u.key){var d=K_[u.key]||u.key;if(d!=="Unidentified")return d}return u.type==="keypress"?(u=pp(u),u===13?"Enter":String.fromCharCode(u)):u.type==="keydown"||u.type==="keyup"?X_[u.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:n0,charCode:function(u){return u.type==="keypress"?pp(u):0},keyCode:function(u){return u.type==="keydown"||u.type==="keyup"?u.keyCode:0},which:function(u){return u.type==="keypress"?pp(u):u.type==="keydown"||u.type==="keyup"?u.keyCode:0}}),J_=Ns(Z_),eO=X({},mp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ck=Ns(eO),tO=X({},rc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:n0}),nO=Ns(tO),sO=X({},Vi,{propertyName:0,elapsedTime:0,pseudoElement:0}),rO=Ns(sO),oO=X({},mp,{deltaX:function(u){return"deltaX"in u?u.deltaX:"wheelDeltaX"in u?-u.wheelDeltaX:0},deltaY:function(u){return"deltaY"in u?u.deltaY:"wheelDeltaY"in u?-u.wheelDeltaY:"wheelDelta"in u?-u.wheelDelta:0},deltaZ:0,deltaMode:0}),aO=Ns(oO),iO=[9,13,27,32],s0=i&&"CompositionEvent"in window,ac=null;i&&"documentMode"in document&&(ac=document.documentMode);var lO=i&&"TextEvent"in window&&!ac,Ik=i&&(!s0||ac&&8<ac&&11>=ac),$k=" ",Tk=!1;function Ek(u,d){switch(u){case"keyup":return iO.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Rk(u){return u=u.detail,typeof u=="object"&&"data"in u?u.data:null}var Wi=!1;function uO(u,d){switch(u){case"compositionend":return Rk(d);case"keypress":return d.which!==32?null:(Tk=!0,$k);case"textInput":return u=d.data,u===$k&&Tk?null:u;default:return null}}function cO(u,d){if(Wi)return u==="compositionend"||!s0&&Ek(u,d)?(u=vk(),hp=Qy=Oo=null,Wi=!1,u):null;switch(u){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return Ik&&d.locale!=="ko"?null:d.data;default:return null}}var dO={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ak(u){var d=u&&u.nodeName&&u.nodeName.toLowerCase();return d==="input"?!!dO[u.type]:d==="textarea"}function Dk(u,d,m,b){Zv(b),d=wp(d,"onChange"),0<d.length&&(m=new Zy("onChange","change",null,m,b),u.push({event:m,listeners:d}))}var ic=null,lc=null;function hO(u){Yk(u,0)}function gp(u){var d=qi(u);if(at(d))return u}function pO(u,d){if(u==="change")return d}var _k=!1;if(i){var r0;if(i){var o0="oninput"in document;if(!o0){var Ok=document.createElement("div");Ok.setAttribute("oninput","return;"),o0=typeof Ok.oninput=="function"}r0=o0}else r0=!1;_k=r0&&(!document.documentMode||9<document.documentMode)}function Fk(){ic&&(ic.detachEvent("onpropertychange",Lk),lc=ic=null)}function Lk(u){if(u.propertyName==="value"&&gp(lc)){var d=[];Dk(d,lc,u,zy(u)),nk(hO,d)}}function fO(u,d,m){u==="focusin"?(Fk(),ic=d,lc=m,ic.attachEvent("onpropertychange",Lk)):u==="focusout"&&Fk()}function mO(u){if(u==="selectionchange"||u==="keyup"||u==="keydown")return gp(lc)}function gO(u,d){if(u==="click")return gp(d)}function yO(u,d){if(u==="input"||u==="change")return gp(d)}function xO(u,d){return u===d&&(u!==0||1/u===1/d)||u!==u&&d!==d}var or=typeof Object.is=="function"?Object.is:xO;function uc(u,d){if(or(u,d))return!0;if(typeof u!="object"||u===null||typeof d!="object"||d===null)return!1;var m=Object.keys(u),b=Object.keys(d);if(m.length!==b.length)return!1;for(b=0;b<m.length;b++){var S=m[b];if(!l.call(d,S)||!or(u[S],d[S]))return!1}return!0}function Pk(u){for(;u&&u.firstChild;)u=u.firstChild;return u}function zk(u,d){var m=Pk(u);u=0;for(var b;m;){if(m.nodeType===3){if(b=u+m.textContent.length,u<=d&&b>=d)return{node:m,offset:d-u};u=b}e:{for(;m;){if(m.nextSibling){m=m.nextSibling;break e}m=m.parentNode}m=void 0}m=Pk(m)}}function Mk(u,d){return u&&d?u===d?!0:u&&u.nodeType===3?!1:d&&d.nodeType===3?Mk(u,d.parentNode):"contains"in u?u.contains(d):u.compareDocumentPosition?!!(u.compareDocumentPosition(d)&16):!1:!1}function Bk(){for(var u=window,d=lt();d instanceof u.HTMLIFrameElement;){try{var m=typeof d.contentWindow.location.href=="string"}catch{m=!1}if(m)u=d.contentWindow;else break;d=lt(u.document)}return d}function a0(u){var d=u&&u.nodeName&&u.nodeName.toLowerCase();return d&&(d==="input"&&(u.type==="text"||u.type==="search"||u.type==="tel"||u.type==="url"||u.type==="password")||d==="textarea"||u.contentEditable==="true")}function bO(u){var d=Bk(),m=u.focusedElem,b=u.selectionRange;if(d!==m&&m&&m.ownerDocument&&Mk(m.ownerDocument.documentElement,m)){if(b!==null&&a0(m)){if(d=b.start,u=b.end,u===void 0&&(u=d),"selectionStart"in m)m.selectionStart=d,m.selectionEnd=Math.min(u,m.value.length);else if(u=(d=m.ownerDocument||document)&&d.defaultView||window,u.getSelection){u=u.getSelection();var S=m.textContent.length,C=Math.min(b.start,S);b=b.end===void 0?C:Math.min(b.end,S),!u.extend&&C>b&&(S=b,b=C,C=S),S=zk(m,C);var R=zk(m,b);S&&R&&(u.rangeCount!==1||u.anchorNode!==S.node||u.anchorOffset!==S.offset||u.focusNode!==R.node||u.focusOffset!==R.offset)&&(d=d.createRange(),d.setStart(S.node,S.offset),u.removeAllRanges(),C>b?(u.addRange(d),u.extend(R.node,R.offset)):(d.setEnd(R.node,R.offset),u.addRange(d)))}}for(d=[],u=m;u=u.parentNode;)u.nodeType===1&&d.push({element:u,left:u.scrollLeft,top:u.scrollTop});for(typeof m.focus=="function"&&m.focus(),m=0;m<d.length;m++)u=d[m],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}}var wO=i&&"documentMode"in document&&11>=document.documentMode,Ui=null,i0=null,cc=null,l0=!1;function Vk(u,d,m){var b=m.window===m?m.document:m.nodeType===9?m:m.ownerDocument;l0||Ui==null||Ui!==lt(b)||(b=Ui,"selectionStart"in b&&a0(b)?b={start:b.selectionStart,end:b.selectionEnd}:(b=(b.ownerDocument&&b.ownerDocument.defaultView||window).getSelection(),b={anchorNode:b.anchorNode,anchorOffset:b.anchorOffset,focusNode:b.focusNode,focusOffset:b.focusOffset}),cc&&uc(cc,b)||(cc=b,b=wp(i0,"onSelect"),0<b.length&&(d=new Zy("onSelect","select",null,d,m),u.push({event:d,listeners:b}),d.target=Ui)))}function yp(u,d){var m={};return m[u.toLowerCase()]=d.toLowerCase(),m["Webkit"+u]="webkit"+d,m["Moz"+u]="moz"+d,m}var ji={animationend:yp("Animation","AnimationEnd"),animationiteration:yp("Animation","AnimationIteration"),animationstart:yp("Animation","AnimationStart"),transitionend:yp("Transition","TransitionEnd")},u0={},Wk={};i&&(Wk=document.createElement("div").style,"AnimationEvent"in window||(delete ji.animationend.animation,delete ji.animationiteration.animation,delete ji.animationstart.animation),"TransitionEvent"in window||delete ji.transitionend.transition);function xp(u){if(u0[u])return u0[u];if(!ji[u])return u;var d=ji[u],m;for(m in d)if(d.hasOwnProperty(m)&&m in Wk)return u0[u]=d[m];return u}var Uk=xp("animationend"),jk=xp("animationiteration"),Gk=xp("animationstart"),Hk=xp("transitionend"),qk=new Map,Kk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fo(u,d){qk.set(u,d),o(d,[u])}for(var c0=0;c0<Kk.length;c0++){var d0=Kk[c0],vO=d0.toLowerCase(),kO=d0[0].toUpperCase()+d0.slice(1);Fo(vO,"on"+kO)}Fo(Uk,"onAnimationEnd"),Fo(jk,"onAnimationIteration"),Fo(Gk,"onAnimationStart"),Fo("dblclick","onDoubleClick"),Fo("focusin","onFocus"),Fo("focusout","onBlur"),Fo(Hk,"onTransitionEnd"),a("onMouseEnter",["mouseout","mouseover"]),a("onMouseLeave",["mouseout","mouseover"]),a("onPointerEnter",["pointerout","pointerover"]),a("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var dc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),SO=new Set("cancel close invalid load scroll toggle".split(" ").concat(dc));function Xk(u,d,m){var b=u.type||"unknown-event";u.currentTarget=m,v_(b,d,void 0,u),u.currentTarget=null}function Yk(u,d){d=(d&4)!==0;for(var m=0;m<u.length;m++){var b=u[m],S=b.event;b=b.listeners;e:{var C=void 0;if(d)for(var R=b.length-1;0<=R;R--){var V=b[R],Y=V.instance,ue=V.currentTarget;if(V=V.listener,Y!==C&&S.isPropagationStopped())break e;Xk(S,V,ue),C=Y}else for(R=0;R<b.length;R++){if(V=b[R],Y=V.instance,ue=V.currentTarget,V=V.listener,Y!==C&&S.isPropagationStopped())break e;Xk(S,V,ue),C=Y}}}if(np)throw u=Wy,np=!1,Wy=null,u}function It(u,d){var m=d[b0];m===void 0&&(m=d[b0]=new Set);var b=u+"__bubble";m.has(b)||(Qk(d,u,2,!1),m.add(b))}function h0(u,d,m){var b=0;d&&(b|=4),Qk(m,u,b,d)}var bp="_reactListening"+Math.random().toString(36).slice(2);function hc(u){if(!u[bp]){u[bp]=!0,s.forEach(function(m){m!=="selectionchange"&&(SO.has(m)||h0(m,!1,u),h0(m,!0,u))});var d=u.nodeType===9?u:u.ownerDocument;d===null||d[bp]||(d[bp]=!0,h0("selectionchange",!1,d))}}function Qk(u,d,m,b){switch(wk(d)){case 1:var S=P_;break;case 4:S=z_;break;default:S=Xy}m=S.bind(null,d,m,u),S=void 0,!Vy||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(S=!0),b?S!==void 0?u.addEventListener(d,m,{capture:!0,passive:S}):u.addEventListener(d,m,!0):S!==void 0?u.addEventListener(d,m,{passive:S}):u.addEventListener(d,m,!1)}function p0(u,d,m,b,S){var C=b;if((d&1)===0&&(d&2)===0&&b!==null)e:for(;;){if(b===null)return;var R=b.tag;if(R===3||R===4){var V=b.stateNode.containerInfo;if(V===S||V.nodeType===8&&V.parentNode===S)break;if(R===4)for(R=b.return;R!==null;){var Y=R.tag;if((Y===3||Y===4)&&(Y=R.stateNode.containerInfo,Y===S||Y.nodeType===8&&Y.parentNode===S))return;R=R.return}for(;V!==null;){if(R=Ra(V),R===null)return;if(Y=R.tag,Y===5||Y===6){b=C=R;continue e}V=V.parentNode}}b=b.return}nk(function(){var ue=C,xe=zy(m),be=[];e:{var ye=qk.get(u);if(ye!==void 0){var Ee=Zy,_e=u;switch(u){case"keypress":if(pp(m)===0)break e;case"keydown":case"keyup":Ee=J_;break;case"focusin":_e="focus",Ee=t0;break;case"focusout":_e="blur",Ee=t0;break;case"beforeblur":case"afterblur":Ee=t0;break;case"click":if(m.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ee=Sk;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ee=V_;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ee=nO;break;case Uk:case jk:case Gk:Ee=j_;break;case Hk:Ee=rO;break;case"scroll":Ee=M_;break;case"wheel":Ee=aO;break;case"copy":case"cut":case"paste":Ee=H_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ee=Ck}var Le=(d&4)!==0,Kt=!Le&&u==="scroll",ae=Le?ye!==null?ye+"Capture":null:ye;Le=[];for(var ee=ue,ie;ee!==null;){ie=ee;var we=ie.stateNode;if(ie.tag===5&&we!==null&&(ie=we,ae!==null&&(we=Ku(ee,ae),we!=null&&Le.push(pc(ee,we,ie)))),Kt)break;ee=ee.return}0<Le.length&&(ye=new Ee(ye,_e,null,m,xe),be.push({event:ye,listeners:Le}))}}if((d&7)===0){e:{if(ye=u==="mouseover"||u==="pointerover",Ee=u==="mouseout"||u==="pointerout",ye&&m!==Py&&(_e=m.relatedTarget||m.fromElement)&&(Ra(_e)||_e[Jr]))break e;if((Ee||ye)&&(ye=xe.window===xe?xe:(ye=xe.ownerDocument)?ye.defaultView||ye.parentWindow:window,Ee?(_e=m.relatedTarget||m.toElement,Ee=ue,_e=_e?Ra(_e):null,_e!==null&&(Kt=Ea(_e),_e!==Kt||_e.tag!==5&&_e.tag!==6)&&(_e=null)):(Ee=null,_e=ue),Ee!==_e)){if(Le=Sk,we="onMouseLeave",ae="onMouseEnter",ee="mouse",(u==="pointerout"||u==="pointerover")&&(Le=Ck,we="onPointerLeave",ae="onPointerEnter",ee="pointer"),Kt=Ee==null?ye:qi(Ee),ie=_e==null?ye:qi(_e),ye=new Le(we,ee+"leave",Ee,m,xe),ye.target=Kt,ye.relatedTarget=ie,we=null,Ra(xe)===ue&&(Le=new Le(ae,ee+"enter",_e,m,xe),Le.target=ie,Le.relatedTarget=Kt,we=Le),Kt=we,Ee&&_e)t:{for(Le=Ee,ae=_e,ee=0,ie=Le;ie;ie=Gi(ie))ee++;for(ie=0,we=ae;we;we=Gi(we))ie++;for(;0<ee-ie;)Le=Gi(Le),ee--;for(;0<ie-ee;)ae=Gi(ae),ie--;for(;ee--;){if(Le===ae||ae!==null&&Le===ae.alternate)break t;Le=Gi(Le),ae=Gi(ae)}Le=null}else Le=null;Ee!==null&&Zk(be,ye,Ee,Le,!1),_e!==null&&Kt!==null&&Zk(be,Kt,_e,Le,!0)}}e:{if(ye=ue?qi(ue):window,Ee=ye.nodeName&&ye.nodeName.toLowerCase(),Ee==="select"||Ee==="input"&&ye.type==="file")var Pe=pO;else if(Ak(ye))if(_k)Pe=yO;else{Pe=mO;var Ve=fO}else(Ee=ye.nodeName)&&Ee.toLowerCase()==="input"&&(ye.type==="checkbox"||ye.type==="radio")&&(Pe=gO);if(Pe&&(Pe=Pe(u,ue))){Dk(be,Pe,m,xe);break e}Ve&&Ve(u,ye,ue),u==="focusout"&&(Ve=ye._wrapperState)&&Ve.controlled&&ye.type==="number"&&ks(ye,"number",ye.value)}switch(Ve=ue?qi(ue):window,u){case"focusin":(Ak(Ve)||Ve.contentEditable==="true")&&(Ui=Ve,i0=ue,cc=null);break;case"focusout":cc=i0=Ui=null;break;case"mousedown":l0=!0;break;case"contextmenu":case"mouseup":case"dragend":l0=!1,Vk(be,m,xe);break;case"selectionchange":if(wO)break;case"keydown":case"keyup":Vk(be,m,xe)}var We;if(s0)e:{switch(u){case"compositionstart":var je="onCompositionStart";break e;case"compositionend":je="onCompositionEnd";break e;case"compositionupdate":je="onCompositionUpdate";break e}je=void 0}else Wi?Ek(u,m)&&(je="onCompositionEnd"):u==="keydown"&&m.keyCode===229&&(je="onCompositionStart");je&&(Ik&&m.locale!=="ko"&&(Wi||je!=="onCompositionStart"?je==="onCompositionEnd"&&Wi&&(We=vk()):(Oo=xe,Qy="value"in Oo?Oo.value:Oo.textContent,Wi=!0)),Ve=wp(ue,je),0<Ve.length&&(je=new Nk(je,u,null,m,xe),be.push({event:je,listeners:Ve}),We?je.data=We:(We=Rk(m),We!==null&&(je.data=We)))),(We=lO?uO(u,m):cO(u,m))&&(ue=wp(ue,"onBeforeInput"),0<ue.length&&(xe=new Nk("onBeforeInput","beforeinput",null,m,xe),be.push({event:xe,listeners:ue}),xe.data=We))}Yk(be,d)})}function pc(u,d,m){return{instance:u,listener:d,currentTarget:m}}function wp(u,d){for(var m=d+"Capture",b=[];u!==null;){var S=u,C=S.stateNode;S.tag===5&&C!==null&&(S=C,C=Ku(u,m),C!=null&&b.unshift(pc(u,C,S)),C=Ku(u,d),C!=null&&b.push(pc(u,C,S))),u=u.return}return b}function Gi(u){if(u===null)return null;do u=u.return;while(u&&u.tag!==5);return u||null}function Zk(u,d,m,b,S){for(var C=d._reactName,R=[];m!==null&&m!==b;){var V=m,Y=V.alternate,ue=V.stateNode;if(Y!==null&&Y===b)break;V.tag===5&&ue!==null&&(V=ue,S?(Y=Ku(m,C),Y!=null&&R.unshift(pc(m,Y,V))):S||(Y=Ku(m,C),Y!=null&&R.push(pc(m,Y,V)))),m=m.return}R.length!==0&&u.push({event:d,listeners:R})}var NO=/\r\n?/g,CO=/\u0000|\uFFFD/g;function Jk(u){return(typeof u=="string"?u:""+u).replace(NO,`
`).replace(CO,"")}function vp(u,d,m){if(d=Jk(d),Jk(u)!==d&&m)throw Error(t(425))}function kp(){}var f0=null,m0=null;function g0(u,d){return u==="textarea"||u==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var y0=typeof setTimeout=="function"?setTimeout:void 0,IO=typeof clearTimeout=="function"?clearTimeout:void 0,eS=typeof Promise=="function"?Promise:void 0,$O=typeof queueMicrotask=="function"?queueMicrotask:typeof eS<"u"?function(u){return eS.resolve(null).then(u).catch(TO)}:y0;function TO(u){setTimeout(function(){throw u})}function x0(u,d){var m=d,b=0;do{var S=m.nextSibling;if(u.removeChild(m),S&&S.nodeType===8)if(m=S.data,m==="/$"){if(b===0){u.removeChild(S),sc(d);return}b--}else m!=="$"&&m!=="$?"&&m!=="$!"||b++;m=S}while(m);sc(d)}function Lo(u){for(;u!=null;u=u.nextSibling){var d=u.nodeType;if(d===1||d===3)break;if(d===8){if(d=u.data,d==="$"||d==="$!"||d==="$?")break;if(d==="/$")return null}}return u}function tS(u){u=u.previousSibling;for(var d=0;u;){if(u.nodeType===8){var m=u.data;if(m==="$"||m==="$!"||m==="$?"){if(d===0)return u;d--}else m==="/$"&&d++}u=u.previousSibling}return null}var Hi=Math.random().toString(36).slice(2),Er="__reactFiber$"+Hi,fc="__reactProps$"+Hi,Jr="__reactContainer$"+Hi,b0="__reactEvents$"+Hi,EO="__reactListeners$"+Hi,RO="__reactHandles$"+Hi;function Ra(u){var d=u[Er];if(d)return d;for(var m=u.parentNode;m;){if(d=m[Jr]||m[Er]){if(m=d.alternate,d.child!==null||m!==null&&m.child!==null)for(u=tS(u);u!==null;){if(m=u[Er])return m;u=tS(u)}return d}u=m,m=u.parentNode}return null}function mc(u){return u=u[Er]||u[Jr],!u||u.tag!==5&&u.tag!==6&&u.tag!==13&&u.tag!==3?null:u}function qi(u){if(u.tag===5||u.tag===6)return u.stateNode;throw Error(t(33))}function Sp(u){return u[fc]||null}var w0=[],Ki=-1;function Po(u){return{current:u}}function $t(u){0>Ki||(u.current=w0[Ki],w0[Ki]=null,Ki--)}function Ct(u,d){Ki++,w0[Ki]=u.current,u.current=d}var zo={},Fn=Po(zo),is=Po(!1),Aa=zo;function Xi(u,d){var m=u.type.contextTypes;if(!m)return zo;var b=u.stateNode;if(b&&b.__reactInternalMemoizedUnmaskedChildContext===d)return b.__reactInternalMemoizedMaskedChildContext;var S={},C;for(C in m)S[C]=d[C];return b&&(u=u.stateNode,u.__reactInternalMemoizedUnmaskedChildContext=d,u.__reactInternalMemoizedMaskedChildContext=S),S}function ls(u){return u=u.childContextTypes,u!=null}function Np(){$t(is),$t(Fn)}function nS(u,d,m){if(Fn.current!==zo)throw Error(t(168));Ct(Fn,d),Ct(is,m)}function sS(u,d,m){var b=u.stateNode;if(d=d.childContextTypes,typeof b.getChildContext!="function")return m;b=b.getChildContext();for(var S in b)if(!(S in d))throw Error(t(108,Se(u)||"Unknown",S));return X({},m,b)}function Cp(u){return u=(u=u.stateNode)&&u.__reactInternalMemoizedMergedChildContext||zo,Aa=Fn.current,Ct(Fn,u),Ct(is,is.current),!0}function rS(u,d,m){var b=u.stateNode;if(!b)throw Error(t(169));m?(u=sS(u,d,Aa),b.__reactInternalMemoizedMergedChildContext=u,$t(is),$t(Fn),Ct(Fn,u)):$t(is),Ct(is,m)}var eo=null,Ip=!1,v0=!1;function oS(u){eo===null?eo=[u]:eo.push(u)}function AO(u){Ip=!0,oS(u)}function Mo(){if(!v0&&eo!==null){v0=!0;var u=0,d=mt;try{var m=eo;for(mt=1;u<m.length;u++){var b=m[u];do b=b(!0);while(b!==null)}eo=null,Ip=!1}catch(S){throw eo!==null&&(eo=eo.slice(u+1)),ik(Uy,Mo),S}finally{mt=d,v0=!1}}return null}var Yi=[],Qi=0,$p=null,Tp=0,Ms=[],Bs=0,Da=null,to=1,no="";function _a(u,d){Yi[Qi++]=Tp,Yi[Qi++]=$p,$p=u,Tp=d}function aS(u,d,m){Ms[Bs++]=to,Ms[Bs++]=no,Ms[Bs++]=Da,Da=u;var b=to;u=no;var S=32-rr(b)-1;b&=~(1<<S),m+=1;var C=32-rr(d)+S;if(30<C){var R=S-S%5;C=(b&(1<<R)-1).toString(32),b>>=R,S-=R,to=1<<32-rr(d)+S|m<<S|b,no=C+u}else to=1<<C|m<<S|b,no=u}function k0(u){u.return!==null&&(_a(u,1),aS(u,1,0))}function S0(u){for(;u===$p;)$p=Yi[--Qi],Yi[Qi]=null,Tp=Yi[--Qi],Yi[Qi]=null;for(;u===Da;)Da=Ms[--Bs],Ms[Bs]=null,no=Ms[--Bs],Ms[Bs]=null,to=Ms[--Bs],Ms[Bs]=null}var Cs=null,Is=null,At=!1,ar=null;function iS(u,d){var m=js(5,null,null,0);m.elementType="DELETED",m.stateNode=d,m.return=u,d=u.deletions,d===null?(u.deletions=[m],u.flags|=16):d.push(m)}function lS(u,d){switch(u.tag){case 5:var m=u.type;return d=d.nodeType!==1||m.toLowerCase()!==d.nodeName.toLowerCase()?null:d,d!==null?(u.stateNode=d,Cs=u,Is=Lo(d.firstChild),!0):!1;case 6:return d=u.pendingProps===""||d.nodeType!==3?null:d,d!==null?(u.stateNode=d,Cs=u,Is=null,!0):!1;case 13:return d=d.nodeType!==8?null:d,d!==null?(m=Da!==null?{id:to,overflow:no}:null,u.memoizedState={dehydrated:d,treeContext:m,retryLane:1073741824},m=js(18,null,null,0),m.stateNode=d,m.return=u,u.child=m,Cs=u,Is=null,!0):!1;default:return!1}}function N0(u){return(u.mode&1)!==0&&(u.flags&128)===0}function C0(u){if(At){var d=Is;if(d){var m=d;if(!lS(u,d)){if(N0(u))throw Error(t(418));d=Lo(m.nextSibling);var b=Cs;d&&lS(u,d)?iS(b,m):(u.flags=u.flags&-4097|2,At=!1,Cs=u)}}else{if(N0(u))throw Error(t(418));u.flags=u.flags&-4097|2,At=!1,Cs=u}}}function uS(u){for(u=u.return;u!==null&&u.tag!==5&&u.tag!==3&&u.tag!==13;)u=u.return;Cs=u}function Ep(u){if(u!==Cs)return!1;if(!At)return uS(u),At=!0,!1;var d;if((d=u.tag!==3)&&!(d=u.tag!==5)&&(d=u.type,d=d!=="head"&&d!=="body"&&!g0(u.type,u.memoizedProps)),d&&(d=Is)){if(N0(u))throw cS(),Error(t(418));for(;d;)iS(u,d),d=Lo(d.nextSibling)}if(uS(u),u.tag===13){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(t(317));e:{for(u=u.nextSibling,d=0;u;){if(u.nodeType===8){var m=u.data;if(m==="/$"){if(d===0){Is=Lo(u.nextSibling);break e}d--}else m!=="$"&&m!=="$!"&&m!=="$?"||d++}u=u.nextSibling}Is=null}}else Is=Cs?Lo(u.stateNode.nextSibling):null;return!0}function cS(){for(var u=Is;u;)u=Lo(u.nextSibling)}function Zi(){Is=Cs=null,At=!1}function I0(u){ar===null?ar=[u]:ar.push(u)}var DO=N.ReactCurrentBatchConfig;function gc(u,d,m){if(u=m.ref,u!==null&&typeof u!="function"&&typeof u!="object"){if(m._owner){if(m=m._owner,m){if(m.tag!==1)throw Error(t(309));var b=m.stateNode}if(!b)throw Error(t(147,u));var S=b,C=""+u;return d!==null&&d.ref!==null&&typeof d.ref=="function"&&d.ref._stringRef===C?d.ref:(d=function(R){var V=S.refs;R===null?delete V[C]:V[C]=R},d._stringRef=C,d)}if(typeof u!="string")throw Error(t(284));if(!m._owner)throw Error(t(290,u))}return u}function Rp(u,d){throw u=Object.prototype.toString.call(d),Error(t(31,u==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":u))}function dS(u){var d=u._init;return d(u._payload)}function hS(u){function d(ae,ee){if(u){var ie=ae.deletions;ie===null?(ae.deletions=[ee],ae.flags|=16):ie.push(ee)}}function m(ae,ee){if(!u)return null;for(;ee!==null;)d(ae,ee),ee=ee.sibling;return null}function b(ae,ee){for(ae=new Map;ee!==null;)ee.key!==null?ae.set(ee.key,ee):ae.set(ee.index,ee),ee=ee.sibling;return ae}function S(ae,ee){return ae=qo(ae,ee),ae.index=0,ae.sibling=null,ae}function C(ae,ee,ie){return ae.index=ie,u?(ie=ae.alternate,ie!==null?(ie=ie.index,ie<ee?(ae.flags|=2,ee):ie):(ae.flags|=2,ee)):(ae.flags|=1048576,ee)}function R(ae){return u&&ae.alternate===null&&(ae.flags|=2),ae}function V(ae,ee,ie,we){return ee===null||ee.tag!==6?(ee=yx(ie,ae.mode,we),ee.return=ae,ee):(ee=S(ee,ie),ee.return=ae,ee)}function Y(ae,ee,ie,we){var Pe=ie.type;return Pe===P?xe(ae,ee,ie.props.children,we,ie.key):ee!==null&&(ee.elementType===Pe||typeof Pe=="object"&&Pe!==null&&Pe.$$typeof===se&&dS(Pe)===ee.type)?(we=S(ee,ie.props),we.ref=gc(ae,ee,ie),we.return=ae,we):(we=ef(ie.type,ie.key,ie.props,null,ae.mode,we),we.ref=gc(ae,ee,ie),we.return=ae,we)}function ue(ae,ee,ie,we){return ee===null||ee.tag!==4||ee.stateNode.containerInfo!==ie.containerInfo||ee.stateNode.implementation!==ie.implementation?(ee=xx(ie,ae.mode,we),ee.return=ae,ee):(ee=S(ee,ie.children||[]),ee.return=ae,ee)}function xe(ae,ee,ie,we,Pe){return ee===null||ee.tag!==7?(ee=Va(ie,ae.mode,we,Pe),ee.return=ae,ee):(ee=S(ee,ie),ee.return=ae,ee)}function be(ae,ee,ie){if(typeof ee=="string"&&ee!==""||typeof ee=="number")return ee=yx(""+ee,ae.mode,ie),ee.return=ae,ee;if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case T:return ie=ef(ee.type,ee.key,ee.props,null,ae.mode,ie),ie.ref=gc(ae,null,ee),ie.return=ae,ie;case D:return ee=xx(ee,ae.mode,ie),ee.return=ae,ee;case se:var we=ee._init;return be(ae,we(ee._payload),ie)}if(Rt(ee)||J(ee))return ee=Va(ee,ae.mode,ie,null),ee.return=ae,ee;Rp(ae,ee)}return null}function ye(ae,ee,ie,we){var Pe=ee!==null?ee.key:null;if(typeof ie=="string"&&ie!==""||typeof ie=="number")return Pe!==null?null:V(ae,ee,""+ie,we);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case T:return ie.key===Pe?Y(ae,ee,ie,we):null;case D:return ie.key===Pe?ue(ae,ee,ie,we):null;case se:return Pe=ie._init,ye(ae,ee,Pe(ie._payload),we)}if(Rt(ie)||J(ie))return Pe!==null?null:xe(ae,ee,ie,we,null);Rp(ae,ie)}return null}function Ee(ae,ee,ie,we,Pe){if(typeof we=="string"&&we!==""||typeof we=="number")return ae=ae.get(ie)||null,V(ee,ae,""+we,Pe);if(typeof we=="object"&&we!==null){switch(we.$$typeof){case T:return ae=ae.get(we.key===null?ie:we.key)||null,Y(ee,ae,we,Pe);case D:return ae=ae.get(we.key===null?ie:we.key)||null,ue(ee,ae,we,Pe);case se:var Ve=we._init;return Ee(ae,ee,ie,Ve(we._payload),Pe)}if(Rt(we)||J(we))return ae=ae.get(ie)||null,xe(ee,ae,we,Pe,null);Rp(ee,we)}return null}function _e(ae,ee,ie,we){for(var Pe=null,Ve=null,We=ee,je=ee=0,xn=null;We!==null&&je<ie.length;je++){We.index>je?(xn=We,We=null):xn=We.sibling;var ct=ye(ae,We,ie[je],we);if(ct===null){We===null&&(We=xn);break}u&&We&&ct.alternate===null&&d(ae,We),ee=C(ct,ee,je),Ve===null?Pe=ct:Ve.sibling=ct,Ve=ct,We=xn}if(je===ie.length)return m(ae,We),At&&_a(ae,je),Pe;if(We===null){for(;je<ie.length;je++)We=be(ae,ie[je],we),We!==null&&(ee=C(We,ee,je),Ve===null?Pe=We:Ve.sibling=We,Ve=We);return At&&_a(ae,je),Pe}for(We=b(ae,We);je<ie.length;je++)xn=Ee(We,ae,je,ie[je],we),xn!==null&&(u&&xn.alternate!==null&&We.delete(xn.key===null?je:xn.key),ee=C(xn,ee,je),Ve===null?Pe=xn:Ve.sibling=xn,Ve=xn);return u&&We.forEach(function(Ko){return d(ae,Ko)}),At&&_a(ae,je),Pe}function Le(ae,ee,ie,we){var Pe=J(ie);if(typeof Pe!="function")throw Error(t(150));if(ie=Pe.call(ie),ie==null)throw Error(t(151));for(var Ve=Pe=null,We=ee,je=ee=0,xn=null,ct=ie.next();We!==null&&!ct.done;je++,ct=ie.next()){We.index>je?(xn=We,We=null):xn=We.sibling;var Ko=ye(ae,We,ct.value,we);if(Ko===null){We===null&&(We=xn);break}u&&We&&Ko.alternate===null&&d(ae,We),ee=C(Ko,ee,je),Ve===null?Pe=Ko:Ve.sibling=Ko,Ve=Ko,We=xn}if(ct.done)return m(ae,We),At&&_a(ae,je),Pe;if(We===null){for(;!ct.done;je++,ct=ie.next())ct=be(ae,ct.value,we),ct!==null&&(ee=C(ct,ee,je),Ve===null?Pe=ct:Ve.sibling=ct,Ve=ct);return At&&_a(ae,je),Pe}for(We=b(ae,We);!ct.done;je++,ct=ie.next())ct=Ee(We,ae,je,ct.value,we),ct!==null&&(u&&ct.alternate!==null&&We.delete(ct.key===null?je:ct.key),ee=C(ct,ee,je),Ve===null?Pe=ct:Ve.sibling=ct,Ve=ct);return u&&We.forEach(function(dF){return d(ae,dF)}),At&&_a(ae,je),Pe}function Kt(ae,ee,ie,we){if(typeof ie=="object"&&ie!==null&&ie.type===P&&ie.key===null&&(ie=ie.props.children),typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case T:e:{for(var Pe=ie.key,Ve=ee;Ve!==null;){if(Ve.key===Pe){if(Pe=ie.type,Pe===P){if(Ve.tag===7){m(ae,Ve.sibling),ee=S(Ve,ie.props.children),ee.return=ae,ae=ee;break e}}else if(Ve.elementType===Pe||typeof Pe=="object"&&Pe!==null&&Pe.$$typeof===se&&dS(Pe)===Ve.type){m(ae,Ve.sibling),ee=S(Ve,ie.props),ee.ref=gc(ae,Ve,ie),ee.return=ae,ae=ee;break e}m(ae,Ve);break}else d(ae,Ve);Ve=Ve.sibling}ie.type===P?(ee=Va(ie.props.children,ae.mode,we,ie.key),ee.return=ae,ae=ee):(we=ef(ie.type,ie.key,ie.props,null,ae.mode,we),we.ref=gc(ae,ee,ie),we.return=ae,ae=we)}return R(ae);case D:e:{for(Ve=ie.key;ee!==null;){if(ee.key===Ve)if(ee.tag===4&&ee.stateNode.containerInfo===ie.containerInfo&&ee.stateNode.implementation===ie.implementation){m(ae,ee.sibling),ee=S(ee,ie.children||[]),ee.return=ae,ae=ee;break e}else{m(ae,ee);break}else d(ae,ee);ee=ee.sibling}ee=xx(ie,ae.mode,we),ee.return=ae,ae=ee}return R(ae);case se:return Ve=ie._init,Kt(ae,ee,Ve(ie._payload),we)}if(Rt(ie))return _e(ae,ee,ie,we);if(J(ie))return Le(ae,ee,ie,we);Rp(ae,ie)}return typeof ie=="string"&&ie!==""||typeof ie=="number"?(ie=""+ie,ee!==null&&ee.tag===6?(m(ae,ee.sibling),ee=S(ee,ie),ee.return=ae,ae=ee):(m(ae,ee),ee=yx(ie,ae.mode,we),ee.return=ae,ae=ee),R(ae)):m(ae,ee)}return Kt}var Ji=hS(!0),pS=hS(!1),Ap=Po(null),Dp=null,el=null,$0=null;function T0(){$0=el=Dp=null}function E0(u){var d=Ap.current;$t(Ap),u._currentValue=d}function R0(u,d,m){for(;u!==null;){var b=u.alternate;if((u.childLanes&d)!==d?(u.childLanes|=d,b!==null&&(b.childLanes|=d)):b!==null&&(b.childLanes&d)!==d&&(b.childLanes|=d),u===m)break;u=u.return}}function tl(u,d){Dp=u,$0=el=null,u=u.dependencies,u!==null&&u.firstContext!==null&&((u.lanes&d)!==0&&(us=!0),u.firstContext=null)}function Vs(u){var d=u._currentValue;if($0!==u)if(u={context:u,memoizedValue:d,next:null},el===null){if(Dp===null)throw Error(t(308));el=u,Dp.dependencies={lanes:0,firstContext:u}}else el=el.next=u;return d}var Oa=null;function A0(u){Oa===null?Oa=[u]:Oa.push(u)}function fS(u,d,m,b){var S=d.interleaved;return S===null?(m.next=m,A0(d)):(m.next=S.next,S.next=m),d.interleaved=m,so(u,b)}function so(u,d){u.lanes|=d;var m=u.alternate;for(m!==null&&(m.lanes|=d),m=u,u=u.return;u!==null;)u.childLanes|=d,m=u.alternate,m!==null&&(m.childLanes|=d),m=u,u=u.return;return m.tag===3?m.stateNode:null}var Bo=!1;function D0(u){u.updateQueue={baseState:u.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function mS(u,d){u=u.updateQueue,d.updateQueue===u&&(d.updateQueue={baseState:u.baseState,firstBaseUpdate:u.firstBaseUpdate,lastBaseUpdate:u.lastBaseUpdate,shared:u.shared,effects:u.effects})}function ro(u,d){return{eventTime:u,lane:d,tag:0,payload:null,callback:null,next:null}}function Vo(u,d,m){var b=u.updateQueue;if(b===null)return null;if(b=b.shared,(it&2)!==0){var S=b.pending;return S===null?d.next=d:(d.next=S.next,S.next=d),b.pending=d,so(u,m)}return S=b.interleaved,S===null?(d.next=d,A0(b)):(d.next=S.next,S.next=d),b.interleaved=d,so(u,m)}function _p(u,d,m){if(d=d.updateQueue,d!==null&&(d=d.shared,(m&4194240)!==0)){var b=d.lanes;b&=u.pendingLanes,m|=b,d.lanes=m,Hy(u,m)}}function gS(u,d){var m=u.updateQueue,b=u.alternate;if(b!==null&&(b=b.updateQueue,m===b)){var S=null,C=null;if(m=m.firstBaseUpdate,m!==null){do{var R={eventTime:m.eventTime,lane:m.lane,tag:m.tag,payload:m.payload,callback:m.callback,next:null};C===null?S=C=R:C=C.next=R,m=m.next}while(m!==null);C===null?S=C=d:C=C.next=d}else S=C=d;m={baseState:b.baseState,firstBaseUpdate:S,lastBaseUpdate:C,shared:b.shared,effects:b.effects},u.updateQueue=m;return}u=m.lastBaseUpdate,u===null?m.firstBaseUpdate=d:u.next=d,m.lastBaseUpdate=d}function Op(u,d,m,b){var S=u.updateQueue;Bo=!1;var C=S.firstBaseUpdate,R=S.lastBaseUpdate,V=S.shared.pending;if(V!==null){S.shared.pending=null;var Y=V,ue=Y.next;Y.next=null,R===null?C=ue:R.next=ue,R=Y;var xe=u.alternate;xe!==null&&(xe=xe.updateQueue,V=xe.lastBaseUpdate,V!==R&&(V===null?xe.firstBaseUpdate=ue:V.next=ue,xe.lastBaseUpdate=Y))}if(C!==null){var be=S.baseState;R=0,xe=ue=Y=null,V=C;do{var ye=V.lane,Ee=V.eventTime;if((b&ye)===ye){xe!==null&&(xe=xe.next={eventTime:Ee,lane:0,tag:V.tag,payload:V.payload,callback:V.callback,next:null});e:{var _e=u,Le=V;switch(ye=d,Ee=m,Le.tag){case 1:if(_e=Le.payload,typeof _e=="function"){be=_e.call(Ee,be,ye);break e}be=_e;break e;case 3:_e.flags=_e.flags&-65537|128;case 0:if(_e=Le.payload,ye=typeof _e=="function"?_e.call(Ee,be,ye):_e,ye==null)break e;be=X({},be,ye);break e;case 2:Bo=!0}}V.callback!==null&&V.lane!==0&&(u.flags|=64,ye=S.effects,ye===null?S.effects=[V]:ye.push(V))}else Ee={eventTime:Ee,lane:ye,tag:V.tag,payload:V.payload,callback:V.callback,next:null},xe===null?(ue=xe=Ee,Y=be):xe=xe.next=Ee,R|=ye;if(V=V.next,V===null){if(V=S.shared.pending,V===null)break;ye=V,V=ye.next,ye.next=null,S.lastBaseUpdate=ye,S.shared.pending=null}}while(!0);if(xe===null&&(Y=be),S.baseState=Y,S.firstBaseUpdate=ue,S.lastBaseUpdate=xe,d=S.shared.interleaved,d!==null){S=d;do R|=S.lane,S=S.next;while(S!==d)}else C===null&&(S.shared.lanes=0);Pa|=R,u.lanes=R,u.memoizedState=be}}function yS(u,d,m){if(u=d.effects,d.effects=null,u!==null)for(d=0;d<u.length;d++){var b=u[d],S=b.callback;if(S!==null){if(b.callback=null,b=m,typeof S!="function")throw Error(t(191,S));S.call(b)}}}var yc={},Rr=Po(yc),xc=Po(yc),bc=Po(yc);function Fa(u){if(u===yc)throw Error(t(174));return u}function _0(u,d){switch(Ct(bc,d),Ct(xc,u),Ct(Rr,yc),u=d.nodeType,u){case 9:case 11:d=(d=d.documentElement)?d.namespaceURI:zs(null,"");break;default:u=u===8?d.parentNode:d,d=u.namespaceURI||null,u=u.tagName,d=zs(d,u)}$t(Rr),Ct(Rr,d)}function nl(){$t(Rr),$t(xc),$t(bc)}function xS(u){Fa(bc.current);var d=Fa(Rr.current),m=zs(d,u.type);d!==m&&(Ct(xc,u),Ct(Rr,m))}function O0(u){xc.current===u&&($t(Rr),$t(xc))}var Pt=Po(0);function Fp(u){for(var d=u;d!==null;){if(d.tag===13){var m=d.memoizedState;if(m!==null&&(m=m.dehydrated,m===null||m.data==="$?"||m.data==="$!"))return d}else if(d.tag===19&&d.memoizedProps.revealOrder!==void 0){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===u)break;for(;d.sibling===null;){if(d.return===null||d.return===u)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var F0=[];function L0(){for(var u=0;u<F0.length;u++)F0[u]._workInProgressVersionPrimary=null;F0.length=0}var Lp=N.ReactCurrentDispatcher,P0=N.ReactCurrentBatchConfig,La=0,zt=null,an=null,gn=null,Pp=!1,wc=!1,vc=0,_O=0;function Ln(){throw Error(t(321))}function z0(u,d){if(d===null)return!1;for(var m=0;m<d.length&&m<u.length;m++)if(!or(u[m],d[m]))return!1;return!0}function M0(u,d,m,b,S,C){if(La=C,zt=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,Lp.current=u===null||u.memoizedState===null?PO:zO,u=m(b,S),wc){C=0;do{if(wc=!1,vc=0,25<=C)throw Error(t(301));C+=1,gn=an=null,d.updateQueue=null,Lp.current=MO,u=m(b,S)}while(wc)}if(Lp.current=Bp,d=an!==null&&an.next!==null,La=0,gn=an=zt=null,Pp=!1,d)throw Error(t(300));return u}function B0(){var u=vc!==0;return vc=0,u}function Ar(){var u={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gn===null?zt.memoizedState=gn=u:gn=gn.next=u,gn}function Ws(){if(an===null){var u=zt.alternate;u=u!==null?u.memoizedState:null}else u=an.next;var d=gn===null?zt.memoizedState:gn.next;if(d!==null)gn=d,an=u;else{if(u===null)throw Error(t(310));an=u,u={memoizedState:an.memoizedState,baseState:an.baseState,baseQueue:an.baseQueue,queue:an.queue,next:null},gn===null?zt.memoizedState=gn=u:gn=gn.next=u}return gn}function kc(u,d){return typeof d=="function"?d(u):d}function V0(u){var d=Ws(),m=d.queue;if(m===null)throw Error(t(311));m.lastRenderedReducer=u;var b=an,S=b.baseQueue,C=m.pending;if(C!==null){if(S!==null){var R=S.next;S.next=C.next,C.next=R}b.baseQueue=S=C,m.pending=null}if(S!==null){C=S.next,b=b.baseState;var V=R=null,Y=null,ue=C;do{var xe=ue.lane;if((La&xe)===xe)Y!==null&&(Y=Y.next={lane:0,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null}),b=ue.hasEagerState?ue.eagerState:u(b,ue.action);else{var be={lane:xe,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null};Y===null?(V=Y=be,R=b):Y=Y.next=be,zt.lanes|=xe,Pa|=xe}ue=ue.next}while(ue!==null&&ue!==C);Y===null?R=b:Y.next=V,or(b,d.memoizedState)||(us=!0),d.memoizedState=b,d.baseState=R,d.baseQueue=Y,m.lastRenderedState=b}if(u=m.interleaved,u!==null){S=u;do C=S.lane,zt.lanes|=C,Pa|=C,S=S.next;while(S!==u)}else S===null&&(m.lanes=0);return[d.memoizedState,m.dispatch]}function W0(u){var d=Ws(),m=d.queue;if(m===null)throw Error(t(311));m.lastRenderedReducer=u;var b=m.dispatch,S=m.pending,C=d.memoizedState;if(S!==null){m.pending=null;var R=S=S.next;do C=u(C,R.action),R=R.next;while(R!==S);or(C,d.memoizedState)||(us=!0),d.memoizedState=C,d.baseQueue===null&&(d.baseState=C),m.lastRenderedState=C}return[C,b]}function bS(){}function wS(u,d){var m=zt,b=Ws(),S=d(),C=!or(b.memoizedState,S);if(C&&(b.memoizedState=S,us=!0),b=b.queue,U0(SS.bind(null,m,b,u),[u]),b.getSnapshot!==d||C||gn!==null&&gn.memoizedState.tag&1){if(m.flags|=2048,Sc(9,kS.bind(null,m,b,S,d),void 0,null),yn===null)throw Error(t(349));(La&30)!==0||vS(m,d,S)}return S}function vS(u,d,m){u.flags|=16384,u={getSnapshot:d,value:m},d=zt.updateQueue,d===null?(d={lastEffect:null,stores:null},zt.updateQueue=d,d.stores=[u]):(m=d.stores,m===null?d.stores=[u]:m.push(u))}function kS(u,d,m,b){d.value=m,d.getSnapshot=b,NS(d)&&CS(u)}function SS(u,d,m){return m(function(){NS(d)&&CS(u)})}function NS(u){var d=u.getSnapshot;u=u.value;try{var m=d();return!or(u,m)}catch{return!0}}function CS(u){var d=so(u,1);d!==null&&cr(d,u,1,-1)}function IS(u){var d=Ar();return typeof u=="function"&&(u=u()),d.memoizedState=d.baseState=u,u={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:kc,lastRenderedState:u},d.queue=u,u=u.dispatch=LO.bind(null,zt,u),[d.memoizedState,u]}function Sc(u,d,m,b){return u={tag:u,create:d,destroy:m,deps:b,next:null},d=zt.updateQueue,d===null?(d={lastEffect:null,stores:null},zt.updateQueue=d,d.lastEffect=u.next=u):(m=d.lastEffect,m===null?d.lastEffect=u.next=u:(b=m.next,m.next=u,u.next=b,d.lastEffect=u)),u}function $S(){return Ws().memoizedState}function zp(u,d,m,b){var S=Ar();zt.flags|=u,S.memoizedState=Sc(1|d,m,void 0,b===void 0?null:b)}function Mp(u,d,m,b){var S=Ws();b=b===void 0?null:b;var C=void 0;if(an!==null){var R=an.memoizedState;if(C=R.destroy,b!==null&&z0(b,R.deps)){S.memoizedState=Sc(d,m,C,b);return}}zt.flags|=u,S.memoizedState=Sc(1|d,m,C,b)}function TS(u,d){return zp(8390656,8,u,d)}function U0(u,d){return Mp(2048,8,u,d)}function ES(u,d){return Mp(4,2,u,d)}function RS(u,d){return Mp(4,4,u,d)}function AS(u,d){if(typeof d=="function")return u=u(),d(u),function(){d(null)};if(d!=null)return u=u(),d.current=u,function(){d.current=null}}function DS(u,d,m){return m=m!=null?m.concat([u]):null,Mp(4,4,AS.bind(null,d,u),m)}function j0(){}function _S(u,d){var m=Ws();d=d===void 0?null:d;var b=m.memoizedState;return b!==null&&d!==null&&z0(d,b[1])?b[0]:(m.memoizedState=[u,d],u)}function OS(u,d){var m=Ws();d=d===void 0?null:d;var b=m.memoizedState;return b!==null&&d!==null&&z0(d,b[1])?b[0]:(u=u(),m.memoizedState=[u,d],u)}function FS(u,d,m){return(La&21)===0?(u.baseState&&(u.baseState=!1,us=!0),u.memoizedState=m):(or(m,d)||(m=dk(),zt.lanes|=m,Pa|=m,u.baseState=!0),d)}function OO(u,d){var m=mt;mt=m!==0&&4>m?m:4,u(!0);var b=P0.transition;P0.transition={};try{u(!1),d()}finally{mt=m,P0.transition=b}}function LS(){return Ws().memoizedState}function FO(u,d,m){var b=Go(u);if(m={lane:b,action:m,hasEagerState:!1,eagerState:null,next:null},PS(u))zS(d,m);else if(m=fS(u,d,m,b),m!==null){var S=Xn();cr(m,u,b,S),MS(m,d,b)}}function LO(u,d,m){var b=Go(u),S={lane:b,action:m,hasEagerState:!1,eagerState:null,next:null};if(PS(u))zS(d,S);else{var C=u.alternate;if(u.lanes===0&&(C===null||C.lanes===0)&&(C=d.lastRenderedReducer,C!==null))try{var R=d.lastRenderedState,V=C(R,m);if(S.hasEagerState=!0,S.eagerState=V,or(V,R)){var Y=d.interleaved;Y===null?(S.next=S,A0(d)):(S.next=Y.next,Y.next=S),d.interleaved=S;return}}catch{}finally{}m=fS(u,d,S,b),m!==null&&(S=Xn(),cr(m,u,b,S),MS(m,d,b))}}function PS(u){var d=u.alternate;return u===zt||d!==null&&d===zt}function zS(u,d){wc=Pp=!0;var m=u.pending;m===null?d.next=d:(d.next=m.next,m.next=d),u.pending=d}function MS(u,d,m){if((m&4194240)!==0){var b=d.lanes;b&=u.pendingLanes,m|=b,d.lanes=m,Hy(u,m)}}var Bp={readContext:Vs,useCallback:Ln,useContext:Ln,useEffect:Ln,useImperativeHandle:Ln,useInsertionEffect:Ln,useLayoutEffect:Ln,useMemo:Ln,useReducer:Ln,useRef:Ln,useState:Ln,useDebugValue:Ln,useDeferredValue:Ln,useTransition:Ln,useMutableSource:Ln,useSyncExternalStore:Ln,useId:Ln,unstable_isNewReconciler:!1},PO={readContext:Vs,useCallback:function(u,d){return Ar().memoizedState=[u,d===void 0?null:d],u},useContext:Vs,useEffect:TS,useImperativeHandle:function(u,d,m){return m=m!=null?m.concat([u]):null,zp(4194308,4,AS.bind(null,d,u),m)},useLayoutEffect:function(u,d){return zp(4194308,4,u,d)},useInsertionEffect:function(u,d){return zp(4,2,u,d)},useMemo:function(u,d){var m=Ar();return d=d===void 0?null:d,u=u(),m.memoizedState=[u,d],u},useReducer:function(u,d,m){var b=Ar();return d=m!==void 0?m(d):d,b.memoizedState=b.baseState=d,u={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:u,lastRenderedState:d},b.queue=u,u=u.dispatch=FO.bind(null,zt,u),[b.memoizedState,u]},useRef:function(u){var d=Ar();return u={current:u},d.memoizedState=u},useState:IS,useDebugValue:j0,useDeferredValue:function(u){return Ar().memoizedState=u},useTransition:function(){var u=IS(!1),d=u[0];return u=OO.bind(null,u[1]),Ar().memoizedState=u,[d,u]},useMutableSource:function(){},useSyncExternalStore:function(u,d,m){var b=zt,S=Ar();if(At){if(m===void 0)throw Error(t(407));m=m()}else{if(m=d(),yn===null)throw Error(t(349));(La&30)!==0||vS(b,d,m)}S.memoizedState=m;var C={value:m,getSnapshot:d};return S.queue=C,TS(SS.bind(null,b,C,u),[u]),b.flags|=2048,Sc(9,kS.bind(null,b,C,m,d),void 0,null),m},useId:function(){var u=Ar(),d=yn.identifierPrefix;if(At){var m=no,b=to;m=(b&~(1<<32-rr(b)-1)).toString(32)+m,d=":"+d+"R"+m,m=vc++,0<m&&(d+="H"+m.toString(32)),d+=":"}else m=_O++,d=":"+d+"r"+m.toString(32)+":";return u.memoizedState=d},unstable_isNewReconciler:!1},zO={readContext:Vs,useCallback:_S,useContext:Vs,useEffect:U0,useImperativeHandle:DS,useInsertionEffect:ES,useLayoutEffect:RS,useMemo:OS,useReducer:V0,useRef:$S,useState:function(){return V0(kc)},useDebugValue:j0,useDeferredValue:function(u){var d=Ws();return FS(d,an.memoizedState,u)},useTransition:function(){var u=V0(kc)[0],d=Ws().memoizedState;return[u,d]},useMutableSource:bS,useSyncExternalStore:wS,useId:LS,unstable_isNewReconciler:!1},MO={readContext:Vs,useCallback:_S,useContext:Vs,useEffect:U0,useImperativeHandle:DS,useInsertionEffect:ES,useLayoutEffect:RS,useMemo:OS,useReducer:W0,useRef:$S,useState:function(){return W0(kc)},useDebugValue:j0,useDeferredValue:function(u){var d=Ws();return an===null?d.memoizedState=u:FS(d,an.memoizedState,u)},useTransition:function(){var u=W0(kc)[0],d=Ws().memoizedState;return[u,d]},useMutableSource:bS,useSyncExternalStore:wS,useId:LS,unstable_isNewReconciler:!1};function ir(u,d){if(u&&u.defaultProps){d=X({},d),u=u.defaultProps;for(var m in u)d[m]===void 0&&(d[m]=u[m]);return d}return d}function G0(u,d,m,b){d=u.memoizedState,m=m(b,d),m=m==null?d:X({},d,m),u.memoizedState=m,u.lanes===0&&(u.updateQueue.baseState=m)}var Vp={isMounted:function(u){return(u=u._reactInternals)?Ea(u)===u:!1},enqueueSetState:function(u,d,m){u=u._reactInternals;var b=Xn(),S=Go(u),C=ro(b,S);C.payload=d,m!=null&&(C.callback=m),d=Vo(u,C,S),d!==null&&(cr(d,u,S,b),_p(d,u,S))},enqueueReplaceState:function(u,d,m){u=u._reactInternals;var b=Xn(),S=Go(u),C=ro(b,S);C.tag=1,C.payload=d,m!=null&&(C.callback=m),d=Vo(u,C,S),d!==null&&(cr(d,u,S,b),_p(d,u,S))},enqueueForceUpdate:function(u,d){u=u._reactInternals;var m=Xn(),b=Go(u),S=ro(m,b);S.tag=2,d!=null&&(S.callback=d),d=Vo(u,S,b),d!==null&&(cr(d,u,b,m),_p(d,u,b))}};function BS(u,d,m,b,S,C,R){return u=u.stateNode,typeof u.shouldComponentUpdate=="function"?u.shouldComponentUpdate(b,C,R):d.prototype&&d.prototype.isPureReactComponent?!uc(m,b)||!uc(S,C):!0}function VS(u,d,m){var b=!1,S=zo,C=d.contextType;return typeof C=="object"&&C!==null?C=Vs(C):(S=ls(d)?Aa:Fn.current,b=d.contextTypes,C=(b=b!=null)?Xi(u,S):zo),d=new d(m,C),u.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Vp,u.stateNode=d,d._reactInternals=u,b&&(u=u.stateNode,u.__reactInternalMemoizedUnmaskedChildContext=S,u.__reactInternalMemoizedMaskedChildContext=C),d}function WS(u,d,m,b){u=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(m,b),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(m,b),d.state!==u&&Vp.enqueueReplaceState(d,d.state,null)}function H0(u,d,m,b){var S=u.stateNode;S.props=m,S.state=u.memoizedState,S.refs={},D0(u);var C=d.contextType;typeof C=="object"&&C!==null?S.context=Vs(C):(C=ls(d)?Aa:Fn.current,S.context=Xi(u,C)),S.state=u.memoizedState,C=d.getDerivedStateFromProps,typeof C=="function"&&(G0(u,d,C,m),S.state=u.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof S.getSnapshotBeforeUpdate=="function"||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(d=S.state,typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount(),d!==S.state&&Vp.enqueueReplaceState(S,S.state,null),Op(u,m,S,b),S.state=u.memoizedState),typeof S.componentDidMount=="function"&&(u.flags|=4194308)}function sl(u,d){try{var m="",b=d;do m+=pe(b),b=b.return;while(b);var S=m}catch(C){S=`
Error generating stack: `+C.message+`
`+C.stack}return{value:u,source:d,stack:S,digest:null}}function q0(u,d,m){return{value:u,source:null,stack:m??null,digest:d??null}}function K0(u,d){try{console.error(d.value)}catch(m){setTimeout(function(){throw m})}}var BO=typeof WeakMap=="function"?WeakMap:Map;function US(u,d,m){m=ro(-1,m),m.tag=3,m.payload={element:null};var b=d.value;return m.callback=function(){Kp||(Kp=!0,ux=b),K0(u,d)},m}function jS(u,d,m){m=ro(-1,m),m.tag=3;var b=u.type.getDerivedStateFromError;if(typeof b=="function"){var S=d.value;m.payload=function(){return b(S)},m.callback=function(){K0(u,d)}}var C=u.stateNode;return C!==null&&typeof C.componentDidCatch=="function"&&(m.callback=function(){K0(u,d),typeof b!="function"&&(Uo===null?Uo=new Set([this]):Uo.add(this));var R=d.stack;this.componentDidCatch(d.value,{componentStack:R!==null?R:""})}),m}function GS(u,d,m){var b=u.pingCache;if(b===null){b=u.pingCache=new BO;var S=new Set;b.set(d,S)}else S=b.get(d),S===void 0&&(S=new Set,b.set(d,S));S.has(m)||(S.add(m),u=eF.bind(null,u,d,m),d.then(u,u))}function HS(u){do{var d;if((d=u.tag===13)&&(d=u.memoizedState,d=d!==null?d.dehydrated!==null:!0),d)return u;u=u.return}while(u!==null);return null}function qS(u,d,m,b,S){return(u.mode&1)===0?(u===d?u.flags|=65536:(u.flags|=128,m.flags|=131072,m.flags&=-52805,m.tag===1&&(m.alternate===null?m.tag=17:(d=ro(-1,1),d.tag=2,Vo(m,d,1))),m.lanes|=1),u):(u.flags|=65536,u.lanes=S,u)}var VO=N.ReactCurrentOwner,us=!1;function Kn(u,d,m,b){d.child=u===null?pS(d,null,m,b):Ji(d,u.child,m,b)}function KS(u,d,m,b,S){m=m.render;var C=d.ref;return tl(d,S),b=M0(u,d,m,b,C,S),m=B0(),u!==null&&!us?(d.updateQueue=u.updateQueue,d.flags&=-2053,u.lanes&=~S,oo(u,d,S)):(At&&m&&k0(d),d.flags|=1,Kn(u,d,b,S),d.child)}function XS(u,d,m,b,S){if(u===null){var C=m.type;return typeof C=="function"&&!gx(C)&&C.defaultProps===void 0&&m.compare===null&&m.defaultProps===void 0?(d.tag=15,d.type=C,YS(u,d,C,b,S)):(u=ef(m.type,null,b,d,d.mode,S),u.ref=d.ref,u.return=d,d.child=u)}if(C=u.child,(u.lanes&S)===0){var R=C.memoizedProps;if(m=m.compare,m=m!==null?m:uc,m(R,b)&&u.ref===d.ref)return oo(u,d,S)}return d.flags|=1,u=qo(C,b),u.ref=d.ref,u.return=d,d.child=u}function YS(u,d,m,b,S){if(u!==null){var C=u.memoizedProps;if(uc(C,b)&&u.ref===d.ref)if(us=!1,d.pendingProps=b=C,(u.lanes&S)!==0)(u.flags&131072)!==0&&(us=!0);else return d.lanes=u.lanes,oo(u,d,S)}return X0(u,d,m,b,S)}function QS(u,d,m){var b=d.pendingProps,S=b.children,C=u!==null?u.memoizedState:null;if(b.mode==="hidden")if((d.mode&1)===0)d.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ct(ol,$s),$s|=m;else{if((m&1073741824)===0)return u=C!==null?C.baseLanes|m:m,d.lanes=d.childLanes=1073741824,d.memoizedState={baseLanes:u,cachePool:null,transitions:null},d.updateQueue=null,Ct(ol,$s),$s|=u,null;d.memoizedState={baseLanes:0,cachePool:null,transitions:null},b=C!==null?C.baseLanes:m,Ct(ol,$s),$s|=b}else C!==null?(b=C.baseLanes|m,d.memoizedState=null):b=m,Ct(ol,$s),$s|=b;return Kn(u,d,S,m),d.child}function ZS(u,d){var m=d.ref;(u===null&&m!==null||u!==null&&u.ref!==m)&&(d.flags|=512,d.flags|=2097152)}function X0(u,d,m,b,S){var C=ls(m)?Aa:Fn.current;return C=Xi(d,C),tl(d,S),m=M0(u,d,m,b,C,S),b=B0(),u!==null&&!us?(d.updateQueue=u.updateQueue,d.flags&=-2053,u.lanes&=~S,oo(u,d,S)):(At&&b&&k0(d),d.flags|=1,Kn(u,d,m,S),d.child)}function JS(u,d,m,b,S){if(ls(m)){var C=!0;Cp(d)}else C=!1;if(tl(d,S),d.stateNode===null)Up(u,d),VS(d,m,b),H0(d,m,b,S),b=!0;else if(u===null){var R=d.stateNode,V=d.memoizedProps;R.props=V;var Y=R.context,ue=m.contextType;typeof ue=="object"&&ue!==null?ue=Vs(ue):(ue=ls(m)?Aa:Fn.current,ue=Xi(d,ue));var xe=m.getDerivedStateFromProps,be=typeof xe=="function"||typeof R.getSnapshotBeforeUpdate=="function";be||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(V!==b||Y!==ue)&&WS(d,R,b,ue),Bo=!1;var ye=d.memoizedState;R.state=ye,Op(d,b,R,S),Y=d.memoizedState,V!==b||ye!==Y||is.current||Bo?(typeof xe=="function"&&(G0(d,m,xe,b),Y=d.memoizedState),(V=Bo||BS(d,m,V,b,ye,Y,ue))?(be||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(d.flags|=4194308)):(typeof R.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=b,d.memoizedState=Y),R.props=b,R.state=Y,R.context=ue,b=V):(typeof R.componentDidMount=="function"&&(d.flags|=4194308),b=!1)}else{R=d.stateNode,mS(u,d),V=d.memoizedProps,ue=d.type===d.elementType?V:ir(d.type,V),R.props=ue,be=d.pendingProps,ye=R.context,Y=m.contextType,typeof Y=="object"&&Y!==null?Y=Vs(Y):(Y=ls(m)?Aa:Fn.current,Y=Xi(d,Y));var Ee=m.getDerivedStateFromProps;(xe=typeof Ee=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(V!==be||ye!==Y)&&WS(d,R,b,Y),Bo=!1,ye=d.memoizedState,R.state=ye,Op(d,b,R,S);var _e=d.memoizedState;V!==be||ye!==_e||is.current||Bo?(typeof Ee=="function"&&(G0(d,m,Ee,b),_e=d.memoizedState),(ue=Bo||BS(d,m,ue,b,ye,_e,Y)||!1)?(xe||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(b,_e,Y),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(b,_e,Y)),typeof R.componentDidUpdate=="function"&&(d.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof R.componentDidUpdate!="function"||V===u.memoizedProps&&ye===u.memoizedState||(d.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||V===u.memoizedProps&&ye===u.memoizedState||(d.flags|=1024),d.memoizedProps=b,d.memoizedState=_e),R.props=b,R.state=_e,R.context=Y,b=ue):(typeof R.componentDidUpdate!="function"||V===u.memoizedProps&&ye===u.memoizedState||(d.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||V===u.memoizedProps&&ye===u.memoizedState||(d.flags|=1024),b=!1)}return Y0(u,d,m,b,C,S)}function Y0(u,d,m,b,S,C){ZS(u,d);var R=(d.flags&128)!==0;if(!b&&!R)return S&&rS(d,m,!1),oo(u,d,C);b=d.stateNode,VO.current=d;var V=R&&typeof m.getDerivedStateFromError!="function"?null:b.render();return d.flags|=1,u!==null&&R?(d.child=Ji(d,u.child,null,C),d.child=Ji(d,null,V,C)):Kn(u,d,V,C),d.memoizedState=b.state,S&&rS(d,m,!0),d.child}function eN(u){var d=u.stateNode;d.pendingContext?nS(u,d.pendingContext,d.pendingContext!==d.context):d.context&&nS(u,d.context,!1),_0(u,d.containerInfo)}function tN(u,d,m,b,S){return Zi(),I0(S),d.flags|=256,Kn(u,d,m,b),d.child}var Q0={dehydrated:null,treeContext:null,retryLane:0};function Z0(u){return{baseLanes:u,cachePool:null,transitions:null}}function nN(u,d,m){var b=d.pendingProps,S=Pt.current,C=!1,R=(d.flags&128)!==0,V;if((V=R)||(V=u!==null&&u.memoizedState===null?!1:(S&2)!==0),V?(C=!0,d.flags&=-129):(u===null||u.memoizedState!==null)&&(S|=1),Ct(Pt,S&1),u===null)return C0(d),u=d.memoizedState,u!==null&&(u=u.dehydrated,u!==null)?((d.mode&1)===0?d.lanes=1:u.data==="$!"?d.lanes=8:d.lanes=1073741824,null):(R=b.children,u=b.fallback,C?(b=d.mode,C=d.child,R={mode:"hidden",children:R},(b&1)===0&&C!==null?(C.childLanes=0,C.pendingProps=R):C=tf(R,b,0,null),u=Va(u,b,m,null),C.return=d,u.return=d,C.sibling=u,d.child=C,d.child.memoizedState=Z0(m),d.memoizedState=Q0,u):J0(d,R));if(S=u.memoizedState,S!==null&&(V=S.dehydrated,V!==null))return WO(u,d,R,b,V,S,m);if(C){C=b.fallback,R=d.mode,S=u.child,V=S.sibling;var Y={mode:"hidden",children:b.children};return(R&1)===0&&d.child!==S?(b=d.child,b.childLanes=0,b.pendingProps=Y,d.deletions=null):(b=qo(S,Y),b.subtreeFlags=S.subtreeFlags&14680064),V!==null?C=qo(V,C):(C=Va(C,R,m,null),C.flags|=2),C.return=d,b.return=d,b.sibling=C,d.child=b,b=C,C=d.child,R=u.child.memoizedState,R=R===null?Z0(m):{baseLanes:R.baseLanes|m,cachePool:null,transitions:R.transitions},C.memoizedState=R,C.childLanes=u.childLanes&~m,d.memoizedState=Q0,b}return C=u.child,u=C.sibling,b=qo(C,{mode:"visible",children:b.children}),(d.mode&1)===0&&(b.lanes=m),b.return=d,b.sibling=null,u!==null&&(m=d.deletions,m===null?(d.deletions=[u],d.flags|=16):m.push(u)),d.child=b,d.memoizedState=null,b}function J0(u,d){return d=tf({mode:"visible",children:d},u.mode,0,null),d.return=u,u.child=d}function Wp(u,d,m,b){return b!==null&&I0(b),Ji(d,u.child,null,m),u=J0(d,d.pendingProps.children),u.flags|=2,d.memoizedState=null,u}function WO(u,d,m,b,S,C,R){if(m)return d.flags&256?(d.flags&=-257,b=q0(Error(t(422))),Wp(u,d,R,b)):d.memoizedState!==null?(d.child=u.child,d.flags|=128,null):(C=b.fallback,S=d.mode,b=tf({mode:"visible",children:b.children},S,0,null),C=Va(C,S,R,null),C.flags|=2,b.return=d,C.return=d,b.sibling=C,d.child=b,(d.mode&1)!==0&&Ji(d,u.child,null,R),d.child.memoizedState=Z0(R),d.memoizedState=Q0,C);if((d.mode&1)===0)return Wp(u,d,R,null);if(S.data==="$!"){if(b=S.nextSibling&&S.nextSibling.dataset,b)var V=b.dgst;return b=V,C=Error(t(419)),b=q0(C,b,void 0),Wp(u,d,R,b)}if(V=(R&u.childLanes)!==0,us||V){if(b=yn,b!==null){switch(R&-R){case 4:S=2;break;case 16:S=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:S=32;break;case 536870912:S=268435456;break;default:S=0}S=(S&(b.suspendedLanes|R))!==0?0:S,S!==0&&S!==C.retryLane&&(C.retryLane=S,so(u,S),cr(b,u,S,-1))}return mx(),b=q0(Error(t(421))),Wp(u,d,R,b)}return S.data==="$?"?(d.flags|=128,d.child=u.child,d=tF.bind(null,u),S._reactRetry=d,null):(u=C.treeContext,Is=Lo(S.nextSibling),Cs=d,At=!0,ar=null,u!==null&&(Ms[Bs++]=to,Ms[Bs++]=no,Ms[Bs++]=Da,to=u.id,no=u.overflow,Da=d),d=J0(d,b.children),d.flags|=4096,d)}function sN(u,d,m){u.lanes|=d;var b=u.alternate;b!==null&&(b.lanes|=d),R0(u.return,d,m)}function ex(u,d,m,b,S){var C=u.memoizedState;C===null?u.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:b,tail:m,tailMode:S}:(C.isBackwards=d,C.rendering=null,C.renderingStartTime=0,C.last=b,C.tail=m,C.tailMode=S)}function rN(u,d,m){var b=d.pendingProps,S=b.revealOrder,C=b.tail;if(Kn(u,d,b.children,m),b=Pt.current,(b&2)!==0)b=b&1|2,d.flags|=128;else{if(u!==null&&(u.flags&128)!==0)e:for(u=d.child;u!==null;){if(u.tag===13)u.memoizedState!==null&&sN(u,m,d);else if(u.tag===19)sN(u,m,d);else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===d)break e;for(;u.sibling===null;){if(u.return===null||u.return===d)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}b&=1}if(Ct(Pt,b),(d.mode&1)===0)d.memoizedState=null;else switch(S){case"forwards":for(m=d.child,S=null;m!==null;)u=m.alternate,u!==null&&Fp(u)===null&&(S=m),m=m.sibling;m=S,m===null?(S=d.child,d.child=null):(S=m.sibling,m.sibling=null),ex(d,!1,S,m,C);break;case"backwards":for(m=null,S=d.child,d.child=null;S!==null;){if(u=S.alternate,u!==null&&Fp(u)===null){d.child=S;break}u=S.sibling,S.sibling=m,m=S,S=u}ex(d,!0,m,null,C);break;case"together":ex(d,!1,null,null,void 0);break;default:d.memoizedState=null}return d.child}function Up(u,d){(d.mode&1)===0&&u!==null&&(u.alternate=null,d.alternate=null,d.flags|=2)}function oo(u,d,m){if(u!==null&&(d.dependencies=u.dependencies),Pa|=d.lanes,(m&d.childLanes)===0)return null;if(u!==null&&d.child!==u.child)throw Error(t(153));if(d.child!==null){for(u=d.child,m=qo(u,u.pendingProps),d.child=m,m.return=d;u.sibling!==null;)u=u.sibling,m=m.sibling=qo(u,u.pendingProps),m.return=d;m.sibling=null}return d.child}function UO(u,d,m){switch(d.tag){case 3:eN(d),Zi();break;case 5:xS(d);break;case 1:ls(d.type)&&Cp(d);break;case 4:_0(d,d.stateNode.containerInfo);break;case 10:var b=d.type._context,S=d.memoizedProps.value;Ct(Ap,b._currentValue),b._currentValue=S;break;case 13:if(b=d.memoizedState,b!==null)return b.dehydrated!==null?(Ct(Pt,Pt.current&1),d.flags|=128,null):(m&d.child.childLanes)!==0?nN(u,d,m):(Ct(Pt,Pt.current&1),u=oo(u,d,m),u!==null?u.sibling:null);Ct(Pt,Pt.current&1);break;case 19:if(b=(m&d.childLanes)!==0,(u.flags&128)!==0){if(b)return rN(u,d,m);d.flags|=128}if(S=d.memoizedState,S!==null&&(S.rendering=null,S.tail=null,S.lastEffect=null),Ct(Pt,Pt.current),b)break;return null;case 22:case 23:return d.lanes=0,QS(u,d,m)}return oo(u,d,m)}var oN,tx,aN,iN;oN=function(u,d){for(var m=d.child;m!==null;){if(m.tag===5||m.tag===6)u.appendChild(m.stateNode);else if(m.tag!==4&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===d)break;for(;m.sibling===null;){if(m.return===null||m.return===d)return;m=m.return}m.sibling.return=m.return,m=m.sibling}},tx=function(){},aN=function(u,d,m,b){var S=u.memoizedProps;if(S!==b){u=d.stateNode,Fa(Rr.current);var C=null;switch(m){case"input":S=vt(u,S),b=vt(u,b),C=[];break;case"select":S=X({},S,{value:void 0}),b=X({},b,{value:void 0}),C=[];break;case"textarea":S=Tn(u,S),b=Tn(u,b),C=[];break;default:typeof S.onClick!="function"&&typeof b.onClick=="function"&&(u.onclick=kp)}Fy(m,b);var R;m=null;for(ue in S)if(!b.hasOwnProperty(ue)&&S.hasOwnProperty(ue)&&S[ue]!=null)if(ue==="style"){var V=S[ue];for(R in V)V.hasOwnProperty(R)&&(m||(m={}),m[R]="")}else ue!=="dangerouslySetInnerHTML"&&ue!=="children"&&ue!=="suppressContentEditableWarning"&&ue!=="suppressHydrationWarning"&&ue!=="autoFocus"&&(r.hasOwnProperty(ue)?C||(C=[]):(C=C||[]).push(ue,null));for(ue in b){var Y=b[ue];if(V=S!=null?S[ue]:void 0,b.hasOwnProperty(ue)&&Y!==V&&(Y!=null||V!=null))if(ue==="style")if(V){for(R in V)!V.hasOwnProperty(R)||Y&&Y.hasOwnProperty(R)||(m||(m={}),m[R]="");for(R in Y)Y.hasOwnProperty(R)&&V[R]!==Y[R]&&(m||(m={}),m[R]=Y[R])}else m||(C||(C=[]),C.push(ue,m)),m=Y;else ue==="dangerouslySetInnerHTML"?(Y=Y?Y.__html:void 0,V=V?V.__html:void 0,Y!=null&&V!==Y&&(C=C||[]).push(ue,Y)):ue==="children"?typeof Y!="string"&&typeof Y!="number"||(C=C||[]).push(ue,""+Y):ue!=="suppressContentEditableWarning"&&ue!=="suppressHydrationWarning"&&(r.hasOwnProperty(ue)?(Y!=null&&ue==="onScroll"&&It("scroll",u),C||V===Y||(C=[])):(C=C||[]).push(ue,Y))}m&&(C=C||[]).push("style",m);var ue=C;(d.updateQueue=ue)&&(d.flags|=4)}},iN=function(u,d,m,b){m!==b&&(d.flags|=4)};function Nc(u,d){if(!At)switch(u.tailMode){case"hidden":d=u.tail;for(var m=null;d!==null;)d.alternate!==null&&(m=d),d=d.sibling;m===null?u.tail=null:m.sibling=null;break;case"collapsed":m=u.tail;for(var b=null;m!==null;)m.alternate!==null&&(b=m),m=m.sibling;b===null?d||u.tail===null?u.tail=null:u.tail.sibling=null:b.sibling=null}}function Pn(u){var d=u.alternate!==null&&u.alternate.child===u.child,m=0,b=0;if(d)for(var S=u.child;S!==null;)m|=S.lanes|S.childLanes,b|=S.subtreeFlags&14680064,b|=S.flags&14680064,S.return=u,S=S.sibling;else for(S=u.child;S!==null;)m|=S.lanes|S.childLanes,b|=S.subtreeFlags,b|=S.flags,S.return=u,S=S.sibling;return u.subtreeFlags|=b,u.childLanes=m,d}function jO(u,d,m){var b=d.pendingProps;switch(S0(d),d.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pn(d),null;case 1:return ls(d.type)&&Np(),Pn(d),null;case 3:return b=d.stateNode,nl(),$t(is),$t(Fn),L0(),b.pendingContext&&(b.context=b.pendingContext,b.pendingContext=null),(u===null||u.child===null)&&(Ep(d)?d.flags|=4:u===null||u.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,ar!==null&&(hx(ar),ar=null))),tx(u,d),Pn(d),null;case 5:O0(d);var S=Fa(bc.current);if(m=d.type,u!==null&&d.stateNode!=null)aN(u,d,m,b,S),u.ref!==d.ref&&(d.flags|=512,d.flags|=2097152);else{if(!b){if(d.stateNode===null)throw Error(t(166));return Pn(d),null}if(u=Fa(Rr.current),Ep(d)){b=d.stateNode,m=d.type;var C=d.memoizedProps;switch(b[Er]=d,b[fc]=C,u=(d.mode&1)!==0,m){case"dialog":It("cancel",b),It("close",b);break;case"iframe":case"object":case"embed":It("load",b);break;case"video":case"audio":for(S=0;S<dc.length;S++)It(dc[S],b);break;case"source":It("error",b);break;case"img":case"image":case"link":It("error",b),It("load",b);break;case"details":It("toggle",b);break;case"input":ht(b,C),It("invalid",b);break;case"select":b._wrapperState={wasMultiple:!!C.multiple},It("invalid",b);break;case"textarea":$r(b,C),It("invalid",b)}Fy(m,C),S=null;for(var R in C)if(C.hasOwnProperty(R)){var V=C[R];R==="children"?typeof V=="string"?b.textContent!==V&&(C.suppressHydrationWarning!==!0&&vp(b.textContent,V,u),S=["children",V]):typeof V=="number"&&b.textContent!==""+V&&(C.suppressHydrationWarning!==!0&&vp(b.textContent,V,u),S=["children",""+V]):r.hasOwnProperty(R)&&V!=null&&R==="onScroll"&&It("scroll",b)}switch(m){case"input":Ge(b),bt(b,C,!0);break;case"textarea":Ge(b),Ps(b);break;case"select":case"option":break;default:typeof C.onClick=="function"&&(b.onclick=kp)}b=S,d.updateQueue=b,b!==null&&(d.flags|=4)}else{R=S.nodeType===9?S:S.ownerDocument,u==="http://www.w3.org/1999/xhtml"&&(u=sr(m)),u==="http://www.w3.org/1999/xhtml"?m==="script"?(u=R.createElement("div"),u.innerHTML="<script><\/script>",u=u.removeChild(u.firstChild)):typeof b.is=="string"?u=R.createElement(m,{is:b.is}):(u=R.createElement(m),m==="select"&&(R=u,b.multiple?R.multiple=!0:b.size&&(R.size=b.size))):u=R.createElementNS(u,m),u[Er]=d,u[fc]=b,oN(u,d,!1,!1),d.stateNode=u;e:{switch(R=Ly(m,b),m){case"dialog":It("cancel",u),It("close",u),S=b;break;case"iframe":case"object":case"embed":It("load",u),S=b;break;case"video":case"audio":for(S=0;S<dc.length;S++)It(dc[S],u);S=b;break;case"source":It("error",u),S=b;break;case"img":case"image":case"link":It("error",u),It("load",u),S=b;break;case"details":It("toggle",u),S=b;break;case"input":ht(u,b),S=vt(u,b),It("invalid",u);break;case"option":S=b;break;case"select":u._wrapperState={wasMultiple:!!b.multiple},S=X({},b,{value:void 0}),It("invalid",u);break;case"textarea":$r(u,b),S=Tn(u,b),It("invalid",u);break;default:S=b}Fy(m,S),V=S;for(C in V)if(V.hasOwnProperty(C)){var Y=V[C];C==="style"?ep(u,Y):C==="dangerouslySetInnerHTML"?(Y=Y?Y.__html:void 0,Y!=null&&Eo(u,Y)):C==="children"?typeof Y=="string"?(m!=="textarea"||Y!=="")&&Qr(u,Y):typeof Y=="number"&&Qr(u,""+Y):C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&C!=="autoFocus"&&(r.hasOwnProperty(C)?Y!=null&&C==="onScroll"&&It("scroll",u):Y!=null&&I(u,C,Y,R))}switch(m){case"input":Ge(u),bt(u,b,!1);break;case"textarea":Ge(u),Ps(u);break;case"option":b.value!=null&&u.setAttribute("value",""+Ne(b.value));break;case"select":u.multiple=!!b.multiple,C=b.value,C!=null?qn(u,!!b.multiple,C,!1):b.defaultValue!=null&&qn(u,!!b.multiple,b.defaultValue,!0);break;default:typeof S.onClick=="function"&&(u.onclick=kp)}switch(m){case"button":case"input":case"select":case"textarea":b=!!b.autoFocus;break e;case"img":b=!0;break e;default:b=!1}}b&&(d.flags|=4)}d.ref!==null&&(d.flags|=512,d.flags|=2097152)}return Pn(d),null;case 6:if(u&&d.stateNode!=null)iN(u,d,u.memoizedProps,b);else{if(typeof b!="string"&&d.stateNode===null)throw Error(t(166));if(m=Fa(bc.current),Fa(Rr.current),Ep(d)){if(b=d.stateNode,m=d.memoizedProps,b[Er]=d,(C=b.nodeValue!==m)&&(u=Cs,u!==null))switch(u.tag){case 3:vp(b.nodeValue,m,(u.mode&1)!==0);break;case 5:u.memoizedProps.suppressHydrationWarning!==!0&&vp(b.nodeValue,m,(u.mode&1)!==0)}C&&(d.flags|=4)}else b=(m.nodeType===9?m:m.ownerDocument).createTextNode(b),b[Er]=d,d.stateNode=b}return Pn(d),null;case 13:if($t(Pt),b=d.memoizedState,u===null||u.memoizedState!==null&&u.memoizedState.dehydrated!==null){if(At&&Is!==null&&(d.mode&1)!==0&&(d.flags&128)===0)cS(),Zi(),d.flags|=98560,C=!1;else if(C=Ep(d),b!==null&&b.dehydrated!==null){if(u===null){if(!C)throw Error(t(318));if(C=d.memoizedState,C=C!==null?C.dehydrated:null,!C)throw Error(t(317));C[Er]=d}else Zi(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;Pn(d),C=!1}else ar!==null&&(hx(ar),ar=null),C=!0;if(!C)return d.flags&65536?d:null}return(d.flags&128)!==0?(d.lanes=m,d):(b=b!==null,b!==(u!==null&&u.memoizedState!==null)&&b&&(d.child.flags|=8192,(d.mode&1)!==0&&(u===null||(Pt.current&1)!==0?ln===0&&(ln=3):mx())),d.updateQueue!==null&&(d.flags|=4),Pn(d),null);case 4:return nl(),tx(u,d),u===null&&hc(d.stateNode.containerInfo),Pn(d),null;case 10:return E0(d.type._context),Pn(d),null;case 17:return ls(d.type)&&Np(),Pn(d),null;case 19:if($t(Pt),C=d.memoizedState,C===null)return Pn(d),null;if(b=(d.flags&128)!==0,R=C.rendering,R===null)if(b)Nc(C,!1);else{if(ln!==0||u!==null&&(u.flags&128)!==0)for(u=d.child;u!==null;){if(R=Fp(u),R!==null){for(d.flags|=128,Nc(C,!1),b=R.updateQueue,b!==null&&(d.updateQueue=b,d.flags|=4),d.subtreeFlags=0,b=m,m=d.child;m!==null;)C=m,u=b,C.flags&=14680066,R=C.alternate,R===null?(C.childLanes=0,C.lanes=u,C.child=null,C.subtreeFlags=0,C.memoizedProps=null,C.memoizedState=null,C.updateQueue=null,C.dependencies=null,C.stateNode=null):(C.childLanes=R.childLanes,C.lanes=R.lanes,C.child=R.child,C.subtreeFlags=0,C.deletions=null,C.memoizedProps=R.memoizedProps,C.memoizedState=R.memoizedState,C.updateQueue=R.updateQueue,C.type=R.type,u=R.dependencies,C.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext}),m=m.sibling;return Ct(Pt,Pt.current&1|2),d.child}u=u.sibling}C.tail!==null&&qt()>al&&(d.flags|=128,b=!0,Nc(C,!1),d.lanes=4194304)}else{if(!b)if(u=Fp(R),u!==null){if(d.flags|=128,b=!0,m=u.updateQueue,m!==null&&(d.updateQueue=m,d.flags|=4),Nc(C,!0),C.tail===null&&C.tailMode==="hidden"&&!R.alternate&&!At)return Pn(d),null}else 2*qt()-C.renderingStartTime>al&&m!==1073741824&&(d.flags|=128,b=!0,Nc(C,!1),d.lanes=4194304);C.isBackwards?(R.sibling=d.child,d.child=R):(m=C.last,m!==null?m.sibling=R:d.child=R,C.last=R)}return C.tail!==null?(d=C.tail,C.rendering=d,C.tail=d.sibling,C.renderingStartTime=qt(),d.sibling=null,m=Pt.current,Ct(Pt,b?m&1|2:m&1),d):(Pn(d),null);case 22:case 23:return fx(),b=d.memoizedState!==null,u!==null&&u.memoizedState!==null!==b&&(d.flags|=8192),b&&(d.mode&1)!==0?($s&1073741824)!==0&&(Pn(d),d.subtreeFlags&6&&(d.flags|=8192)):Pn(d),null;case 24:return null;case 25:return null}throw Error(t(156,d.tag))}function GO(u,d){switch(S0(d),d.tag){case 1:return ls(d.type)&&Np(),u=d.flags,u&65536?(d.flags=u&-65537|128,d):null;case 3:return nl(),$t(is),$t(Fn),L0(),u=d.flags,(u&65536)!==0&&(u&128)===0?(d.flags=u&-65537|128,d):null;case 5:return O0(d),null;case 13:if($t(Pt),u=d.memoizedState,u!==null&&u.dehydrated!==null){if(d.alternate===null)throw Error(t(340));Zi()}return u=d.flags,u&65536?(d.flags=u&-65537|128,d):null;case 19:return $t(Pt),null;case 4:return nl(),null;case 10:return E0(d.type._context),null;case 22:case 23:return fx(),null;case 24:return null;default:return null}}var jp=!1,zn=!1,HO=typeof WeakSet=="function"?WeakSet:Set,Re=null;function rl(u,d){var m=u.ref;if(m!==null)if(typeof m=="function")try{m(null)}catch(b){Bt(u,d,b)}else m.current=null}function nx(u,d,m){try{m()}catch(b){Bt(u,d,b)}}var lN=!1;function qO(u,d){if(f0=cp,u=Bk(),a0(u)){if("selectionStart"in u)var m={start:u.selectionStart,end:u.selectionEnd};else e:{m=(m=u.ownerDocument)&&m.defaultView||window;var b=m.getSelection&&m.getSelection();if(b&&b.rangeCount!==0){m=b.anchorNode;var S=b.anchorOffset,C=b.focusNode;b=b.focusOffset;try{m.nodeType,C.nodeType}catch{m=null;break e}var R=0,V=-1,Y=-1,ue=0,xe=0,be=u,ye=null;t:for(;;){for(var Ee;be!==m||S!==0&&be.nodeType!==3||(V=R+S),be!==C||b!==0&&be.nodeType!==3||(Y=R+b),be.nodeType===3&&(R+=be.nodeValue.length),(Ee=be.firstChild)!==null;)ye=be,be=Ee;for(;;){if(be===u)break t;if(ye===m&&++ue===S&&(V=R),ye===C&&++xe===b&&(Y=R),(Ee=be.nextSibling)!==null)break;be=ye,ye=be.parentNode}be=Ee}m=V===-1||Y===-1?null:{start:V,end:Y}}else m=null}m=m||{start:0,end:0}}else m=null;for(m0={focusedElem:u,selectionRange:m},cp=!1,Re=d;Re!==null;)if(d=Re,u=d.child,(d.subtreeFlags&1028)!==0&&u!==null)u.return=d,Re=u;else for(;Re!==null;){d=Re;try{var _e=d.alternate;if((d.flags&1024)!==0)switch(d.tag){case 0:case 11:case 15:break;case 1:if(_e!==null){var Le=_e.memoizedProps,Kt=_e.memoizedState,ae=d.stateNode,ee=ae.getSnapshotBeforeUpdate(d.elementType===d.type?Le:ir(d.type,Le),Kt);ae.__reactInternalSnapshotBeforeUpdate=ee}break;case 3:var ie=d.stateNode.containerInfo;ie.nodeType===1?ie.textContent="":ie.nodeType===9&&ie.documentElement&&ie.removeChild(ie.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(we){Bt(d,d.return,we)}if(u=d.sibling,u!==null){u.return=d.return,Re=u;break}Re=d.return}return _e=lN,lN=!1,_e}function Cc(u,d,m){var b=d.updateQueue;if(b=b!==null?b.lastEffect:null,b!==null){var S=b=b.next;do{if((S.tag&u)===u){var C=S.destroy;S.destroy=void 0,C!==void 0&&nx(d,m,C)}S=S.next}while(S!==b)}}function Gp(u,d){if(d=d.updateQueue,d=d!==null?d.lastEffect:null,d!==null){var m=d=d.next;do{if((m.tag&u)===u){var b=m.create;m.destroy=b()}m=m.next}while(m!==d)}}function sx(u){var d=u.ref;if(d!==null){var m=u.stateNode;switch(u.tag){case 5:u=m;break;default:u=m}typeof d=="function"?d(u):d.current=u}}function uN(u){var d=u.alternate;d!==null&&(u.alternate=null,uN(d)),u.child=null,u.deletions=null,u.sibling=null,u.tag===5&&(d=u.stateNode,d!==null&&(delete d[Er],delete d[fc],delete d[b0],delete d[EO],delete d[RO])),u.stateNode=null,u.return=null,u.dependencies=null,u.memoizedProps=null,u.memoizedState=null,u.pendingProps=null,u.stateNode=null,u.updateQueue=null}function cN(u){return u.tag===5||u.tag===3||u.tag===4}function dN(u){e:for(;;){for(;u.sibling===null;){if(u.return===null||cN(u.return))return null;u=u.return}for(u.sibling.return=u.return,u=u.sibling;u.tag!==5&&u.tag!==6&&u.tag!==18;){if(u.flags&2||u.child===null||u.tag===4)continue e;u.child.return=u,u=u.child}if(!(u.flags&2))return u.stateNode}}function rx(u,d,m){var b=u.tag;if(b===5||b===6)u=u.stateNode,d?m.nodeType===8?m.parentNode.insertBefore(u,d):m.insertBefore(u,d):(m.nodeType===8?(d=m.parentNode,d.insertBefore(u,m)):(d=m,d.appendChild(u)),m=m._reactRootContainer,m!=null||d.onclick!==null||(d.onclick=kp));else if(b!==4&&(u=u.child,u!==null))for(rx(u,d,m),u=u.sibling;u!==null;)rx(u,d,m),u=u.sibling}function ox(u,d,m){var b=u.tag;if(b===5||b===6)u=u.stateNode,d?m.insertBefore(u,d):m.appendChild(u);else if(b!==4&&(u=u.child,u!==null))for(ox(u,d,m),u=u.sibling;u!==null;)ox(u,d,m),u=u.sibling}var En=null,lr=!1;function Wo(u,d,m){for(m=m.child;m!==null;)hN(u,d,m),m=m.sibling}function hN(u,d,m){if(Tr&&typeof Tr.onCommitFiberUnmount=="function")try{Tr.onCommitFiberUnmount(rp,m)}catch{}switch(m.tag){case 5:zn||rl(m,d);case 6:var b=En,S=lr;En=null,Wo(u,d,m),En=b,lr=S,En!==null&&(lr?(u=En,m=m.stateNode,u.nodeType===8?u.parentNode.removeChild(m):u.removeChild(m)):En.removeChild(m.stateNode));break;case 18:En!==null&&(lr?(u=En,m=m.stateNode,u.nodeType===8?x0(u.parentNode,m):u.nodeType===1&&x0(u,m),sc(u)):x0(En,m.stateNode));break;case 4:b=En,S=lr,En=m.stateNode.containerInfo,lr=!0,Wo(u,d,m),En=b,lr=S;break;case 0:case 11:case 14:case 15:if(!zn&&(b=m.updateQueue,b!==null&&(b=b.lastEffect,b!==null))){S=b=b.next;do{var C=S,R=C.destroy;C=C.tag,R!==void 0&&((C&2)!==0||(C&4)!==0)&&nx(m,d,R),S=S.next}while(S!==b)}Wo(u,d,m);break;case 1:if(!zn&&(rl(m,d),b=m.stateNode,typeof b.componentWillUnmount=="function"))try{b.props=m.memoizedProps,b.state=m.memoizedState,b.componentWillUnmount()}catch(V){Bt(m,d,V)}Wo(u,d,m);break;case 21:Wo(u,d,m);break;case 22:m.mode&1?(zn=(b=zn)||m.memoizedState!==null,Wo(u,d,m),zn=b):Wo(u,d,m);break;default:Wo(u,d,m)}}function pN(u){var d=u.updateQueue;if(d!==null){u.updateQueue=null;var m=u.stateNode;m===null&&(m=u.stateNode=new HO),d.forEach(function(b){var S=nF.bind(null,u,b);m.has(b)||(m.add(b),b.then(S,S))})}}function ur(u,d){var m=d.deletions;if(m!==null)for(var b=0;b<m.length;b++){var S=m[b];try{var C=u,R=d,V=R;e:for(;V!==null;){switch(V.tag){case 5:En=V.stateNode,lr=!1;break e;case 3:En=V.stateNode.containerInfo,lr=!0;break e;case 4:En=V.stateNode.containerInfo,lr=!0;break e}V=V.return}if(En===null)throw Error(t(160));hN(C,R,S),En=null,lr=!1;var Y=S.alternate;Y!==null&&(Y.return=null),S.return=null}catch(ue){Bt(S,d,ue)}}if(d.subtreeFlags&12854)for(d=d.child;d!==null;)fN(d,u),d=d.sibling}function fN(u,d){var m=u.alternate,b=u.flags;switch(u.tag){case 0:case 11:case 14:case 15:if(ur(d,u),Dr(u),b&4){try{Cc(3,u,u.return),Gp(3,u)}catch(Le){Bt(u,u.return,Le)}try{Cc(5,u,u.return)}catch(Le){Bt(u,u.return,Le)}}break;case 1:ur(d,u),Dr(u),b&512&&m!==null&&rl(m,m.return);break;case 5:if(ur(d,u),Dr(u),b&512&&m!==null&&rl(m,m.return),u.flags&32){var S=u.stateNode;try{Qr(S,"")}catch(Le){Bt(u,u.return,Le)}}if(b&4&&(S=u.stateNode,S!=null)){var C=u.memoizedProps,R=m!==null?m.memoizedProps:C,V=u.type,Y=u.updateQueue;if(u.updateQueue=null,Y!==null)try{V==="input"&&C.type==="radio"&&C.name!=null&&ut(S,C),Ly(V,R);var ue=Ly(V,C);for(R=0;R<Y.length;R+=2){var xe=Y[R],be=Y[R+1];xe==="style"?ep(S,be):xe==="dangerouslySetInnerHTML"?Eo(S,be):xe==="children"?Qr(S,be):I(S,xe,be,ue)}switch(V){case"input":xt(S,C);break;case"textarea":as(S,C);break;case"select":var ye=S._wrapperState.wasMultiple;S._wrapperState.wasMultiple=!!C.multiple;var Ee=C.value;Ee!=null?qn(S,!!C.multiple,Ee,!1):ye!==!!C.multiple&&(C.defaultValue!=null?qn(S,!!C.multiple,C.defaultValue,!0):qn(S,!!C.multiple,C.multiple?[]:"",!1))}S[fc]=C}catch(Le){Bt(u,u.return,Le)}}break;case 6:if(ur(d,u),Dr(u),b&4){if(u.stateNode===null)throw Error(t(162));S=u.stateNode,C=u.memoizedProps;try{S.nodeValue=C}catch(Le){Bt(u,u.return,Le)}}break;case 3:if(ur(d,u),Dr(u),b&4&&m!==null&&m.memoizedState.isDehydrated)try{sc(d.containerInfo)}catch(Le){Bt(u,u.return,Le)}break;case 4:ur(d,u),Dr(u);break;case 13:ur(d,u),Dr(u),S=u.child,S.flags&8192&&(C=S.memoizedState!==null,S.stateNode.isHidden=C,!C||S.alternate!==null&&S.alternate.memoizedState!==null||(lx=qt())),b&4&&pN(u);break;case 22:if(xe=m!==null&&m.memoizedState!==null,u.mode&1?(zn=(ue=zn)||xe,ur(d,u),zn=ue):ur(d,u),Dr(u),b&8192){if(ue=u.memoizedState!==null,(u.stateNode.isHidden=ue)&&!xe&&(u.mode&1)!==0)for(Re=u,xe=u.child;xe!==null;){for(be=Re=xe;Re!==null;){switch(ye=Re,Ee=ye.child,ye.tag){case 0:case 11:case 14:case 15:Cc(4,ye,ye.return);break;case 1:rl(ye,ye.return);var _e=ye.stateNode;if(typeof _e.componentWillUnmount=="function"){b=ye,m=ye.return;try{d=b,_e.props=d.memoizedProps,_e.state=d.memoizedState,_e.componentWillUnmount()}catch(Le){Bt(b,m,Le)}}break;case 5:rl(ye,ye.return);break;case 22:if(ye.memoizedState!==null){yN(be);continue}}Ee!==null?(Ee.return=ye,Re=Ee):yN(be)}xe=xe.sibling}e:for(xe=null,be=u;;){if(be.tag===5){if(xe===null){xe=be;try{S=be.stateNode,ue?(C=S.style,typeof C.setProperty=="function"?C.setProperty("display","none","important"):C.display="none"):(V=be.stateNode,Y=be.memoizedProps.style,R=Y!=null&&Y.hasOwnProperty("display")?Y.display:null,V.style.display=Ta("display",R))}catch(Le){Bt(u,u.return,Le)}}}else if(be.tag===6){if(xe===null)try{be.stateNode.nodeValue=ue?"":be.memoizedProps}catch(Le){Bt(u,u.return,Le)}}else if((be.tag!==22&&be.tag!==23||be.memoizedState===null||be===u)&&be.child!==null){be.child.return=be,be=be.child;continue}if(be===u)break e;for(;be.sibling===null;){if(be.return===null||be.return===u)break e;xe===be&&(xe=null),be=be.return}xe===be&&(xe=null),be.sibling.return=be.return,be=be.sibling}}break;case 19:ur(d,u),Dr(u),b&4&&pN(u);break;case 21:break;default:ur(d,u),Dr(u)}}function Dr(u){var d=u.flags;if(d&2){try{e:{for(var m=u.return;m!==null;){if(cN(m)){var b=m;break e}m=m.return}throw Error(t(160))}switch(b.tag){case 5:var S=b.stateNode;b.flags&32&&(Qr(S,""),b.flags&=-33);var C=dN(u);ox(u,C,S);break;case 3:case 4:var R=b.stateNode.containerInfo,V=dN(u);rx(u,V,R);break;default:throw Error(t(161))}}catch(Y){Bt(u,u.return,Y)}u.flags&=-3}d&4096&&(u.flags&=-4097)}function KO(u,d,m){Re=u,mN(u)}function mN(u,d,m){for(var b=(u.mode&1)!==0;Re!==null;){var S=Re,C=S.child;if(S.tag===22&&b){var R=S.memoizedState!==null||jp;if(!R){var V=S.alternate,Y=V!==null&&V.memoizedState!==null||zn;V=jp;var ue=zn;if(jp=R,(zn=Y)&&!ue)for(Re=S;Re!==null;)R=Re,Y=R.child,R.tag===22&&R.memoizedState!==null?xN(S):Y!==null?(Y.return=R,Re=Y):xN(S);for(;C!==null;)Re=C,mN(C),C=C.sibling;Re=S,jp=V,zn=ue}gN(u)}else(S.subtreeFlags&8772)!==0&&C!==null?(C.return=S,Re=C):gN(u)}}function gN(u){for(;Re!==null;){var d=Re;if((d.flags&8772)!==0){var m=d.alternate;try{if((d.flags&8772)!==0)switch(d.tag){case 0:case 11:case 15:zn||Gp(5,d);break;case 1:var b=d.stateNode;if(d.flags&4&&!zn)if(m===null)b.componentDidMount();else{var S=d.elementType===d.type?m.memoizedProps:ir(d.type,m.memoizedProps);b.componentDidUpdate(S,m.memoizedState,b.__reactInternalSnapshotBeforeUpdate)}var C=d.updateQueue;C!==null&&yS(d,C,b);break;case 3:var R=d.updateQueue;if(R!==null){if(m=null,d.child!==null)switch(d.child.tag){case 5:m=d.child.stateNode;break;case 1:m=d.child.stateNode}yS(d,R,m)}break;case 5:var V=d.stateNode;if(m===null&&d.flags&4){m=V;var Y=d.memoizedProps;switch(d.type){case"button":case"input":case"select":case"textarea":Y.autoFocus&&m.focus();break;case"img":Y.src&&(m.src=Y.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(d.memoizedState===null){var ue=d.alternate;if(ue!==null){var xe=ue.memoizedState;if(xe!==null){var be=xe.dehydrated;be!==null&&sc(be)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}zn||d.flags&512&&sx(d)}catch(ye){Bt(d,d.return,ye)}}if(d===u){Re=null;break}if(m=d.sibling,m!==null){m.return=d.return,Re=m;break}Re=d.return}}function yN(u){for(;Re!==null;){var d=Re;if(d===u){Re=null;break}var m=d.sibling;if(m!==null){m.return=d.return,Re=m;break}Re=d.return}}function xN(u){for(;Re!==null;){var d=Re;try{switch(d.tag){case 0:case 11:case 15:var m=d.return;try{Gp(4,d)}catch(Y){Bt(d,m,Y)}break;case 1:var b=d.stateNode;if(typeof b.componentDidMount=="function"){var S=d.return;try{b.componentDidMount()}catch(Y){Bt(d,S,Y)}}var C=d.return;try{sx(d)}catch(Y){Bt(d,C,Y)}break;case 5:var R=d.return;try{sx(d)}catch(Y){Bt(d,R,Y)}}}catch(Y){Bt(d,d.return,Y)}if(d===u){Re=null;break}var V=d.sibling;if(V!==null){V.return=d.return,Re=V;break}Re=d.return}}var XO=Math.ceil,Hp=N.ReactCurrentDispatcher,ax=N.ReactCurrentOwner,Us=N.ReactCurrentBatchConfig,it=0,yn=null,Zt=null,Rn=0,$s=0,ol=Po(0),ln=0,Ic=null,Pa=0,qp=0,ix=0,$c=null,cs=null,lx=0,al=1/0,ao=null,Kp=!1,ux=null,Uo=null,Xp=!1,jo=null,Yp=0,Tc=0,cx=null,Qp=-1,Zp=0;function Xn(){return(it&6)!==0?qt():Qp!==-1?Qp:Qp=qt()}function Go(u){return(u.mode&1)===0?1:(it&2)!==0&&Rn!==0?Rn&-Rn:DO.transition!==null?(Zp===0&&(Zp=dk()),Zp):(u=mt,u!==0||(u=window.event,u=u===void 0?16:wk(u.type)),u)}function cr(u,d,m,b){if(50<Tc)throw Tc=0,cx=null,Error(t(185));Zu(u,m,b),((it&2)===0||u!==yn)&&(u===yn&&((it&2)===0&&(qp|=m),ln===4&&Ho(u,Rn)),ds(u,b),m===1&&it===0&&(d.mode&1)===0&&(al=qt()+500,Ip&&Mo()))}function ds(u,d){var m=u.callbackNode;D_(u,d);var b=ip(u,u===yn?Rn:0);if(b===0)m!==null&&lk(m),u.callbackNode=null,u.callbackPriority=0;else if(d=b&-b,u.callbackPriority!==d){if(m!=null&&lk(m),d===1)u.tag===0?AO(wN.bind(null,u)):oS(wN.bind(null,u)),$O(function(){(it&6)===0&&Mo()}),m=null;else{switch(hk(b)){case 1:m=Uy;break;case 4:m=uk;break;case 16:m=sp;break;case 536870912:m=ck;break;default:m=sp}m=TN(m,bN.bind(null,u))}u.callbackPriority=d,u.callbackNode=m}}function bN(u,d){if(Qp=-1,Zp=0,(it&6)!==0)throw Error(t(327));var m=u.callbackNode;if(il()&&u.callbackNode!==m)return null;var b=ip(u,u===yn?Rn:0);if(b===0)return null;if((b&30)!==0||(b&u.expiredLanes)!==0||d)d=Jp(u,b);else{d=b;var S=it;it|=2;var C=kN();(yn!==u||Rn!==d)&&(ao=null,al=qt()+500,Ma(u,d));do try{ZO();break}catch(V){vN(u,V)}while(!0);T0(),Hp.current=C,it=S,Zt!==null?d=0:(yn=null,Rn=0,d=ln)}if(d!==0){if(d===2&&(S=jy(u),S!==0&&(b=S,d=dx(u,S))),d===1)throw m=Ic,Ma(u,0),Ho(u,b),ds(u,qt()),m;if(d===6)Ho(u,b);else{if(S=u.current.alternate,(b&30)===0&&!YO(S)&&(d=Jp(u,b),d===2&&(C=jy(u),C!==0&&(b=C,d=dx(u,C))),d===1))throw m=Ic,Ma(u,0),Ho(u,b),ds(u,qt()),m;switch(u.finishedWork=S,u.finishedLanes=b,d){case 0:case 1:throw Error(t(345));case 2:Ba(u,cs,ao);break;case 3:if(Ho(u,b),(b&130023424)===b&&(d=lx+500-qt(),10<d)){if(ip(u,0)!==0)break;if(S=u.suspendedLanes,(S&b)!==b){Xn(),u.pingedLanes|=u.suspendedLanes&S;break}u.timeoutHandle=y0(Ba.bind(null,u,cs,ao),d);break}Ba(u,cs,ao);break;case 4:if(Ho(u,b),(b&4194240)===b)break;for(d=u.eventTimes,S=-1;0<b;){var R=31-rr(b);C=1<<R,R=d[R],R>S&&(S=R),b&=~C}if(b=S,b=qt()-b,b=(120>b?120:480>b?480:1080>b?1080:1920>b?1920:3e3>b?3e3:4320>b?4320:1960*XO(b/1960))-b,10<b){u.timeoutHandle=y0(Ba.bind(null,u,cs,ao),b);break}Ba(u,cs,ao);break;case 5:Ba(u,cs,ao);break;default:throw Error(t(329))}}}return ds(u,qt()),u.callbackNode===m?bN.bind(null,u):null}function dx(u,d){var m=$c;return u.current.memoizedState.isDehydrated&&(Ma(u,d).flags|=256),u=Jp(u,d),u!==2&&(d=cs,cs=m,d!==null&&hx(d)),u}function hx(u){cs===null?cs=u:cs.push.apply(cs,u)}function YO(u){for(var d=u;;){if(d.flags&16384){var m=d.updateQueue;if(m!==null&&(m=m.stores,m!==null))for(var b=0;b<m.length;b++){var S=m[b],C=S.getSnapshot;S=S.value;try{if(!or(C(),S))return!1}catch{return!1}}}if(m=d.child,d.subtreeFlags&16384&&m!==null)m.return=d,d=m;else{if(d===u)break;for(;d.sibling===null;){if(d.return===null||d.return===u)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function Ho(u,d){for(d&=~ix,d&=~qp,u.suspendedLanes|=d,u.pingedLanes&=~d,u=u.expirationTimes;0<d;){var m=31-rr(d),b=1<<m;u[m]=-1,d&=~b}}function wN(u){if((it&6)!==0)throw Error(t(327));il();var d=ip(u,0);if((d&1)===0)return ds(u,qt()),null;var m=Jp(u,d);if(u.tag!==0&&m===2){var b=jy(u);b!==0&&(d=b,m=dx(u,b))}if(m===1)throw m=Ic,Ma(u,0),Ho(u,d),ds(u,qt()),m;if(m===6)throw Error(t(345));return u.finishedWork=u.current.alternate,u.finishedLanes=d,Ba(u,cs,ao),ds(u,qt()),null}function px(u,d){var m=it;it|=1;try{return u(d)}finally{it=m,it===0&&(al=qt()+500,Ip&&Mo())}}function za(u){jo!==null&&jo.tag===0&&(it&6)===0&&il();var d=it;it|=1;var m=Us.transition,b=mt;try{if(Us.transition=null,mt=1,u)return u()}finally{mt=b,Us.transition=m,it=d,(it&6)===0&&Mo()}}function fx(){$s=ol.current,$t(ol)}function Ma(u,d){u.finishedWork=null,u.finishedLanes=0;var m=u.timeoutHandle;if(m!==-1&&(u.timeoutHandle=-1,IO(m)),Zt!==null)for(m=Zt.return;m!==null;){var b=m;switch(S0(b),b.tag){case 1:b=b.type.childContextTypes,b!=null&&Np();break;case 3:nl(),$t(is),$t(Fn),L0();break;case 5:O0(b);break;case 4:nl();break;case 13:$t(Pt);break;case 19:$t(Pt);break;case 10:E0(b.type._context);break;case 22:case 23:fx()}m=m.return}if(yn=u,Zt=u=qo(u.current,null),Rn=$s=d,ln=0,Ic=null,ix=qp=Pa=0,cs=$c=null,Oa!==null){for(d=0;d<Oa.length;d++)if(m=Oa[d],b=m.interleaved,b!==null){m.interleaved=null;var S=b.next,C=m.pending;if(C!==null){var R=C.next;C.next=S,b.next=R}m.pending=b}Oa=null}return u}function vN(u,d){do{var m=Zt;try{if(T0(),Lp.current=Bp,Pp){for(var b=zt.memoizedState;b!==null;){var S=b.queue;S!==null&&(S.pending=null),b=b.next}Pp=!1}if(La=0,gn=an=zt=null,wc=!1,vc=0,ax.current=null,m===null||m.return===null){ln=1,Ic=d,Zt=null;break}e:{var C=u,R=m.return,V=m,Y=d;if(d=Rn,V.flags|=32768,Y!==null&&typeof Y=="object"&&typeof Y.then=="function"){var ue=Y,xe=V,be=xe.tag;if((xe.mode&1)===0&&(be===0||be===11||be===15)){var ye=xe.alternate;ye?(xe.updateQueue=ye.updateQueue,xe.memoizedState=ye.memoizedState,xe.lanes=ye.lanes):(xe.updateQueue=null,xe.memoizedState=null)}var Ee=HS(R);if(Ee!==null){Ee.flags&=-257,qS(Ee,R,V,C,d),Ee.mode&1&&GS(C,ue,d),d=Ee,Y=ue;var _e=d.updateQueue;if(_e===null){var Le=new Set;Le.add(Y),d.updateQueue=Le}else _e.add(Y);break e}else{if((d&1)===0){GS(C,ue,d),mx();break e}Y=Error(t(426))}}else if(At&&V.mode&1){var Kt=HS(R);if(Kt!==null){(Kt.flags&65536)===0&&(Kt.flags|=256),qS(Kt,R,V,C,d),I0(sl(Y,V));break e}}C=Y=sl(Y,V),ln!==4&&(ln=2),$c===null?$c=[C]:$c.push(C),C=R;do{switch(C.tag){case 3:C.flags|=65536,d&=-d,C.lanes|=d;var ae=US(C,Y,d);gS(C,ae);break e;case 1:V=Y;var ee=C.type,ie=C.stateNode;if((C.flags&128)===0&&(typeof ee.getDerivedStateFromError=="function"||ie!==null&&typeof ie.componentDidCatch=="function"&&(Uo===null||!Uo.has(ie)))){C.flags|=65536,d&=-d,C.lanes|=d;var we=jS(C,V,d);gS(C,we);break e}}C=C.return}while(C!==null)}NN(m)}catch(Pe){d=Pe,Zt===m&&m!==null&&(Zt=m=m.return);continue}break}while(!0)}function kN(){var u=Hp.current;return Hp.current=Bp,u===null?Bp:u}function mx(){(ln===0||ln===3||ln===2)&&(ln=4),yn===null||(Pa&268435455)===0&&(qp&268435455)===0||Ho(yn,Rn)}function Jp(u,d){var m=it;it|=2;var b=kN();(yn!==u||Rn!==d)&&(ao=null,Ma(u,d));do try{QO();break}catch(S){vN(u,S)}while(!0);if(T0(),it=m,Hp.current=b,Zt!==null)throw Error(t(261));return yn=null,Rn=0,ln}function QO(){for(;Zt!==null;)SN(Zt)}function ZO(){for(;Zt!==null&&!S_();)SN(Zt)}function SN(u){var d=$N(u.alternate,u,$s);u.memoizedProps=u.pendingProps,d===null?NN(u):Zt=d,ax.current=null}function NN(u){var d=u;do{var m=d.alternate;if(u=d.return,(d.flags&32768)===0){if(m=jO(m,d,$s),m!==null){Zt=m;return}}else{if(m=GO(m,d),m!==null){m.flags&=32767,Zt=m;return}if(u!==null)u.flags|=32768,u.subtreeFlags=0,u.deletions=null;else{ln=6,Zt=null;return}}if(d=d.sibling,d!==null){Zt=d;return}Zt=d=u}while(d!==null);ln===0&&(ln=5)}function Ba(u,d,m){var b=mt,S=Us.transition;try{Us.transition=null,mt=1,JO(u,d,m,b)}finally{Us.transition=S,mt=b}return null}function JO(u,d,m,b){do il();while(jo!==null);if((it&6)!==0)throw Error(t(327));m=u.finishedWork;var S=u.finishedLanes;if(m===null)return null;if(u.finishedWork=null,u.finishedLanes=0,m===u.current)throw Error(t(177));u.callbackNode=null,u.callbackPriority=0;var C=m.lanes|m.childLanes;if(__(u,C),u===yn&&(Zt=yn=null,Rn=0),(m.subtreeFlags&2064)===0&&(m.flags&2064)===0||Xp||(Xp=!0,TN(sp,function(){return il(),null})),C=(m.flags&15990)!==0,(m.subtreeFlags&15990)!==0||C){C=Us.transition,Us.transition=null;var R=mt;mt=1;var V=it;it|=4,ax.current=null,qO(u,m),fN(m,u),bO(m0),cp=!!f0,m0=f0=null,u.current=m,KO(m),N_(),it=V,mt=R,Us.transition=C}else u.current=m;if(Xp&&(Xp=!1,jo=u,Yp=S),C=u.pendingLanes,C===0&&(Uo=null),$_(m.stateNode),ds(u,qt()),d!==null)for(b=u.onRecoverableError,m=0;m<d.length;m++)S=d[m],b(S.value,{componentStack:S.stack,digest:S.digest});if(Kp)throw Kp=!1,u=ux,ux=null,u;return(Yp&1)!==0&&u.tag!==0&&il(),C=u.pendingLanes,(C&1)!==0?u===cx?Tc++:(Tc=0,cx=u):Tc=0,Mo(),null}function il(){if(jo!==null){var u=hk(Yp),d=Us.transition,m=mt;try{if(Us.transition=null,mt=16>u?16:u,jo===null)var b=!1;else{if(u=jo,jo=null,Yp=0,(it&6)!==0)throw Error(t(331));var S=it;for(it|=4,Re=u.current;Re!==null;){var C=Re,R=C.child;if((Re.flags&16)!==0){var V=C.deletions;if(V!==null){for(var Y=0;Y<V.length;Y++){var ue=V[Y];for(Re=ue;Re!==null;){var xe=Re;switch(xe.tag){case 0:case 11:case 15:Cc(8,xe,C)}var be=xe.child;if(be!==null)be.return=xe,Re=be;else for(;Re!==null;){xe=Re;var ye=xe.sibling,Ee=xe.return;if(uN(xe),xe===ue){Re=null;break}if(ye!==null){ye.return=Ee,Re=ye;break}Re=Ee}}}var _e=C.alternate;if(_e!==null){var Le=_e.child;if(Le!==null){_e.child=null;do{var Kt=Le.sibling;Le.sibling=null,Le=Kt}while(Le!==null)}}Re=C}}if((C.subtreeFlags&2064)!==0&&R!==null)R.return=C,Re=R;else e:for(;Re!==null;){if(C=Re,(C.flags&2048)!==0)switch(C.tag){case 0:case 11:case 15:Cc(9,C,C.return)}var ae=C.sibling;if(ae!==null){ae.return=C.return,Re=ae;break e}Re=C.return}}var ee=u.current;for(Re=ee;Re!==null;){R=Re;var ie=R.child;if((R.subtreeFlags&2064)!==0&&ie!==null)ie.return=R,Re=ie;else e:for(R=ee;Re!==null;){if(V=Re,(V.flags&2048)!==0)try{switch(V.tag){case 0:case 11:case 15:Gp(9,V)}}catch(Pe){Bt(V,V.return,Pe)}if(V===R){Re=null;break e}var we=V.sibling;if(we!==null){we.return=V.return,Re=we;break e}Re=V.return}}if(it=S,Mo(),Tr&&typeof Tr.onPostCommitFiberRoot=="function")try{Tr.onPostCommitFiberRoot(rp,u)}catch{}b=!0}return b}finally{mt=m,Us.transition=d}}return!1}function CN(u,d,m){d=sl(m,d),d=US(u,d,1),u=Vo(u,d,1),d=Xn(),u!==null&&(Zu(u,1,d),ds(u,d))}function Bt(u,d,m){if(u.tag===3)CN(u,u,m);else for(;d!==null;){if(d.tag===3){CN(d,u,m);break}else if(d.tag===1){var b=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof b.componentDidCatch=="function"&&(Uo===null||!Uo.has(b))){u=sl(m,u),u=jS(d,u,1),d=Vo(d,u,1),u=Xn(),d!==null&&(Zu(d,1,u),ds(d,u));break}}d=d.return}}function eF(u,d,m){var b=u.pingCache;b!==null&&b.delete(d),d=Xn(),u.pingedLanes|=u.suspendedLanes&m,yn===u&&(Rn&m)===m&&(ln===4||ln===3&&(Rn&130023424)===Rn&&500>qt()-lx?Ma(u,0):ix|=m),ds(u,d)}function IN(u,d){d===0&&((u.mode&1)===0?d=1:(d=ap,ap<<=1,(ap&130023424)===0&&(ap=4194304)));var m=Xn();u=so(u,d),u!==null&&(Zu(u,d,m),ds(u,m))}function tF(u){var d=u.memoizedState,m=0;d!==null&&(m=d.retryLane),IN(u,m)}function nF(u,d){var m=0;switch(u.tag){case 13:var b=u.stateNode,S=u.memoizedState;S!==null&&(m=S.retryLane);break;case 19:b=u.stateNode;break;default:throw Error(t(314))}b!==null&&b.delete(d),IN(u,m)}var $N;$N=function(u,d,m){if(u!==null)if(u.memoizedProps!==d.pendingProps||is.current)us=!0;else{if((u.lanes&m)===0&&(d.flags&128)===0)return us=!1,UO(u,d,m);us=(u.flags&131072)!==0}else us=!1,At&&(d.flags&1048576)!==0&&aS(d,Tp,d.index);switch(d.lanes=0,d.tag){case 2:var b=d.type;Up(u,d),u=d.pendingProps;var S=Xi(d,Fn.current);tl(d,m),S=M0(null,d,b,u,S,m);var C=B0();return d.flags|=1,typeof S=="object"&&S!==null&&typeof S.render=="function"&&S.$$typeof===void 0?(d.tag=1,d.memoizedState=null,d.updateQueue=null,ls(b)?(C=!0,Cp(d)):C=!1,d.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,D0(d),S.updater=Vp,d.stateNode=S,S._reactInternals=d,H0(d,b,u,m),d=Y0(null,d,b,!0,C,m)):(d.tag=0,At&&C&&k0(d),Kn(null,d,S,m),d=d.child),d;case 16:b=d.elementType;e:{switch(Up(u,d),u=d.pendingProps,S=b._init,b=S(b._payload),d.type=b,S=d.tag=rF(b),u=ir(b,u),S){case 0:d=X0(null,d,b,u,m);break e;case 1:d=JS(null,d,b,u,m);break e;case 11:d=KS(null,d,b,u,m);break e;case 14:d=XS(null,d,b,ir(b.type,u),m);break e}throw Error(t(306,b,""))}return d;case 0:return b=d.type,S=d.pendingProps,S=d.elementType===b?S:ir(b,S),X0(u,d,b,S,m);case 1:return b=d.type,S=d.pendingProps,S=d.elementType===b?S:ir(b,S),JS(u,d,b,S,m);case 3:e:{if(eN(d),u===null)throw Error(t(387));b=d.pendingProps,C=d.memoizedState,S=C.element,mS(u,d),Op(d,b,null,m);var R=d.memoizedState;if(b=R.element,C.isDehydrated)if(C={element:b,isDehydrated:!1,cache:R.cache,pendingSuspenseBoundaries:R.pendingSuspenseBoundaries,transitions:R.transitions},d.updateQueue.baseState=C,d.memoizedState=C,d.flags&256){S=sl(Error(t(423)),d),d=tN(u,d,b,m,S);break e}else if(b!==S){S=sl(Error(t(424)),d),d=tN(u,d,b,m,S);break e}else for(Is=Lo(d.stateNode.containerInfo.firstChild),Cs=d,At=!0,ar=null,m=pS(d,null,b,m),d.child=m;m;)m.flags=m.flags&-3|4096,m=m.sibling;else{if(Zi(),b===S){d=oo(u,d,m);break e}Kn(u,d,b,m)}d=d.child}return d;case 5:return xS(d),u===null&&C0(d),b=d.type,S=d.pendingProps,C=u!==null?u.memoizedProps:null,R=S.children,g0(b,S)?R=null:C!==null&&g0(b,C)&&(d.flags|=32),ZS(u,d),Kn(u,d,R,m),d.child;case 6:return u===null&&C0(d),null;case 13:return nN(u,d,m);case 4:return _0(d,d.stateNode.containerInfo),b=d.pendingProps,u===null?d.child=Ji(d,null,b,m):Kn(u,d,b,m),d.child;case 11:return b=d.type,S=d.pendingProps,S=d.elementType===b?S:ir(b,S),KS(u,d,b,S,m);case 7:return Kn(u,d,d.pendingProps,m),d.child;case 8:return Kn(u,d,d.pendingProps.children,m),d.child;case 12:return Kn(u,d,d.pendingProps.children,m),d.child;case 10:e:{if(b=d.type._context,S=d.pendingProps,C=d.memoizedProps,R=S.value,Ct(Ap,b._currentValue),b._currentValue=R,C!==null)if(or(C.value,R)){if(C.children===S.children&&!is.current){d=oo(u,d,m);break e}}else for(C=d.child,C!==null&&(C.return=d);C!==null;){var V=C.dependencies;if(V!==null){R=C.child;for(var Y=V.firstContext;Y!==null;){if(Y.context===b){if(C.tag===1){Y=ro(-1,m&-m),Y.tag=2;var ue=C.updateQueue;if(ue!==null){ue=ue.shared;var xe=ue.pending;xe===null?Y.next=Y:(Y.next=xe.next,xe.next=Y),ue.pending=Y}}C.lanes|=m,Y=C.alternate,Y!==null&&(Y.lanes|=m),R0(C.return,m,d),V.lanes|=m;break}Y=Y.next}}else if(C.tag===10)R=C.type===d.type?null:C.child;else if(C.tag===18){if(R=C.return,R===null)throw Error(t(341));R.lanes|=m,V=R.alternate,V!==null&&(V.lanes|=m),R0(R,m,d),R=C.sibling}else R=C.child;if(R!==null)R.return=C;else for(R=C;R!==null;){if(R===d){R=null;break}if(C=R.sibling,C!==null){C.return=R.return,R=C;break}R=R.return}C=R}Kn(u,d,S.children,m),d=d.child}return d;case 9:return S=d.type,b=d.pendingProps.children,tl(d,m),S=Vs(S),b=b(S),d.flags|=1,Kn(u,d,b,m),d.child;case 14:return b=d.type,S=ir(b,d.pendingProps),S=ir(b.type,S),XS(u,d,b,S,m);case 15:return YS(u,d,d.type,d.pendingProps,m);case 17:return b=d.type,S=d.pendingProps,S=d.elementType===b?S:ir(b,S),Up(u,d),d.tag=1,ls(b)?(u=!0,Cp(d)):u=!1,tl(d,m),VS(d,b,S),H0(d,b,S,m),Y0(null,d,b,!0,u,m);case 19:return rN(u,d,m);case 22:return QS(u,d,m)}throw Error(t(156,d.tag))};function TN(u,d){return ik(u,d)}function sF(u,d,m,b){this.tag=u,this.key=m,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=b,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function js(u,d,m,b){return new sF(u,d,m,b)}function gx(u){return u=u.prototype,!(!u||!u.isReactComponent)}function rF(u){if(typeof u=="function")return gx(u)?1:0;if(u!=null){if(u=u.$$typeof,u===j)return 11;if(u===te)return 14}return 2}function qo(u,d){var m=u.alternate;return m===null?(m=js(u.tag,d,u.key,u.mode),m.elementType=u.elementType,m.type=u.type,m.stateNode=u.stateNode,m.alternate=u,u.alternate=m):(m.pendingProps=d,m.type=u.type,m.flags=0,m.subtreeFlags=0,m.deletions=null),m.flags=u.flags&14680064,m.childLanes=u.childLanes,m.lanes=u.lanes,m.child=u.child,m.memoizedProps=u.memoizedProps,m.memoizedState=u.memoizedState,m.updateQueue=u.updateQueue,d=u.dependencies,m.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},m.sibling=u.sibling,m.index=u.index,m.ref=u.ref,m}function ef(u,d,m,b,S,C){var R=2;if(b=u,typeof u=="function")gx(u)&&(R=1);else if(typeof u=="string")R=5;else e:switch(u){case P:return Va(m.children,S,C,d);case z:R=8,S|=8;break;case F:return u=js(12,m,d,S|2),u.elementType=F,u.lanes=C,u;case Z:return u=js(13,m,d,S),u.elementType=Z,u.lanes=C,u;case ne:return u=js(19,m,d,S),u.elementType=ne,u.lanes=C,u;case K:return tf(m,S,C,d);default:if(typeof u=="object"&&u!==null)switch(u.$$typeof){case L:R=10;break e;case E:R=9;break e;case j:R=11;break e;case te:R=14;break e;case se:R=16,b=null;break e}throw Error(t(130,u==null?u:typeof u,""))}return d=js(R,m,d,S),d.elementType=u,d.type=b,d.lanes=C,d}function Va(u,d,m,b){return u=js(7,u,b,d),u.lanes=m,u}function tf(u,d,m,b){return u=js(22,u,b,d),u.elementType=K,u.lanes=m,u.stateNode={isHidden:!1},u}function yx(u,d,m){return u=js(6,u,null,d),u.lanes=m,u}function xx(u,d,m){return d=js(4,u.children!==null?u.children:[],u.key,d),d.lanes=m,d.stateNode={containerInfo:u.containerInfo,pendingChildren:null,implementation:u.implementation},d}function oF(u,d,m,b,S){this.tag=d,this.containerInfo=u,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Gy(0),this.expirationTimes=Gy(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Gy(0),this.identifierPrefix=b,this.onRecoverableError=S,this.mutableSourceEagerHydrationData=null}function bx(u,d,m,b,S,C,R,V,Y){return u=new oF(u,d,m,V,Y),d===1?(d=1,C===!0&&(d|=8)):d=0,C=js(3,null,null,d),u.current=C,C.stateNode=u,C.memoizedState={element:b,isDehydrated:m,cache:null,transitions:null,pendingSuspenseBoundaries:null},D0(C),u}function aF(u,d,m){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:D,key:b==null?null:""+b,children:u,containerInfo:d,implementation:m}}function EN(u){if(!u)return zo;u=u._reactInternals;e:{if(Ea(u)!==u||u.tag!==1)throw Error(t(170));var d=u;do{switch(d.tag){case 3:d=d.stateNode.context;break e;case 1:if(ls(d.type)){d=d.stateNode.__reactInternalMemoizedMergedChildContext;break e}}d=d.return}while(d!==null);throw Error(t(171))}if(u.tag===1){var m=u.type;if(ls(m))return sS(u,m,d)}return d}function RN(u,d,m,b,S,C,R,V,Y){return u=bx(m,b,!0,u,S,C,R,V,Y),u.context=EN(null),m=u.current,b=Xn(),S=Go(m),C=ro(b,S),C.callback=d??null,Vo(m,C,S),u.current.lanes=S,Zu(u,S,b),ds(u,b),u}function nf(u,d,m,b){var S=d.current,C=Xn(),R=Go(S);return m=EN(m),d.context===null?d.context=m:d.pendingContext=m,d=ro(C,R),d.payload={element:u},b=b===void 0?null:b,b!==null&&(d.callback=b),u=Vo(S,d,R),u!==null&&(cr(u,S,R,C),_p(u,S,R)),R}function sf(u){if(u=u.current,!u.child)return null;switch(u.child.tag){case 5:return u.child.stateNode;default:return u.child.stateNode}}function AN(u,d){if(u=u.memoizedState,u!==null&&u.dehydrated!==null){var m=u.retryLane;u.retryLane=m!==0&&m<d?m:d}}function wx(u,d){AN(u,d),(u=u.alternate)&&AN(u,d)}function iF(){return null}var DN=typeof reportError=="function"?reportError:function(u){console.error(u)};function vx(u){this._internalRoot=u}rf.prototype.render=vx.prototype.render=function(u){var d=this._internalRoot;if(d===null)throw Error(t(409));nf(u,d,null,null)},rf.prototype.unmount=vx.prototype.unmount=function(){var u=this._internalRoot;if(u!==null){this._internalRoot=null;var d=u.containerInfo;za(function(){nf(null,u,null,null)}),d[Jr]=null}};function rf(u){this._internalRoot=u}rf.prototype.unstable_scheduleHydration=function(u){if(u){var d=mk();u={blockedOn:null,target:u,priority:d};for(var m=0;m<_o.length&&d!==0&&d<_o[m].priority;m++);_o.splice(m,0,u),m===0&&xk(u)}};function kx(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)}function of(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11&&(u.nodeType!==8||u.nodeValue!==" react-mount-point-unstable "))}function _N(){}function lF(u,d,m,b,S){if(S){if(typeof b=="function"){var C=b;b=function(){var ue=sf(R);C.call(ue)}}var R=RN(d,b,u,0,null,!1,!1,"",_N);return u._reactRootContainer=R,u[Jr]=R.current,hc(u.nodeType===8?u.parentNode:u),za(),R}for(;S=u.lastChild;)u.removeChild(S);if(typeof b=="function"){var V=b;b=function(){var ue=sf(Y);V.call(ue)}}var Y=bx(u,0,!1,null,null,!1,!1,"",_N);return u._reactRootContainer=Y,u[Jr]=Y.current,hc(u.nodeType===8?u.parentNode:u),za(function(){nf(d,Y,m,b)}),Y}function af(u,d,m,b,S){var C=m._reactRootContainer;if(C){var R=C;if(typeof S=="function"){var V=S;S=function(){var Y=sf(R);V.call(Y)}}nf(d,R,u,S)}else R=lF(m,d,u,S,b);return sf(R)}pk=function(u){switch(u.tag){case 3:var d=u.stateNode;if(d.current.memoizedState.isDehydrated){var m=Qu(d.pendingLanes);m!==0&&(Hy(d,m|1),ds(d,qt()),(it&6)===0&&(al=qt()+500,Mo()))}break;case 13:za(function(){var b=so(u,1);if(b!==null){var S=Xn();cr(b,u,1,S)}}),wx(u,1)}},qy=function(u){if(u.tag===13){var d=so(u,134217728);if(d!==null){var m=Xn();cr(d,u,134217728,m)}wx(u,134217728)}},fk=function(u){if(u.tag===13){var d=Go(u),m=so(u,d);if(m!==null){var b=Xn();cr(m,u,d,b)}wx(u,d)}},mk=function(){return mt},gk=function(u,d){var m=mt;try{return mt=u,d()}finally{mt=m}},My=function(u,d,m){switch(d){case"input":if(xt(u,m),d=m.name,m.type==="radio"&&d!=null){for(m=u;m.parentNode;)m=m.parentNode;for(m=m.querySelectorAll("input[name="+JSON.stringify(""+d)+'][type="radio"]'),d=0;d<m.length;d++){var b=m[d];if(b!==u&&b.form===u.form){var S=Sp(b);if(!S)throw Error(t(90));at(b),xt(b,S)}}}break;case"textarea":as(u,m);break;case"select":d=m.value,d!=null&&qn(u,!!m.multiple,d,!1)}},ek=px,tk=za;var uF={usingClientEntryPoint:!1,Events:[mc,qi,Sp,Zv,Jv,px]},Ec={findFiberByHostInstance:Ra,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},cF={bundleType:Ec.bundleType,version:Ec.version,rendererPackageName:Ec.rendererPackageName,rendererConfig:Ec.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:N.ReactCurrentDispatcher,findHostInstanceByFiber:function(u){return u=ok(u),u===null?null:u.stateNode},findFiberByHostInstance:Ec.findFiberByHostInstance||iF,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var lf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lf.isDisabled&&lf.supportsFiber)try{rp=lf.inject(cF),Tr=lf}catch{}}return hs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=uF,hs.createPortal=function(u,d){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!kx(d))throw Error(t(200));return aF(u,d,null,m)},hs.createRoot=function(u,d){if(!kx(u))throw Error(t(299));var m=!1,b="",S=DN;return d!=null&&(d.unstable_strictMode===!0&&(m=!0),d.identifierPrefix!==void 0&&(b=d.identifierPrefix),d.onRecoverableError!==void 0&&(S=d.onRecoverableError)),d=bx(u,1,!1,null,null,m,!1,b,S),u[Jr]=d.current,hc(u.nodeType===8?u.parentNode:u),new vx(d)},hs.findDOMNode=function(u){if(u==null)return null;if(u.nodeType===1)return u;var d=u._reactInternals;if(d===void 0)throw typeof u.render=="function"?Error(t(188)):(u=Object.keys(u).join(","),Error(t(268,u)));return u=ok(d),u=u===null?null:u.stateNode,u},hs.flushSync=function(u){return za(u)},hs.hydrate=function(u,d,m){if(!of(d))throw Error(t(200));return af(null,u,d,!0,m)},hs.hydrateRoot=function(u,d,m){if(!kx(u))throw Error(t(405));var b=m!=null&&m.hydratedSources||null,S=!1,C="",R=DN;if(m!=null&&(m.unstable_strictMode===!0&&(S=!0),m.identifierPrefix!==void 0&&(C=m.identifierPrefix),m.onRecoverableError!==void 0&&(R=m.onRecoverableError)),d=RN(d,null,u,1,m??null,S,!1,C,R),u[Jr]=d.current,hc(u),b)for(u=0;u<b.length;u++)m=b[u],S=m._getVersion,S=S(m._source),d.mutableSourceEagerHydrationData==null?d.mutableSourceEagerHydrationData=[m,S]:d.mutableSourceEagerHydrationData.push(m,S);return new rf(d)},hs.render=function(u,d,m){if(!of(d))throw Error(t(200));return af(null,u,d,!1,m)},hs.unmountComponentAtNode=function(u){if(!of(u))throw Error(t(40));return u._reactRootContainer?(za(function(){af(null,null,u,!1,function(){u._reactRootContainer=null,u[Jr]=null})}),!0):!1},hs.unstable_batchedUpdates=px,hs.unstable_renderSubtreeIntoContainer=function(u,d,m,b){if(!of(m))throw Error(t(200));if(u==null||u._reactInternals===void 0)throw Error(t(38));return af(u,d,m,!1,b)},hs.version="18.3.1-next-f1338f8080-20240426",hs}var VN;function XI(){if(VN)return Cx.exports;VN=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Cx.exports=bF(),Cx.exports}var WN;function wF(){if(WN)return uf;WN=1;var n=XI();return uf.createRoot=n.createRoot,uf.hydrateRoot=n.hydrateRoot,uf}var vF=wF();const kF=rw(vF);XI();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Uc(){return Uc=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},Uc.apply(this,arguments)}var Zo;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(Zo||(Zo={}));const UN="popstate";function SF(n){n===void 0&&(n={});function e(s,r){let{pathname:o,search:a,hash:i}=s.location;return eb("",{pathname:o,search:a,hash:i},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(s,r){return typeof r=="string"?r:zf(r)}return CF(e,t,null,n)}function nn(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function YI(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function NF(){return Math.random().toString(36).substr(2,8)}function jN(n,e){return{usr:n.state,key:n.key,idx:e}}function eb(n,e,t,s){return t===void 0&&(t=null),Uc({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?Ol(e):e,{state:t,key:e&&e.key||s||NF()})}function zf(n){let{pathname:e="/",search:t="",hash:s=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),s&&s!=="#"&&(e+=s.charAt(0)==="#"?s:"#"+s),e}function Ol(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let s=n.indexOf("?");s>=0&&(e.search=n.substr(s),n=n.substr(0,s)),n&&(e.pathname=n)}return e}function CF(n,e,t,s){s===void 0&&(s={});let{window:r=document.defaultView,v5Compat:o=!1}=s,a=r.history,i=Zo.Pop,l=null,c=h();c==null&&(c=0,a.replaceState(Uc({},a.state,{idx:c}),""));function h(){return(a.state||{idx:null}).idx}function p(){i=Zo.Pop;let x=h(),v=x==null?null:x-c;c=x,l&&l({action:i,location:w.location,delta:v})}function f(x,v){i=Zo.Push;let k=eb(w.location,x,v);c=h()+1;let I=jN(k,c),N=w.createHref(k);try{a.pushState(I,"",N)}catch(T){if(T instanceof DOMException&&T.name==="DataCloneError")throw T;r.location.assign(N)}o&&l&&l({action:i,location:w.location,delta:1})}function g(x,v){i=Zo.Replace;let k=eb(w.location,x,v);c=h();let I=jN(k,c),N=w.createHref(k);a.replaceState(I,"",N),o&&l&&l({action:i,location:w.location,delta:0})}function y(x){let v=r.location.origin!=="null"?r.location.origin:r.location.href,k=typeof x=="string"?x:zf(x);return k=k.replace(/ $/,"%20"),nn(v,"No window.location.(origin|href) available to create URL for href: "+k),new URL(k,v)}let w={get action(){return i},get location(){return n(r,a)},listen(x){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(UN,p),l=x,()=>{r.removeEventListener(UN,p),l=null}},createHref(x){return e(r,x)},createURL:y,encodeLocation(x){let v=y(x);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:f,replace:g,go(x){return a.go(x)}};return w}var GN;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(GN||(GN={}));function IF(n,e,t){return t===void 0&&(t="/"),$F(n,e,t)}function $F(n,e,t,s){let r=typeof e=="string"?Ol(e):e,o=iw(r.pathname||"/",t);if(o==null)return null;let a=QI(n);TF(a);let i=null;for(let l=0;i==null&&l<a.length;++l){let c=BF(o);i=PF(a[l],c)}return i}function QI(n,e,t,s){e===void 0&&(e=[]),t===void 0&&(t=[]),s===void 0&&(s="");let r=(o,a,i)=>{let l={relativePath:i===void 0?o.path||"":i,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};l.relativePath.startsWith("/")&&(nn(l.relativePath.startsWith(s),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(s.length));let c=na([s,l.relativePath]),h=t.concat(l);o.children&&o.children.length>0&&(nn(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),QI(o.children,e,h,c)),!(o.path==null&&!o.index)&&e.push({path:c,score:FF(c,o.index),routesMeta:h})};return n.forEach((o,a)=>{var i;if(o.path===""||!((i=o.path)!=null&&i.includes("?")))r(o,a);else for(let l of ZI(o.path))r(o,a,l)}),e}function ZI(n){let e=n.split("/");if(e.length===0)return[];let[t,...s]=e,r=t.endsWith("?"),o=t.replace(/\?$/,"");if(s.length===0)return r?[o,""]:[o];let a=ZI(s.join("/")),i=[];return i.push(...a.map(l=>l===""?o:[o,l].join("/"))),r&&i.push(...a),i.map(l=>n.startsWith("/")&&l===""?"/":l)}function TF(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:LF(e.routesMeta.map(s=>s.childrenIndex),t.routesMeta.map(s=>s.childrenIndex)))}const EF=/^:[\w-]+$/,RF=3,AF=2,DF=1,_F=10,OF=-2,HN=n=>n==="*";function FF(n,e){let t=n.split("/"),s=t.length;return t.some(HN)&&(s+=OF),e&&(s+=AF),t.filter(r=>!HN(r)).reduce((r,o)=>r+(EF.test(o)?RF:o===""?DF:_F),s)}function LF(n,e){return n.length===e.length&&n.slice(0,-1).every((s,r)=>s===e[r])?n[n.length-1]-e[e.length-1]:0}function PF(n,e,t){let{routesMeta:s}=n,r={},o="/",a=[];for(let i=0;i<s.length;++i){let l=s[i],c=i===s.length-1,h=o==="/"?e:e.slice(o.length)||"/",p=zF({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},h),f=l.route;if(!p)return null;Object.assign(r,p.params),a.push({params:r,pathname:na([o,p.pathname]),pathnameBase:jF(na([o,p.pathnameBase])),route:f}),p.pathnameBase!=="/"&&(o=na([o,p.pathnameBase]))}return a}function zF(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,s]=MF(n.path,n.caseSensitive,n.end),r=e.match(t);if(!r)return null;let o=r[0],a=o.replace(/(.)\/+$/,"$1"),i=r.slice(1);return{params:s.reduce((c,h,p)=>{let{paramName:f,isOptional:g}=h;if(f==="*"){let w=i[p]||"";a=o.slice(0,o.length-w.length).replace(/(.)\/+$/,"$1")}const y=i[p];return g&&!y?c[f]=void 0:c[f]=(y||"").replace(/%2F/g,"/"),c},{}),pathname:o,pathnameBase:a,pattern:n}}function MF(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),YI(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let s=[],r="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,i,l)=>(s.push({paramName:i,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(s.push({paramName:"*"}),r+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":n!==""&&n!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),s]}function BF(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return YI(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function iw(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,s=n.charAt(t);return s&&s!=="/"?null:n.slice(t)||"/"}function VF(n,e){e===void 0&&(e="/");let{pathname:t,search:s="",hash:r=""}=typeof n=="string"?Ol(n):n;return{pathname:t?t.startsWith("/")?t:WF(t,e):e,search:GF(s),hash:HF(r)}}function WF(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function Tx(n,e,t,s){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function UF(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function JI(n,e){let t=UF(n);return e?t.map((s,r)=>r===t.length-1?s.pathname:s.pathnameBase):t.map(s=>s.pathnameBase)}function e2(n,e,t,s){s===void 0&&(s=!1);let r;typeof n=="string"?r=Ol(n):(r=Uc({},n),nn(!r.pathname||!r.pathname.includes("?"),Tx("?","pathname","search",r)),nn(!r.pathname||!r.pathname.includes("#"),Tx("#","pathname","hash",r)),nn(!r.search||!r.search.includes("#"),Tx("#","search","hash",r)));let o=n===""||r.pathname==="",a=o?"/":r.pathname,i;if(a==null)i=t;else{let p=e.length-1;if(!s&&a.startsWith("..")){let f=a.split("/");for(;f[0]==="..";)f.shift(),p-=1;r.pathname=f.join("/")}i=p>=0?e[p]:"/"}let l=VF(r,i),c=a&&a!=="/"&&a.endsWith("/"),h=(o||a===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(c||h)&&(l.pathname+="/"),l}const na=n=>n.join("/").replace(/\/\/+/g,"/"),jF=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),GF=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,HF=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function qF(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const t2=["post","put","patch","delete"];new Set(t2);const KF=["get",...t2];new Set(KF);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function jc(){return jc=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},jc.apply(this,arguments)}const lw=ve.createContext(null),XF=ve.createContext(null),ki=ve.createContext(null),gm=ve.createContext(null),Si=ve.createContext({outlet:null,matches:[],isDataRoute:!1}),n2=ve.createContext(null);function YF(n,e){let{relative:t}=e===void 0?{}:e;hd()||nn(!1);let{basename:s,navigator:r}=ve.useContext(ki),{hash:o,pathname:a,search:i}=o2(n,{relative:t}),l=a;return s!=="/"&&(l=a==="/"?s:na([s,a])),r.createHref({pathname:l,search:i,hash:o})}function hd(){return ve.useContext(gm)!=null}function pd(){return hd()||nn(!1),ve.useContext(gm).location}function s2(n){ve.useContext(ki).static||ve.useLayoutEffect(n)}function r2(){let{isDataRoute:n}=ve.useContext(Si);return n?u3():QF()}function QF(){hd()||nn(!1);let n=ve.useContext(lw),{basename:e,future:t,navigator:s}=ve.useContext(ki),{matches:r}=ve.useContext(Si),{pathname:o}=pd(),a=JSON.stringify(JI(r,t.v7_relativeSplatPath)),i=ve.useRef(!1);return s2(()=>{i.current=!0}),ve.useCallback(function(c,h){if(h===void 0&&(h={}),!i.current)return;if(typeof c=="number"){s.go(c);return}let p=e2(c,JSON.parse(a),o,h.relative==="path");n==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:na([e,p.pathname])),(h.replace?s.replace:s.push)(p,h.state,h)},[e,s,a,o,n])}function o2(n,e){let{relative:t}=e===void 0?{}:e,{future:s}=ve.useContext(ki),{matches:r}=ve.useContext(Si),{pathname:o}=pd(),a=JSON.stringify(JI(r,s.v7_relativeSplatPath));return ve.useMemo(()=>e2(n,JSON.parse(a),o,t==="path"),[n,a,o,t])}function ZF(n,e){return JF(n,e)}function JF(n,e,t,s){hd()||nn(!1);let{navigator:r}=ve.useContext(ki),{matches:o}=ve.useContext(Si),a=o[o.length-1],i=a?a.params:{};a&&a.pathname;let l=a?a.pathnameBase:"/";a&&a.route;let c=pd(),h;if(e){var p;let x=typeof e=="string"?Ol(e):e;l==="/"||(p=x.pathname)!=null&&p.startsWith(l)||nn(!1),h=x}else h=c;let f=h.pathname||"/",g=f;if(l!=="/"){let x=l.replace(/^\//,"").split("/");g="/"+f.replace(/^\//,"").split("/").slice(x.length).join("/")}let y=IF(n,{pathname:g}),w=r3(y&&y.map(x=>Object.assign({},x,{params:Object.assign({},i,x.params),pathname:na([l,r.encodeLocation?r.encodeLocation(x.pathname).pathname:x.pathname]),pathnameBase:x.pathnameBase==="/"?l:na([l,r.encodeLocation?r.encodeLocation(x.pathnameBase).pathname:x.pathnameBase])})),o,t,s);return e&&w?ve.createElement(gm.Provider,{value:{location:jc({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:Zo.Pop}},w):w}function e3(){let n=l3(),e=qF(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ve.createElement(ve.Fragment,null,ve.createElement("h2",null,"Unexpected Application Error!"),ve.createElement("h3",{style:{fontStyle:"italic"}},e),t?ve.createElement("pre",{style:r},t):null,null)}const t3=ve.createElement(e3,null);class n3 extends ve.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?ve.createElement(Si.Provider,{value:this.props.routeContext},ve.createElement(n2.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function s3(n){let{routeContext:e,match:t,children:s}=n,r=ve.useContext(lw);return r&&r.static&&r.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=t.route.id),ve.createElement(Si.Provider,{value:e},s)}function r3(n,e,t,s){var r;if(e===void 0&&(e=[]),t===void 0&&(t=null),s===void 0&&(s=null),n==null){var o;if(!t)return null;if(t.errors)n=t.matches;else if((o=s)!=null&&o.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let a=n,i=(r=t)==null?void 0:r.errors;if(i!=null){let h=a.findIndex(p=>p.route.id&&(i==null?void 0:i[p.route.id])!==void 0);h>=0||nn(!1),a=a.slice(0,Math.min(a.length,h+1))}let l=!1,c=-1;if(t&&s&&s.v7_partialHydration)for(let h=0;h<a.length;h++){let p=a[h];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(c=h),p.route.id){let{loaderData:f,errors:g}=t,y=p.route.loader&&f[p.route.id]===void 0&&(!g||g[p.route.id]===void 0);if(p.route.lazy||y){l=!0,c>=0?a=a.slice(0,c+1):a=[a[0]];break}}}return a.reduceRight((h,p,f)=>{let g,y=!1,w=null,x=null;t&&(g=i&&p.route.id?i[p.route.id]:void 0,w=p.route.errorElement||t3,l&&(c<0&&f===0?(c3("route-fallback"),y=!0,x=null):c===f&&(y=!0,x=p.route.hydrateFallbackElement||null)));let v=e.concat(a.slice(0,f+1)),k=()=>{let I;return g?I=w:y?I=x:p.route.Component?I=ve.createElement(p.route.Component,null):p.route.element?I=p.route.element:I=h,ve.createElement(s3,{match:p,routeContext:{outlet:h,matches:v,isDataRoute:t!=null},children:I})};return t&&(p.route.ErrorBoundary||p.route.errorElement||f===0)?ve.createElement(n3,{location:t.location,revalidation:t.revalidation,component:w,error:g,children:k(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):k()},null)}var a2=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(a2||{}),i2=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(i2||{});function o3(n){let e=ve.useContext(lw);return e||nn(!1),e}function a3(n){let e=ve.useContext(XF);return e||nn(!1),e}function i3(n){let e=ve.useContext(Si);return e||nn(!1),e}function l2(n){let e=i3(),t=e.matches[e.matches.length-1];return t.route.id||nn(!1),t.route.id}function l3(){var n;let e=ve.useContext(n2),t=a3(),s=l2();return e!==void 0?e:(n=t.errors)==null?void 0:n[s]}function u3(){let{router:n}=o3(a2.UseNavigateStable),e=l2(i2.UseNavigateStable),t=ve.useRef(!1);return s2(()=>{t.current=!0}),ve.useCallback(function(r,o){o===void 0&&(o={}),t.current&&(typeof r=="number"?n.navigate(r):n.navigate(r,jc({fromRouteId:e},o)))},[n,e])}const qN={};function c3(n,e,t){qN[n]||(qN[n]=!0)}function d3(n,e){n==null||n.v7_startTransition,n==null||n.v7_relativeSplatPath}function dl(n){nn(!1)}function h3(n){let{basename:e="/",children:t=null,location:s,navigationType:r=Zo.Pop,navigator:o,static:a=!1,future:i}=n;hd()&&nn(!1);let l=e.replace(/^\/*/,"/"),c=ve.useMemo(()=>({basename:l,navigator:o,static:a,future:jc({v7_relativeSplatPath:!1},i)}),[l,i,o,a]);typeof s=="string"&&(s=Ol(s));let{pathname:h="/",search:p="",hash:f="",state:g=null,key:y="default"}=s,w=ve.useMemo(()=>{let x=iw(h,l);return x==null?null:{location:{pathname:x,search:p,hash:f,state:g,key:y},navigationType:r}},[l,h,p,f,g,y,r]);return w==null?null:ve.createElement(ki.Provider,{value:c},ve.createElement(gm.Provider,{children:t,value:w}))}function p3(n){let{children:e,location:t}=n;return ZF(tb(e),t)}new Promise(()=>{});function tb(n,e){e===void 0&&(e=[]);let t=[];return ve.Children.forEach(n,(s,r)=>{if(!ve.isValidElement(s))return;let o=[...e,r];if(s.type===ve.Fragment){t.push.apply(t,tb(s.props.children,o));return}s.type!==dl&&nn(!1),!s.props.index||!s.props.children||nn(!1);let a={id:s.props.id||o.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(a.children=tb(s.props.children,o)),t.push(a)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function nb(){return nb=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},nb.apply(this,arguments)}function f3(n,e){if(n==null)return{};var t={},s=Object.keys(n),r,o;for(o=0;o<s.length;o++)r=s[o],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}function m3(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function g3(n,e){return n.button===0&&(!e||e==="_self")&&!m3(n)}const y3=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],x3="6";try{window.__reactRouterVersion=x3}catch{}const b3="startTransition",KN=gF[b3];function w3(n){let{basename:e,children:t,future:s,window:r}=n,o=ve.useRef();o.current==null&&(o.current=SF({window:r,v5Compat:!0}));let a=o.current,[i,l]=ve.useState({action:a.action,location:a.location}),{v7_startTransition:c}=s||{},h=ve.useCallback(p=>{c&&KN?KN(()=>l(p)):l(p)},[l,c]);return ve.useLayoutEffect(()=>a.listen(h),[a,h]),ve.useEffect(()=>d3(s),[s]),ve.createElement(h3,{basename:e,children:t,location:i.location,navigationType:i.action,navigator:a,future:s})}const v3=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",k3=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,If=ve.forwardRef(function(e,t){let{onClick:s,relative:r,reloadDocument:o,replace:a,state:i,target:l,to:c,preventScrollReset:h,viewTransition:p}=e,f=f3(e,y3),{basename:g}=ve.useContext(ki),y,w=!1;if(typeof c=="string"&&k3.test(c)&&(y=c,v3))try{let I=new URL(window.location.href),N=c.startsWith("//")?new URL(I.protocol+c):new URL(c),T=iw(N.pathname,g);N.origin===I.origin&&T!=null?c=T+N.search+N.hash:w=!0}catch{}let x=YF(c,{relative:r}),v=S3(c,{replace:a,state:i,target:l,preventScrollReset:h,relative:r,viewTransition:p});function k(I){s&&s(I),I.defaultPrevented||v(I)}return ve.createElement("a",nb({},f,{href:y||x,onClick:w||o?s:k,ref:t,target:l}))});var XN;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(XN||(XN={}));var YN;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(YN||(YN={}));function S3(n,e){let{target:t,replace:s,state:r,preventScrollReset:o,relative:a,viewTransition:i}=e===void 0?{}:e,l=r2(),c=pd(),h=o2(n,{relative:a});return ve.useCallback(p=>{if(g3(p,t)){p.preventDefault();let f=s!==void 0?s:zf(c)===zf(h);l(n,{replace:f,state:r,preventScrollReset:o,relative:a,viewTransition:i})}},[c,l,h,s,r,t,n,o,a,i])}const sb=(n,e)=>e.some(t=>n instanceof t);let QN,ZN;function N3(){return QN||(QN=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function C3(){return ZN||(ZN=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const rb=new WeakMap,Ex=new WeakMap,ym=new WeakMap;function I3(n){const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(ti(n.result)),r()},a=()=>{s(n.error),r()};n.addEventListener("success",o),n.addEventListener("error",a)});return ym.set(e,n),e}function $3(n){if(rb.has(n))return;const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),r()},a=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});rb.set(n,e)}let ob={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return rb.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ti(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function u2(n){ob=n(ob)}function T3(n){return C3().includes(n)?function(...e){return n.apply(ab(this),e),ti(this.request)}:function(...e){return ti(n.apply(ab(this),e))}}function E3(n){return typeof n=="function"?T3(n):(n instanceof IDBTransaction&&$3(n),sb(n,N3())?new Proxy(n,ob):n)}function ti(n){if(n instanceof IDBRequest)return I3(n);if(Ex.has(n))return Ex.get(n);const e=E3(n);return e!==n&&(Ex.set(n,e),ym.set(e,n)),e}const ab=n=>ym.get(n);function R3(n,e,{blocked:t,upgrade:s,blocking:r,terminated:o}={}){const a=indexedDB.open(n,e),i=ti(a);return s&&a.addEventListener("upgradeneeded",l=>{s(ti(a.result),l.oldVersion,l.newVersion,ti(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),i.then(l=>{o&&l.addEventListener("close",()=>o()),r&&l.addEventListener("versionchange",c=>r(c.oldVersion,c.newVersion,c))}).catch(()=>{}),i}const A3=["get","getKey","getAll","getAllKeys","count"],D3=["put","add","delete","clear"],Rx=new Map;function JN(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Rx.get(e))return Rx.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,r=D3.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(r||A3.includes(t)))return;const o=async function(a,...i){const l=this.transaction(a,r?"readwrite":"readonly");let c=l.store;return s&&(c=c.index(i.shift())),(await Promise.all([c[t](...i),r&&l.done]))[0]};return Rx.set(e,o),o}u2(n=>({...n,get:(e,t,s)=>JN(e,t)||n.get(e,t,s),has:(e,t)=>!!JN(e,t)||n.has(e,t)}));const _3=["continue","continuePrimaryKey","advance"],eC={},ib=new WeakMap,c2=new WeakMap,O3={get(n,e){if(!_3.includes(e))return n[e];let t=eC[e];return t||(t=eC[e]=function(...s){ib.set(this,c2.get(this)[e](...s))}),t}};async function*F3(...n){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...n)),!e)return;e=e;const t=new Proxy(e,O3);for(c2.set(t,e),ym.set(t,ab(e));e;)yield t,e=await(ib.get(t)||e.continue()),ib.delete(t)}function tC(n,e){return e===Symbol.asyncIterator&&sb(n,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&sb(n,[IDBIndex,IDBObjectStore])}u2(n=>({...n,get(e,t,s){return tC(e,t)?F3:n.get(e,t,s)},has(e,t){return tC(e,t)||n.has(e,t)}}));class Ax extends Error{constructor(e,t="UNKNOWN_ERROR",s){super(e),this.code=t,this.context=s,this.name="AppError"}}const Gc=(n,e)=>(console.error(`Error in ${e||"unknown context"}:`,n),n instanceof Ax?n:n instanceof Error?new Ax(n.message,"RUNTIME_ERROR",{originalError:n.name}):new Ax("An unexpected error occurred","UNKNOWN_ERROR",{context:e})),Mf=n=>!!(n&&typeof n=="object"&&n.id&&typeof n.timestamp=="number"&&Array.isArray(n.ingredients)&&n.nutrition&&typeof n.nutrition=="object"),lb=n=>!!(n&&typeof n=="object"&&typeof n.dailyCalories=="number"&&typeof n.dailyProtein=="number"&&typeof n.dailyCarbs=="number"&&typeof n.dailyFat=="number"&&(n.units==="metric"||n.units==="imperial")&&typeof n.darkMode=="boolean");let ll=null;const fd=async()=>{if(ll)return ll;try{return ll=await R3("FoodTrackerDB",1,{upgrade(n){console.log("Upgrading database..."),n.objectStoreNames.contains("meals")||(n.createObjectStore("meals",{keyPath:"id"}).createIndex("timestamp","timestamp"),console.log("Created meals store")),n.objectStoreNames.contains("settings")||(n.createObjectStore("settings",{keyPath:"key"}),console.log("Created settings store"))},blocked(){console.warn("Database upgrade blocked")},blocking(){console.warn("Database blocking upgrade")},terminated(){console.warn("Database connection terminated"),ll=null}}),console.log("Database initialized successfully"),ll}catch(n){throw console.error("Failed to initialize database:",n),ll=null,n}},nC=async n=>{try{if(!Mf(n))throw new Error("Invalid meal data structure");const e=await fd();if(!e)throw new Error("Database not available");await e.put("meals",n),console.log("Meal saved successfully:",n.id)}catch(e){throw Gc(e,"saveMeal")}},L3=async()=>{try{const n=await fd();if(!n)return console.warn("Database not available for loading meals"),[];const e=await n.getAll("meals");if(console.log("Loaded meals from database:",e.length),!Array.isArray(e))return console.warn("Invalid meals data from database"),[];const t=e.filter(s=>Mf(s));return t.length!==e.length&&console.warn(`Filtered out ${e.length-t.length} invalid meals`),t.sort((s,r)=>{const o=(s==null?void 0:s.timestamp)||0;return((r==null?void 0:r.timestamp)||0)-o})}catch(n){return Gc(n,"loadMeals"),[]}},d2=async n=>{try{if(!lb(n))throw new Error("Invalid settings data structure");const e=await fd();if(!e)throw new Error("Database not available");await e.put("settings",{key:"userSettings",...n}),console.log("Settings saved successfully")}catch(e){throw Gc(e,"saveSettings")}},P3=async()=>{const n={dailyCalories:2e3,dailyProtein:150,dailyCarbs:250,dailyFat:70,units:"metric",darkMode:!1};try{const e=await fd();if(!e)return console.warn("Database not available, using default settings"),n;const t=await e.get("settings","userSettings");if(t&&typeof t=="object"){const{key:s,...r}=t;return{dailyCalories:typeof r.dailyCalories=="number"?r.dailyCalories:n.dailyCalories,dailyProtein:typeof r.dailyProtein=="number"?r.dailyProtein:n.dailyProtein,dailyCarbs:typeof r.dailyCarbs=="number"?r.dailyCarbs:n.dailyCarbs,dailyFat:typeof r.dailyFat=="number"?r.dailyFat:n.dailyFat,units:r.units==="imperial"?"imperial":"metric",darkMode:typeof r.darkMode=="boolean"?r.darkMode:n.darkMode}}return n}catch(e){return console.error("Failed to load settings:",e),n}},z3=async()=>{const n=await fd();await n.clear("meals"),await n.clear("settings")},Xo=(n,e)=>{},Vc=(n,e)=>{console.error(`[ERROR:${n}]`,{timestamp:new Date().toISOString(),error:e instanceof Error?{name:e.name,message:e.message,stack:e.stack}:e,type:typeof e})},M3=(n,e)=>{},dr={meals:[],settings:{dailyCalories:2e3,dailyProtein:150,dailyCarbs:250,dailyFat:70,units:"metric",darkMode:!1},isLoading:!0,darkMode:!1},B3=(n,e)=>{switch(e.type){case"SET_MEALS":return{...n,meals:e.payload};case"ADD_MEAL":return{...n,meals:[e.payload,...n.meals]};case"DELETE_MEAL":return{...n,meals:n.meals.filter(r=>r.id!==e.payload)};case"UPDATE_MEAL":return{...n,meals:n.meals.map(r=>r.id===e.payload.id?e.payload:r)};case"SET_SETTINGS":return{...n,settings:e.payload,darkMode:e.payload.darkMode};case"SET_LOADING":return{...n,isLoading:e.payload};case"TOGGLE_DARK_MODE":const t=!n.darkMode,s={...n.settings,darkMode:t};return d2(s),{...n,darkMode:t,settings:s};default:return n}},h2=ve.createContext(void 0),V3=({children:n})=>{const[e,t]=ve.useReducer(B3,dr);ve.useEffect(()=>{(async()=>{try{Xo("AppContext:init","Setting loading state"),t({type:"SET_LOADING",payload:!0}),Xo("AppContext:init","Setting default values"),t({type:"SET_MEALS",payload:[]}),t({type:"SET_SETTINGS",payload:dr.settings}),Xo("AppContext:init","Starting data load");const p=Promise.all([L3().catch(v=>(Vc("AppContext:loadMeals",v),[])),P3().catch(v=>(Vc("AppContext:loadSettings",v),dr.settings))]),f=new Promise(v=>setTimeout(()=>{Xo("AppContext:init","Data loading timed out, using defaults"),v([[],dr.settings])},3e3)),[g,y]=await Promise.race([p,f]);Xo("AppContext:rawData",{meals:g,settings:y});const w=Array.isArray(g)?g.filter(v=>Mf(v)):[];Xo("AppContext:validMeals",w);const x=lb(y)?y:{...dr.settings,...y&&typeof y=="object"?{dailyCalories:typeof y.dailyCalories=="number"?y.dailyCalories:dr.settings.dailyCalories,dailyProtein:typeof y.dailyProtein=="number"?y.dailyProtein:dr.settings.dailyProtein,dailyCarbs:typeof y.dailyCarbs=="number"?y.dailyCarbs:dr.settings.dailyCarbs,dailyFat:typeof y.dailyFat=="number"?y.dailyFat:dr.settings.dailyFat,units:y.units==="imperial"?"imperial":"metric",darkMode:typeof y.darkMode=="boolean"?y.darkMode:dr.settings.darkMode}:{}};Xo("AppContext:validSettings",x),t({type:"SET_MEALS",payload:w}),t({type:"SET_SETTINGS",payload:x}),Xo("AppContext:success",{mealsCount:w.length,settingsValid:!!x})}catch(p){Vc("AppContext:loadData",p),t({type:"SET_MEALS",payload:[]}),t({type:"SET_SETTINGS",payload:dr.settings})}finally{setTimeout(()=>{t({type:"SET_LOADING",payload:!1})},100)}})()},[]);const c={state:e,addMeal:async h=>{try{if(!Mf(h))throw new Error("Invalid meal data");await nC(h),t({type:"ADD_MEAL",payload:h})}catch(p){const f=Gc(p,"addMeal");throw console.error("Failed to save meal:",f.message),f}},deleteMeal:async h=>{t({type:"DELETE_MEAL",payload:h})},updateMeal:async h=>{try{await nC(h),t({type:"UPDATE_MEAL",payload:h})}catch(p){console.error("Failed to update meal:",p)}},updateSettings:async h=>{try{if(!lb(h))throw new Error("Invalid settings data");await d2(h),t({type:"SET_SETTINGS",payload:h})}catch(p){const f=Gc(p,"updateSettings");throw console.error("Failed to save settings:",f.message),f}},toggleDarkMode:()=>{t({type:"TOGGLE_DARK_MODE"})},getTodaysNutrition:()=>{try{if(!e||!e.meals||!Array.isArray(e.meals))return{calories:0,protein:0,carbs:0,fat:0};const h=new Date().toDateString();return e.meals.filter(f=>{if(!f||typeof f!="object"||!f.timestamp)return!1;try{return new Date(f.timestamp).toDateString()===h}catch{return!1}}).reduce((f,g)=>!g||!g.nutrition||typeof g.nutrition!="object"?f:{calories:f.calories+(Number(g.nutrition.calories)||0),protein:f.protein+(Number(g.nutrition.protein)||0),carbs:f.carbs+(Number(g.nutrition.carbs)||0),fat:f.fat+(Number(g.nutrition.fat)||0)},{calories:0,protein:0,carbs:0,fat:0})}catch(h){return console.error("Error calculating today's nutrition:",h),{calories:0,protein:0,carbs:0,fat:0}}}};return O.jsx(h2.Provider,{value:c,children:n})},Fl=()=>{const n=ve.useContext(h2);if(!n)throw Vc("useApp","called outside of AppProvider"),new Error("useApp must be used within an AppProvider");return n.state||Vc("useApp","Context state is undefined"),M3("useApp:state",n.state),n};class W3 extends aw.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("App Error:",e,t)}render(){return this.state.hasError?O.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4",children:O.jsxs("div",{className:"text-center max-w-md",children:[O.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"Something went wrong"}),O.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"The app encountered an error. Please refresh the page to try again."}),O.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium",children:"Refresh Page"})]})}):this.props.children}}const U3=()=>{var n;try{const{state:e,getTodaysNutrition:t}=Fl(),s=t();return O.jsxs("div",{className:"fixed top-4 right-4 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg p-3 shadow-lg text-xs max-w-xs z-50",children:[O.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:"App Status"}),O.jsxs("div",{className:"space-y-1 text-gray-600 dark:text-gray-400",children:[O.jsxs("div",{children:["State: ",e?"":""]}),O.jsxs("div",{children:["Loading: ",e!=null&&e.isLoading?"Yes":"No"]}),O.jsxs("div",{children:["Settings: ",e!=null&&e.settings?"":""]}),O.jsxs("div",{children:["Meals: ",((n=e==null?void 0:e.meals)==null?void 0:n.length)||0]}),O.jsxs("div",{children:["Dark Mode: ",e!=null&&e.darkMode?"On":"Off"]}),O.jsxs("div",{children:["Today Cal: ",(s==null?void 0:s.calories)||0]}),O.jsxs("div",{children:["IndexedDB: ",typeof window<"u"&&"indexedDB"in window?"":""]}),O.jsxs("div",{children:["Timestamp: ",new Date().toLocaleTimeString()]})]})]})}catch(e){return O.jsxs("div",{className:"fixed top-4 right-4 bg-red-100 dark:bg-red-900 border border-red-300 dark:border-red-700 rounded-lg p-3 shadow-lg text-xs max-w-xs z-50",children:[O.jsx("h4",{className:"font-semibold text-red-900 dark:text-red-100 mb-2",children:"Error"}),O.jsx("div",{className:"text-red-700 dark:text-red-300",children:e instanceof Error?e.message:"Unknown error"})]})}},j3=({children:n})=>{const e=pd(),{state:t}=Fl(),[s,r]=ve.useState(!1);if(ve.useEffect(()=>{const a=setTimeout(()=>{r(!0)},3e3);return()=>clearTimeout(a)},[]),!t)return O.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),O.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Initializing app..."})]})});if(t.isLoading&&!s)return O.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),O.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading app data..."})]})});const o=[{path:"/",icon:"",label:"Home"},{path:"/add",icon:"",label:"Add"},{path:"/history",icon:"",label:"History"},{path:"/settings",icon:"",label:"Settings"}];return O.jsx("div",{className:`min-h-screen ${t!=null&&t.darkMode?"dark":""}`,children:O.jsxs("div",{className:"bg-white dark:bg-gray-900 text-gray-900 dark:text-white",children:[!1,O.jsx("header",{className:"bg-blue-500 dark:bg-blue-600 text-white p-4 safe-area-top",children:O.jsx("h1",{className:"text-xl font-bold text-center","data-testid":"app-title",children:"Food Tracker"})}),O.jsx("main",{className:"pb-20 min-h-screen",children:n}),O.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 safe-area-bottom",children:O.jsx("div",{className:"flex justify-around items-center py-2",children:o.map(a=>{const i=e.pathname===a.path;return O.jsxs(If,{to:a.path,className:`flex flex-col items-center p-2 rounded-lg transition-colors ${i?"text-blue-500 dark:text-blue-400":"text-gray-600 dark:text-gray-400 hover:text-blue-500 dark:hover:text-blue-400"}`,"data-testid":`nav-${a.label.toLowerCase()}`,children:[O.jsx("span",{className:"text-2xl mb-1",children:a.icon}),O.jsx("span",{className:"text-xs",children:a.label})]},a.path)})})})]})})},sC=()=>{var a;console.log("Dashboard: Component rendering...");const{state:n,getTodaysNutrition:e}=Fl();if(console.log("Dashboard: State received:",{hasState:!!n,isLoading:n==null?void 0:n.isLoading,settingsLoaded:!!(n!=null&&n.settings),mealsCount:((a=n==null?void 0:n.meals)==null?void 0:a.length)||0}),!n)return console.warn("Dashboard: No state available"),O.jsx("div",{className:"p-4 flex items-center justify-center min-h-64",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),O.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Initializing app..."})]})});if(n.isLoading)return O.jsx("div",{className:"p-4 flex items-center justify-center min-h-64",children:O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),O.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading dashboard..."})]})});if(!n.settings)return console.warn("Dashboard: Settings not available"),O.jsx("div",{className:"p-4 flex items-center justify-center min-h-64",children:O.jsxs("div",{className:"text-center",children:[O.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Settings unavailable"}),O.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg",children:"Retry"})]})});const t=(()=>{try{const i=e();return i&&typeof i=="object"?i:{calories:0,protein:0,carbs:0,fat:0}}catch(i){return console.error("Dashboard: Error getting today's nutrition:",i),{calories:0,protein:0,carbs:0,fat:0}}})(),s=(i,l)=>Math.min(i/l*100,100),r=({label:i,current:l,target:c,unit:h,color:p})=>O.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:[O.jsxs("div",{className:"flex justify-between items-center mb-2",children:[O.jsx("h3",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:i}),O.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:[Math.round(l),"/",c,h]})]}),O.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:O.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${p}`,style:{width:`${s(l,c)}%`}})}),O.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:[Math.round(c-l)," ",h," remaining"]})]}),o=(()=>{try{if(!n.meals||!Array.isArray(n.meals))return[];const i=new Date().toDateString();return n.meals.filter(l=>{if(!l||typeof l!="object"||!l.timestamp)return!1;try{return new Date(l.timestamp).toDateString()===i}catch(c){return console.warn("Dashboard: Invalid meal timestamp:",l.timestamp,c),!1}})}catch(i){return console.error("Dashboard: Error filtering today's meals:",i),[]}})();return O.jsxs("div",{className:"p-4 space-y-6",children:[O.jsxs("div",{className:"text-center",children:[O.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Welcome Back!"}),O.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Track your nutrition with AI-powered food recognition"})]}),O.jsx(If,{to:"/add",className:"block w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-4 px-6 rounded-lg text-center transition-colors","data-testid":"quick-add-meal",children:" Add New Meal"}),O.jsxs("div",{className:"space-y-4",children:[O.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Today's Progress"}),O.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[O.jsx(r,{label:"Calories",current:t.calories,target:n.settings.dailyCalories,unit:"cal",color:"bg-blue-500"}),O.jsx(r,{label:"Protein",current:t.protein,target:n.settings.dailyProtein,unit:"g",color:"bg-green-500"}),O.jsx(r,{label:"Carbs",current:t.carbs,target:n.settings.dailyCarbs,unit:"g",color:"bg-yellow-500"}),O.jsx(r,{label:"Fat",current:t.fat,target:n.settings.dailyFat,unit:"g",color:"bg-red-500"})]})]}),O.jsxs("div",{className:"space-y-4",children:[O.jsxs("div",{className:"flex justify-between items-center",children:[O.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Today's Meals (",o.length,")"]}),O.jsx(If,{to:"/history",className:"text-blue-500 hover:text-blue-600 text-sm font-medium",children:"View All"})]}),o.length===0?O.jsxs("div",{className:"text-center py-8",children:[O.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"No meals logged today yet"}),O.jsx(If,{to:"/add",className:"inline-block bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg text-sm font-medium transition-colors",children:"Add Your First Meal"})]}):O.jsx("div",{className:"space-y-3",children:o.slice(0,3).map(i=>{var l;return!i||!i.id?null:O.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm","data-testid":`meal-${i.id}`,children:O.jsxs("div",{className:"flex items-center space-x-3",children:[i.photo&&O.jsx("img",{src:i.photo,alt:"Meal",className:"w-12 h-12 rounded-lg object-cover",onError:c=>{console.warn("Failed to load meal image:",i.id),c.currentTarget.style.display="none"}}),O.jsxs("div",{className:"flex-1",children:[O.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:Array.isArray(i.ingredients)&&i.ingredients.length>0&&i.ingredients.map(c=>(c==null?void 0:c.name)||"Unknown").filter(c=>c!=="Unknown").join(", ")||"No ingredients"}),O.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[Math.round(((l=i.nutrition)==null?void 0:l.calories)||0)," cal  ",Math.round(i.totalWeight||0),"g"]}),O.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500",children:(()=>{try{return new Date(i.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return"Unknown time"}})()})]})]})},i.id)}).filter(Boolean)})]}),O.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:O.jsxs("div",{className:"flex items-start space-x-3",children:[O.jsx("span",{className:"text-2xl",children:""}),O.jsxs("div",{children:[O.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-1",children:"Install as App"}),O.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Add to your home screen for quick access and offline use. Tap Share  Add to Home Screen in Safari."})]})]})})]})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G3=1e-7,H3=1e-4;class uw{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class xm{refCount(e){return ps("refCount")}incRef(e){return ps("incRef")}timerAvailable(){return!0}time(e){return ps("time")}read(e){return ps("read")}readSync(e){return ps("readSync")}readToGPU(e,t){return ps("readToGPU")}numDataIds(){return ps("numDataIds")}disposeData(e,t){return ps("disposeData")}write(e,t,s){return ps("write")}move(e,t,s,r,o){return ps("move")}createTensorFromGPUData(e,t,s){return ps("createTensorFromGPUData")}memory(){return ps("memory")}floatPrecision(){return ps("floatPrecision")}epsilon(){return this.floatPrecision()===32?G3:H3}dispose(){return ps("dispose")}}function ps(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cw(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,co(n,e,t)}function q3(n,e){if(n.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${n.length}Second array length was ${e.length}`);let t=n.length,s=0;for(;t>0;)s=Math.random()*t|0,t--,co(n,t,s),co(e,t,s)}function aa(n,e,t){return Math.max(n,Math.min(e,t))}function bm(n){return n%2===0?n:n+1}function co(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function p2(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function K3(n,e){const t=Math.random();return e*t+(1-t)*n}function X3(n,e){let t=0;for(let s=0;s<n.length;s++){const r=Number(n[s])-Number(e[s]);t+=r*r}return t}function A(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Sn(n,e,t=""){A(Je(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function Ni(n){A(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function ce(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function Y3(n){return n.length===0}function f2(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==null&&e[t]!==null&&n[t]!==e[t])return!1;return!0}function Je(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function ii(n){return n%1===0}function Q3(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;{const e=Math.exp(2*n);return(e-1)/(e+1)}}function Bf(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function Z3(n){const e=new Uint32Array(n);for(let t=0;t<n;++t)e[t]=t;return cw(e),e}function ni(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function ub(n,e=r=>0,t,s){return new Promise((r,o)=>{let a=0;const i=()=>{if(n()){r();return}a++;const l=e(a);if(t!=null&&a>=t){o();return}s!=null?s(i,l):setTimeout(i,l)};i()})}function dw(n,e){let t=1,s=-1;for(let o=0;o<n.length;++o)if(n[o]>=0)t*=n[o];else if(n[o]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${o}`);s=o}else if(n[o]<0)throw Error(`Shapes can not be < 0. Found ${n[o]} at dim ${o}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[s]=e/t,r}function Qe(n,e){const t=e.length;return n=n==null?e.map((s,r)=>r):[].concat(n),A(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),A(n.every(s=>ii(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function bo(n,e){const t=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||r?null:Qe(e,n).sort();let a=0;for(let i=0;i<n.length;++i){if(o!=null){if(o[a]===i&&n[i]!==1)throw new Error(`Can't squeeze axis ${i} since its dim '${n[i]}' is not 1`);(o[a]==null||o[a]>i)&&n[i]===1&&(t.push(n[i]),s.push(i)),o[a]<=i&&a++}n[i]!==1&&(t.push(n[i]),s.push(i))}return{newShape:t,keptDims:s}}function hn(n,e){return Mt(n,e)}function Mt(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function m2(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function g2(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function hw(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function Hc(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function y2(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function Lr(n){return typeof n=="string"||n instanceof String}function x2(n){return typeof n=="boolean"}function Vf(n){return typeof n=="number"}function Ci(n){return Array.isArray(n)?Ci(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":Vf(n)?"float32":Lr(n)?"string":x2(n)?"bool":"float32"}function ia(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Wf(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function ze(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function b2(n,e,t,s=!1){const r=new Array;if(e.length===1){const o=e[0]*(s?2:1);for(let a=0;a<o;a++)r[a]=t[n+a]}else{const o=e[0],a=e.slice(1),i=a.reduce((l,c)=>l*c)*(s?2:1);for(let l=0;l<o;l++)r[l]=b2(n+l*i,a,t,s)}return r}function Ds(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((r,o)=>r*o)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return b2(0,n,e,t)}function w2(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function wm(n,e){const t=kn(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function kn(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function pw(n,e){const t=n.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return Ds(n,new Float32Array(t));if(e==="int32")return Ds(n,new Int32Array(t));if(e==="bool")return Ds(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function vs(n){n.forEach(e=>{A(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function yr(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=t[r]*n[r];return s}function Ii(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/t[r]),n-=s[r]*t[r];return s[s.length-1]=n,s}function la(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rC="tfjsflags";class v2{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=J3,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(oe().getBool("IS_TEST")||oe().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];oe().getBool("IS_TEST")||oe().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(la(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);rC in e&&e[rC].split(",").forEach(s=>{const[r,o]=s.split(":");this.urlFlags[r]=tL(r,o)})}}function J3(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>(eL(e,s[0],s[1]),s.join("="))),e}function eL(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function tL(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function oe(){return fw}let fw=null;function nL(n){fw=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Dx;function k2(){if(Dx==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");Dx=n}return Dx}function sL(){const n=k2();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function mw(n,e){const t=sL();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const md="Abs",Ll="Acos",Pl="Acosh",$i="Add",gd="AddN",vm="All",km="Any",yd="ArgMax",xd="ArgMin",zl="Asin",Ml="Asinh",Bl="Atan",Vl="Atanh",Wl="Atan2",bd="AvgPool",Sm="AvgPoolGrad",wd="AvgPool3D",Nm="AvgPool3DGrad",vd="BatchMatMul",kd="BatchToSpaceND",Cm="Bincount",Sd="BitwiseAnd",S2="BroadcastTo",Im="BroadcastArgs",Ul="Cast",jl="Ceil",Gl="ClipByValue",$m="Complex",Nd="ComplexAbs",Cd="Concat",Id="Conv2D",Tm="Conv2DBackpropFilter",$d="Conv2DBackpropInput",Td="Conv3D",Em="Conv3DBackpropFilterV2",Rm="Conv3DBackpropInputV2",Hl="Cos",ql="Cosh",Am="Cumprod",Ed="Cumsum",Dm="CropAndResize",_m="DenseBincount",Om="DepthToSpace",Rd="DepthwiseConv2dNative",Fm="DepthwiseConv2dNativeBackpropFilter",Lm="DepthwiseConv2dNativeBackpropInput",Pm="Diag",Ad="Dilation2D",Uf="Dilation2DBackpropInput",jf="Dilation2DBackpropFilter",zm="Draw",Kl="RealDiv",Mm="Einsum",Xl="Elu",Bm="EluGrad",Yl="Erf",Dd="Equal",Ql="Exp",_d="ExpandDims",Zl="Expm1",Vm="FFT",Wm="Fill",Um="FlipLeftRight",Jl="Floor",eu="FloorDiv",Od="FusedBatchNorm",Fd="GatherV2",jm="GatherNd",Ld="Greater",tu="GreaterEqual",nu="Identity",Gm="IFFT",Hm="Imag",su="IsFinite",ru="IsInf",ou="IsNan",Pd="LeakyRelu",zd="Less",Md="LessEqual",qm="LinSpace",au="Log",iu="Log1p",Bd="LogicalAnd",Vd="LogicalNot",Wd="LogicalOr",rL="LogicalXor",N2="LogSoftmax",oL="LowerBound",Ud="LRN",Km="LRNGrad",aL="MatrixBandPart",jd="Max",lu="Maximum",Gd="MaxPool",Xm="MaxPoolGrad",Hd="MaxPool3D",Ym="MaxPool3DGrad",Qm="MaxPoolWithArgmax",qd="Mean",Kd="Min",uu="Minimum",Xd="MirrorPad",cu="Mod",Zm="Multinomial",du="Multiply",Yd="Neg",Qd="NotEqual",Jm="NonMaxSuppressionV3",eg="NonMaxSuppressionV4",tg="NonMaxSuppressionV5",Zd="OnesLike",Jd="OneHot",eh="Pack",th="PadV2",iL="Pool",hu="Pow",nh="Prelu",sh="Prod",ng="RaggedGather",sg="RaggedRange",rg="RaggedTensorToTensor",og="Range",ag="Real",pu="Reciprocal",fu="Relu",rh="Reshape",oh="ResizeNearestNeighbor",ig="ResizeNearestNeighborGrad",ah="ResizeBilinear",lg="ResizeBilinearGrad",mu="Relu6",ih="Reverse",gu="Round",yu="Rsqrt",ug="ScatterNd",cg="TensorScatterUpdate",dg="SearchSorted",lh="Select",xu="Selu",uh="Slice",bu="Sin",wu="Sinh",vu="Sign",ku="Sigmoid",Su="Softplus",Nu="Sqrt",ch="Sum",dh="SpaceToBatchND",hh="SplitV",ph="Softmax",hg="SparseFillEmptyRows",pg="SparseReshape",fg="SparseSegmentMean",mg="SparseSegmentSum",gg="SparseToDense",Cu="SquaredDifference",yg="Square",fh="StaticRegexReplace",xg="StridedSlice",bg="StringNGrams",wg="StringSplit",vg="StringToHashBucketFast",Iu="Sub",$u="Tan",Tu="Tanh",Eu="Tile",kg="TopK",Sg="Transform",si="Transpose",Ng="Unique",mh="Unpack",gh="UnsortedSegmentSum",lL="UpperBound",yh="ZerosLike",Ru="Step",Gf="FromPixels",Cg="RotateWithOffset",qc="_FusedMatMul",Kc="FusedConv2D",Xc="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ts(...n){oe().getBool("IS_TEST")||oe().getBool("PROD")||console.warn(...n)}function uL(...n){oe().getBool("IS_TEST")||oe().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wl=mw("kernelRegistry",()=>new Map),Yc=mw("gradRegistry",()=>new Map);function Qc(n,e){const t=gw(n,e);return wl.get(t)}function cb(n){return Yc.get(n)}function Hf(n){const e=wl.entries(),t=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[o,a]=r,[i]=o.split("_");i===n&&t.push(a)}return t}function Ig(n){const{kernelName:e,backendName:t}=n,s=gw(e,t);wl.has(s)&&Ts(`The kernel '${e}' for backend '${t}' is already registered`),wl.set(s,n)}function C2(n){const{kernelName:e}=n;Yc.has(e)&&oe().getBool("DEBUG")&&Ts(`Overriding the gradient for '${e}'`),Yc.set(e,n)}function cL(n,e){const t=gw(n,e);if(!wl.has(t))throw new Error(`The kernel '${n}' for backend '${e}' is not registered`);wl.delete(t)}function dL(n){if(!Yc.has(n))throw new Error(`The gradient '${n}' for backend is not registered`);Yc.delete(n)}function hL(n,e){Hf(n).forEach(s=>{const r=Object.assign({},s,{backendName:e});Ig(r)})}function gw(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I2(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var _x,oC;function pL(){if(oC)return _x;oC=1,_x=e;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(L,E,j){this.low=L|0,this.high=E|0,this.unsigned=!!j}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function t(L){return(L&&L.__isLong__)===!0}e.isLong=t;var s={},r={};function o(L,E){var j,Z,ne;return E?(L>>>=0,(ne=0<=L&&L<256)&&(Z=r[L],Z)?Z:(j=i(L,(L|0)<0?-1:0,!0),ne&&(r[L]=j),j)):(L|=0,(ne=-128<=L&&L<128)&&(Z=s[L],Z)?Z:(j=i(L,L<0?-1:0,!1),ne&&(s[L]=j),j))}e.fromInt=o;function a(L,E){if(isNaN(L))return E?k:v;if(E){if(L<0)return k;if(L>=y)return P}else{if(L<=-9223372036854776e3)return z;if(L+1>=w)return D}return L<0?a(-L,E).neg():i(L%g|0,L/g|0,E)}e.fromNumber=a;function i(L,E,j){return new e(L,E,j)}e.fromBits=i;var l=Math.pow;function c(L,E,j){if(L.length===0)throw Error("empty string");if(L==="NaN"||L==="Infinity"||L==="+Infinity"||L==="-Infinity")return v;if(typeof E=="number"?(j=E,E=!1):E=!!E,j=j||10,j<2||36<j)throw RangeError("radix");var Z;if((Z=L.indexOf("-"))>0)throw Error("interior hyphen");if(Z===0)return c(L.substring(1),E,j).neg();for(var ne=a(l(j,8)),te=v,se=0;se<L.length;se+=8){var K=Math.min(8,L.length-se),B=parseInt(L.substring(se,se+K),j);if(K<8){var J=a(l(j,K));te=te.mul(J).add(a(B))}else te=te.mul(ne),te=te.add(a(B))}return te.unsigned=E,te}e.fromString=c;function h(L,E){return typeof L=="number"?a(L,E):typeof L=="string"?c(L,E):i(L.low,L.high,typeof E=="boolean"?E:L.unsigned)}e.fromValue=h;var p=65536,f=1<<24,g=p*p,y=g*g,w=y/2,x=o(f),v=o(0);e.ZERO=v;var k=o(0,!0);e.UZERO=k;var I=o(1);e.ONE=I;var N=o(1,!0);e.UONE=N;var T=o(-1);e.NEG_ONE=T;var D=i(-1,2147483647,!1);e.MAX_VALUE=D;var P=i(-1,-1,!0);e.MAX_UNSIGNED_VALUE=P;var z=i(0,-2147483648,!1);e.MIN_VALUE=z;var F=e.prototype;return F.toInt=function(){return this.unsigned?this.low>>>0:this.low},F.toNumber=function(){return this.unsigned?(this.high>>>0)*g+(this.low>>>0):this.high*g+(this.low>>>0)},F.toString=function(E){if(E=E||10,E<2||36<E)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(z)){var j=a(E),Z=this.div(j),ne=Z.mul(j).sub(this);return Z.toString(E)+ne.toInt().toString(E)}else return"-"+this.neg().toString(E);for(var te=a(l(E,6),this.unsigned),se=this,K="";;){var B=se.div(te),J=se.sub(B.mul(te)).toInt()>>>0,X=J.toString(E);if(se=B,se.isZero())return X+K;for(;X.length<6;)X="0"+X;K=""+X+K}},F.getHighBits=function(){return this.high},F.getHighBitsUnsigned=function(){return this.high>>>0},F.getLowBits=function(){return this.low},F.getLowBitsUnsigned=function(){return this.low>>>0},F.getNumBitsAbs=function(){if(this.isNegative())return this.eq(z)?64:this.neg().getNumBitsAbs();for(var E=this.high!=0?this.high:this.low,j=31;j>0&&(E&1<<j)==0;j--);return this.high!=0?j+33:j+1},F.isZero=function(){return this.high===0&&this.low===0},F.eqz=F.isZero,F.isNegative=function(){return!this.unsigned&&this.high<0},F.isPositive=function(){return this.unsigned||this.high>=0},F.isOdd=function(){return(this.low&1)===1},F.isEven=function(){return(this.low&1)===0},F.equals=function(E){return t(E)||(E=h(E)),this.unsigned!==E.unsigned&&this.high>>>31===1&&E.high>>>31===1?!1:this.high===E.high&&this.low===E.low},F.eq=F.equals,F.notEquals=function(E){return!this.eq(E)},F.neq=F.notEquals,F.ne=F.notEquals,F.lessThan=function(E){return this.comp(E)<0},F.lt=F.lessThan,F.lessThanOrEqual=function(E){return this.comp(E)<=0},F.lte=F.lessThanOrEqual,F.le=F.lessThanOrEqual,F.greaterThan=function(E){return this.comp(E)>0},F.gt=F.greaterThan,F.greaterThanOrEqual=function(E){return this.comp(E)>=0},F.gte=F.greaterThanOrEqual,F.ge=F.greaterThanOrEqual,F.compare=function(E){if(t(E)||(E=h(E)),this.eq(E))return 0;var j=this.isNegative(),Z=E.isNegative();return j&&!Z?-1:!j&&Z?1:this.unsigned?E.high>>>0>this.high>>>0||E.high===this.high&&E.low>>>0>this.low>>>0?-1:1:this.sub(E).isNegative()?-1:1},F.comp=F.compare,F.negate=function(){return!this.unsigned&&this.eq(z)?z:this.not().add(I)},F.neg=F.negate,F.add=function(E){t(E)||(E=h(E));var j=this.high>>>16,Z=this.high&65535,ne=this.low>>>16,te=this.low&65535,se=E.high>>>16,K=E.high&65535,B=E.low>>>16,J=E.low&65535,X=0,M=0,H=0,le=0;return le+=te+J,H+=le>>>16,le&=65535,H+=ne+B,M+=H>>>16,H&=65535,M+=Z+K,X+=M>>>16,M&=65535,X+=j+se,X&=65535,i(H<<16|le,X<<16|M,this.unsigned)},F.subtract=function(E){return t(E)||(E=h(E)),this.add(E.neg())},F.sub=F.subtract,F.multiply=function(E){if(this.isZero())return v;if(t(E)||(E=h(E)),n){var j=n.mul(this.low,this.high,E.low,E.high);return i(j,n.get_high(),this.unsigned)}if(E.isZero())return v;if(this.eq(z))return E.isOdd()?z:v;if(E.eq(z))return this.isOdd()?z:v;if(this.isNegative())return E.isNegative()?this.neg().mul(E.neg()):this.neg().mul(E).neg();if(E.isNegative())return this.mul(E.neg()).neg();if(this.lt(x)&&E.lt(x))return a(this.toNumber()*E.toNumber(),this.unsigned);var Z=this.high>>>16,ne=this.high&65535,te=this.low>>>16,se=this.low&65535,K=E.high>>>16,B=E.high&65535,J=E.low>>>16,X=E.low&65535,M=0,H=0,le=0,he=0;return he+=se*X,le+=he>>>16,he&=65535,le+=te*X,H+=le>>>16,le&=65535,le+=se*J,H+=le>>>16,le&=65535,H+=ne*X,M+=H>>>16,H&=65535,H+=te*J,M+=H>>>16,H&=65535,H+=se*B,M+=H>>>16,H&=65535,M+=Z*X+ne*J+te*B+se*K,M&=65535,i(le<<16|he,M<<16|H,this.unsigned)},F.mul=F.multiply,F.divide=function(E){if(t(E)||(E=h(E)),E.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&E.low===-1&&E.high===-1)return this;var j=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,E.low,E.high);return i(j,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?k:v;var Z,ne,te;if(this.unsigned){if(E.unsigned||(E=E.toUnsigned()),E.gt(this))return k;if(E.gt(this.shru(1)))return N;te=k}else{if(this.eq(z)){if(E.eq(I)||E.eq(T))return z;if(E.eq(z))return I;var se=this.shr(1);return Z=se.div(E).shl(1),Z.eq(v)?E.isNegative()?I:T:(ne=this.sub(E.mul(Z)),te=Z.add(ne.div(E)),te)}else if(E.eq(z))return this.unsigned?k:v;if(this.isNegative())return E.isNegative()?this.neg().div(E.neg()):this.neg().div(E).neg();if(E.isNegative())return this.div(E.neg()).neg();te=v}for(ne=this;ne.gte(E);){Z=Math.max(1,Math.floor(ne.toNumber()/E.toNumber()));for(var K=Math.ceil(Math.log(Z)/Math.LN2),B=K<=48?1:l(2,K-48),J=a(Z),X=J.mul(E);X.isNegative()||X.gt(ne);)Z-=B,J=a(Z,this.unsigned),X=J.mul(E);J.isZero()&&(J=I),te=te.add(J),ne=ne.sub(X)}return te},F.div=F.divide,F.modulo=function(E){if(t(E)||(E=h(E)),n){var j=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,E.low,E.high);return i(j,n.get_high(),this.unsigned)}return this.sub(this.div(E).mul(E))},F.mod=F.modulo,F.rem=F.modulo,F.not=function(){return i(~this.low,~this.high,this.unsigned)},F.and=function(E){return t(E)||(E=h(E)),i(this.low&E.low,this.high&E.high,this.unsigned)},F.or=function(E){return t(E)||(E=h(E)),i(this.low|E.low,this.high|E.high,this.unsigned)},F.xor=function(E){return t(E)||(E=h(E)),i(this.low^E.low,this.high^E.high,this.unsigned)},F.shiftLeft=function(E){return t(E)&&(E=E.toInt()),(E&=63)===0?this:E<32?i(this.low<<E,this.high<<E|this.low>>>32-E,this.unsigned):i(0,this.low<<E-32,this.unsigned)},F.shl=F.shiftLeft,F.shiftRight=function(E){return t(E)&&(E=E.toInt()),(E&=63)===0?this:E<32?i(this.low>>>E|this.high<<32-E,this.high>>E,this.unsigned):i(this.high>>E-32,this.high>=0?0:-1,this.unsigned)},F.shr=F.shiftRight,F.shiftRightUnsigned=function(E){if(t(E)&&(E=E.toInt()),E&=63,E===0)return this;var j=this.high;if(E<32){var Z=this.low;return i(Z>>>E|j<<32-E,j>>>E,this.unsigned)}else return E===32?i(j,0,this.unsigned):i(j>>>E-32,0,this.unsigned)},F.shru=F.shiftRightUnsigned,F.shr_u=F.shiftRightUnsigned,F.toSigned=function(){return this.unsigned?i(this.low,this.high,!1):this},F.toUnsigned=function(){return this.unsigned?this:i(this.low,this.high,!0)},F.toBytes=function(E){return E?this.toBytesLE():this.toBytesBE()},F.toBytesLE=function(){var E=this.high,j=this.low;return[j&255,j>>>8&255,j>>>16&255,j>>>24,E&255,E>>>8&255,E>>>16&255,E>>>24]},F.toBytesBE=function(){var E=this.high,j=this.low;return[E>>>24,E>>>16&255,E>>>8&255,E&255,j>>>24,j>>>16&255,j>>>8&255,j&255]},e.fromBytes=function(E,j,Z){return Z?e.fromBytesLE(E,j):e.fromBytesBE(E,j)},e.fromBytesLE=function(E,j){return new e(E[0]|E[1]<<8|E[2]<<16|E[3]<<24,E[4]|E[5]<<8|E[6]<<16|E[7]<<24,j)},e.fromBytesBE=function(E,j){return new e(E[4]<<24|E[5]<<16|E[6]<<8|E[7],E[0]<<24|E[1]<<16|E[2]<<8|E[3],j)},_x}var $2=pL();const T2=rw($2),fL=KI({__proto__:null,default:T2},[$2]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ka=T2||fL;function xh(n){return Ka.fromString(n,!0,16)}const E2=xh("c3a5c85c97cb3127"),Ha=xh("b492b66fbe98f273"),Vn=xh("9ae16a3b2f90404f");function db(n){return n.xor(n.shru(47))}function R2(n,e,t){const s=n.slice(e,e+t);return Ka.fromBytes(Array.from(s),!0,!0)}function kt(n,e){return R2(n,e,8)}function aC(n,e){return R2(n,e,4)}function un(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function sa(n,e,t=xh("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let r=e.xor(s).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function mL(n,e,t,s,r,o){r=r.add(n),o=un(o.add(r).add(s),21);const a=r;return r=r.add(e),r=r.add(t),o=o.add(un(r,44)),[r.add(s),o.add(a)]}function cf(n,e,t,s){return mL(kt(n,e),kt(n,e+8),kt(n,e+16),kt(n,e+24),t,s)}function gL(n,e=n.length){if(e>=8){const t=Vn.add(e*2),s=kt(n,0).add(Vn),r=kt(n,e-8),o=un(r,37).mul(t).add(s),a=un(s,25).add(r).mul(t);return sa(o,a,t)}if(e>=4){const t=Vn.add(e*2),s=aC(n,0);return sa(s.shl(3).add(e),aC(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],r=n[e-1],o=t+(s<<8),a=e+(r<<2);return db(Vn.mul(o).xor(E2.mul(a))).mul(Vn)}return Vn}function yL(n,e=n.length){const t=Vn.add(e*2),s=kt(n,0).mul(Ha),r=kt(n,8),o=kt(n,e-8).mul(t),a=kt(n,e-16).mul(Vn);return sa(un(s.add(r),43).add(un(o,30)).add(a),s.add(un(r.add(Vn),18)).add(o),t)}function xL(n,e=n.length){const t=Vn.add(e*2),s=kt(n,0).mul(Vn),r=kt(n,8),o=kt(n,e-8).mul(t),a=kt(n,e-16).mul(Vn),i=un(s.add(r),43).add(un(o,30)).add(a),l=sa(i,s.add(un(r.add(Vn),18)).add(o),t),c=kt(n,16).mul(t),h=kt(n,24),p=i.add(kt(n,e-32)).mul(t),f=l.add(kt(n,e-24)).mul(t);return sa(un(c.add(h),43).add(un(p,30)).add(f),c.add(un(h.add(s),18)).add(p),t)}function A2(n,e=n.length){const t=Ka.fromNumber(81,!0);if(e<=32)return e<=16?gL(n,e):yL(n,e);if(e<=64)return xL(n,e);let s=t,r=t.mul(Ha).add(113),o=db(r.mul(Vn).add(113)).mul(Vn),a=[Ka.UZERO,Ka.UZERO],i=[Ka.UZERO,Ka.UZERO];s=s.mul(Vn).add(kt(n,0));let l=0;const c=(e-1>>6)*64,h=c+(e-1&63)-63;do s=un(s.add(r).add(a[0]).add(kt(n,l+8)),37).mul(Ha),r=un(r.add(a[1]).add(kt(n,l+48)),42).mul(Ha),s=s.xor(i[1]),r=r.add(a[0]).add(kt(n,l+40)),o=un(o.add(i[0]),33).mul(Ha),a=cf(n,l,a[1].mul(Ha),s.add(i[0])),i=cf(n,l+32,o.add(i[1]),r.add(kt(n,l+16))),[o,s]=[s,o],l+=64;while(l!==c);const p=Ha.add(o.and(255).shl(1));return l=h,i[0]=i[0].add(e-1&63),a[0]=a[0].add(i[0]),i[0]=i[0].add(a[0]),s=un(s.add(r).add(a[0]).add(kt(n,l+8)),37).mul(p),r=un(r.add(a[1]).add(kt(n,l+48)),42).mul(p),s=s.xor(i[1].mul(9)),r=r.add(a[0].mul(9).add(kt(n,l+40))),o=un(o.add(i[0]),33).mul(p),a=cf(n,l,a[1].mul(p),s.add(i[0])),i=cf(n,l+32,o.add(i[1]),r.add(kt(n,l+16))),[o,s]=[s,o],sa(sa(a[0],i[0],p).add(db(r).mul(E2)).add(o),sa(a[1],i[1],p).add(s),p)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wo(n,e){return e==="string"?zr(n):xa([n],e)}function bL(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function xa(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Ur(n)),oe().getBool("DEBUG")&&m2(n,e),bL(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function Mn(){return oe().platform.now()}function wL(n,e){return oe().platform.fetch(n,e)}function zr(n,e="utf-8"){return e=e||"utf-8",oe().platform.encode(n,e)}function fo(n,e="utf-8"){return e=e||"utf-8",oe().platform.decode(n,e)}function cn(n){return oe().platform.isTypedArray!=null?oe().platform.isTypedArray(n):I2(n)}function Ur(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||la(n)||n==null||cn(n)&&t)e.push(n);else if(Array.isArray(n)||cn(n))for(let s=0;s<n.length;++s)Ur(n[s],e,t);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)Ur(n[r],e,t)}return e}const vL=Object.freeze(Object.defineProperty({__proto__:null,arraysEqual:Je,arraysEqualWithNull:f2,assert:A,assertNonNegativeIntegerDimensions:vs,assertNonNull:Ni,assertShapesMatch:Sn,bytesFromStringArray:y2,bytesPerElement:Hc,checkConversionForErrors:m2,clamp:aa,computeStrides:ze,convertBackendValuesAndArrayBuffer:w2,createScalarValue:wo,createShuffledIndices:Z3,decodeString:fo,distSquared:X3,encodeString:zr,fetch:wL,fingerPrint64:A2,flatten:Ur,getArrayFromDType:Mt,getTypedArrayFromDType:hn,hasEncodingLoss:hw,hexToLong:xh,indexToLoc:Ii,inferDtype:Ci,inferFromImplicitShape:dw,isBoolean:x2,isFunction:ia,isInt:ii,isNumber:Vf,isPromise:la,isScalarShape:Y3,isString:Lr,isTypedArray:cn,isValidDtype:g2,locToIndex:yr,makeOnesTypedArray:wm,makeZerosNestedTypedArray:pw,makeZerosTypedArray:kn,nearestDivisor:Wf,nearestLargerEven:bm,now:Mn,parseAxisParam:Qe,randUniform:K3,repeatedTry:ub,rightPad:ni,shuffle:cw,shuffleCombo:q3,sizeFromShape:ce,sizeToSquarishShape:Bf,squeezeShape:bo,sum:p2,swap:co,tanh:Q3,toNestedArray:Ds,toTypedArray:xa},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kL{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new NL)}profileKernel(e,t,s){let r;const o=()=>{r=s()};let a;const i=Mn();if(this.backendTimer.timerAvailable())a=this.backendTimer.time(o);else{o();for(const c of r)c.dataSync();a=Promise.resolve({kernelMs:Mn()-i})}if(oe().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<r.length;c++){const h=r[c];h.data().then(p=>{SL(p,h.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:a.then(c=>c.kernelMs),extraInfo:a.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:r,inputs:o,extraInfo:a}=e;s.forEach(i=>{Promise.all([i.data(),r,a]).then(l=>{this.logger.logKernelProfile(t,i,l[0],l[1],o,l[2])})})}}function SL(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}class NL{logKernelProfile(e,t,s,r,o,a){const i=typeof r=="number"?ni(`${r}ms`,9):r.error,l=ni(e,25),c=t.rank,h=t.size,p=ni(t.shape.toString(),14);let f="";for(const g in o){const y=o[g];if(y!=null){const w=y.shape||t.shape,x=w.length;f+=`${g}: ${x}D ${x>0?w:""} `}}console.log(`%c${l}	%c${i}	%c${c}D ${p}	%c${h}	%c${f}	%c${a}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CL(n,e,t){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<n.length;l++){const c=n[l],h=c.inputs;for(const p in h){const f=h[p];let g=!1;for(let y=0;y<e.length;y++)if(s[f.id]){c.outputs.forEach(w=>s[w.id]=!0),g=!0,r[c.id]=!0;break}if(g)break}}const o={};o[t.id]=!0;const a={};for(let l=n.length-1;l>=0;l--){const c=n[l],h=c.inputs;for(let p=0;p<c.outputs.length;p++)if(o[c.outputs[p].id]){for(const f in h)o[h[f].id]=!0,a[c.id]=!0;break}}const i=[];for(let l=0;l<n.length;l++){const c=n[l];if(r[c.id]&&a[c.id]){const h={};for(const f in c.inputs){const g=c.inputs[f];s[g.id]&&(h[f]=g)}const p=Object.assign({},c);p.inputs=h,p.outputs=c.outputs,i.push(p)}}return i}function IL(n,e,t,s){for(let r=e.length-1;r>=0;r--){const o=e[r],a=[];if(o.outputs.forEach(l=>{const c=n[l.id];c!=null?a.push(c):a.push(null)}),o.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const i=o.gradient(a);for(const l in o.inputs){if(!(l in i))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(i)}.`);const c=t(()=>i[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);const h=o.inputs[l];if(!Je(c.shape,h.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${h.shape}'`);if(n[h.id]==null)n[h.id]=c;else{const p=n[h.id];n[h.id]=s(p,c),p.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iC=20,Ac=3,Ox=7;function $L(n,e,t,s){const r=ze(e),o=TL(n,e,t,r),a=e.length,i=$f(n,e,t,r,o),l=["Tensor"];return s&&(l.push(`  dtype: ${t}`),l.push(`  rank: ${a}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(i.map(c=>"    "+c).join(`
`)),l.join(`
`)}function TL(n,e,t,s){const r=ce(e),o=s[s.length-1],a=new Array(o).fill(0),i=e.length,l=t==="complex64"?Lc(n):n;if(i>1)for(let c=0;c<r/o;c++){const h=c*o;for(let p=0;p<o;p++)a[p]=Math.max(a[p],Fc(l[h+p],0,t).length)}return a}function Fc(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(Ox))} + ${parseFloat(n[1].toFixed(Ox))}j`:Lr(n)?s=`'${n}'`:t==="bool"?s=D2(n):s=parseFloat(n.toFixed(Ox)).toString(),ni(s,e)}function D2(n){return n===0?"false":"true"}function $f(n,e,t,s,r,o=!0){const a=t==="complex64"?2:1,i=e[0],l=e.length;if(l===0){if(t==="complex64"){const w=Lc(n);return[Fc(w[0],0,t)]}return t==="bool"?[D2(n[0])]:[n[0].toString()]}if(l===1){if(i>iC){const x=Ac*a;let v=Array.from(n.slice(0,x)),k=Array.from(n.slice((i-Ac)*a,i*a));return t==="complex64"&&(v=Lc(v),k=Lc(k)),["["+v.map((I,N)=>Fc(I,r[N],t)).join(", ")+", ..., "+k.map((I,N)=>Fc(I,r[i-Ac+N],t)).join(", ")+"]"]}return["["+(t==="complex64"?Lc(n):Array.from(n)).map((x,v)=>Fc(x,r[v],t)).join(", ")+"]"]}const c=e.slice(1),h=s.slice(1),p=s[0]*a,f=[];if(i>iC){for(let w=0;w<Ac;w++){const x=w*p,v=x+p;f.push(...$f(n.slice(x,v),c,t,h,r,!1))}f.push("...");for(let w=i-Ac;w<i;w++){const x=w*p,v=x+p;f.push(...$f(n.slice(x,v),c,t,h,r,w===i-1))}}else for(let w=0;w<i;w++){const x=w*p,v=x+p;f.push(...$f(n.slice(x,v),c,t,h,r,w===i-1))}const g=l===2?",":"";f[0]="["+(i>0?f[0]+g:"");for(let w=1;w<f.length-1;w++)f[w]=" "+f[w]+g;let y=`,
`;for(let w=2;w<l;w++)y+=`
`;return f[f.length-1]=" "+f[f.length-1]+"]"+(o?"":y),f}function Lc(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yt{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=ce(e),s!=null){const r=s.length;A(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||Mt(t,this.size),this.strides=ze(e)}set(e,...t){t.length===0&&(t=[0]),A(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const o=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(o)}t++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return mr().makeTensor(this.values,this.shape,this.dtype)}}let mr=null,hl=null;function EL(n){mr=n}function RL(n){hl=n}class dt{constructor(e,t,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=ce(e),this.strides=ze(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return hl.buffer(this.shape,this.dtype,e)}bufferSync(){return hl.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Ds(this.shape,e,this.dtype==="complex64")}arraySync(){return Ds(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=mr().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>fo(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),mr().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=mr().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>fo(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await mr().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),mr().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return hl.print(this,e)}clone(){return this.throwIfDisposed(),hl.clone(this)}toString(e=!1){const t=this.dataSync();return $L(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),hl.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),mr().makeVariable(this,e,t,s)}}Object.defineProperty(dt,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function de(){return mw("Tensor",()=>dt)}de();class Zc extends dt{constructor(e,t,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Je(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);mr().disposeTensor(this),this.dataId=e.dataId,mr().incRef(this,null)}dispose(){mr().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Zc,Symbol.hasInstance,{value:n=>n instanceof dt&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var hb;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(hb||(hb={}));var pb;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(pb||(pb={}));var fb;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(fb||(fb={}));var mb;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(mb||(mb={}));var gb;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(gb||(gb={}));const AL={float32:mb,int32:pb,bool:fb,complex64:gb};function Jn(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return AL[n][e]}function $g(n){return Jn(n,"int32")}function _2(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function O2(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ft(n,e){if(n.dtype===e.dtype)return[n,e];const t=Jn(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function F2(n,e){A(n.dtype===e.dtype,()=>`The dtypes of the first(${n.dtype}) and second(${e.dtype}) input must match`)}function DL(n,e){return e.some(t=>t.id===n.id)}function yw(n){const e=[];return L2(n,e,new Set),e}function L2(n,e,t){if(n==null)return;if(n instanceof dt){e.push(n);return}if(!_L(n))return;const s=n;for(const r in s){const o=s[r];t.has(o)||(t.add(o),L2(o,e,t))}}function _L(n){return Array.isArray(n)||typeof n=="object"}const OL=Object.freeze(Object.defineProperty({__proto__:null,assertTypesMatch:F2,getTensorsInContainer:yw,isTensorInList:DL,makeTypesMatch:Ft},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fx(n){return n.kernelName!=null}class lC{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class vl{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new lC}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(Ts(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new kL(this.backendInstance),!0}setupRegisteredKernels(){Hf(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){Hf(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof xm)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,o=s.then(a=>r<this.pendingBackendInitId?!1:(this.registry[e]=a,this.pendingBackendInit=null,!0)).catch(a=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,Ts(`Initialization of backend ${e} failed`),Ts(a.stack||a.message)),!1));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return Ts(`Initialization of backend ${e} failed`),Ts(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:r,asyncInit:o}=this.initializeBackend(s);if(o||r)return{name:s,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),r=s.backend,o=this.readSync(t),a=r.refCount(t);r.disposeData(t,!0),s.backend=e,e.move(t,o,s.shape,s.dtype,a),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,s){e();try{const r=s();return t(),r}catch(r){throw t(),r}}nextTensorId(){return vl.nextTensorId++}nextVariableId(){return vl.nextVariableId++}clone(e){const t=W.runKernel(nu,{x:e}),s={x:e},r=a=>({x:()=>{const i="float32",l={x:a},c={dtype:i};return W.runKernel(Ul,l,c)}}),o=[];return this.addTapeNode(this.state.activeScope.name,s,[t],r,o,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,!(Qc(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const r=this.backend.numDataIds();let o=0;s.forEach(l=>{o+=l.dtype==="complex64"?3:1});const a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=r-t-o-a;if(i>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${i} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const r=this.isTapeOn(),o=this.state.numBytes,a=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let i;this.backendName==null&&this.backend;let l;const c=Fx(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Fx(e)){const{kernelName:y,inputs:w,attrs:x}=e;this.backendName==null&&this.backend;const v=Qc(y,this.backendName);A(v!=null,()=>`Cannot find registered kernel '${y}' for backend '${this.backendName}'`),i=()=>{const k=this.backend.numDataIds();l=v.kernelFunc({inputs:w,attrs:x,backend:this.backend});const I=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(y,k,I);const N=I.map(T=>T.rank!=null?T:this.makeTensorFromTensorInfo(T));if(r){const T=this.getTensorsForGradient(y,w,N);s=this.saveTensorsForBackwardMode(T)}return N}}else{const{forwardFunc:y}=e,w=x=>{r&&(s=x.map(v=>this.keep(this.clone(v))))};i=()=>{const x=this.backend.numDataIds();l=this.tidy(()=>y(this.backend,w));const v=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,x,v),v}}const{inputs:h,attrs:p}=e,f=Fx(e)?null:e.backwardsFunc;let g;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=i():(g=this.profiler.profileKernel(c,h,()=>i()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(g),t=g.outputs)}),r&&this.addTapeNode(c,h,t,f,s,p),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-a,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(h).map(y=>h[y]!=null?h[y].shape:null),outputShapes:t.map(y=>y.shape),kernelTimeMs:g.timeMs,extraInfo:g.extraInfo}),Array.isArray(l)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,t,s){const r=cb(e);if(r!=null){const o=r.inputsToSave||[],a=r.outputsToSave||[];let i;r.saveAllInputs?(A(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),i=Object.keys(t).map(c=>t[c])):i=o.map(c=>t[c]);const l=s.filter((c,h)=>a[h]);return i.concat(l)}return[]}makeTensor(e,t,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let o=e;s==="string"&&Lr(e[0])&&(o=e.map(l=>zr(l)));const a=r.write(o,t,s),i=new dt(t,s,a,this.nextTensorId());if(this.trackTensor(i,r),s==="string"){const l=this.state.tensorInfo.get(a),c=y2(o);this.state.numBytes+=c-l.bytes,l.bytes=c}return i}makeTensorFromDataId(e,t,s,r){s=s||"float32";const o={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(o,r)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:r,dtype:o}=e,a=new dt(r,o,s,this.nextTensorId());return this.trackTensor(a,t),a}makeVariable(e,t=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const o=new Zc(e,t,s,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error(`Variable with name ${o.name} was already registered`);return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*Hc(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof Zc||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*Hc(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,r,o,a){const i={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:o},l=cb(e);l!=null&&(r=l.gradFunc),r!=null&&(i.gradient=c=>(c=c.map((h,p)=>{if(h==null){const f=s[p],g=kn(f.size,f.dtype);return this.makeTensor(g,f.shape,f.dtype)}return h}),r(c.length>1?c:c[0],o,a))),this.state.activeTape.push(i)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=yw(e),s=new Set(t.map(o=>o.id));for(let o=0;o<this.state.activeScope.track.length;o++){const a=this.state.activeScope.track[o];!a.kept&&!s.has(a.id)&&a.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(o=>{!o.kept&&o.scopeId===r.id&&this.track(o)})}gradients(e,t,s,r=!1){if(A(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const o=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));A(o instanceof dt,()=>"The result y returned by f() must be a tensor.");const a=CL(this.state.activeTape,t,o);if(!r&&a.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const i={};i[o.id]=s??FL(o.shape),IL(i,a,c=>this.tidy(c),LL);const l=t.map(c=>i[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(const h of c.saved)h.dispose()}),this.state.activeTape=null),{value:o,grads:l}})}customGrad(e){return A(ia(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{A(t.every(i=>i instanceof dt),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};t.forEach((i,l)=>{r[l]=i});const o=(i,l)=>(s=e(...t,l),A(s.value instanceof dt,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),A(ia(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),a=(i,l)=>{const c=s.gradFunc(i,l),h=Array.isArray(c)?c:[c];A(h.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),A(h.every(f=>f instanceof dt),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const p={};return h.forEach((f,g)=>{p[g]=()=>f}),p};return this.runKernelFunc({forwardFunc:o,backwardsFunc:a,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=Mn(),s=await this.backend.time(e);return s.wallMs=Mn()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new lC;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}vl.nextTensorId=0;vl.nextVariableId=0;function FL(n){const e=wm(ce(n),"float32");return W.makeTensor(e,n,"float32")}function P2(){const n=k2();if(n._tfengine==null){const e=new v2(n);n._tfengine=new vl(e)}return nL(n._tfengine.ENV),EL(()=>n._tfengine),n._tfengine}const W=P2();function LL(n,e){const t={a:n,b:e};return W.runKernel($i,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PL(){return typeof navigator<"u"&&navigator!=null}let yb;function zL(n){yb=n}function xw(n){if(yb!==void 0)return yb;if(n||PL()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function bw(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}const ML=Object.freeze(Object.defineProperty({__proto__:null,isBrowser:bw,isMobile:xw,mockIsMobile:zL},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const es=oe();es.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});es.registerFlag("IS_BROWSER",()=>bw());es.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");es.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));es.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));es.registerFlag("PROD",()=>!1);es.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>es.getBool("DEBUG"));es.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);es.registerFlag("IS_TEST",()=>!1);es.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>es.getBool("DEBUG"));es.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);es.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);es.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jr(n,e){let t=n;if(cn(n))return e==="string"?[]:[n.length];if(_2(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(O2(n))return[n.buffer.size/(e==null?4:Hc(e))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||cn(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&oe().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&z2(n,s,[]),s}function z2(n,e,t){if(t=t||[],!Array.isArray(n)&&!cn(n)){A(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}A(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),A(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let r=0;r<n.length;++r)z2(n[r],s,t.concat(r))}function uC(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function _(n,e,t,s="numeric"){if(n instanceof de())return uC(s,n.dtype,e,t),n;let r=Ci(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),uC(s,r,e,t),n==null||!cn(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${l}'`)}const o=jr(n,r);!cn(n)&&!Array.isArray(n)&&(n=[n]);const i=r!=="string"?xa(n,r):Ur(n,[],!0);return W.makeTensor(i,o,r)}function Jc(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((o,a)=>_(o,`${e}[${a}]`,t,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ww="__op";function U(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+ww;const r=(...o)=>{W.startScope(t);try{const a=s(...o);return la(a)&&console.error("Cannot return a Promise inside of tidy."),W.endScope(a),a}catch(a){throw W.endScope(null),a}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BL(n,e){const t=_(n,"real","complex"),s=_(e,"imag","complex");Sn(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:t,imag:s};return W.runKernel($m,r)}const mo=U({complex_:BL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ba(n,e,t,s){if(s==null)s=Ci(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(O2(n)||_2(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return W.backend.createTensorFromGPUData(n,e||t,s)}if(!cn(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){vs(e);const r=ce(e),o=ce(t);A(r===o,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${o}`);for(let a=0;a<t.length;++a){const i=t[a],l=a===t.length-1?i!==ce(e.slice(a)):!0;A(t[a]===e[a]||!l,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!cn(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?xa(n,s):Ur(n,[],!0),W.makeTensor(n,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zs(n,e,t){const s=jr(n,t);return ba(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const li={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Nr{static join(e){return new Nr(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>cn(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const o=t+r.byteLength;this.shards.push({buffer:r,start:t,end:o}),t=o}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=t-e,o=new ArrayBuffer(r),a=new Uint8Array(o);let i=0;for(let l=s;l<this.shards.length;l++){const c=this.shards[l],p=e+i-c.start,f=i,y=Math.min(t,c.end)-c.start,w=new Uint8Array(c.buffer,p,y-p);if(a.set(w,f),i+=w.length,t<c.end)break}return o}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(r){return e<r.start?-1:e>=r.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=VL(this.shards,t);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function VL(n,e){let t=0,s=n.length;for(;t<=s;){const r=Math.floor((s-t)/2)+t,o=e(n[r]);if(o===0)return r;o<0?s=r:t=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WL(){oe().set("PROD",!0)}function UL(){oe().set("DEBUG",!0)}function jL(){oe().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function GL(n){oe().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function HL(){W.disposeVariables()}function fr(){return W}function xb(){return W.memory()}function qL(n){return W.profile(n)}function re(n,e){return W.tidy(n,e)}function Ye(n){yw(n).forEach(t=>t.dispose())}function Jt(n){return W.keep(n)}function KL(n){return W.time(n)}function XL(n){return W.setBackend(n)}function YL(){return W.ready()}function M2(){return W.backendName}function QL(n){W.removeBackend(n)}function ZL(n){return W.findBackend(n)}function JL(n){return W.findBackendFactory(n)}function vw(n,e,t=1){return W.registerBackend(n,e,t)}function kw(){return W.backend}function eP(n,e){oe().setPlatform(n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ua=4;async function bb(n,e){const t=[],s=[],r=Array.isArray(n)?n.map(a=>a.name):Object.keys(n);for(let a=0;a<r.length;++a){const i=r[a],l=Array.isArray(n)?n[a].tensor:n[i];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${i}': ${l.dtype}`);const c={name:i,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const h=new Promise(async p=>{const f=await l.bytes(),g=f.reduce((x,v)=>x+v.length,0)+ua*f.length,y=new Uint8Array(g);let w=0;for(let x=0;x<f.length;x++){const v=f[x],k=new Uint8Array(new Uint32Array([v.length]).buffer);y.set(k,w),w+=ua,y.set(v,w),w+=v.length}p(y)});s.push(h)}else s.push(l.data());e!=null&&(c.group=e),t.push(c)}const o=await Promise.all(s);return{data:sP(o),specs:t}}function B2(n,e){const t=new Nr(n),s={};let r=0;for(const o of e){const a=tP(o,(i,l)=>t.slice(r+i,r+l));s[o.name]=V2(o,t.slice(r,r+a)),r+=a}return s}function tP(n,e){const t=ce(n.shape);let s;if("quantization"in n){const r=n.quantization;s=li[r.dtype]}else if(n.dtype==="string"){let r=0;for(let o=0;o<t;o++)r+=ua+new Uint32Array(e(r,r+ua))[0];return r}else s=li[n.dtype];return t*s}async function nP(n,e){const t=ce(n.shape);let s;if("quantization"in n){const r=n.quantization;s=li[r.dtype]}else if(n.dtype==="string"){let r=0;for(let o=0;o<t;o++)r+=ua+new Uint32Array(await e(r,r+ua))[0];return r}else s=li[n.dtype];return t*s}function V2(n,e){const t=n.name,s=n.dtype,r=n.shape,o=ce(r);let a,i=0;if("quantization"in n){const l=n.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${n.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${n.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${n.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const c=li[l.dtype],h=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){a=new Float32Array(h.length);for(let p=0;p<h.length;p++){const f=h[p];a[p]=f*l.scale+l.min}}else if(l.dtype==="float16")a=uP()(h);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(s==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);a=new Int32Array(h.length);for(let p=0;p<h.length;p++){const f=h[p];a[p]=Math.round(f*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);i+=o*c}else if(s==="string"){const l=ce(n.shape);a=[];for(let c=0;c<l;c++){const h=new Uint32Array(e.slice(i,i+ua))[0];i+=ua;const p=new Uint8Array(e.slice(i,i+h));a.push(p),i+=h}}else{const l=li[s];if(s==="float32")a=new Float32Array(e);else if(s==="int32")a=new Int32Array(e);else if(s==="bool")a=new Uint8Array(e);else if(s==="complex64"){a=new Float32Array(e);const c=new Float32Array(a.length/2),h=new Float32Array(a.length/2);for(let y=0;y<c.length;y++)c[y]=a[y*2],h[y]=a[y*2+1];const p=Zs(c,r,"float32"),f=Zs(h,r,"float32"),g=mo(p,f);return p.dispose(),f.dispose(),g}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);i+=o*l}return Zs(a,r,s)}async function cC(n,e,t){let s=new Uint8Array(e);for(;s.byteLength<t;){const{done:r,value:o}=await n.read();if(r&&o==null){const i=t-s.byteLength;throw new Error(`Reader is done but ${i} bytes are still expected`)}const a=new Uint8Array(s.length+o.byteLength);a.set(s,0),a.set(new Uint8Array(o),s.length),s=a}return s.buffer}async function W2(n,e){const t={},s=n.getReader();let r=new ArrayBuffer(0);for(const o of e){const a=await nP(o,async(c,h)=>(r=await cC(s,r,h),r.slice(c,h)));r=await cC(s,r,a);const i=r.slice(0,a);r=r.slice(a);const l=V2(o,i);if(t[o.name]=l,M2()==="webgpu"){const c=kw();"uploadToGPU"in c&&ce(l.shape)>=oe().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&c.uploadToGPU(l.dataId)}}return t}function sP(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(o=>{if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${o.constructor.name}`)});const s=new Uint8Array(e);let r=0;return t.forEach(o=>{s.set(new Uint8Array(o.buffer),r),r+=o.byteLength}),s.buffer}const Sw=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function dC(n){return Sw?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function rP(n){if(Sw)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function oP(n){if(Sw){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function U2(n){return Nr.join(n)}function hC(n){const e="/";for(n=n.trim();n.endsWith(e);)n=n.slice(0,n.length-1);const t=n.split(e);return t[t.length-1]}function j2(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function G2(n,e,t){const s={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(s.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=t}return n.signature!=null&&(s.signature=n.signature),n.userDefinedMetadata!=null&&(s.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(s.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(s.initializerSignature=n.initializerSignature),s}async function Nw(n,e){let t,s;return n.weightsManifest!=null&&([t,s]=await e(n.weightsManifest)),G2(n,t,s)}function bh(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:dC(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:dC(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new Nr(n.weightData).byteLength}}function wb(n){const e=[];for(const t of n)e.push(...t.weights);return e}function aP(){const n=t=>{let s=t<<13,r=0;for(;(s&8388608)===0;)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function iP(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function lP(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function uP(){const n=aP(),e=iP(),t=lP();return s=>{const r=new ArrayBuffer(4*s.length),o=new Uint32Array(r);for(let a=0;a<s.length;a++){const i=s[a],l=n[t[i>>10]+(i&1023)]+e[i>>10];o[a]=l}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dt{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Dt.instance==null&&(Dt.instance=new Dt),Dt.instance}static registerSaveRouter(e){Dt.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Dt.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Dt.getHandlers(e,"save")}static getLoadHandlers(e,t){return Dt.getHandlers(e,"load",t)}static getHandlers(e,t,s){const r=[];return(t==="load"?Dt.getInstance().loadRouters:Dt.getInstance().saveRouters).forEach(a=>{const i=a(e,s);i!==null&&r.push(i)}),r}}const cP=n=>Dt.registerSaveRouter(n),dP=n=>Dt.registerLoadRouter(n),H2=n=>Dt.getSaveHandlers(n),hP=(n,e)=>Dt.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vb="tensorflowjs",kb=1,Ja="models_store",Jo="model_info_store";function q2(){if(!oe().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Sb(n){const e=n.result;e.createObjectStore(Ja,{keyPath:"modelPath"}),e.createObjectStore(Jo,{keyPath:"modelPath"})}class ui{constructor(e){if(this.indexedDB=q2(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,r)=>{const o=this.indexedDB.open(vb,kb);o.onupgradeneeded=()=>Sb(o),o.onsuccess=()=>{const a=o.result;if(t==null){const i=a.transaction(Ja,"readonly"),c=i.objectStore(Ja).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return a.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(c.result.modelArtifacts)},c.onerror=h=>(a.close(),r(c.error)),i.oncomplete=()=>a.close()}else{t.weightData=Nr.join(t.weightData);const i=bh(t),l=a.transaction(Jo,"readwrite");let c=l.objectStore(Jo),h;try{h=c.put({modelPath:this.modelPath,modelArtifactsInfo:i})}catch(f){return r(f)}let p;h.onsuccess=()=>{p=a.transaction(Ja,"readwrite");const f=p.objectStore(Ja);let g;try{g=f.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:i})}catch(y){return r(y)}g.onsuccess=()=>s({modelArtifactsInfo:i}),g.onerror=y=>{c=l.objectStore(Jo);const w=c.delete(this.modelPath);w.onsuccess=()=>(a.close(),r(g.error)),w.onerror=x=>(a.close(),r(g.error))}},h.onerror=f=>(a.close(),r(h.error)),l.oncomplete=()=>{p==null?a.close():p.oncomplete=()=>a.close()}}},o.onerror=a=>r(o.error)})}}ui.URL_SCHEME="indexeddb://";const K2=n=>oe().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ui.URL_SCHEME)?pP(n.slice(ui.URL_SCHEME.length)):null;Dt.registerSaveRouter(K2);Dt.registerLoadRouter(K2);function pP(n){return new ui(n)}function fP(n){return n.startsWith(ui.URL_SCHEME)?n.slice(ui.URL_SCHEME.length):n}class mP{constructor(){this.indexedDB=q2()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open(vb,kb);s.onupgradeneeded=()=>Sb(s),s.onsuccess=()=>{const r=s.result,o=r.transaction(Jo,"readonly"),i=o.objectStore(Jo).getAll();i.onsuccess=()=>{const l={};for(const c of i.result)l[c.modelPath]=c.modelArtifactsInfo;e(l)},i.onerror=l=>(r.close(),t(i.error)),o.oncomplete=()=>r.close()},s.onerror=r=>t(s.error)})}async removeModel(e){return e=fP(e),new Promise((t,s)=>{const r=this.indexedDB.open(vb,kb);r.onupgradeneeded=()=>Sb(r),r.onsuccess=()=>{const o=r.result,a=o.transaction(Jo,"readwrite"),i=a.objectStore(Jo),l=i.get(e);let c;l.onsuccess=()=>{if(l.result==null)return o.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const h=i.delete(e),p=()=>{c=o.transaction(Ja,"readwrite");const g=c.objectStore(Ja).delete(e);g.onsuccess=()=>t(l.result.modelArtifactsInfo),g.onerror=y=>s(l.error)};h.onsuccess=p,h.onerror=f=>(p(),o.close(),s(l.error))}},l.onerror=h=>(o.close(),s(l.error)),a.oncomplete=()=>{c==null?o.close():c.oncomplete=()=>o.close()}},r.onerror=o=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ho="/",pl="tensorflowjs_models",X2="info",gP="model_topology",yP="weight_specs",xP="weight_data",bP="model_metadata";function Y2(n){return{info:[pl,n,X2].join(ho),topology:[pl,n,gP].join(ho),weightSpecs:[pl,n,yP].join(ho),weightData:[pl,n,xP].join(ho),modelMetadata:[pl,n,bP].join(ho)}}function Q2(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function wP(n){const e=n.split(ho);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(ho)}function vP(n){return n.startsWith(ci.URL_SCHEME)?n.slice(ci.URL_SCHEME.length):n}class ci{constructor(e){if(!oe().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Y2(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=bh(e),o=Nr.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,rP(o));const a={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(a)),{modelArtifactsInfo:r}}catch{throw Q2(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const o=this.LS.getItem(this.keys.modelMetadata);if(o!=null){const i=JSON.parse(o);t.format=i.format,t.generatedBy=i.generatedBy,t.convertedBy=i.convertedBy,i.signature!=null&&(t.signature=i.signature),i.userDefinedMetadata!=null&&(t.userDefinedMetadata=i.userDefinedMetadata),i.modelInitializer!=null&&(t.modelInitializer=i.modelInitializer),i.initializerSignature!=null&&(t.initializerSignature=i.initializerSignature),i.trainingConfig!=null&&(t.trainingConfig=i.trainingConfig)}const a=this.LS.getItem(this.keys.weightData);if(a==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=oP(a),t}}ci.URL_SCHEME="localstorage://";const Z2=n=>oe().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ci.URL_SCHEME)?kP(n.slice(ci.URL_SCHEME.length)):null;Dt.registerSaveRouter(Z2);Dt.registerLoadRouter(Z2);function kP(n){return new ci(n)}class SP{constructor(){A(oe().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),A(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=pl+ho,s=ho+X2;for(let r=0;r<this.LS.length;++r){const o=this.LS.key(r);if(o.startsWith(t)&&o.endsWith(s)){const a=wP(o);e[a]=JSON.parse(this.LS.getItem(o))}}return e}async removeModel(e){e=vP(e);const t=Y2(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return Q2(t),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ml="://";class Bn{constructor(){this.managers={}}static getInstance(){return Bn.instance==null&&(Bn.instance=new Bn),Bn.instance}static registerManager(e,t){A(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(ml)&&(e=e.slice(0,e.indexOf(ml))),A(e.length>0,()=>"scheme must not be an empty string.");const s=Bn.getInstance();A(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=Bn.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(Bn.getInstance().managers)}}function Tf(n){if(n.indexOf(ml)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Bn.getSchemes().join(",")}`);return{scheme:n.split(ml)[0],path:n.split(ml)[1]}}async function J2(n,e,t=!1){A(n!==e,()=>`Old path and new path are the same: '${n}'`);const s=Dt.getLoadHandlers(n);A(s.length>0,()=>`Copying failed because no load handler is found for source URL ${n}.`),A(s.length<2,()=>`Copying failed because more than one (${s.length}) load handlers for source URL ${n}.`);const r=s[0],o=Dt.getSaveHandlers(e);A(o.length>0,()=>`Copying failed because no save handler is found for destination URL ${e}.`),A(o.length<2,()=>`Copying failed because more than one (${s.length}) save handlers for destination URL ${e}.`);const a=o[0],i=Tf(n).scheme,l=Tf(n).path,c=i===Tf(n).scheme,h=await r.load();t&&c&&await Bn.getManager(i).removeModel(l);const p=await a.save(h);return t&&!c&&await Bn.getManager(i).removeModel(l),p.modelArtifactsInfo}async function NP(){const n=Bn.getSchemes(),e={};for(const t of n){const s=await Bn.getManager(t).listModels();for(const r in s){const o=t+ml+r;e[o]=s[r]}}return e}async function CP(n){const e=Tf(n);return Bn.getManager(e.scheme).removeModel(e.path)}async function IP(n,e){return J2(n,e,!1)}async function $P(n,e){return J2(n,e,!0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TP{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!oe().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return I2(e)}}if(oe().get("IS_BROWSER")){oe().setPlatform("browser",new TP);try{Bn.registerManager(ci.URL_SCHEME,new SP)}catch{}try{Bn.registerManager(ui.URL_SCHEME,new mP)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EP={importFetch:()=>require("node-fetch")};let Lx;class RP{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return oe().global.fetch!=null?oe().global.fetch(e,t):(Lx==null&&(Lx=EP.importFetch()),Lx(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}oe().get("IS_NODE")&&!oe().get("IS_BROWSER")&&oe().setPlatform("node",new RP);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qe(n,e="float32",t){return e=e||"float32",vs(n),new Yt(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AP(n,e){const t=_(n,"x","cast");if(!g2(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},r={dtype:e};return W.runKernel(Ul,s,r)}const ke=U({cast_:AP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DP(n){const t={x:_(n,"x","clone","string_or_numeric")};return W.runKernel(nu,t)}const Mr=U({clone_:DP});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cw(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */P2();const _P={buffer:qe,cast:ke,clone:Mr,print:Cw};RL(_P);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OP(n,e){let t=_(n,"a","add"),s=_(e,"b","add");[t,s]=Ft(t,s);const r={a:t,b:s};return W.runKernel($i,r)}const fe=U({add_:OP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FP(n,e){let t=_(n,"a","floorDiv"),s=_(e,"b","floorDiv");[t,s]=Ft(t,s);const r={a:t,b:s};return W.runKernel(eu,r)}const Tg=U({floorDiv_:FP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LP(n,e){let t=_(n,"a","div"),s=_(e,"b","div");if([t,s]=Ft(t,s),t.dtype==="int32"&&s.dtype==="int32")return Tg(t,s);const r={a:t,b:s},o={};return W.runKernel(Kl,r,o)}const Fe=U({div_:LP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PP(n,e){let t=_(n,"a","mul"),s=_(e,"b","mul");[t,s]=Ft(t,s);const r={a:t,b:s};return W.runKernel(du,r)}const G=U({mul_:PP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zP(n){const e=_(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return W.runKernel(Nd,t)}else{const t={x:e};return W.runKernel(md,t)}}const Xt=U({abs_:zP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MP(n){const t={x:_(n,"x","acos")};return W.runKernel(Ll,t)}const Iw=U({acos_:MP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BP(n){const t={x:_(n,"x","acosh")};return W.runKernel(Pl,t)}const $w=U({acosh_:BP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VP(n){A(Array.isArray(n),()=>"The argument passed to tf.addN() must be a list of tensors"),A(n.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${n.length}`);const e=n.map((r,o)=>_(r,`tensors${o}`,"addN")),t=e[0];e.forEach(r=>{if(r.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(r=>{if(!Je(r.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const s=e;return W.runKernel(gd,s)}const e$=U({addN_:VP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WP(n,e=null,t=!1){const r={x:_(n,"x","all","bool")},o={axis:e,keepDims:t};return W.runKernel(vm,r,o)}const Eg=U({all_:WP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UP(n,e=null,t=!1){const r={x:_(n,"x","any","bool")},o={axis:e,keepDims:t};return W.runKernel(km,r,o)}const ed=U({any_:UP});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jP(n,e=0){const s={x:_(n,"x","argMax")},r={axis:e};return W.runKernel(yd,s,r)}const di=U({argMax_:jP});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GP(n,e=0){const s={x:_(n,"x","argMin")},r={axis:e};return W.runKernel(xd,s,r)}const Tw=U({argMin_:GP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HP(n){const t={x:_(n,"x","asin")};return W.runKernel(zl,t)}const Ew=U({asin_:HP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qP(n){const t={x:_(n,"x","asinh")};return W.runKernel(Ml,t)}const Rw=U({asinh_:qP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KP(n){const t={x:_(n,"x","atan")};return W.runKernel(Bl,t)}const Aw=U({atan_:KP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XP(n,e){let t=_(n,"a","atan2"),s=_(e,"b","atan2");[t,s]=Ft(t,s);const r={a:t,b:s};return W.runKernel(Wl,r)}const Dw=U({atan2_:XP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YP(n){const t={x:_(n,"x","atanh")};return W.runKernel(Vl,t)}const _w=U({atanh_:YP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wh(n,e,t,s,r="NHWC",o){const a=n[3],i=[...e,a],l=ko(r);return fn(n,i,t,o,s,null,null,l)}function er(n,e,t,s,r,o,a="channelsLast"){const[i,l]=td(e);let c;if(a==="channelsLast")c=[i,l,n[3],n[3]];else if(a==="channelsFirst")c=[i,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${a}`);return fn(n,c,t,s,r,o,!1,a)}function vo(n,e,t,s,r,o,a="NDHWC"){const[i,l,c]=Nb(e);let h,p;if(a==="NDHWC")p="channelsLast",h=[i,l,c,n[4],n[4]];else if(a==="NCDHW")p="channelsFirst",h=[i,l,c,n[1],n[1]];else throw new Error(`Unknown dataFormat ${a}`);return wa(n,h,t,s,r,!1,p,o)}function fn(n,e,t,s,r,o,a=!1,i="channelsLast"){let[l,c,h,p]=[-1,-1,-1,-1];if(i==="channelsLast")[l,c,h,p]=n;else if(i==="channelsFirst")[l,p,c,h]=n;else throw new Error(`Unknown dataFormat ${i}`);const[f,g,,y]=e,[w,x]=td(t),[v,k]=td(s),I=gl(f,v),N=gl(g,k),{padInfo:T,outHeight:D,outWidth:P}=JP(r,c,h,w,x,I,N,o,i),z=a?y*p:y;let F;return i==="channelsFirst"?F=[l,z,D,P]:i==="channelsLast"&&(F=[l,D,P,z]),{batchSize:l,dataFormat:i,inHeight:c,inWidth:h,inChannels:p,outHeight:D,outWidth:P,outChannels:z,padInfo:T,strideHeight:w,strideWidth:x,filterHeight:f,filterWidth:g,effectiveFilterHeight:I,effectiveFilterWidth:N,dilationHeight:v,dilationWidth:k,inShape:n,outShape:F,filterShape:e}}function wa(n,e,t,s,r,o=!1,a="channelsLast",i){let[l,c,h,p,f]=[-1,-1,-1,-1,-1];if(a==="channelsLast")[l,c,h,p,f]=n;else if(a==="channelsFirst")[l,f,c,h,p]=n;else throw new Error(`Unknown dataFormat ${a}`);const[g,y,w,,x]=e,[v,k,I]=Nb(t),[N,T,D]=Nb(s),P=gl(g,N),z=gl(y,T),F=gl(w,D),{padInfo:L,outDepth:E,outHeight:j,outWidth:Z}=ez(r,c,h,p,v,k,I,P,z,F,i),ne=o?x*f:x;let te;return a==="channelsFirst"?te=[l,ne,E,j,Z]:a==="channelsLast"&&(te=[l,E,j,Z,ne]),{batchSize:l,dataFormat:a,inDepth:c,inHeight:h,inWidth:p,inChannels:f,outDepth:E,outHeight:j,outWidth:Z,outChannels:ne,padInfo:L,strideDepth:v,strideHeight:k,strideWidth:I,filterDepth:g,filterHeight:y,filterWidth:w,effectiveFilterDepth:P,effectiveFilterHeight:z,effectiveFilterWidth:F,dilationDepth:N,dilationHeight:T,dilationWidth:D,inShape:n,outShape:te,filterShape:e}}function QP(n,e,t,s,r){s==null&&(s=Ow(n,e,t));const o=n[0],a=n[1],i=nd((o-e+2*s)/t+1,r),l=nd((a-e+2*s)/t+1,r);return[i,l]}function ZP(n,e,t,s,r,o){r==null&&(r=Ow(n,e[0],s[0]));const a=[0,0,0,t];for(let i=0;i<3;i++)n[i]+2*r>=e[i]&&(a[i]=nd((n[i]-e[i]+2*r)/s[i]+1,o));return a}function Ow(n,e,t,s=1){const r=gl(e,s);return Math.floor((n[0]*(t-1)-t+r)/2)}function td(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function Nb(n){return typeof n=="number"?[n,n,n]:n}function gl(n,e){return e<=1?n:n+(n-1)*(e-1)}function JP(n,e,t,s,r,o,a,i,l){let c,h,p;if(typeof n=="number"){c={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const g=QP([e,t],o,s,n,i);h=g[0],p=g[1]}else if(n==="same"){h=Math.ceil(e/s),p=Math.ceil(t/r);const f=Math.max(0,(h-1)*s+o-e),g=Math.max(0,(p-1)*r+a-t),y=Math.floor(f/2),w=f-y,x=Math.floor(g/2),v=g-x;c={top:y,bottom:w,left:x,right:v,type:"SAME"}}else if(n==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},h=Math.ceil((e-o+1)/s),p=Math.ceil((t-a+1)/r);else if(typeof n=="object"){const f=l==="channelsLast"?n[1][0]:n[2][0],g=l==="channelsLast"?n[1][1]:n[2][1],y=l==="channelsLast"?n[2][0]:n[3][0],w=l==="channelsLast"?n[2][1]:n[3][1];c={top:f,bottom:g,left:y,right:w,type:f===0&&g===0&&y===0&&w===0?"VALID":"EXPLICIT"},h=nd((e-o+f+g)/s+1,i),p=nd((t-a+y+w)/r+1,i)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:c,outHeight:h,outWidth:p}}function ez(n,e,t,s,r,o,a,i,l,c,h){let p,f,g,y;if(n==="valid"&&(n=0),typeof n=="number"){p={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const x=ZP([e,t,s,1],[i,l,c],1,[r,o,a],n,h);f=x[0],g=x[1],y=x[2]}else if(n==="same"){f=Math.ceil(e/r),g=Math.ceil(t/o),y=Math.ceil(s/a);const w=(f-1)*r+i-e,x=(g-1)*o+l-t,v=(y-1)*a+c-s,k=Math.floor(w/2),I=w-k,N=Math.floor(x/2),T=x-N,D=Math.floor(v/2),P=v-D;p={top:N,bottom:T,left:D,right:P,front:k,back:I,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:p,outDepth:f,outHeight:g,outWidth:y}}function nd(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function ca(n){const[e,t,s]=td(n);return e===1&&t===1&&s===1}function Nn(n,e){return ca(n)||ca(e)}function hi(n){return td(n).every(e=>e>0)}function ko(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function Gn(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")A(ii(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{A(ii(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tz(n,e){const s={x:_(n,"x","reshape","string_or_numeric")},r={shape:e};return W.runKernel(rh,s,r)}const q=U({reshape_:tz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nz(n,e,t,s,r){const o=_(n,"x","avgPool","float32"),a=1;A(Nn(t,a),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${a}'`);let i=o,l=!1;o.rank===3&&(l=!0,i=q(o,[1,o.shape[0],o.shape[1],o.shape[2]])),A(i.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${i.rank}.`),Gn("avgPool",s,r);const c={x:i},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r};let p=W.runKernel(bd,c,h);return p=ke(p,o.dtype),l?q(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const vh=U({avgPool_:nz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sz(n,e,t,s,r,o="NDHWC"){const a=_(n,"x","avgPool3d","float32");let i=a,l=!1;a.rank===4&&(l=!0,i=q(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),A(i.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${i.rank}.`),A(o==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),A(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),Gn("avgPool3d",s,r);const c={x:i},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:o};let p=W.runKernel(wd,c,h);return p=ke(p,i.dtype),l?q(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const Fw=U({avgPool3d_:sz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rz(n,e=0){A(n.length>=1,()=>"Pass at least one tensor to concat");const t=Jc(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(o=>{if(o.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${o.dtype}. `)}),t.length===1)return Mr(t[0]);const s=t,r={axis:e};return W.runKernel(Cd,s,r)}const Wt=U({concat_:rz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oz(n,e,t=!1,s=!1){let r=_(n,"a","matMul"),o=_(e,"b","matMul");[r,o]=Ft(r,o);const a={a:r,b:o},i={transposeA:t,transposeB:s};return W.runKernel(vd,a,i)}const Xe=U({matMul_:oz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function az(n){const t={x:_(n,"x","sigmoid","float32")};return W.runKernel(ku,t)}const xr=U({sigmoid_:az});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iz(n,e,t){const s=_(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},o={begin:e,size:t};return W.runKernel(uh,r,o)}const tt=U({slice_:iz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lz(n){const t={x:_(n,"x","tanh","float32")};return W.runKernel(Tu,t)}const da=U({tanh_:lz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uz(n,e,t,s,r,o){const a=_(n,"forgetBias","basicLSTMCell"),i=_(e,"lstmKernel","basicLSTMCell"),l=_(t,"lstmBias","basicLSTMCell"),c=_(s,"data","basicLSTMCell"),h=_(r,"c","basicLSTMCell"),p=_(o,"h","basicLSTMCell"),f=Wt([c,p],1),g=Xe(f,i),y=fe(g,l),w=y.shape[0],x=y.shape[1]/4,v=[w,x],k=tt(y,[0,0],v),I=tt(y,[0,x],v),N=tt(y,[0,x*2],v),T=tt(y,[0,x*3],v),D=fe(G(xr(k),da(I)),G(h,xr(fe(a,N)))),P=G(da(D),xr(T));return[D,P]}const t$=U({basicLSTMCell_:uz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cz(n,e,t){const s=_(n,"x","batchToSpaceND"),r=e.reduce((i,l)=>i*l);A(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),A(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),A(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const o={x:s},a={blockShape:e,crops:t};return W.runKernel(kd,o,a)}const kh=U({batchToSpaceND_:cz});function dz(n){let e;return n.rank===0||n.rank===1?e=q(n,[1,1,1,n.size]):n.rank===2?e=q(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=q(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hz(n,e,t,s,r,o){o==null&&(o=.001);const a=_(n,"x","batchNorm"),i=_(e,"mean","batchNorm"),l=_(t,"variance","batchNorm");let c;r!=null&&(c=_(r,"scale","batchNorm"));let h;s!=null&&(h=_(s,"offset","batchNorm")),A(i.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),A(h==null||i.rank===h.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),A(c==null||i.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const f={x:dz(a),scale:c,offset:h,mean:i,variance:l},g={varianceEpsilon:o},y=W.runKernel(Od,f,g);return q(y,a.shape)}const Au=U({batchNorm_:hz});function pz(n,e,t,s,r,o){const a=_(n,"x","batchNorm"),i=_(e,"mean","batchNorm"),l=_(t,"variance","batchNorm");let c;r!=null&&(c=_(r,"scale","batchNorm"));let h;return s!=null&&(h=_(s,"offset","batchNorm")),A(a.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${a.rank}.`),A(i.rank===2||i.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${i.rank}.`),A(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&A(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),h!=null&&A(h.rank===2||h.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${h.rank}.`),Au(a,i,l,h,c,o)}const Lw=U({batchNorm2d_:pz});function fz(n,e,t,s,r,o){const a=_(n,"x","batchNorm"),i=_(e,"mean","batchNorm"),l=_(t,"variance","batchNorm");let c;r!=null&&(c=_(r,"scale","batchNorm"));let h;return s!=null&&(h=_(s,"offset","batchNorm")),A(a.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${a.rank}.`),A(i.rank===3||i.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${i.rank}.`),A(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&A(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),h!=null&&A(h.rank===3||h.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${h.rank}.`),Au(a,i,l,h,c,o)}const Pw=U({batchNorm3d_:fz});function mz(n,e,t,s,r,o){const a=_(n,"x","batchNorm"),i=_(e,"mean","batchNorm"),l=_(t,"variance","batchNorm");let c;r!=null&&(c=_(r,"scale","batchNorm"));let h;return s!=null&&(h=_(s,"offset","batchNorm")),A(a.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${a.rank}.`),A(i.rank===4||i.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${i.rank}.`),A(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&A(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),h!=null&&A(h.rank===4||h.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${h.rank}.`),Au(a,i,l,h,c,o)}const zw=U({batchNorm4d_:mz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gz(n,e,t){const s=_(n,"x","bincount"),r=_(e,"weights","bincount");A(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),A(t>=0,()=>`size must be non-negative, but got ${t}.`),A(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const o={x:s,weights:r},a={size:t};return W.runKernel(Cm,o,a)}const Mw=U({bincount_:gz});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yz(n,e){const t=_(n,"x","bitwiseAnd"),s=_(e,"y","bitwiseAnd");if(!Je(t.shape,s.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${t.shape}, y: ${s.shape}`);if(t.dtype!=="int32"||s.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${t.dtype} and type of y: ${s.dtype}`);const r={a:t,b:s};return W.runKernel(Sd,r)}const n$=U({bitwiseAnd_:yz});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xz(n,e){const t=_(n,"s0","broadcastArgs","int32"),s=_(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${t.rank}`);if(s.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${s.rank}`);const r={s0:t,s1:s};return W.runKernel(Im,r)}const s$=U({broadcastArgs_:xz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bz(n,e){let t=_(n,"broadcastTo","x");const s=t.shape;if(vs(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const c=t.shape.slice();for(;c.length<e.length;)c.unshift(1);t=q(t,c)}const r=t.shape,o=Array.from(e);for(let c=e.length-1;c>=0;c--)if(r[c]===e[c])o[c]=1;else if(t.shape[c]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(o.map((c,h)=>c>1?h:-1).filter(c=>c>=0).length===0)return Mr(t);const i={x:t},l={reps:o};return W.runKernel(Eu,i,l)}const ri=U({broadcastTo_:bz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wz(n){const t={x:_(n,"x","ceil","float32")};return W.runKernel(jl,t)}const Bw=U({ceil_:wz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ti(n,e,t){vs(n),t=t||Ci(e);const s={shape:n,value:e,dtype:t};return W.runKernel(Wm,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vz(n,e,t){const s=_(n,"x","clipByValue");if(A(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return Ti(s.shape,e,s.dtype);const r={x:s},o={clipValueMin:e,clipValueMax:t};return W.runKernel(Gl,r,o)}const ts=U({clipByValue_:vz});function kz(n){return Wt(n,0)}const Vw=U({concat1d_:kz});function Sz(n,e){return Wt(n,e)}const Ww=U({concat2d_:Sz});function Nz(n,e){return Wt(n,e)}const Uw=U({concat3d_:Nz});function Cz(n,e){return Wt(n,e)}const jw=U({concat4d_:Cz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iz(n,e,t,s,r="NHWC",o=[1,1],a){const i=_(n,"x","conv2d","float32"),l=_(e,"filter","conv2d","float32");let c=i,h=!1;i.rank===3&&(h=!0,c=q(i,[1,i.shape[0],i.shape[1],i.shape[2]])),A(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),A(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),Gn("conv2d",s,a);const p=r==="NHWC"?c.shape[3]:c.shape[1];A(p===l.shape[2],()=>`Error in conv2d: depth of input (${p}) must match input depth for filter ${l.shape[2]}.`),A(Nn(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),A(hi(o),()=>"Error in conv2D: Dilated rates should be larger than 0."),A(hi(t),()=>"Error in conv2D: Strides should be larger than 0.");const f={x:c,filter:l},g={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:a},y=W.runKernel(Id,f,g);return h?q(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const go=U({conv2d_:Iz});function $z(n,e,t,s,r="NWC",o=1,a){const i=_(n,"x","conv1d"),l=_(e,"filter","conv1d");let c=i,h=!1;i.rank===2&&(h=!0,c=q(i,[1,i.shape[0],i.shape[1]])),A(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),A(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),Gn("conv1d",s,a),A(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),A(Nn(t,o),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${o}'`),A(hi(o),()=>"Error in conv1D: Dilated rates should be larger than 0."),A(hi(t),()=>"Error in conv1D: Stride should be larger than 0."),A(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const p=q(l,[1,l.shape[0],l.shape[1],l.shape[2]]),f=q(c,[c.shape[0],1,c.shape[1],c.shape[2]]),x=go(f,p,[1,t],s,"NHWC",[1,o],a);return h?q(x,[x.shape[2],x.shape[3]]):q(x,[x.shape[0],x.shape[2],x.shape[3]])}const Rg=U({conv1d_:$z});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tz(n,e,t,s,r,o="NHWC",a){A(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let i=n,l=e,c=!1;e.rank===3&&(c=!0,l=q(e,[1,e.shape[0],e.shape[1],e.shape[2]]),i=[1,n[0],n[1],n[2]]),A(i.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${i.length}.`),A(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),A(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const h=o==="NHWC"?i[3]:i[1],p=o==="NHWC"?l.shape[3]:l.shape[1];A(h===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${h}) must match input depth for filter ${t.shape[2]}.`),A(p===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${p}) must match output depth for filter ${t.shape[3]}.`),Gn("conv2dDerInput",r,a);const f={dy:l,filter:t},g={strides:s,pad:r,dataFormat:o,dimRoundingMode:a,inputShape:i},y=W.runKernel($d,f,g);return c?q(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const Gw=U({conv2DBackpropInput_:Tz});function Ez(n,e,t,s,r,o){const a=_(n,"x","conv2dTranspose"),i=_(e,"filter","conv2dTranspose");return Gw(t,a,i,s,r,"NHWC",o)}const Ag=U({conv2dTranspose_:Ez});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rz(n,e,t,s,r="NDHWC",o=[1,1,1]){const a=_(n,"x","conv3d"),i=_(e,"filter","conv3d");let l=a,c=!1;a.rank===4&&(c=!0,l=q(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),A(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),A(i.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${i.rank}.`),A(l.shape[4]===i.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${i.shape[3]}.`),A(Nn(t,o),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),A(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),A(hi(o),()=>"Error in conv3D: Dilated rates should be larger than 0."),A(hi(t),()=>"Error in conv3D: Strides should be larger than 0.");const h={x:l,filter:i},p={strides:t,pad:s,dataFormat:r,dilations:o},f=W.runKernel(Td,h,p);return c?q(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const Hw=U({conv3d_:Rz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Az(n,e,t,s,r){A(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let o=n,a=e,i=!1;e.rank===4&&(i=!0,a=q(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,n[0],n[1],n[2],n[3]]);const l=o[4],c=a.shape[4];A(o.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`),A(a.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${a.rank}`),A(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),A(l===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[3]}.`),A(c===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${t.shape[4]}.`);const h={dy:a,filter:t},p={pad:r,strides:s,inputShape:o},f=W.runKernel(Rm,h,p);return i?q(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const r$=U({conv3DBackpropInput_:Az});function Dz(n,e,t,s,r){const o=_(n,"x","conv3dTranspose"),a=_(e,"filter","conv3dTranspose");return r$(t,o,a,s,r)}const qw=U({conv3dTranspose_:Dz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _z(n){const t={x:_(n,"x","cos","float32")};return W.runKernel(Hl,t)}const Sh=U({cos_:_z});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oz(n){const t={x:_(n,"x","cosh","float32")};return W.runKernel(ql,t)}const Dg=U({cosh_:Oz});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fz(n,e=0,t=!1,s=!1){const o={x:_(n,"x","cumprod")},a={axis:e,exclusive:t,reverse:s};return W.runKernel(Am,o,a)}const sd=U({cumprod_:Fz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lz(n,e=0,t=!1,s=!1){const o={x:_(n,"x","cumsum")},a={axis:e,exclusive:t,reverse:s};return W.runKernel(Ed,o,a)}const _g=U({cumsum_:Lz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pz(n,e,t,s=!1){const r=_(n,"x","denseBincount"),o=_(e,"weights","denseBincount");A(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),A(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),A(t>=0,()=>`size must be non-negative, but got ${t}.`),A(o.size===r.size||o.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${o.shape}.`);const a={x:r,weights:o},i={size:t,binaryOutput:s};return W.runKernel(_m,a,i)}const qf=U({denseBincount_:Pz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zz(n,e,t="NHWC"){const s=_(n,"x","depthToSpace","float32"),r=t==="NHWC"?s.shape[1]:s.shape[2],o=t==="NHWC"?s.shape[2]:s.shape[3],a=t==="NHWC"?s.shape[3]:s.shape[1];A(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),A(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),A(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e} for depthToSpace with input shape
        ${s.shape}`),A(a%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${a} for depthToSpace with input shape ${s.shape}`);const i={x:s},l={blockSize:e,dataFormat:t};return W.runKernel(Om,i,l)}const Kw=U({depthToSpace_:zz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mz(n,e,t,s,r="NHWC",o=[1,1],a){const i=_(n,"x","depthwiseConv2d","float32"),l=_(e,"filter","depthwiseConv2d","float32");let c=i,h=!1;i.rank===3&&(h=!0,c=q(i,[1,i.shape[0],i.shape[1],i.shape[2]])),A(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),A(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const p=r==="NHWC"?c.shape[3]:c.shape[1];A(p===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${p}) must match the inChannels dimension in filter ${l.shape[2]}.`),Gn("depthwiseConv2d",s,a);const f={x:c,filter:l},g={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:a},y=W.runKernel(Rd,f,g);return h?q(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const Du=U({depthwiseConv2d_:Mz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bz(n){const t={x:_(n,"x","diag")};return W.runKernel(Pm,t)}const o$=U({diag_:Bz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vz(n,e,t,s,r=[1,1],o="NHWC"){const a=_(n,"x","dilation2d"),i=_(e,"filter","dilation2d");A(a.rank===3||a.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${a.rank}.`),A(i.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${i.rank}.`),A(o==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`);let l=a,c=!1;a.rank===3&&(l=q(a,[1,a.shape[0],a.shape[1],a.shape[2]]),c=!0),A(l.shape[3]===i.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${i.shape[2]}`);const h={x:l,filter:i},p={strides:t,pad:s,dilations:r},f=W.runKernel(Ad,h,p);return c?q(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const Xw=U({dilation2d_:Vz});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pi(n,e){const t=n.length,s=[];for(let r=0;r<t;r++){const o=t-1-r,a=n[o]||1;(e[e.length-1-r]||1)>1&&a===1&&s.unshift(o)}return s}function Qt(n,e){const t=[];for(let s=0;s<e.length;s++){const r=n[n.length-s-1],o=e.length-s-1,a=e[o];(r==null||r===1&&a>1)&&t.unshift(o)}return t}function He(n,e){const t=Math.max(n.length,e.length),s=new Array(t);for(let r=0;r<t;r++){let o=n[n.length-r-1];o==null&&(o=1);let a=e[e.length-r-1];if(a==null&&(a=1),o===1)s[t-r-1]=a;else if(a===1)s[t-r-1]=o;else if(o!==a){const i=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(i)}else s[t-r-1]=o}return s}const Wz=Object.freeze(Object.defineProperty({__proto__:null,assertAndGetBroadcastShape:He,getBroadcastDims:pi,getReductionAxes:Qt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uz(n,e){let t=_(n,"a","equal","string_or_numeric"),s=_(e,"b","equal","string_or_numeric");[t,s]=Ft(t,s),He(t.shape,s.shape);const r={a:t,b:s};return W.runKernel(Dd,r)}const Js=U({equal_:Uz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jz(n,e,t){const s=_(e,"a","where"),r=_(t,"b","where"),o=_(n,"condition","where","bool"),a=He(He(o.shape,s.shape),r.shape),i=ri(o,a),l=ri(s,a),c=ri(r,a),h={condition:i,t:l,e:c};return W.runKernel(lh,h)}const vn=U({where_:jz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gz(n){const t={x:_(n,"x","zerosLike")};return W.runKernel(yh,t)}const st=U({zerosLike_:Gz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hz(n,e){let t=_(n,"a","div"),s=_(e,"b","div");[t,s]=Ft(t,s);const r=Fe(t,s),o=st(r),a=Js(s,o);return vn(a,o,r)}const Yw=U({divNoNan_:Hz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qz(n,e){const t=_(n,"t1","dot"),s=_(e,"t2","dot");A((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const r=t.rank===1?t.size:t.shape[1],o=s.rank===1?s.size:s.shape[0];if(A(r===o,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${o}.`),t.rank===1&&s.rank===1){const a=q(t,[1,-1]),i=q(s,[-1,1]),l=Xe(a,i);return q(l,[])}else if(t.rank===1&&s.rank===2){const a=q(t,[1,-1]),i=q(s,[s.shape[0],s.shape[1]]),l=Xe(a,i);return q(l,[l.size])}else if(t.rank===2&&s.rank===1){const a=q(s,[-1,1]),i=Xe(t,a);return q(i,[i.size])}else{const a=q(s,[s.shape[0],s.shape[1]]);return Xe(t,a)}}const Qw=U({dot_:qz});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kz(n,...e){const t=e.map((r,o)=>_(r,`tensors${o}`,"einsum")),s={equation:n};return W.runKernel(Mm,t,s)}const Xa=U({einsum_:Kz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xz(n){const t={x:_(n,"x","elu","float32")};return W.runKernel(Xl,t)}const _u=U({elu_:Xz});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yz(n,e){const t=_(n,"x","ensureShape","string_or_numeric");if(!f2(t.shape,e))throw new Error(`EnsureShape: Shape of tensor ${t.shape} is not compatible with expected shape ${e}`);return n}const a$=U({ensureShape_:Yz});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qz(n){let e=_(n,"x","erf");A(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=ke(e,"float32"));const t={x:e};return W.runKernel(Yl,t)}const Og=U({erf_:Qz});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zw(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function i$(n,e,t){const s=n.length+e.length,r=[];let o=0,a=0;for(let i=0;i<s;i++)t.indexOf(i)===-1?r.push(n[o++]):r.push(e[a++]);return r}function mn(n,e){const t=[],s=n.length;for(let o=0;o<s;o++)e.indexOf(o)===-1&&t.push(n[o]);const r=e.map(o=>n[o]);return[t,r]}function Ut(n,e){const t=e.map(s=>1);return i$(n,t,e)}function Cn(n,e,t){A(Zw(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function Lt(n,e){if(Zw(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function va(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function jt(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zz(n,e=null,t=!1){const r={x:_(n,"x","max")},o={reductionIndices:e,keepDims:t};return W.runKernel(jd,r,o)}const _s=U({max_:Zz});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jz(n,e=null,t=!1){const r={x:_(n,"x","min")},o={axis:e,keepDims:t};return W.runKernel(Kd,r,o)}const kl=U({min_:Jz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e4(n,e){let t=_(n,"base","pow"),s=_(e,"exp","pow");[t,s]=Ft(t,s);const r={a:t,b:s};return W.runKernel(hu,r)}const Gr=U({pow_:e4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Me(n,e){if((cn(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&cn(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return ba(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t4(n){const t={x:_(n,"x","sqrt","float32")};return W.runKernel(Nu,t)}const pn=U({sqrt_:t4});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n4(n){const e=_(n,"x","square"),t={};return W.runKernel("Square",{x:e},t)}const gt=U({square_:n4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s4(n,e=null,t=!1){let s=_(n,"x","sum");s.dtype==="bool"&&(s=ke(s,"int32"));const r={x:s},o={axis:e,keepDims:t};return W.runKernel(ch,r,o)}const Ae=U({sum_:s4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r4(n,e="euclidean",t=null,s=!1){n=_(n,"x","norm");const r=l$(n,e,t);let o=r.shape;if(s){const a=Qe(t,n.shape);o=Ut(r.shape,a)}return q(r,o)}function l$(n,e,t=null){if(n.rank===0)return Xt(n);if(n.rank!==1&&t===null)return l$(q(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Ae(Xt(n),t);if(e===1/0)return _s(Xt(n),t);if(e===-1/0)return kl(Xt(n),t);if(e==="euclidean"||e===2)return pn(Ae(Gr(Xt(n),Me(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return _s(Ae(Xt(n),t[0]),t[1]-1);if(e===1/0)return _s(Ae(Xt(n),t[1]),t[0]);if(e===-1/0)return kl(Ae(Xt(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return pn(Ae(gt(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const Ou=U({norm_:r4});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o4(n,e=null,t=!1){return Ou(n,"euclidean",e,t)}const Jw=U({euclideanNorm_:o4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a4(n){const t={x:_(n,"x","exp")};return W.runKernel(Ql,t)}const ns=U({exp_:a4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i4(n,e=0){const t=_(n,"x","expandDims","string_or_numeric");A(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},r={dim:e};return W.runKernel(_d,s,r)}const An=U({expandDims_:i4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l4(n){const t={x:_(n,"x","expm1")};return W.runKernel(Zl,t)}const e1=U({expm1_:l4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u4(n,e){const t=_(n,"x","tile","string_or_numeric");A(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},r={reps:e};return W.runKernel(Eu,s,r)}const Rs=U({tile_:u4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c4(n,e,t,s="float32"){e==null&&(e=n);const r=qe([n,e],s),o=n<=e?n:e;for(let i=0;i<o;++i)r.set(1,i,i);const a=q(r.toTensor(),[n,e]);if(t==null)return a;if(t.length===1)return Rs(An(a,0),[t[0],1,1]);if(t.length===2)return Rs(An(An(a,0),0),[t[0],t[1],1,1]);if(t.length===3)return Rs(An(An(An(a,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const Fg=U({eye_:c4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d4(n){const t={x:_(n,"x","floor","float32")};return W.runKernel(Jl,t)}const Fu=U({floor_:d4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h4(n,e,t=0,s=0){const r=_(n,"x","gather"),o=_(e,"indices","gather","int32"),a={x:r,indices:o},i={axis:t,batchDims:s};return W.runKernel(Fd,a,i)}const Lu=U({gather_:h4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p4(n,e){let t=_(n,"a","greater","string_or_numeric"),s=_(e,"b","greater","string_or_numeric");[t,s]=Ft(t,s),He(t.shape,s.shape);const r={a:t,b:s};return W.runKernel(Ld,r)}const os=U({greater_:p4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f4(n,e){let t=_(n,"a","greaterEqual","string_or_numeric"),s=_(e,"b","greaterEqual","string_or_numeric");[t,s]=Ft(t,s),He(t.shape,s.shape);const r={a:t,b:s};return W.runKernel(tu,r)}const So=U({greaterEqual_:f4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m4(n){const t={input:_(n,"input","imag")};return W.runKernel(Hm,t)}const Nh=U({imag_:m4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g4(n){const t={x:_(n,"x","isFinite")};return W.runKernel(su,t)}const t1=U({isFinite_:g4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y4(n){const t={x:_(n,"x","isInf")};return W.runKernel(ru,t)}const n1=U({isInf_:y4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x4(n){const t={x:_(n,"x","isNaN")};return W.runKernel(ou,t)}const s1=U({isNaN_:x4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b4(n,e=.2){const s={x:_(n,"x","leakyRelu")},r={alpha:e};return W.runKernel(Pd,s,r)}const Ch=U({leakyRelu_:b4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w4(n,e){let t=_(n,"a","less","string_or_numeric"),s=_(e,"b","less","string_or_numeric");[t,s]=Ft(t,s),He(t.shape,s.shape);const r={a:t,b:s};return W.runKernel(zd,r)}const Sl=U({less_:w4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v4(n,e){let t=_(n,"a","lessEqual","string_or_numeric"),s=_(e,"b","lessEqual","string_or_numeric");[t,s]=Ft(t,s),He(t.shape,s.shape);const r={a:t,b:s};return W.runKernel(Md,r)}const ka=U({lessEqual_:v4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u$(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");const s={start:n,stop:e,num:t};return W.runKernel(qm,{},s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k4(n,e=5,t=1,s=1,r=.5){const o=_(n,"x","localResponseNormalization");A(o.rank===4||o.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${o.rank}.`),A(ii(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let a=o,i=!1;o.rank===3&&(i=!0,a=q(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const l={x:a},c={depthRadius:e,bias:t,alpha:s,beta:r},h=W.runKernel(Ud,l,c);return i?q(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const r1=U({localResponseNormalization_:k4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S4(n){const t={x:_(n,"x","log","float32")};return W.runKernel(au,t)}const ys=U({log_:S4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N4(n){const t={x:_(n,"x","log1p")};return W.runKernel(iu,t)}const Ih=U({log1p_:N4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C4(n){return A(ia(n),()=>"The f passed in grad(f) must be a function"),(e,t)=>{const s=_(e,"x","tf.grad","string_or_numeric"),r=t!=null?_(t,"dy","tf.grad"):null;return W.tidy(()=>{const{value:o,grads:a}=W.gradients(()=>n(s),[s],r);return r!=null&&Sn(o.shape,r.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Lg(a),a[0]})}}function I4(n){return A(ia(n),()=>"The f passed in grads(f) must be a function"),(e,t)=>{A(Array.isArray(e),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");const s=Jc(e,"args","tf.grads","string_or_numeric"),r=t!=null?_(t,"dy","tf.grads"):null;return W.tidy(()=>{const{value:o,grads:a}=W.gradients(()=>n(...s),s,r);return r!=null&&Sn(o.shape,r.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Lg(a),a})}}function $4(n){return A(ia(n),()=>"The f passed in valueAndGrad(f) must be a function"),(e,t)=>{A(e instanceof dt,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),A(t==null||t instanceof dt,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");const{grads:s,value:r}=W.gradients(()=>n(e),[e],t);return Lg(s),{grad:s[0],value:r}}}function T4(n){return A(ia(n),()=>"The f passed in valueAndGrads(f) must be a function"),(e,t)=>{A(Array.isArray(e)&&e.every(r=>r instanceof dt),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),A(t==null||t instanceof dt,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");const s=W.gradients(()=>n(...e),e,t);return t!=null&&Sn(s.value.shape,t.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Lg(s.grads),s}}function c$(n,e){A(ia(n),()=>"The f passed in variableGrads(f) must be a function"),A(e==null||Array.isArray(e)&&e.every(c=>c instanceof Zc),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const c in W.registeredVariables)e.push(W.registeredVariables[c])}const s=t?e.filter(c=>!c.trainable):null,r=e.length;e=e.filter(c=>c.trainable),A(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const o=!0,{value:a,grads:i}=W.gradients(n,e,null,o);A(i.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),A(a.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${a.rank} tensor`);const l={};return e.forEach((c,h)=>{i[h]!=null&&(l[c.name]=i[h])}),s!=null&&s.forEach(c=>l[c.name]=null),{value:a,grads:l}}function Hr(n){return W.customGrad(n)}function Lg(n){if(n.filter(t=>t==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E4(n){const t={x:_(n,"x","neg")};return W.runKernel(Yd,t)}const St=U({neg_:E4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R4(n){const t={x:_(n,"x","softplus")};return W.runKernel(Su,t)}const Ei=U({softplus_:R4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A4(n){const e=_(n,"x","logSigmoid");return Hr(s=>({value:St(Ei(St(s))),gradFunc:a=>G(a,xr(St(s)))}))(e)}const o1=U({logSigmoid_:A4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D4(n,e){let t=_(n,"a","sub"),s=_(e,"b","sub");[t,s]=Ft(t,s);const r={a:t,b:s};return W.runKernel(Iu,r)}const Te=U({sub_:D4});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _4(n,e=-1){const t=_(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return Hr((r,o)=>{const i=_s(r,e,!0),l=Te(r,i),c=Te(ke(l,"float32"),ys(Ae(ns(l),e,!0)));return o([c]),{value:c,gradFunc:(p,f)=>{const[g]=f,y=!0,w=ns(g);return Te(p,G(Ae(p,e,y),w))}}})(t)}const Pg=U({logSoftmax_:_4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O4(n,e=null,t=!1){const s=_(n,"x","logSumExp"),r=Qe(e,s.shape),o=_s(s,r,!0),a=Te(s,o),i=ns(a),l=Ae(i,r),c=ys(l),h=fe(q(o,c.shape),c);if(t){const p=Ut(h.shape,r);return q(h,p)}return h}const $h=U({logSumExp_:O4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F4(n,e){const t=_(n,"a","logicalAnd","bool"),s=_(e,"b","logicalAnd","bool");He(t.shape,s.shape);const r={a:t,b:s};return W.runKernel(Bd,r)}const wr=U({logicalAnd_:F4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L4(n){const t={x:_(n,"x","logicalNot","bool")};return W.runKernel(Vd,t)}const Th=U({logicalNot_:L4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P4(n,e){const t=_(n,"a","logicalOr","bool"),s=_(e,"b","logicalOr","bool");He(t.shape,s.shape);const r={a:t,b:s};return W.runKernel(Wd,r)}const zg=U({logicalOr_:P4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z4(n,e){const t=_(n,"a","logicalXor","bool"),s=_(e,"b","logicalXor","bool");return He(t.shape,s.shape),wr(zg(n,e),Th(wr(n,e)))}const a1=U({logicalXor_:z4});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const df=2147483648;function M4(n,e,t="left"){const s=_(n,"sortedSequence","searchSorted"),r=_(e,"values","searchSorted"),o=s.shape[s.shape.length-1],a=r.shape[r.shape.length-1],i=q(s,[-1,o]),l=q(r,[-1,a]);if(i.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(i.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(ce(l.shape)>=df)throw new Error(`values tensor size must less than ${df}`);if(i.shape[1]>=df)throw new Error(`trailing dim_size must less than ${df} for int32 output type, was ${i.shape[1]}`);const c={sortedSequence:i,values:l},h={side:t};return W.runKernel(dg,c,h)}const Mg=U({searchSorted_:M4});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d$(n,e){return Mg(n,e,"left")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B4(n,e,t,s,r){const o=_(n,"x","maxPool"),a=1;let i=o,l=!1;o.rank===3&&(l=!0,i=q(o,[1,o.shape[0],o.shape[1],o.shape[2]])),A(i.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${i.rank}.`),A(Nn(t,a),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${a}'`),Gn("maxPool",s,r);const c={x:i},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r},p=W.runKernel(Gd,c,h);return l?q(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Eh=U({maxPool_:B4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V4(n,e=[1,1,1],t,s,r,o="NDHWC"){const a=_(n,"x","maxPool3d");let i=a,l=!1;a.rank===4&&(l=!0,i=q(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),A(i.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${i.rank}.`),A(o==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),Gn("maxPool3d",s,r);const c={x:i},h={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:o},p=W.runKernel(Hd,c,h);return l?q(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const i1=U({maxPool3d_:V4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W4(n,e,t,s,r=!1){const a={x:_(n,"x","maxPoolWithArgmax")},i={filterSize:e,strides:t,pad:s,includeBatchInIndex:r},l=W.runKernel(Qm,a,i);return{result:l[0],indexes:l[1]}}const h$=U({maxPoolWithArgmax_:W4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U4(n,e){let t=_(n,"a","maximum"),s=_(e,"b","maximum");[t,s]=Ft(t,s),t.dtype==="bool"&&(t=ke(t,"int32"),s=ke(s,"int32")),He(t.shape,s.shape);const r={a:t,b:s};return W.runKernel(lu,r)}const Xr=U({maximum_:U4});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j4(n,e=null,t=!1){const r={x:_(n,"x","mean")},o={axis:e,keepDims:t};return W.runKernel(qd,r,o)}const _t=U({mean_:j4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vt(n,e="float32"){if(vs(n),e==="complex64"){const s=Vt(n,"float32"),r=Vt(n,"float32");return mo(s,r)}const t=kn(ce(n),e);return W.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qn(n,e="float32"){if(vs(n),e==="complex64"){const s=Qn(n,"float32"),r=Vt(n,"float32");return mo(s,r)}const t=wm(ce(n),e);return W.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p$(n,e,{indexing:t="xy"}={}){if(t!=="xy"&&t!=="ij")throw new TypeError(`${t} is not a valid third argument to meshgrid`);if(n===void 0)return[];let s=_(n,"x","meshgrid",n instanceof dt?n.dtype:"float32");if(e===void 0)return[s];let r=_(e,"y","meshgrid",e instanceof dt?e.dtype:"float32");const o=ce(s.shape),a=ce(r.shape);return t==="xy"?(s=q(s,[1,-1]),r=q(r,[-1,1]),[Xe(Qn([a,1],s.dtype),s),Xe(r,Qn([1,o],r.dtype))]):(s=q(s,[-1,1]),r=q(r,[1,-1]),[Xe(s,Qn([1,a],s.dtype)),Xe(Qn([o,1],r.dtype),r)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G4(n,e){let t=_(n,"a","minimum"),s=_(e,"b","minimum");[t,s]=Ft(t,s),t.dtype==="bool"&&(t=ke(t,"int32"),s=ke(s,"int32")),He(t.shape,s.shape);const r={a:t,b:s};return W.runKernel(uu,r)}const ha=U({minimum_:G4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H4(n,e,t){A(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=_(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");A(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let i=0;i<s.rank;i++)A(e[i].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),A(e[i][0]>=0&&e[i][0]<=s.shape[i]-r&&e[i][1]>=0&&e[i][1]<=s.shape[i]-r,()=>`Padding in dimension ${i} cannot be greater than or equal to ${s.shape[i]-r} or less than 0 for input of shape ${s.shape}`);const o={paddings:e,mode:t},a={x:s};return W.runKernel(Xd,a,o)}const l1=U({mirrorPad_:H4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q4(n,e){let t=_(n,"a","mod"),s=_(e,"b","mod");[t,s]=Ft(t,s);const r={a:t,b:s};return W.runKernel(cu,r)}const u1=U({mod_:q4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K4(n,e=null,t=!1){n=_(n,"x","moments");const s=Qe(e,n.shape),r=_t(n,s,t);let o=r.shape;t||(o=Ut(r.shape,s));const a=gt(Te(ke(n,"float32"),q(r,o))),i=_t(a,s,t);return{mean:r,variance:i}}const Rh=U({moments_:K4});function X4(n,e,t,s){const r=_(e,"data","multiRNNCell"),o=Jc(t,"c","multiRNNCell"),a=Jc(s,"h","multiRNNCell");let i=r;const l=[];for(let p=0;p<n.length;p++){const f=n[p](i,o[p],a[p]);l.push(f[0]),l.push(f[1]),i=f[1]}const c=[],h=[];for(let p=0;p<l.length;p+=2)c.push(l[p]),h.push(l[p+1]);return[c,h]}const f$=U({multiRNNCell_:X4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y4(n,e,t,s=!1){const r=_(n,"logits","multinomial"),o=r.size,a=r.rank;if(o<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${o}.`);if(a>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${a}`);t=t||Math.random();const l={logits:a===1?q(r,[1,-1]):r},c={numSamples:e,seed:t,normalized:s},h=W.runKernel(Zm,l,c);return a===1?q(h,[h.size]):h}const m$=U({multinomial_:Y4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q4(n,e){let t=_(n,"a","notEqual","string_or_numeric"),s=_(e,"b","notEqual","string_or_numeric");[t,s]=Ft(t,s),He(t.shape,s.shape);const r={a:t,b:s};return W.runKernel(Qd,r)}const fi=U({notEqual_:Q4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z4(n,e,t=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const a={indices:_(n,"indices","oneHot","int32")},i={dtype:r,depth:e,onValue:t,offValue:s};return W.runKernel(Jd,a,i)}const Nl=U({oneHot_:Z4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J4(n){const t={x:_(n,"x","onesLike")};return W.runKernel(Zd,t)}const xs=U({onesLike_:J4});function eM(n,e){const t=_(n,"v1","outerProduct"),s=_(e,"v2","outerProduct");A(t.rank===1&&s.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${t.rank} and ${s.rank}.`);const r=q(t,[-1,1]),o=q(s,[1,-1]);return Xe(r,o)}const g$=U({outerProduct_:eM});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tM(n,e,t=0){const s=_(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},o={x:s};return W.runKernel(th,o,r)}const No=U({pad_:tM});function nM(n,e,t=0){return A(e.length===2,()=>"Invalid number of paddings. Must be length of 2."),No(n,[e],t)}const y$=U({pad1d_:nM});function sM(n,e,t=0){return A(e.length===2&&e[0].length===2&&e[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),No(n,e,t)}const x$=U({pad2d_:sM});function rM(n,e,t=0){return A(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),No(n,e,t)}const b$=U({pad3d_:rM});function oM(n,e,t=0){return A(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),No(n,e,t)}const w$=U({pad4d_:oM});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aM(n,e,t){const s=_(n,"x","spaceToBatchND");A(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),A(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),A(s.shape.reduce((a,i,l)=>l>0&&l<=e.length?a&&(i+t[l-1][0]+t[l-1][1])%e[l-1]===0:a,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},o={blockShape:e,paddings:t};return W.runKernel(dh,r,o)}const Ah=U({spaceToBatchND_:aM});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iM(n,e,t,s,r,o,a){r==null&&(r=[1,1]),o==null&&(o=1),s===0&&(s="valid");const i=_(n,"x","maxPool");let l=i,c=!1;i.rank===3&&(c=!0,l=q(i,[1,i.shape[0],i.shape[1],i.shape[2]])),A(Nn(o,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${r}'`);const h=er(l.shape,e,o,r,s),p=[h.dilationHeight,h.dilationWidth];let f;s==="same"?f=uM([h.filterHeight,h.filterWidth],p):f=[[0,0],[0,0]];const g=p[0]===1&&p[1]===1,[y,w]=lM([h.inHeight,h.inWidth],p,f),x=g?s:"valid",v=g?l:Ah(l,p,y),I=(t==="avg"?()=>vh(v,e,o,x,a):()=>Eh(v,e,o,x,a))(),N=g?I:kh(I,p,w);return c?q(N,[N.shape[1],N.shape[2],N.shape[3]]):N}function lM(n,e,t){const s=t.map(h=>h[0]),r=t.map(h=>h[1]),o=n.concat(s,r),a=e.map((h,p)=>(h-o[p]%h)%h),i=r.map((h,p)=>h+a[p]),l=e.map((h,p)=>[s[p],i[p]]),c=e.map((h,p)=>[0,a[p]]);return[l,c]}function uM(n,e){const s=n.map((a,i)=>a+(a-1)*(e[i]-1)).map(a=>a-1),r=s.map(a=>Math.floor(a/2)),o=s.map((a,i)=>a-r[i]);return s.map((a,i)=>[r[i],o[i]])}const c1=U({pool_:iM});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cM(n,e){const t=_(n,"x","prelu"),s=_(e,"alpha","prelu"),r={x:t,alpha:s};return W.runKernel(nh,r)}const Dh=U({prelu_:cM});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dM(n,e=null,t=!1){let s=_(n,"x","prod");s.dtype==="bool"&&(s=ke(s,"int32"));const r={x:s},o={axis:e,keepDims:t};return W.runKernel(sh,r,o)}const d1=U({prod_:dM});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hM(n,e,t,s){const r=n.map((h,p)=>_(h,`tensors${p}`,"raggedGather","int32")),o=_(e,"paramsDenseValues","raggedGather"),a=_(t,"indices","raggedGather","int32"),i={paramsNestedSplits:r,paramsDenseValues:o,indices:a},l={outputRaggedRank:s},c=W.runKernel(ng,i,l);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}const v$=U({raggedGather_:hM});/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pM(n,e,t){const s=_(n,"starts","raggedRange"),r=_(e,"limits","raggedRange",s.dtype),o=_(t,"deltas","raggedRange",s.dtype),a={starts:s,limits:r,deltas:o},i=W.runKernel(sg,a);return{rtNestedSplits:i[0],rtDenseValues:i[1]}}const k$=U({raggedRange_:pM});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fM(n,e,t,s,r){const o=_(n,"shape","raggedTensorToTensor","int32"),a=_(e,"values","raggedTensorToTensor"),i=_(t,"defaultValue","raggedTensorToTensor",a.dtype),l=s.map((p,f)=>_(p,`tensors${f}`,"raggedTensorToTensor","int32")),c={shape:o,values:a,defaultValue:i,rowPartitionTensors:l},h={rowPartitionTypes:r};return W.runKernel(rg,c,h)}const S$=U({raggedTensorToTensor_:fM});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mM(n,e,t){vs(n);const s=ce(n);let r=null;if(t==null||t==="float32")r=new Float32Array(s);else if(t==="int32")r=new Int32Array(s);else if(t==="bool")r=new Uint8Array(s);else throw new Error(`Unknown data type ${t}`);for(let o=0;o<s;o++)r[o]=e();return W.makeTensor(r,n,t)}const N$=U({rand_:mM});var Ef={exports:{}},gM=Ef.exports,pC;function yM(){return pC||(pC=1,function(n){(function(e,t,s){function r(l){var c=this,h=i();c.next=function(){var p=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=p-(c.c=p|0)},c.c=1,c.s0=h(" "),c.s1=h(" "),c.s2=h(" "),c.s0-=h(l),c.s0<0&&(c.s0+=1),c.s1-=h(l),c.s1<0&&(c.s1+=1),c.s2-=h(l),c.s2<0&&(c.s2+=1),h=null}function o(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function a(l,c){var h=new r(l),p=c&&c.state,f=h.next;return f.int32=function(){return h.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,p&&(typeof p=="object"&&o(p,h),f.state=function(){return o(h,{})}),f}function i(){var l=4022871197,c=function(h){h=String(h);for(var p=0;p<h.length;p++){l+=h.charCodeAt(p);var f=.02519603282416938*l;l=f>>>0,f-=l,f*=l,l=f>>>0,f-=l,l+=f*4294967296}return(l>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=a:this.alea=a})(gM,n)}(Ef)),Ef.exports}var Rf={exports:{}},xM=Rf.exports,fC;function bM(){return fC||(fC=1,function(n){(function(e,t,s){function r(i){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var p=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^p^p>>>8},i===(i|0)?l.x=i:c+=i;for(var h=0;h<c.length+64;h++)l.x^=c.charCodeAt(h)|0,l.next()}function o(i,l){return l.x=i.x,l.y=i.y,l.z=i.z,l.w=i.w,l}function a(i,l){var c=new r(i),h=l&&l.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var f=c.next()>>>11,g=(c.next()>>>0)/4294967296,y=(f+g)/(1<<21);while(y===0);return y},p.int32=c.next,p.quick=p,h&&(typeof h=="object"&&o(h,c),p.state=function(){return o(c,{})}),p}t&&t.exports?t.exports=a:this.xor128=a})(xM,n)}(Rf)),Rf.exports}var Af={exports:{}},wM=Af.exports,mC;function vM(){return mC||(mC=1,function(n){(function(e,t,s){function r(i){var l=this,c="";l.next=function(){var p=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(p^p<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,i===(i|0)?l.x=i:c+=i;for(var h=0;h<c.length+64;h++)l.x^=c.charCodeAt(h)|0,h==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function o(i,l){return l.x=i.x,l.y=i.y,l.z=i.z,l.w=i.w,l.v=i.v,l.d=i.d,l}function a(i,l){var c=new r(i),h=l&&l.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var f=c.next()>>>11,g=(c.next()>>>0)/4294967296,y=(f+g)/(1<<21);while(y===0);return y},p.int32=c.next,p.quick=p,h&&(typeof h=="object"&&o(h,c),p.state=function(){return o(c,{})}),p}t&&t.exports?t.exports=a:this.xorwow=a})(wM,n)}(Af)),Af.exports}var Df={exports:{}},kM=Df.exports,gC;function SM(){return gC||(gC=1,function(n){(function(e,t,s){function r(i){var l=this;l.next=function(){var h=l.x,p=l.i,f,g;return f=h[p],f^=f>>>7,g=f^f<<24,f=h[p+1&7],g^=f^f>>>10,f=h[p+3&7],g^=f^f>>>3,f=h[p+4&7],g^=f^f<<7,f=h[p+7&7],f=f^f<<13,g^=f^f<<9,h[p]=g,l.i=p+1&7,g};function c(h,p){var f,g=[];if(p===(p|0))g[0]=p;else for(p=""+p,f=0;f<p.length;++f)g[f&7]=g[f&7]<<15^p.charCodeAt(f)+g[f+1&7]<<13;for(;g.length<8;)g.push(0);for(f=0;f<8&&g[f]===0;++f);for(f==8?g[7]=-1:g[f],h.x=g,h.i=0,f=256;f>0;--f)h.next()}c(l,i)}function o(i,l){return l.x=i.x.slice(),l.i=i.i,l}function a(i,l){i==null&&(i=+new Date);var c=new r(i),h=l&&l.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var f=c.next()>>>11,g=(c.next()>>>0)/4294967296,y=(f+g)/(1<<21);while(y===0);return y},p.int32=c.next,p.quick=p,h&&(h.x&&o(h,c),p.state=function(){return o(c,{})}),p}t&&t.exports?t.exports=a:this.xorshift7=a})(kM,n)}(Df)),Df.exports}var _f={exports:{}},NM=_f.exports,yC;function CM(){return yC||(yC=1,function(n){(function(e,t,s){function r(i){var l=this;l.next=function(){var h=l.w,p=l.X,f=l.i,g,y;return l.w=h=h+1640531527|0,y=p[f+34&127],g=p[f=f+1&127],y^=y<<13,g^=g<<17,y^=y>>>15,g^=g>>>12,y=p[f]=y^g,l.i=f,y+(h^h>>>16)|0};function c(h,p){var f,g,y,w,x,v=[],k=128;for(p===(p|0)?(g=p,p=null):(p=p+"\0",g=0,k=Math.max(k,p.length)),y=0,w=-32;w<k;++w)p&&(g^=p.charCodeAt((w+32)%p.length)),w===0&&(x=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,w>=0&&(x=x+1640531527|0,f=v[w&127]^=g+x,y=f==0?y+1:0);for(y>=128&&(v[(p&&p.length||0)&127]=-1),y=127,w=4*128;w>0;--w)g=v[y+34&127],f=v[y=y+1&127],g^=g<<13,f^=f<<17,g^=g>>>15,f^=f>>>12,v[y]=g^f;h.w=x,h.X=v,h.i=y}c(l,i)}function o(i,l){return l.i=i.i,l.w=i.w,l.X=i.X.slice(),l}function a(i,l){i==null&&(i=+new Date);var c=new r(i),h=l&&l.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var f=c.next()>>>11,g=(c.next()>>>0)/4294967296,y=(f+g)/(1<<21);while(y===0);return y},p.int32=c.next,p.quick=p,h&&(h.X&&o(h,c),p.state=function(){return o(c,{})}),p}t&&t.exports?t.exports=a:this.xor4096=a})(NM,n)}(_f)),_f.exports}var Of={exports:{}},IM=Of.exports,xC;function $M(){return xC||(xC=1,function(n){(function(e,t,s){function r(i){var l=this,c="";l.next=function(){var p=l.b,f=l.c,g=l.d,y=l.a;return p=p<<25^p>>>7^f,f=f-g|0,g=g<<24^g>>>8^y,y=y-p|0,l.b=p=p<<20^p>>>12^f,l.c=f=f-g|0,l.d=g<<16^f>>>16^y,l.a=y-p|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,i===Math.floor(i)?(l.a=i/4294967296|0,l.b=i|0):c+=i;for(var h=0;h<c.length+20;h++)l.b^=c.charCodeAt(h)|0,l.next()}function o(i,l){return l.a=i.a,l.b=i.b,l.c=i.c,l.d=i.d,l}function a(i,l){var c=new r(i),h=l&&l.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var f=c.next()>>>11,g=(c.next()>>>0)/4294967296,y=(f+g)/(1<<21);while(y===0);return y},p.int32=c.next,p.quick=p,h&&(typeof h=="object"&&o(h,c),p.state=function(){return o(c,{})}),p}t&&t.exports?t.exports=a:this.tychei=a})(IM,n)}(Of)),Of.exports}var Ff={exports:{}};const TM={},EM=Object.freeze(Object.defineProperty({__proto__:null,default:TM},Symbol.toStringTag,{value:"Module"})),RM=hF(EM);var AM=Ff.exports,bC;function DM(){return bC||(bC=1,function(n){(function(e,t,s){var r=256,o=6,a=52,i="random",l=s.pow(r,o),c=s.pow(2,a),h=c*2,p=r-1,f;function g(N,T,D){var P=[];T=T==!0?{entropy:!0}:T||{};var z=v(x(T.entropy?[N,I(t)]:N??k(),3),P),F=new y(P),L=function(){for(var E=F.g(o),j=l,Z=0;E<c;)E=(E+Z)*r,j*=r,Z=F.g(1);for(;E>=h;)E/=2,j/=2,Z>>>=1;return(E+Z)/j};return L.int32=function(){return F.g(4)|0},L.quick=function(){return F.g(4)/4294967296},L.double=L,v(I(F.S),t),(T.pass||D||function(E,j,Z,ne){return ne&&(ne.S&&w(ne,F),E.state=function(){return w(F,{})}),Z?(s[i]=E,j):E})(L,z,"global"in T?T.global:this==s,T.state)}function y(N){var T,D=N.length,P=this,z=0,F=P.i=P.j=0,L=P.S=[];for(D||(N=[D++]);z<r;)L[z]=z++;for(z=0;z<r;z++)L[z]=L[F=p&F+N[z%D]+(T=L[z])],L[F]=T;(P.g=function(E){for(var j,Z=0,ne=P.i,te=P.j,se=P.S;E--;)j=se[ne=p&ne+1],Z=Z*r+se[p&(se[ne]=se[te=p&te+j])+(se[te]=j)];return P.i=ne,P.j=te,Z})(r)}function w(N,T){return T.i=N.i,T.j=N.j,T.S=N.S.slice(),T}function x(N,T){var D=[],P=typeof N,z;if(T&&P=="object")for(z in N)try{D.push(x(N[z],T-1))}catch{}return D.length?D:P=="string"?N:N+"\0"}function v(N,T){for(var D=N+"",P,z=0;z<D.length;)T[p&z]=p&(P^=T[p&z]*19)+D.charCodeAt(z++);return I(T)}function k(){try{var N;return f&&(N=f.randomBytes)?N=N(r):(N=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(N)),I(N)}catch{var T=e.navigator,D=T&&T.plugins;return[+new Date,e,D,e.screen,I(t)]}}function I(N){return String.fromCharCode.apply(0,N)}if(v(s.random(),t),n.exports){n.exports=g;try{f=RM}catch{}}else s["seed"+i]=g})(typeof self<"u"?self:AM,[],Math)}(Ff)),Ff.exports}var Px,wC;function _M(){if(wC)return Px;wC=1;var n=yM(),e=bM(),t=vM(),s=SM(),r=CM(),o=$M(),a=DM();return a.alea=n,a.xor128=e,a.xorwow=t,a.xorshift7=s,a.xor4096=r,a.tychei=o,Px=a,Px}var Bg=_M();/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OM=.001,C$=.1;function FM(n,e,t){return t==null&&(t=h1()),Cb(n,e,(s,r)=>p1(s,r,t))}function h1(){return W.backend.floatPrecision()===32?OM:C$}function Cb(n,e,t){let s=!0;if((cn(n)||cn(e))&&(s=!1),cn(n)&&cn(e)&&(s=!0),s){const a=n.constructor.name,i=e.constructor.name;if(a!==i)throw new Error(`Arrays are of different type. Actual: ${a}. Expected: ${i}`)}if(Array.isArray(n)&&Array.isArray(e)){const a=jr(n),i=jr(e);if(!Je(a,i))throw new Error(`Arrays have different shapes. Actual: [${a}]. Expected: [${i}]`)}const r=cn(n)?n:Ur(n),o=cn(e)?e:Ur(e);if(r.length!==o.length)throw new Error(`Arrays have different lengths actual: ${r.length} vs expected: ${o.length}.
Actual:   ${r}.
Expected: ${o}.`);for(let a=0;a<o.length;++a){const i=r[a],l=o[a];if(!t(i,l))throw new Error(`Arrays differ: actual[${a}] = ${i}, expected[${a}] = ${l}.
Actual:   ${r}.
Expected: ${o}.`)}typeof expect<"u"&&expect().nothing()}function LM(n,e){n().then(()=>e.fail(),()=>e()),typeof expect<"u"&&expect().nothing()}function PM(n,e){const t=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return Lr(n)||Lr(n[0])||Lr(e)||Lr(e[0])?Cb(n,t,(s,r)=>s==r):Cb(n,e,(s,r)=>p1(s,r,0))}function zM(n,e,t){if(t==null&&(t=h1()),!p1(n,e,t))throw new Error(`Numbers differ: actual === ${n}, expected === ${e}`);typeof expect<"u"&&expect().nothing()}function p1(n,e,t){return!isFinite(n)&&!isFinite(e)?!0:!(isNaN(n)||isNaN(e)||Math.abs(n-e)>t)}function MM(n,e,t){for(let s=0;s<n.length;s++)if(n[s]<e||n[s]>t)throw new Error(`Value out of range:${n[s]} low: ${e}, high: ${t}`)}function BM(n,e){const t=new Float32Array(n),s=new Float32Array(e);if(t.length!==s.length)throw new Error(`Expected ArrayBuffer to be of length ${s.length}, but it was ${t.length}`);for(let r=0;r<s.length;r++)if(t[r]!==s[r])throw new Error(`Expected ArrayBuffer value at ${r} to be ${s[r]} but got ${t[r]} instead`)}function I$(n){for(let e=0;e<n.length;e++){const t=n[e];Array.isArray(t)?I$(t):n[e]=zr(t)}return n}function VM(n){const e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(n),new Promise(t=>{e.addEventListener("loadeddata",s=>t(e)),e.load()})}async function WM(n){await n.play(),"requestVideoFrameCallback"in n&&await new Promise(e=>{n.requestVideoFrameCallback(e)})}const UM=Object.freeze(Object.defineProperty({__proto__:null,TEST_EPSILON_FLOAT16:C$,createVideoElement:VM,encodeStrings:I$,expectArrayBuffersEqual:BM,expectArraysClose:FM,expectArraysEqual:PM,expectNumbersClose:zM,expectPromiseToFail:LM,expectValuesInRange:MM,play:WM,testEpsilon:h1},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f1{constructor(e,t,s,r,o){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const a=o||Math.random();this.random=Bg.alea(a.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,s=!1;for(;!s;){let r,o,a;do r=2*this.random()-1,o=2*this.random()-1,a=r*r+o*o;while(a>=1||a===0);const i=Math.sqrt(-2*Math.log(a)/a);e=this.mean+this.stdDev*r*i,t=this.mean+this.stdDev*o*i,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class jM{constructor(e,t,s,r){this.alpha=e,this.beta=1/t,this.dtype=s;const o=r||Math.random();this.randu=Bg.alea(o.toString()),this.randn=new f1(0,1,s,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,s,r,o,a;for(;;){do r=this.randn.nextValue(),a=1+this.c*r;while(a<=0);if(a*=a*a,e=r*r,t=1-.331*e*e,s=.5*e+this.d*(1-a+Math.log(a)),o=this.randu(),o<t||Math.log(o)<s)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}}class GM{constructor(e=0,t=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=Bg.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HM(n,e,t=1,s="float32",r){if(vs(n),t==null&&(t=1),s==null&&(s="float32"),s!=="float32"&&s!=="int32")throw new Error(`Unsupported data type ${s}`);const o=new jM(e,t,s,r),a=qe(n,s);for(let i=0;i<a.values.length;i++)a.values[i]=o.nextValue();return a.toTensor()}const $$=U({randomGamma_:HM});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qM(n,e=0,t=1,s,r){if(vs(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const o=new f1(e,t,s,!1,r),a=qe(n,s);for(let i=0;i<a.values.length;i++)a.values[i]=o.nextValue();return a.toTensor()}const Vg=U({randomNormal_:qM});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KM(n,e,t){if(e!=null&&e==="bool")throw new Error(`Unsupported data type ${e}`);return Vg(n,0,1,e,t)}const T$=U({randomStandardNormal_:KM});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XM(n,e=0,t=1,s="float32",r){vs(n);const o=qe(n,s),a=new GM(e,t,null,r);for(let i=0;i<o.values.length;i++)o.values[i]=a.nextValue();return o.toTensor()}const Sa=U({randomUniform_:XM});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YM(n,e,t,s){return Sa(n,e,t,"int32",s)}const E$=U({randomUniformInt_:YM});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mi(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:s};return W.runKernel(og,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QM(n){const t={input:_(n,"input","real")};return W.runKernel(ag,t)}const Cl=U({real_:QM});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZM(n){const t={x:_(n,"x","reciprocal")};return W.runKernel(pu,t)}const m1=U({reciprocal_:ZM});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JM(n){const t={x:_(n,"x","relu")};return W.runKernel(fu,t)}const Cr=U({relu_:JM});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eB(n){const t={x:_(n,"x","relu6")};return W.runKernel(mu,t)}const Wg=U({relu6_:eB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tB(n,e){const s={x:_(n,"x","reverse")},r={dims:e};return W.runKernel(ih,s,r)}const Os=U({reverse_:tB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nB(n){const e=_(n,"x","reverse");return A(e.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`),Os(e,0)}const R$=U({reverse1d_:nB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sB(n,e){const t=_(n,"x","reverse");return A(t.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${t.rank}.`),Os(t,e)}const A$=U({reverse2d_:sB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rB(n,e){const t=_(n,"x","reverse");return A(t.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${t.rank}.`),Os(t,e)}const D$=U({reverse3d_:rB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oB(n,e){const t=_(n,"x","reverse");return A(t.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${t.rank}.`),Os(t,e)}const _$=U({reverse4d_:oB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aB(n){const t={x:_(n,"x","round")};return W.runKernel(gu,t)}const Ug=U({round_:aB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iB(n){const t={x:_(n,"x","rsqrt","float32")};return W.runKernel(yu,t)}const jg=U({rsqrt_:iB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lB(n){const t={x:_(n,"x","selu")};return W.runKernel(xu,t)}const Gg=U({selu_:lB});function uB(n,e,t,s,r,o=[1,1],a="NHWC"){const i=_(n,"x","separableConv2d"),l=_(e,"depthwiseFilter","separableConv2d"),c=_(t,"pointwiseFilter","separableConv2d");let h=i,p=!1;if(i.rank===3&&(p=!0,h=q(i,[1,i.shape[0],i.shape[1],i.shape[2]])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");A(h.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${h.rank}.`),A(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),A(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),A(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),A(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);const f=l.shape[2],g=l.shape[3];A(c.shape[2]===f*g,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${f*g}, but got ${c.shape[2]}.`);const y=Du(h,l,s,r,a,o),x=go(y,c,1,"valid",a);return p?q(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const Hg=U({separableConv2d_:uB});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function cB(n,e){const t=_(n,"x","setdiff1d"),s=_(e,"y","setdiff1d");A(t.dtype===s.dtype,()=>`x and y should have the same dtype, but got x (${t.dtype}) and y (${s.dtype}).`),A(t.rank===1,()=>`x should be 1D tensor, but got x (${t.shape}).`),A(s.rank===1,()=>`y should be 1D tensor, but got y (${s.shape}).`);const r=await t.data(),o=await s.data(),a=new Set(o);let i=0;for(let h=0;h<r.length;h++)a.has(r[h])||i++;const l=new Yt([i],t.dtype),c=new Yt([i],"int32");for(let h=0,p=0;h<r.length;h++)a.has(r[h])||(l.values[p]=r[h],c.values[p]=h,p++);return[l.toTensor(),c.toTensor()]}const O$=cB;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dB(n){const t={x:_(n,"x","sign")};return W.runKernel(vu,t)}const g1=U({sign_:dB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hB(n){const t={x:_(n,"x","sin","float32")};return W.runKernel(bu,t)}const qg=U({sin_:hB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pB(n){const t={x:_(n,"x","sinh")};return W.runKernel(wu,t)}const Kg=U({sinh_:pB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fB(n,e,t){const s=_(n,"x","slice1d");return A(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),tt(s,[e],[t])}const _h=U({slice1d_:fB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mB(n,e,t){const s=_(n,"x","slice2d");return A(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),tt(s,e,t)}const Xg=U({slice2d_:mB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gB(n,e,t){const s=_(n,"x","slice3d");return A(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),tt(s,e,t)}const Oh=U({slice3d_:gB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yB(n,e,t){const s=_(n,"x","slice4d");return A(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),tt(s,e,t)}const Il=U({slice4d_:yB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xB(n,e=-1){const t=_(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},r={dim:e};return W.runKernel(ph,s,r)}const Pu=U({softmax_:xB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bB(n){A(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return W.runKernel(Vm,e)}const Fh=U({fft_:bB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wB(n){A(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return W.runKernel(Gm,e)}const $l=U({ifft_:wB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vB(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const r=q(n,[t,e]);s=$l(r)}else{const r=[t,2*(e-1)],o=q(Cl(n),[t,e]),a=q(Nh(n),[t,e]),i=Os(tt(o,[0,1],[t,e-2]),1),l=G(Os(tt(a,[0,1],[t,e-2]),1),Me(-1)),c=Wt([o,i],1),h=Wt([a,l],1),p=q(mo(c,h),[r[0],r[1]]);s=$l(p)}if(s=Cl(s),n.rank===3&&n.shape[0]!==0){const r=s,o=n.shape[0];s=q(s,[o,s.shape[0]/o,s.shape[1]]),r.dispose()}return s}const Yg=U({irfft_:vB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kB(n,e,t=0){const r={x:_(n,"x","split")},o={numOrSizeSplits:e,axis:t};return W.runKernel(hh,r,o)}const Zn=U({split_:kB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SB(n,e){A(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let r;if(e!=null&&e<t){const y=n.shape.map(x=>0),w=n.shape.map(x=>x);w[n.shape.length-1]=e,r=tt(n,y,w),t=e}else if(e!=null&&e>t){const y=n.shape.map(w=>w);y[n.shape.length-1]=e-t,r=Wt([n,Vt(y)],n.shape.length-1),t=e}else r=n;const o=st(r),a=q(mo(r,o),[s,t]),i=Fh(a),l=Math.floor(t/2)+1,c=Cl(i),h=Nh(i),p=Zn(c,[l,t-l],c.shape.length-1),f=Zn(h,[l,t-l],h.shape.length-1),g=r.shape.slice();return g[r.shape.length-1]=l,q(mo(p[0],f[0]),g)}const Lh=U({rfft_:SB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NB(n,e){let t=_(n,"a","squaredDifference"),s=_(e,"b","squaredDifference");[t,s]=Ft(t,s),He(t.shape,s.shape);const r={a:t,b:s},o={};return W.runKernel(Cu,r,o)}const Qg=U({squaredDifference_:NB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CB(n,e){const t=_(n,"x","squeeze","string_or_numeric");return q(t,bo(t.shape,e).newShape)}const Co=U({squeeze_:CB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IB(n,e=0){const t=Jc(n,"tensors","stack","string_or_numeric");A(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&A(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,r={axis:e};return W.runKernel(eh,s,r)}const ss=U({stack_:IB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $B(n,e=0){const s={x:_(n,"x","step")},r={alpha:e};return W.runKernel(Ru,s,r)}const Ri=U({step_:$B});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TB(n,e,t,s,r=0,o=0,a=0,i=0,l=0){const h={x:_(n,"x","stridedSlice","string_or_numeric")},p={begin:e,end:t,strides:s,beginMask:r,endMask:o,ellipsisMask:a,newAxisMask:i,shrinkAxisMask:l};return W.runKernel(xg,h,p)}const y1=U({stridedSlice_:TB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EB(n){const t={x:_(n,"x","tan","float32")};return W.runKernel($u,t)}const x1=U({tan_:EB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dn(n,e){Ni(n);const t=jr(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return ba(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yl(n,e,t){if(Ni(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=jr(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return ba(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b1(n,e,t){if(Ni(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const s=jr(n,t);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return ba(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F$(n,e,t){if(Ni(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const s=jr(n,t);if(s.length!==4&&s.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return ba(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L$(n,e,t){if(Ni(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const s=jr(n,t);if(s.length!==5&&s.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return ba(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P$(n,e,t){if(Ni(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const s=jr(n,t);if(s.length!==6&&s.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||s,ba(n,e,s,t)}function w1(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(o+` update.rank < ${r}. `);if(n.length<s+(t.rank-r))throw new Error(o+` Output shape length < ${s+(t.rank-r)}`);if(t.rank!==r+n.length-s)throw new Error(o+` update.rank != ${r+n.length-s}`);for(let a=0;a<r;++a)if(t.shape[a]!==e.shape[a])throw new Error(o+` updates.shape[${a}] (${t.shape[a]}) != indices.shape[${a}] (${e.shape[a]}).`);for(let a=0;a<t.rank-r;++a)if(t.shape[a+r]!==n[a+s])throw new Error(o+` updates.shape[${a+r}] (${t.shape[a+r]}) != shape[${a+r}] (${n[a+r]})`)}function Zg(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}w1(t,e,n)}function Na(n,e,t){const s=e.shape.length,r=s>1?e.shape[s-1]:1,o=t.length;let a=1;for(let p=r;p<o;++p)a*=t[p];const i=r<1?1:r,l=ce(e.shape)/i,c=[...ze(t.slice(0,r)),1],h=ce(t);return{sliceRank:r,numUpdates:l,sliceSize:a,strides:c,outputSize:h}}const RB=Object.freeze(Object.defineProperty({__proto__:null,calculateShapes:Na,validateInput:Zg,validateUpdateShape:w1},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AB(n,e,t){const s=_(n,"tensor","tensorScatterupdate"),r=_(e,"indices","tensorScatterupdate","int32"),o=_(t,"updates","tensorScatterupdate");if(Zg(o,r,s.shape),s.dtype!==o.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${s.dtype} and ${o.dtype}.`);const a={tensor:s,indices:r,updates:o},i={};return W.runKernel(cg,a,i)}const z$=U({tensorScatterUpdate_:AB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DB(n,e=1,t=!0){const s=_(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const o={x:s},a={k:e,sorted:t},[i,l]=W.runKernel(kg,o,a);return{values:i,indices:l}}const v1=U({topk_:DB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _B(n,e=0,t=1,s,r){if(vs(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const o=new f1(e,t,s,!0,r),a=qe(n,s);for(let i=0;i<a.values.length;i++)a.values[i]=o.nextValue();return a.toTensor()}const Jg=U({truncatedNormal_:_B});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OB(n,e=0){const t=_(n,"x","unique","string_or_numeric");A(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},r={axis:e},[o,a]=W.runKernel(Ng,s,r);return{values:o,indices:a}}const k1=U({unique_:OB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FB(n,e,t){const s=_(n,"x","unsortedSegmentSum"),r=_(e,"segmentIds","unsortedSegmentSum","int32");A(ii(t),()=>"numSegments must be of dtype int");const o={x:s,segmentIds:r},a={numSegments:t};return W.runKernel(gh,o,a)}const ey=U({unsortedSegmentSum_:FB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LB(n,e=0){const t=_(n,"x","unstack","string_or_numeric");A(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},r={axis:e};return W.runKernel(mh,s,r)}const Fs=U({unstack_:LB});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M$(n,e){return Mg(n,e,"right")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S1(n,e=!0,t,s){return W.makeVariable(n,e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ty(n,e){const t=[];for(let o=0;o<e.length;o++)e[o]&&t.push(o);const s=qe(n,"int32"),r=qe([t.length,n.length],"int32");for(let o=0;o<t.length;o++){const a=s.indexToLoc(t[o]),i=o*n.length;r.values.set(a,i)}return r.toTensor()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function PB(n){const e=_(n,"condition","whereAsync","bool"),t=await e.data(),s=ty(e.shape,t);return n!==e&&e.dispose(),s}const N1=PB;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function zB(n,e,t){const s=_(n,"tensor","boolMask"),r=_(e,"mask","boolMask","bool"),o=t??0,a=r.rank,i=s.shape;A(a>0,()=>"mask cannot be scalar"),Sn(i.slice(o,o+a),r.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let w=o;w<o+a;w++)l*=i[w];const c=i.slice(0,o).concat([l],i.slice(o+a)),h=q(s,c),p=q(r,[-1]),f=await N1(p),g=Co(f,[1]),y=Lu(h,g,o);return n!==s&&s.dispose(),e!==r&&r.dispose(),g.dispose(),h.dispose(),p.dispose(),f.dispose(),y}const B$=zB;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MB(n,e,t){const s=_(n,"x","transpose");if(e==null&&(e=s.shape.map((a,i)=>i).reverse()),A(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(a=>{A(a>=0&&a<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},o={perm:e};return s.dtype==="complex64"?re(()=>{let a=Cl(s),i=Nh(s);return a=W.runKernel(si,{x:a},o),i=W.runKernel(si,{x:i},o),t&&(i=St(i)),mo(a,i)}):W.runKernel(si,r,o)}const nt=U({transpose_:MB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BB(n,e,t,s,r=!0){const o=_(n,"v","movingAverage"),a=_(e,"x","movingAverage"),i=_(t,"decay","movingAverage");F2(o,a),A(Je(o.shape,a.shape),()=>"Shape mismatch in v and x");const l=Me(1),c=Te(l,i);let h=G(Te(a,o),c);if(r){A(s!=null,()=>"When using zeroDebias: true, step is required.");const p=_(s,"step","movingAverage");h=Fe(h,Te(l,Gr(i,p)))}return fe(o,h)}const V$=U({movingAverage_:BB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VB(n,e,t){vs(t);const s=_(n,"indices","scatterND","int32"),r=_(e,"updates","scatterND");Zg(r,s,t);const o={indices:s,updates:r},a={shape:t};return W.runKernel(ug,o,a)}const W$=U({scatterND_:VB});function WB(n,e,t,s){if(n.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${n.dtype}.`);if(n.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${n.shape}.`);const r=n.rank>0?n.shape[0]:1,o=n.rank>1?n.shape[1]:1;if(t.length!==o)throw new Error(`outputShape has incorrect number of elements:, ${t.length}, should be: ${o}.`);const a=e.size;if(!(e.rank===0||e.rank===1&&a===r))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${r}]`);if(e.dtype!==s.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UB(n,e,t,s=0){vs(t);const r=_(n,"sparseIndices","sparseToDense","int32"),o=_(e,"sparseValues","sparseToDense","string_or_numeric"),a=_(s,"defaultValue","sparseToDense",o.dtype);WB(r,o,t,a);const i={sparseIndices:r,sparseValues:o,defaultValue:a},l={outputShape:t};return W.runKernel(gg,i,l)}const U$=U({sparseToDense_:UB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jB(n,e){const t=_(e,"indices","gatherND","int32"),r={params:_(n,"x","gatherND","string_or_numeric"),indices:t};return W.runKernel(jm,r)}const j$=U({gatherND_:jB});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GB(n,e){if(e==null)return n.shape.slice();if(Je(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HB(n,e,t,s){const r=_(n,"x","dropout");if(A(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),A(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof dt?r.clone():r;const o=GB(r,t),a=1-e,i=Fe(Fu(fe(Sa(o,0,1,"float32",s),a)),a);return G(r,i)}const C1=U({dropout_:HB});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I1(n){return Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))))}function ny(n,e,t){const s=1-n%2,r=new Float32Array(n);for(let o=0;o<n;++o){const a=2*Math.PI*o/(n+s-1);r[o]=e-t*Math.cos(a)}return Dn(r,"float32")}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function qB(n,e,t=1){const s=_(n,"predictions","inTopK"),r=_(e,"targets","inTopK");A(s.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${s.rank}`),A(s.rank-1===r.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${s.rank} and targets rank ${r.rank}`),Sn(s.shape.slice(0,s.shape.length-1),r.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const o=s.shape[s.shape.length-1];A(t>0&&t<=o,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${o}), but got ${t}`);const a=await s.data(),i=await r.data(),[l,c]=[a.length/o,o],h=hn("bool",l);for(let p=0;p<l;p++){const f=p*c,g=a.subarray(f,f+c),y=[];for(let w=0;w<g.length;w++)y.push({value:g[w],index:w});y.sort((w,x)=>x.value-w.value),h[p]=0;for(let w=0;w<t;w++)if(y[w].index===i[p]){h[p]=1;break}}return n!==s&&s.dispose(),e!==r&&r.dispose(),Zs(h,r.shape,"bool")}const G$=qB;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KB(n,e,t,s,r,o="NHWC",a){let i=n;n.rank===3&&(i=q(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=q(e,[1,e.shape[0],e.shape[1],e.shape[2]])),A(i.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${i.shape}.`),A(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),A(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const c=o==="NHWC"?i.shape[3]:i.shape[1],h=o==="NHWC"?l.shape[3]:l.shape[1];A(c===t[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${t[2]}.`),A(h===t[3],()=>`Error in conv2dDerFilter: depth of dy (${h}) must match output depth for filter (${t[3]}).`),Gn("conv2dDerFilter",r,a);const p={x:i,dy:l},f={strides:s,pad:r,dataFormat:o,dimRoundingMode:a,filterShape:t};return W.runKernel(Tm,p,f)}const $1=U({conv2DBackpropFilter_:KB});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sy(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return G(n,Ri(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function ry(n,e){let t=e;const s=Qt(n.shape,e.shape);return s.length>0&&(t=Ae(t,s)),q(t,n.shape)}function oy(n,e,t,s){if(e==="linear")return n;if(e==="relu")return Cr(n);if(e==="elu")return _u(n);if(e==="relu6")return Wg(n);if(e==="prelu")return Dh(n,t);if(e==="leakyrelu")return Ch(n,s);if(e==="sigmoid")return xr(n);throw new Error(`Unknown fused activation ${e}.`)}const ay=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XB({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:o=[1,1],dimRoundingMode:a,bias:i,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:h}){if(l=l||"linear",ay(W.state.gradientDepth,l)===!1){A(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let D=go(n,e,t,s,r,o,a);return i!=null&&(D=fe(D,i)),oy(D,l,c,h)}const p=_(n,"x","conv2d","float32"),f=_(e,"filter","conv2d","float32");let g=p,y=!1;p.rank===3&&(y=!0,g=q(p,[1,p.shape[0],p.shape[1],p.shape[2]])),A(g.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${g.rank}.`),A(f.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`),Gn("fused conv2d",s,a);const w=r==="NHWC"?g.shape[3]:g.shape[1];A(f.shape[2]===w,()=>`Error in conv2d: depth of input (${w}) must match input depth for filter ${f.shape[2]}.`),A(Nn(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);const x=fn(g.shape,f.shape,t,o,s,a);let v;i!=null&&(v=_(i,"bias","fused conv2d"),[v]=Ft(v,p),r==="NHWC"?He(x.outShape,v.shape):(A(v.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${v.shape.length}.`),A(v.shape.length===0||v.shape[0]===x.outChannels||v.shape[0]===1,()=>`Error in fused conv2d: bias shape (${v.shape}) is not compatible with the number of output channels (${x.outChannels})`)));let k;if(c!=null){const D=c.shape;if(A(D.length<=1||D.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${D.length}.`),D.length===1)A(D[0]===1||D[0]===x.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${D}) is not compatible with the number of output channels (${x.outChannels}).`);else if(D.length===3)try{He(D,x.outShape)}catch{const z=`Error in fused conv2d: PReLU activation weights (${D}) is not compatible with the output shape of the conv2d (${x.outShape}).`;throw Error(z)}k=_(c,"prelu weights","fused conv2d")}const I=(D,P)=>{A(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[z,F,L,E]=P,j=sy(D,L,l);A(ca(o),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`);const Z=Gw(F.shape,j,z,t,s),ne=$1(F,j,z.shape,t,s),te=[Z,ne];if(E!=null){const se=ry(E,j);te.push(se)}return te},N={x:g,filter:f,bias:v,preluActivationWeights:k},T={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:a,activation:l,leakyreluAlpha:h};return i==null?Hr((P,z,F)=>{let L=W.runKernel(Kc,N,T);return F([z,P,L]),y&&(L=q(L,[L.shape[1],L.shape[2],L.shape[3]])),{value:L,gradFunc:I}})(g,f):Hr((P,z,F,L)=>{let E=W.runKernel(Kc,N,T);return L([z,P,E,F]),y&&(E=q(E,[E.shape[1],E.shape[2],E.shape[3]])),{value:E,gradFunc:I}})(g,f,v)}const H$=U({fusedConv2d_:XB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YB(n,e,t,s,r,o=[1,1],a){let i=n;n.rank===3&&(i=q(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=q(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:i,dy:l},h={strides:s,pad:r,dimRoundingMode:a,dilations:o,filterShape:t};return W.runKernel(Fm,c,h)}const q$=U({depthwiseConv2dNativeBackpropFilter_:YB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QB(n,e,t,s,r,o=[1,1],a){let i=e,l=!1;e.rank===3&&(l=!0,i=q(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:i,filter:t},h={strides:s,pad:r,dimRoundingMode:a,dilations:o,inputShape:n},p=W.runKernel(Lm,c,h);return l?q(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const K$=U({depthwiseConv2dNativeBackpropInput_:QB});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZB({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:o=[1,1],dimRoundingMode:a,bias:i,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:h}){if(ay(W.state.gradientDepth,l)===!1){let T=Du(n,e,t,s,r,o,a);return i!=null&&(T=fe(T,i)),oy(T,l,c,h)}const p=_(n,"x","depthwiseConv2d","float32"),f=_(e,"filter","depthwiseConv2d","float32");let g=p,y=!1;p.rank===3&&(y=!0,g=q(p,[1,p.shape[0],p.shape[1],p.shape[2]])),A(g.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${g.rank}.`),A(f.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${f.rank}.`),A(g.shape[3]===f.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${g.shape[3]}) must match the inChannels dimension in filter ${f.shape[2]}.`),o==null&&(o=[1,1]),A(Nn(t,o),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),Gn("fused depthwiseConv2d",s,a);const w=fn(g.shape,f.shape,t,o,s,a,!0);let x;i!=null&&(x=_(i,"bias","fused conv2d"),[x]=Ft(x,p),He(w.outShape,x.shape));let v;c!=null&&(v=_(c,"prelu weights","fused depthwiseConv2d"));const k=(T,D)=>{A(ca(o),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`);const[P,z,F,L]=D,E=sy(T,F,l),j=K$(z.shape,E,P,t,s,o,a),Z=q$(z,E,P.shape,t,s,o,a);if(L!=null){const ne=ry(x,E);return[j,Z,ne]}return[j,Z]},I={x:g,filter:f,bias:x,preluActivationWeights:v},N={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:a,activation:l,leakyreluAlpha:h};return i==null?Hr((D,P,z)=>{let F=W.runKernel(Xc,I,N);return z([P,D,F]),y&&(F=q(F,[F.shape[1],F.shape[2],F.shape[3]])),{value:F,gradFunc:k}})(g,f):Hr((D,P,z,F)=>{let L=W.runKernel(Xc,I,N);return F([P,D,L,z]),y&&(L=q(L,[L.shape[1],L.shape[2],L.shape[3]])),{value:L,gradFunc:k}})(g,f,x)}const JB=U({fusedDepthwiseConv2d_:ZB});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eV({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:r,activation:o="linear",preluActivationWeights:a,leakyreluAlpha:i=.2}){if(ay(W.state.gradientDepth,o)===!1){let E=Xe(n,e,t,s);return r!=null&&(E=fe(E,r)),oy(E,o,a,i)}let l=_(n,"a","fused matMul"),c=_(e,"b","fused matMul");[l,c]=Ft(l,c);const h=t?l.shape[l.rank-2]:l.shape[l.rank-1],p=s?c.shape[c.rank-1]:c.shape[c.rank-2],f=t?l.shape[l.rank-1]:l.shape[l.rank-2],g=s?c.shape[c.rank-2]:c.shape[c.rank-1],y=l.shape.slice(0,-2),w=c.shape.slice(0,-2),x=ce(y),v=ce(w);A(h===p,()=>`Error in fused matMul: inner shapes (${h}) and (${p}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${t} and transposeB=${s} must match.`);const I=He(l.shape.slice(0,-2),c.shape.slice(0,-2)).concat([f,g]),N=t?q(l,[x,h,f]):q(l,[x,f,h]),T=s?q(c,[v,g,p]):q(c,[v,p,g]);let D;r!=null&&(D=_(r,"bias","fused matMul"),[D]=Ft(D,l),He(I,D.shape));let P;a!=null&&(P=_(a,"prelu weights","fused matMul"));const z=(E,j)=>{const[Z,ne,te,se]=j,K=sy(q(E,te.shape),te,o);let B,J;if(!t&&!s?(B=Xe(K,ne,!1,!0),J=Xe(Z,K,!0,!1)):!t&&s?(B=Xe(K,ne,!1,!1),J=Xe(K,Z,!0,!1)):t&&!s?(B=Xe(ne,K,!1,!0),J=Xe(Z,K,!1,!1)):(B=Xe(ne,K,!0,!0),J=Xe(K,Z,!0,!0)),r!=null){const X=ry(se,K);return[B,J,X]}else return[B,J]},F={a:N,b:T,bias:D,preluActivationWeights:P},L={transposeA:t,transposeB:s,activation:o,leakyreluAlpha:i};return r==null?Hr((j,Z,ne)=>{const te=W.runKernel(qc,F,L);return ne([j,Z,te]),{value:q(te,I),gradFunc:z}})(N,T):Hr((j,Z,ne,te)=>{const se=W.runKernel(qc,F,L);return te([j,Z,se,ne]),{value:q(se,I),gradFunc:z}})(N,T,D)}const Ib=U({fusedMatMul_:eV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X$=Object.freeze(Object.defineProperty({__proto__:null,conv2d:H$,depthwiseConv2d:JB,matMul:Ib},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tV(n){return ny(n,.54,.46)}const nV=U({hammingWindow_:tV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sV(n){return ny(n,.5,.5)}const Y$=U({hannWindow_:sV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rV(n,e,t,s=!1,r=0){let o=0;const a=[];for(;o+e<=n.size;)a.push(tt(n,o,e)),o+=t;if(s)for(;o<n.size;){const i=o+e-n.size,l=Wt([tt(n,o,e-i),Ti([i],r)]);a.push(l),o+=t}return a.length===0?yl([],[0,e]):q(Wt(a),[a.length,e])}const Q$=U({frame_:rV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oV(n,e,t,s,r=Y$){s==null&&(s=I1(e));const o=Q$(n,e,t),a=G(o,r(e));return Lh(a,s)}const aV=U({stft_:oV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iV(n,e,t,s,r="bilinear",o=0){const a=_(n,"image","cropAndResize"),i=_(e,"boxes","cropAndResize","float32"),l=_(t,"boxInd","cropAndResize","int32"),c=i.shape[0];A(a.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${a.rank}.`),A(i.rank===2&&i.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${i.shape}.`),A(l.rank===1&&l.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${i.shape}.`),A(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),A(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),A(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const h={image:a,boxes:i,boxInd:l},p={method:r,extrapolationValue:o,cropSize:s};return W.runKernel(Dm,h,p)}const lV=U({cropAndResize_:iV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uV(n){const e=_(n,"image","flipLeftRight","float32");A(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return W.runKernel(Um,t,{})}const cV=U({flipLeftRight_:uV});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dV(n){const e=_(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];A(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),A(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,Rs(e,r)}const hV=U({grayscaleToRGB_:dV});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pV(n){const e=_(n,"image","RGBToGrayscale"),t=e.rank-1,s=e.shape[t];A(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),A(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,o=ke(e,"float32"),a=Dn([.2989,.587,.114]);let i;switch(e.rank){case 2:i=Xa("ij,j->i",o,a);break;case 3:i=Xa("ijk,k->ij",o,a);break;case 4:i=Xa("ijkl,l->ijk",o,a);break;case 5:i=Xa("ijklm,m->ijkl",o,a);break;case 6:i=Xa("ijklmn,n->ijklm",o,a);break;default:throw new Error("Not a valid tensor rank.")}return i=An(i,-1),ke(i,r)}const fV=U({rgbToGrayscale_:pV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mV(n,e,t=0,s=.5){const r=_(n,"image","rotateWithOffset","float32");A(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const o={image:r},a={radians:e,fillValue:t,center:s};return W.runKernel(Cg,o,a)}const gV=U({rotateWithOffset_:mV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zu(n,e,t,s,r,o){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),o==null&&(o=0);const a=n.shape[0];return t=Math.min(t,a),A(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),A(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),A(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),A(e.rank===1,()=>"scores must be a 1D tensor"),A(e.shape[0]===a,()=>`scores has incompatible shape with boxes. Expected ${a}, but was ${e.shape[0]}`),A(0<=o&&o<=1,()=>`softNmsSigma must be in [0, 1], but was '${o}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yV(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const o=_(n,"boxes","nonMaxSuppression","float32"),a=_(e,"scores","nonMaxSuppression","float32"),i=zu(o,a,t,s,r);t=i.maxOutputSize,s=i.iouThreshold,r=i.scoreThreshold;const l={maxOutputSize:t,iouThreshold:s,scoreThreshold:r};return W.runKernel(Jm,{boxes:o,scores:a},l)}const xV=U({nonMaxSuppression_:yV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bV(n,e,t){const s=wV(n,e,t),r=s<0?-(s+1):s;n.splice(r,0,e)}function wV(n,e,t){return kV(n,e,t||vV)}function vV(n,e){return n>e?1:n<e?-1:0}function kV(n,e,t){let s=0,r=n.length,o=0,a=!1;for(;s<r;){o=s+(r-s>>>1);const i=t(e,n[o]);i>0?s=o+1:(r=o,a=!i)}return a?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iy(n,e,t,s,r){return T1(n,e,t,s,r,0)}function ly(n,e,t,s,r,o){return T1(n,e,t,s,r,0,!1,o,!0)}function uy(n,e,t,s,r,o){return T1(n,e,t,s,r,o,!0)}function T1(n,e,t,s,r,o,a=!1,i=!1,l=!1){const c=[];for(let x=0;x<e.length;x++)e[x]>r&&c.push({score:e[x],boxIndex:x,suppressBeginIndex:0});c.sort(vC);const h=o>0?-.5/o:0,p=[],f=[];for(;p.length<t&&c.length>0;){const x=c.pop(),{score:v,boxIndex:k,suppressBeginIndex:I}=x;if(v<r)break;let N=!1;for(let T=p.length-1;T>=I;--T){const D=SV(n,k,p[T]);if(D>=s){N=!0;break}if(x.score=x.score*NV(s,h,D),x.score<=r)break}x.suppressBeginIndex=p.length,N||(x.score===v?(p.push(k),f.push(x.score)):x.score>r&&bV(c,x,vC))}const g=p.length,y=t-g;i&&y>0&&(p.push(...new Array(y).fill(0)),f.push(...new Array(y).fill(0)));const w={selectedIndices:p};return a&&(w.selectedScores=f),l&&(w.validOutputs=g),w}function SV(n,e,t){const s=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),o=Math.min(s[0],s[2]),a=Math.min(s[1],s[3]),i=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),c=Math.min(r[0],r[2]),h=Math.min(r[1],r[3]),p=Math.max(r[0],r[2]),f=Math.max(r[1],r[3]),g=(i-o)*(l-a),y=(p-c)*(f-h);if(g<=0||y<=0)return 0;const w=Math.max(o,c),x=Math.max(a,h),v=Math.min(i,p),k=Math.min(l,f),I=Math.max(v-w,0)*Math.max(k-x,0);return I/(g+y-I)}function NV(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function vC(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function CV(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const o=_(n,"boxes","nonMaxSuppressionAsync"),a=_(e,"scores","nonMaxSuppressionAsync"),i=zu(o,a,t,s,r);t=i.maxOutputSize,s=i.iouThreshold,r=i.scoreThreshold;const l=await Promise.all([o.data(),a.data()]),c=l[0],h=l[1],{selectedIndices:p}=iy(c,h,t,s,r);return o!==n&&o.dispose(),a!==e&&a.dispose(),Dn(p,"int32")}const IV=CV;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $V(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const a=_(n,"boxes","nonMaxSuppression"),i=_(e,"scores","nonMaxSuppression"),l=zu(a,i,t,s,r,o);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,o=l.softNmsSigma;const c={boxes:a,scores:i},h={maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:o},p=W.runKernel(tg,c,h);return{selectedIndices:p[0],selectedScores:p[1]}}const TV=U({nonMaxSuppressionWithScore_:$V});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function EV(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const a=_(n,"boxes","nonMaxSuppressionAsync"),i=_(e,"scores","nonMaxSuppressionAsync"),l=zu(a,i,t,s,r,o);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,o=l.softNmsSigma;const c=await Promise.all([a.data(),i.data()]),h=c[0],p=c[1],{selectedIndices:f,selectedScores:g}=uy(h,p,t,s,r,o);return a!==n&&a.dispose(),i!==e&&i.dispose(),{selectedIndices:Dn(f,"int32"),selectedScores:Dn(g)}}const RV=EV;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AV(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const a=_(n,"boxes","nonMaxSuppression"),i=_(e,"scores","nonMaxSuppression"),l=zu(a,i,t,s,r,null),c=l.maxOutputSize,h=l.iouThreshold,p=l.scoreThreshold,f={boxes:a,scores:i},g={maxOutputSize:c,iouThreshold:h,scoreThreshold:p,padToMaxOutputSize:o},y=W.runKernel(eg,f,g);return{selectedIndices:y[0],validOutputs:y[1]}}const DV=U({nonMaxSuppressionPadded_:AV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function _V(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const a=_(n,"boxes","nonMaxSuppressionAsync"),i=_(e,"scores","nonMaxSuppressionAsync"),l=zu(a,i,t,s,r,null),c=l.maxOutputSize,h=l.iouThreshold,p=l.scoreThreshold,[f,g]=await Promise.all([a.data(),i.data()]),{selectedIndices:y,validOutputs:w}=ly(f,g,c,h,p,o);return a!==n&&a.dispose(),i!==e&&i.dispose(),{selectedIndices:Dn(y,"int32"),validOutputs:Me(w,"int32")}}const OV=_V;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FV(n,e,t=!1,s=!1){const r=_(n,"images","resizeBilinear");A(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),A(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),A(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let o=r,a=!1;r.rank===3&&(a=!0,o=q(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const i={images:o},l={alignCorners:t,halfPixelCenters:s,size:e},c=W.runKernel(ah,i,l);return a?q(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const Z$=U({resizeBilinear_:FV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LV(n,e,t=!1,s=!1){const r=_(n,"images","resizeNearestNeighbor");A(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),A(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),A(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),A(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let o=r,a=!1;r.rank===3&&(a=!0,o=q(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const i={images:o},l={alignCorners:t,halfPixelCenters:s,size:e},c=W.runKernel(oh,i,l);return a?q(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const J$=U({resizeNearestNeighbor_:LV});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PV(n,e="binary",t=!1,s=.5){const r=_(n,"image","threshold"),o=.2989,a=.587,i=.114,l=r.shape[0]*r.shape[1];let c=G(Dn([s]),255),h,p,f,g;if(A(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),A(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),A(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),A(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[h,p,f]=Zn(r,[1,1,1],-1);const x=G(h,o),v=G(p,a),k=G(f,i);g=fe(fe(x,v),k)}else g=n;if(e==="otsu"){const x=Mw(ke(Ug(g),"int32"),Zs([]),256);c=zV(x,l)}const y=t?ka(g,c):os(g,c);return ke(G(y,255),"int32")}function zV(n,e){let t=Dn([-1]),s=Dn([0]),r=Dn([0]),o,a,i,l,c,h;for(let p=0;p<n.size-1;p++){o=tt(n,0,p+1),a=tt(n,p+1),c=Fe(Ae(o),e),h=Fe(Ae(a),e);const f=Ae(G(o,mi(0,o.size)));i=Fe(f,Ae(o));const g=Ti(a.shape,o.size),y=fe(mi(0,a.size),g),w=G(a,y);l=Fe(Ae(w),Ae(a));const x=Te(i,l),v=Te(i,l),k=G(c,h);r=G(G(k,x),v);const I=os(r,s);s=vn(I,r,s),t=vn(I,Dn([p]),t)}return t}const MV=U({threshold_:PV});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BV(n,e,t="nearest",s="constant",r=0,o){const a=_(n,"image","transform","float32"),i=_(e,"transforms","transform","float32");A(a.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${a.rank}.`),A(i.rank===2&&(i.shape[0]===a.shape[0]||i.shape[0]===1)&&i.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),A(o==null||o.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`);const l={image:a,transforms:i},c={interpolation:t,fillMode:s,fillValue:r,outputShape:o};return W.runKernel(Sg,l,c)}const VV=U({transform_:BV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WV(n,e,t){const s=_(n,"a","bandPart");A(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[o,a]=s.shape.slice(-2);let i,l;typeof e=="number"?(A(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),A(e<=o,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`),i=_(e<0?o:e,"numLower","bandPart")):(A(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),i=vn(Sl(e,0),o,ha(e,o))),typeof t=="number"?(A(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),A(t<=a,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${a}).`),l=_(t<0?a:t,"numUpper","bandPart")):(A(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=vn(Sl(t,0),a,ha(t,a)));const c=q(mi(0,o,1,"int32"),[-1,1]),h=mi(0,a,1,"int32"),p=Te(c,h),f=wr(ka(p,i),So(p,St(l))),g=Vt([o,a],s.dtype);return q(ss(Fs(q(s,[-1,o,a])).map(y=>vn(f,y,g))),r)}const UV=U({bandPart_:WV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jV(n){let e;if(Array.isArray(n)){e=!1,A(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let o=1;o<n.length;++o)A(n[o].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[o].shape[0]} vs. ${r})`)}else e=!0,n=Zn(n,n.shape[0],0).map(r=>Co(r,[0]));A(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let r=0;r<n.length;++r)t.push(W.tidy(()=>{let o=s[r];if(r>0)for(let a=0;a<r;++a){const i=G(Ae(G(t[a],o)),t[a]);o=Te(o,i)}return Fe(o,Ou(o,"euclidean"))}));return e?ss(t,0):t}const GV=U({gramSchmidt_:jV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HV(n,e=!1){if(A(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return kC(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((l,c)=>l*c),s=Fs(q(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],o=[];s.forEach(l=>{const[c,h]=kC(l,e);r.push(c),o.push(h)});const a=q(ss(r,0),n.shape),i=q(ss(o,0),n.shape);return[a,i]}}function kC(n,e=!1){return W.tidy(()=>{A(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let r=Fg(t),o=Mr(n);const a=yl([[1]],[1,1]);let i=Mr(a);const l=t>=s?s:t;for(let c=0;c<l;++c){const h=o,p=i,f=r;[i,o,r]=W.tidy(()=>{const g=tt(o,[c,c],[t-c,1]),y=Ou(g),w=tt(o,[c,c],[1,1]),x=vn(os(w,0),yl([[-1]]),yl([[1]])),v=Te(w,G(x,y)),k=Fe(g,v);k.shape[0]===1?i=Mr(a):i=Wt([a,tt(k,[1,0],[k.shape[0]-1,k.shape[1]])],0);const I=St(Fe(Xe(x,v),y)),N=tt(o,[c,0],[t-c,s]),T=G(I,i),D=nt(i);if(c===0)o=Te(N,Xe(T,Xe(D,N)));else{const F=Te(N,Xe(T,Xe(D,N)));o=Wt([tt(o,[0,0],[c,s]),F],0)}const P=nt(T),z=tt(r,[0,c],[t,r.shape[1]-c]);if(c===0)r=Te(z,Xe(Xe(z,i),P));else{const F=Te(z,Xe(Xe(z,i),P));r=Wt([tt(r,[0,0],[t,c]),F],1)}return[i,o,r]}),Ye([h,p,f])}return!e&&t>s&&(r=tt(r,[0,0],[t,s]),o=tt(o,[0,0],[s,s])),[r,o]})}const qV=U({qr_:HV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Wn;(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Wn||(Wn={}));function KV(n,e,t=Wn.SUM_BY_NONZERO_WEIGHTS){const s=_(n,"losses","computeWeightedLoss");let r=null;e!=null&&(r=_(e,"weights","computeWeightedLoss"));const o=r==null?s:G(s,r);if(t===Wn.NONE)return o;if(t===Wn.SUM)return Ae(o);if(t===Wn.MEAN){if(r==null)return _t(o);{const a=s.size/r.size,i=Fe(Ae(o),Ae(r));return a>1?Fe(i,Me(a)):i}}if(t===Wn.SUM_BY_NONZERO_WEIGHTS){if(r==null)return Fe(Ae(o),Me(s.size));{const a=G(r,Qn(s.shape)),i=ke(Ae(fi(a,Me(0))),"float32");return Fe(Ae(o),i)}}throw Error(`Unknown reduction: ${t}`)}const Io=U({computeWeightedLoss_:KV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XV(n,e,t,s=Wn.SUM_BY_NONZERO_WEIGHTS){const r=_(n,"labels","absoluteDifference"),o=_(e,"predictions","absoluteDifference");let a=null;t!=null&&(a=_(t,"weights","absoluteDifference")),Sn(r.shape,o.shape,"Error in absoluteDifference: ");const i=Xt(Te(r,o));return Io(i,a,s)}const YV=U({absoluteDifference_:XV});function QV(n,e,t,s,r=Wn.SUM_BY_NONZERO_WEIGHTS){const o=_(n,"labels","cosineDistance"),a=_(e,"predictions","cosineDistance");let i=null;s!=null&&(i=_(s,"weights","cosineDistance")),Sn(o.shape,a.shape,"Error in cosineDistance: ");const l=Me(1),c=Te(l,Ae(G(o,a),t,!0));return Io(c,i,r)}const ZV=U({cosineDistance_:QV});function JV(n,e,t,s=Wn.SUM_BY_NONZERO_WEIGHTS){let r=_(n,"labels","hingeLoss");const o=_(e,"predictions","hingeLoss");let a=null;t!=null&&(a=_(t,"weights","hingeLoss")),Sn(r.shape,o.shape,"Error in hingeLoss: ");const i=Me(1);r=Te(G(Me(2),r),i);const l=Cr(Te(i,G(r,o)));return Io(l,a,s)}const eW=U({hingeLoss_:JV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tW(n,e,t,s=1,r=Wn.SUM_BY_NONZERO_WEIGHTS){const o=_(n,"labels","huberLoss"),a=_(e,"predictions","huberLoss");let i=null;t!=null&&(i=_(t,"weights","huberLoss")),Sn(o.shape,a.shape,"Error in huberLoss: ");const l=Me(s),c=Xt(Te(a,o)),h=ha(c,l),p=Te(c,h),f=fe(G(Me(.5),gt(h)),G(l,p));return Io(f,i,r)}const nW=U({huberLoss_:tW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sW(n,e,t,s=1e-7,r=Wn.SUM_BY_NONZERO_WEIGHTS){const o=_(n,"labels","logLoss"),a=_(e,"predictions","logLoss");let i=null;t!=null&&(i=_(t,"weights","logLoss")),Sn(o.shape,a.shape,"Error in logLoss: ");const l=Me(1),c=Me(s),h=St(G(o,ys(fe(a,c)))),p=G(Te(l,o),ys(fe(Te(l,a),c))),f=Te(h,p);return Io(f,i,r)}const rW=U({logLoss_:sW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oW(n,e,t,s=Wn.SUM_BY_NONZERO_WEIGHTS){const r=_(n,"labels","meanSquaredError"),o=_(e,"predictions","meanSquaredError");let a=null;t!=null&&(a=_(t,"weights","meanSquaredError")),Sn(r.shape,o.shape,"Error in meanSquaredError: ");const i=Qg(r,o);return Io(i,a,s)}const aW=U({meanSquaredError_:oW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iW(n,e){const t=_(n,"labels","sigmoidCrossEntropyWithLogits"),s=_(e,"logits","sigmoidCrossEntropyWithLogits");Sn(t.shape,s.shape,"Error in sigmoidCrossEntropyWithLogits: ");const r=Cr(s),o=G(s,t),a=Ih(ns(St(Xt(s))));return fe(Te(r,o),a)}function lW(n,e,t,s=0,r=Wn.SUM_BY_NONZERO_WEIGHTS){let o=_(n,"multiClassLabels","sigmoidCrossEntropy");const a=_(e,"logits","sigmoidCrossEntropy");let i=null;if(t!=null&&(i=_(t,"weights","sigmoidCrossEntropy")),Sn(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),s>0){const c=Me(s),h=Me(1),p=Me(.5);o=fe(G(o,Te(h,c)),G(p,c))}const l=iW(o,a);return Io(l,i,r)}const uW=U({sigmoidCrossEntropy_:lW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cW(n,e,t=-1){if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${t}`);return Hr((r,o,a)=>{const l=$h(o,[t],!0),c=Te(ke(o,"float32"),l);a([r,c]);const h=St(G(c,r));return{value:Ae(h,[t]),gradFunc:(g,y)=>{const[w,x]=y,v=Ut(g.shape,[t]);return[G(q(g,v),Te(ke(w,"float32"),ns(x))),G(q(g,v),Te(ns(x),ke(w,"float32")))]}}})(n,e)}function dW(n,e,t,s=0,r=Wn.SUM_BY_NONZERO_WEIGHTS){let o=_(n,"onehotLabels","softmaxCrossEntropy");const a=_(e,"logits","softmaxCrossEntropy");let i=null;if(t!=null&&(i=_(t,"weights","softmaxCrossEntropy")),Sn(o.shape,a.shape,"Error in softmaxCrossEntropy: "),s>0){const c=Me(s),h=Me(1),p=Me(o.shape[1]);o=fe(G(o,Te(h,c)),Fe(c,p))}const l=cW(o,a);return Io(l,i,r)}const hW=U({softmaxCrossEntropy_:dW});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pW(n,e,t,s){const r=_(n,"indices","sparseFillEmptyRows","int32"),o=_(e,"values","sparseFillEmptyRows"),a=_(t,"denseShape","sparseFillEmptyRows","int32"),i=_(s,"defaultValue","sparseFillEmptyRows",o.dtype);if(r.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${r.shape}`);if(o.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${o.shape}`);if(a.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${a.shape}`);if(i.rank!==0)throw new Error(`Default value should be a scalar but received shape ${i.shape}`);const l={indices:r,values:o,denseShape:a,defaultValue:i},c=W.runKernel(hg,l);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}const fW=U({sparseFillEmptyRows_:pW});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mW(n,e,t){const s=_(n,"inputIndices","sparseReshape","int32"),r=_(e,"inputShape","sparseReshape","int32"),o=_(t,"newShape","sparseReshape","int32");if(s.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${s.shape}`);if(r.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${r.shape}`);if(o.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${o.shape}`);const a={inputIndices:s,inputShape:r,newShape:o},i=W.runKernel(pg,a);return{outputIndices:i[0],outputShape:i[1]}}const gW=U({sparseReshape_:mW});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yW(n,e,t){const s=_(n,"data","sparseSegmentMean"),r=_(e,"indices","sparseSegmentMean","int32"),o=_(t,"segmentIds","sparseSegmentMean","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${r.shape}`);if(o.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${o.shape}`);const a={data:s,indices:r,segmentIds:o};return W.runKernel(fg,a)}const xW=U({sparseSegmentMean_:yW});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bW(n,e,t){const s=_(n,"data","sparseSegmentSum"),r=_(e,"indices","sparseSegmentSum","int32"),o=_(t,"segmentIds","sparseSegmentSum","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${r.shape}`);if(o.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${o.shape}`);const a={data:s,indices:r,segmentIds:o};return W.runKernel(mg,a)}const wW=U({sparseSegmentSum_:bW});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vW(n,e,t,s,r,o,a,i){const l=_(n,"data","stringNGrams","string");if(l.dtype!=="string")throw new Error("Data must be of datatype string");if(l.shape.length!==1)throw new Error(`Data must be a vector, saw: ${l.shape}`);const c=_(e,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const h={separator:t,nGramWidths:s,leftPad:r,rightPad:o,padWidth:a,preserveShortSequences:i},p={data:l,dataSplits:c},f=W.runKernel(bg,p,h);return{nGrams:f[0],nGramsSplits:f[1]}}const kW=U({stringNGrams_:vW});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SW(n,e,t=!0){const s=_(n,"input","stringSplit","string"),r=_(e,"delimiter","stringSplit","string");if(s.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${s.shape}`);if(r.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${r.shape}`);const o={skipEmpty:t},a={input:s,delimiter:r},i=W.runKernel(wg,a,o);return{indices:i[0],values:i[1],shape:i[2]}}const NW=U({stringSplit_:SW});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CW(n,e){const t=_(n,"input","stringToHashBucketFast","string"),s={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const r={input:t};return W.runKernel(vg,r,s)}const IW=U({stringToHashBucketFast_:CW});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $W(n,e,t,s=!0){const r=_(n,"input","staticRegexReplace","string"),o={pattern:e,rewrite:t,replaceGlobal:s};return W.runKernel(fh,{x:r},o)}const TW=U({staticRegexReplace_:$W});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eT={fft:Fh,ifft:$l,rfft:Lh,irfft:Yg},tT={hammingWindow:nV,hannWindow:Y$,frame:Q$,stft:aV},Xs={flipLeftRight:cV,grayscaleToRGB:hV,resizeNearestNeighbor:J$,resizeBilinear:Z$,rgbToGrayscale:fV,rotateWithOffset:gV,cropAndResize:lV,nonMaxSuppression:xV,nonMaxSuppressionAsync:IV,nonMaxSuppressionWithScore:TV,nonMaxSuppressionWithScoreAsync:RV,nonMaxSuppressionPadded:DV,nonMaxSuppressionPaddedAsync:OV,threshold:MV,transform:VV},E1={bandPart:UV,gramSchmidt:GV,qr:qV},nT={absoluteDifference:YV,computeWeightedLoss:Io,cosineDistance:ZV,hingeLoss:eW,huberLoss:nW,logLoss:rW,meanSquaredError:aW,sigmoidCrossEntropy:uW,softmaxCrossEntropy:hW},sT={sparseFillEmptyRows:fW,sparseReshape:gW,sparseSegmentMean:xW,sparseSegmentSum:wW},rT={stringNGrams:kW,stringSplit:NW,stringToHashBucketFast:IW,staticRegexReplace:TW};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EW=new Map,$b=new Map;class Ai{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class Es{constructor(){this.classNameMap={}}static getMap(){return Es.instance==null&&(Es.instance=new Es),Es.instance}static register(e){Es.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function me(n,e,t){A(n.className!=null,()=>"Class being registered does not have the static className property defined."),A(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),A(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const s=t,r=e+">"+s;return Es.register(n),EW.set(r,n),$b.set(n,r),n}function RW(n){return $b.has(n)?$b.get(n):n.className}const AW=Object.freeze(Object.defineProperty({__proto__:null,Serializable:Ai,SerializationMap:Es,getRegisteredName:RW,registerClass:me},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $o extends Ai{minimize(e,t=!1,s){const{value:r,grads:o}=this.computeGradients(e,s);if(s!=null){const a=s.map(i=>({name:i.name,tensor:o[i.name]}));this.applyGradients(a)}else this.applyGradients(o);return Ye(o),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return c$(e,t)}dispose(){this.iterations_!=null&&Ye(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Me(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty($o,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R1 extends $o{static get className(){return"Adadelta"}constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=W.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=W.registeredVariables[s],a=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:re(()=>st(o).variable(a))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:re(()=>st(o).variable(a))});const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const l=this.accumulatedGrads[r].variable,c=this.accumulatedUpdates[r].variable;re(()=>{const h=fe(G(l,this.rho),G(gt(i),1-this.rho)),p=G(Fe(pn(fe(c,this.epsilon)),pn(fe(l,this.epsilon))),i),f=fe(G(c,this.rho),G(gt(p),1-this.rho));l.assign(h),c.assign(f);const g=fe(G(p,-this.learningRate),o);o.assign(g)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Ye(this.accumulatedGrads.map(e=>e.variable)),Ye(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A1 extends $o{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=W.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:re(()=>Ti(o.shape,this.initialAccumulatorValue).variable(!1))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const i=this.accumulatedGrads[r].variable;re(()=>{const l=fe(i,gt(a));i.assign(l);const c=fe(G(Fe(a,pn(fe(l,W.backend.epsilon()))),-this.learningRate),o);o.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Ye(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D1 extends $o{static get className(){return"Adam"}constructor(e,t,s,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],re(()=>{this.accBeta1=Me(t).variable(),this.accBeta2=Me(s).variable()}),r==null&&(this.epsilon=W.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);re(()=>{const s=Te(1,this.accBeta1),r=Te(1,this.accBeta2);t.forEach((o,a)=>{const i=W.registeredVariables[o],l=!1;this.accumulatedFirstMoment[a]==null&&(this.accumulatedFirstMoment[a]={originalName:`${o}/m`,variable:re(()=>st(i).variable(l))}),this.accumulatedSecondMoment[a]==null&&(this.accumulatedSecondMoment[a]={originalName:`${o}/v`,variable:re(()=>st(i).variable(l))});const c=Array.isArray(e)?e[a].tensor:e[o];if(c==null)return;const h=this.accumulatedFirstMoment[a].variable,p=this.accumulatedSecondMoment[a].variable,f=fe(G(h,this.beta1),G(c,1-this.beta1)),g=fe(G(p,this.beta2),G(gt(c),1-this.beta2)),y=Fe(f,s),w=Fe(g,r);h.assign(f),p.assign(g);const x=fe(G(Fe(y,fe(pn(w),this.epsilon)),-this.learningRate),i);i.assign(x)}),this.accBeta1.assign(G(this.accBeta1,this.beta1)),this.accBeta2.assign(G(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Ye(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Ye(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),re(()=>{this.accBeta1.assign(Gr(this.beta1,this.iterations_+1)),this.accBeta2.assign(Gr(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _1 extends $o{static get className(){return"Adamax"}constructor(e,t,s,r=null,o=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],re(()=>{this.iteration=Me(0).variable(),this.accBeta1=Me(t).variable()}),r==null&&(this.epsilon=W.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);re(()=>{const s=Te(1,this.accBeta1),r=Fe(-this.learningRate,fe(G(this.iteration,this.decay),1));t.forEach((o,a)=>{const i=W.registeredVariables[o],l=!1;this.accumulatedFirstMoment[a]==null&&(this.accumulatedFirstMoment[a]={originalName:`${o}/m`,variable:st(i).variable(l)}),this.accumulatedWeightedInfNorm[a]==null&&(this.accumulatedWeightedInfNorm[a]={originalName:`${o}/v`,variable:st(i).variable(l)});const c=Array.isArray(e)?e[a].tensor:e[o];if(c==null)return;const h=this.accumulatedFirstMoment[a].variable,p=this.accumulatedWeightedInfNorm[a].variable,f=fe(G(h,this.beta1),G(c,1-this.beta1)),g=G(p,this.beta2),y=Xt(c),w=Xr(g,y);h.assign(f),p.assign(w);const x=fe(G(Fe(r,s),Fe(f,fe(w,this.epsilon))),i);i.assign(x)}),this.iteration.assign(fe(this.iteration,1)),this.accBeta1.assign(G(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Ye(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Ye(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cy extends $o{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const a=W.registeredVariables[s];re(()=>{const i=fe(G(this.c,o),a);a.assign(i)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Jt(Me(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class O1 extends cy{static get className(){return"Momentum"}constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=Me(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=W.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:re(()=>st(o).variable(!1))});const a=this.accumulations[r].variable,i=Array.isArray(e)?e[r].tensor:e[s];i!=null&&re(()=>{let l;const c=fe(G(this.m,a),i);this.useNesterov?l=fe(G(this.c,fe(i,G(c,this.m))),o):l=fe(G(this.c,c),o),a.assign(c),o.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Ye(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class F1 extends $o{static get className(){return"RMSProp"}constructor(e,t=.9,s=0,r=null,o=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,r==null&&(this.epsilon=W.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=W.registeredVariables[s],a=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:re(()=>st(o).variable(a))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:re(()=>st(o).variable(a))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:re(()=>st(o).variable(a))});const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const l=this.accumulatedMeanSquares[r].variable,c=this.accumulatedMoments[r].variable;re(()=>{const h=fe(G(l,this.decay),G(gt(i),1-this.decay));if(this.centered){const p=this.accumulatedMeanGrads[r].variable,f=fe(G(p,this.decay),G(i,1-this.decay)),g=Fe(G(i,this.learningRate),pn(Te(h,fe(gt(f),this.epsilon)))),y=fe(G(c,this.momentum),g);l.assign(h),p.assign(f),c.assign(y);const w=Te(o,y);o.assign(w)}else{const p=fe(G(l,this.decay),G(gt(i),1-this.decay)),f=fe(G(c,this.momentum),Fe(G(i,this.learningRate),pn(fe(p,this.epsilon))));l.assign(p),c.assign(f);const g=Te(o,f);o.assign(g)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Ye(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Ye(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Ye(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DW=[R1,A1,D1,_1,O1,F1,cy];function _W(){for(const n of DW)me(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OW="model",FW=".json",LW=".weights.bin";function SC(n){return new Promise(e=>setTimeout(e)).then(n)}class gi{constructor(e){if(!oe().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(gi.URL_SCHEME)&&(e=e.slice(gi.URL_SCHEME.length)),(e==null||e.length===0)&&(e=OW),this.modelJsonFileName=e+FW,this.weightDataFileName=e+LW}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const t=Nr.join(e.weightData),s=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],o=j2(e,r),a=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),i=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(i.download=this.modelJsonFileName,i.href=a,await SC(()=>i.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){const l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;l.download=this.weightDataFileName,l.href=s,await SC(()=>l.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:bh(e)}}}}gi.URL_SCHEME="downloads://";class PW{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,t)=>{const s=new FileReader;s.onload=r=>{const o=JSON.parse(r.target.result),a=o.modelTopology;if(a==null){t(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(o.weightsManifest==null){t(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:a});return}const l=Nw(o,c=>this.loadWeights(c));e(l)},s.onerror=r=>t(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),s.readAsText(this.jsonFile)})}loadWeights(e){const t=[],s=[];for(const a of e)t.push(...a.weights),s.push(...a.paths);const r=this.checkManifestAndWeightFiles(e),o=s.map(a=>this.loadWeightsFile(a,r[a]));return Promise.all(o).then(a=>[t,a])}loadWeightsFile(e,t){return new Promise((s,r)=>{const o=new FileReader;o.onload=a=>{const i=a.target.result;s(i)},o.onerror=a=>r(`Failed to weights data from file of path '${e}'.`),o.readAsArrayBuffer(t)})}checkManifestAndWeightFiles(e){const t=[],s=this.weightsFiles.map(o=>hC(o.name)),r={};for(const o of e)o.paths.forEach(a=>{const i=hC(a);if(t.indexOf(i)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${i}'`);if(t.push(i),s.indexOf(i)===-1)throw new Error(`Weight file with basename '${i}' is not provided.`);r[a]=this.weightsFiles[s.indexOf(i)]});if(t.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${t.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}const zW=n=>oe().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(gi.URL_SCHEME)?MW(n.slice(gi.URL_SCHEME.length)):null;Dt.registerSaveRouter(zW);function MW(n="model"){return new gi(n)}function BW(n){return new PW(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NC(n,e,t,s){a(n),t=t??0,s=s??1,i(t,s);let r=0;const o=l=>(l.then(c=>{const h=t+ ++r/n.length*(s-t);return e(h),c}),l);function a(l){A(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function i(l,c){A(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),A(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),A(c>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${c}`)}return Promise.all(n.map(o))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function oT(n,e){e==null&&(e={});const t=e.fetchFunc==null?oe().platform.fetch:e.fetchFunc,s=n.map(p=>t(p,e.requestInit,{isBinary:!0})),i=(e.onProgress==null?await Promise.all(s):await NC(s,e.onProgress,0,.5)).map(p=>p.arrayBuffer());return e.onProgress==null?await Promise.all(i):await NC(i,e.onProgress,.5,1)}function VW(n,e){var t;const s=e.fetchFunc==null?oe().platform.fetch:e.fetchFunc;let r=0,o;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async a=>{for(var i;r<n.length;){o||(o=(await s(n[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:c}=await o.read();if(l){r++,o=void 0,(i=e.onProgress)===null||i===void 0||i.call(e,r/n.length);continue}a.enqueue(c);return}a.close()}})}async function WW(n,e="",t,s){return aT(a=>oT(a,{requestInit:s}))(n,e,t)}function aT(n){return async(e,t="",s)=>{const r=e.map(()=>!1),o={},a=s!=null?s.map(()=>!1):[],i=[];if(e.forEach((g,y)=>{let w=0;g.weights.forEach(x=>{const v="quantization"in x?x.quantization.dtype:x.dtype,k=li[v]*ce(x.shape),I=()=>{r[y]=!0,o[y]==null&&(o[y]=[]),o[y].push({manifestEntry:x,groupOffset:w,sizeBytes:k})};s!=null?s.forEach((N,T)=>{N===x.name&&(I(),a[T]=!0)}):I(),i.push(x.name),w+=k})}),!a.every(g=>g)){const g=s.filter((y,w)=>!a[w]);throw new Error(`Could not find weights in manifest with names: ${g.join(", ")}. 
Manifest JSON has weights with names: ${i.join(", ")}.`)}const l=r.reduce((g,y,w)=>(y&&g.push(w),g),[]),c=[];l.forEach(g=>{e[g].paths.forEach(y=>{const w=t+(t.endsWith("/")?"":"/")+y;c.push(w)})});const h=await n(c),p={};let f=0;return l.forEach(g=>{const y=e[g].paths.length,w=new Nr(h.slice(f,f+y));o[g].forEach(v=>{const k=w.slice(v.groupOffset,v.groupOffset+v.sizeBytes),I=B2(k,[v.manifestEntry]);for(const N in I)p[N]=I[N]}),f+=y}),p}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UW="application/octet-stream",jW="application/json";class L1{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(A(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=oe().platform.fetch,A(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&A(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=j2(e,s);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:jW}),"model.json"),e.weightData!=null){const a=Nr.join(e.weightData);t.body.append("model.weights.bin",new Blob([a],{type:UW}),"model.weights.bin")}const o=await this.fetch(this.path,t);if(o.ok)return{modelArtifactsInfo:bh(e),responses:[o]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${o.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let a=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?a+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":a+=" Please make sure the server is serving valid JSON for this request.",new Error(a)}const s=t.modelTopology,r=t.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return Nw(e,t=>this.loadWeights(t))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),s=wb(e.weightsManifest),r=()=>VW(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=GW(t),o=this.weightPathPrefix||s,a=[],i=[];for(const l of e)for(const c of l.paths)this.weightUrlConverter!=null?i.push(this.weightUrlConverter(c)):a.push(o+c+r);return this.weightUrlConverter&&a.push(...await Promise.all(i)),a}async loadWeights(e){const t=await this.getWeightUrls(e),s=wb(e),r=await oT(t,this.loadOptions);return[s,r]}}L1.URL_SCHEME_REGEX=/^https?:\/\//;function GW(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),s=n.substring(0,e),r=t>e?n.substring(t):"";return[s+"/",r]}function Tb(n){return n.match(L1.URL_SCHEME_REGEX)!=null}const iT=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(s=>Tb(s)):t=Tb(n),t)return P1(n,e)}return null};Dt.registerSaveRouter(iT);Dt.registerLoadRouter(iT);function P1(n,e){return new L1(n,e)}function HW(n,e){return P1(n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zx{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class lT{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}}class qW{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=t=>Promise.resolve(e.save(t)))}}function KW(n,e,t,s){const r=arguments;return new qW(uT(...r))}function uT(n,e,t,s){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new zx(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new zx({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new zx({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:s}))}function XW(n){return new lT(n)}function YW(n){return new lT(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z1=Object.freeze(Object.defineProperty({__proto__:null,CompositeArrayBuffer:Nr,browserFiles:BW,browserHTTPRequest:HW,concatenateArrayBuffers:U2,copyModel:IP,decodeWeights:B2,decodeWeightsStream:W2,encodeWeights:bb,fromMemory:KW,fromMemorySync:uT,getLoadHandlers:hP,getModelArtifactsForJSON:Nw,getModelArtifactsForJSONSync:G2,getModelArtifactsInfoForJSON:bh,getSaveHandlers:H2,getWeightSpecs:wb,http:P1,isHTTPScheme:Tb,listModels:NP,loadWeights:WW,moveModel:$P,registerLoadRouter:dP,registerSaveRouter:cP,removeModel:CP,weightsLoaderFactory:aT,withSaveHandler:XW,withSaveHandlerSync:YW},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QW(n,e,t){const s=_(n,"labels","confusionMatrix"),r=_(e,"predictions","confusionMatrix");A(t==null||t>0&&Number.isInteger(t),()=>`If provided, numClasses must be a positive integer, but got ${t}`),A(s.rank===1,()=>`Expected the rank of labels to be 1, but got ${s.rank}`),A(r.rank===1,()=>`Expected the rank of predictions to be 1, but got ${r.rank}`),A(s.shape[0]===r.shape[0],()=>`Mismatch in the number of examples: ${s.shape[0]} vs. ${r.shape[0]}. Labels and predictions should have the same number of elements.`),A(t>0&&Number.isInteger(t),()=>`numClasses is required to be a positive integer, but got ${t}`);const o=Nl(ke(s,"int32"),t),a=Nl(ke(r,"int32"),t),i=nt(o),l=Xe(i,a);return ke(l,"int32")}const ZW=U({confusionMatrix_:QW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JW=Object.freeze(Object.defineProperty({__proto__:null,confusionMatrix:ZW},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Wa,CC=!1;function cT(n,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let t=!1,s=!1,r=!1,o=!1,a=!1,i=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)s=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)r=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)o=!0;else if(n.getContext!=null)a=!0;else if(typeof ImageBitmap<"u"&&n instanceof ImageBitmap)i=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${n.constructor.name}`);if(Qc(Gf,W.backendName)!=null){const y={pixels:n},w={numChannels:e};return W.runKernel(Gf,y,w)}const[c,h]=r?[n.videoWidth,n.videoHeight]:[n.width,n.height];let p;if(a)p=n.getContext("2d").getImageData(0,0,c,h).data;else if(s||t)p=n.data;else if(o||r||i){if(Wa==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")Wa=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Wa=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Wa.canvas.width=c,Wa.canvas.height=h,Wa.drawImage(n,0,0,c,h),p=Wa.getImageData(0,0,c,h).data}let f;if(e===4)f=new Int32Array(p);else{const y=c*h;f=new Int32Array(y*e);for(let w=0;w<y;w++)for(let x=0;x<e;++x)f[w*e+x]=p[w*4+x]}return b1(f,[h,c,e],"int32")}function eU(n){return n!=null&&n.data instanceof Uint8Array}function tU(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function nU(n){return n!=null&&n.width!==0&&n.height!==0}function sU(n){return tU()&&!(n instanceof ImageBitmap)&&nU(n)&&!eU(n)}async function rU(n,e=3){let t=null;if(oe().getBool("WRAP_TO_IMAGEBITMAP")&&sU(n)){let s;try{s=await createImageBitmap(n,{premultiplyAlpha:"none"})}catch{s=null}s!=null&&s.width===n.width&&s.height===n.height?t=s:t=n}else t=n;return cT(t,e)}function dT(n){if(n.rank!==2&&n.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const e=n.rank===2?1:n.shape[2];if(e>4||e===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${e}`);if(n.dtype!=="float32"&&n.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`)}function oU(n){const e=(n==null?void 0:n.alpha)||1;if(e>1||e<0)throw new Error(`Alpha value ${e} is suppoed to be in range [0 - 1].`)}async function aU(n,e){let t=_(n,"img","toPixels");if(!(n instanceof dt)){const c=t;t=ke(c,"int32"),c.dispose()}dT(t);const[s,r]=t.shape.slice(0,2),o=t.rank===2?1:t.shape[2],a=await t.data(),i=t.dtype==="float32"?255:1,l=new Uint8ClampedArray(r*s*4);for(let c=0;c<s*r;++c){const h=[0,0,0,255];for(let f=0;f<o;f++){const g=a[c*o+f];if(t.dtype==="float32"){if(g<0||g>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${g}.`)}else if(t.dtype==="int32"&&(g<0||g>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${g}.`);o===1?(h[0]=g*i,h[1]=g*i,h[2]=g*i):h[f]=g*i}const p=c*4;l[p+0]=Math.round(h[0]),l[p+1]=Math.round(h[1]),l[p+2]=Math.round(h[2]),l[p+3]=Math.round(h[3])}if(e!=null){CC||Qc(zm,W.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),CC=!0),e.width=r,e.height=s;const c=e.getContext("2d"),h=new ImageData(l,r,s);c.putImageData(h,0,0)}return t!==n&&t.dispose(),l}function iU(n,e,t){let s=_(n,"img","draw");if(!(n instanceof dt)){const a=s;s=ke(a,"int32"),a.dispose()}dT(s),oU(t==null?void 0:t.imageOptions);const r={image:s},o={canvas:e,options:t};W.runKernel(zm,r,o)}const hT=U({fromPixels_:cT}),lU=Object.freeze(Object.defineProperty({__proto__:null,draw:iU,fromPixels:hT,fromPixelsAsync:rU,toPixels:aU},Symbol.toStringTag,{value:"Module"}));function dy(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(ce(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,o=r[r.length-1];let a=1;for(let p=0;p<r.length-1;++p)a*=r[p];const i=n.shape,l=r.slice();l.pop();let c=1;for(let p=o;p<t;++p)c*=i[p],l.push(i[p]);const h=[...ze(n.shape).map(p=>p/c),1].slice(0,o);return[l,a,c,h]}const uU=Object.freeze(Object.defineProperty({__proto__:null,prepareAndValidate:dy},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eb=-2,cU=-1;function M1(n,e,t){const s=n.shape.length;A(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),A(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)A(e[r]+t[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function dU(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function B1(n,e,t){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((e[r]-n[r])/t[r]);return s}function pT(n,e,t,s){const r=[...n];for(let o=r.length;o<s.length;o++)r.push(1);for(let o=0;o<t;o++)o===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function fT(n,e,t){return t<=n?t:t-(e-1)}function mT(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function hU(n,e,t,s,r,o,a,i,l){const c=n.length;let h=new Array(c),p=new Array(c),f=new Array(c);if(e.length&&t>0){const g=e[0],y=t+1;h=gT(a,g,y,s,n),p=yT(i,g,y,r,n),f=pT(o,g,y,n)}else for(let g=0;g<c;g++)h[g]=bT(a,s,o,n,g,l),p[g]=wT(i,r,o,n,g,l),f[g]=xT(o,g,l);return{begin:h,end:p,strides:f}}function gT(n,e,t,s,r){const o=[...r],a=mT(t,e);for(let i=0;i<o.length;i++)if(a.indexOf(i)>-1)o[i]=0;else{const l=fT(e,t,i);let c=s[l];n&1<<l&&(c=0),o[i]=c}return o}function yT(n,e,t,s,r){const o=[...r],a=mT(t,e);for(let i=0;i<o.length;i++)if(a.indexOf(i)>-1)o[i]=Number.MAX_SAFE_INTEGER;else{const l=fT(e,t,i);let c=s[l];n&1<<l&&(c=Number.MAX_SAFE_INTEGER),o[i]=c}for(let i=0;i<o.length;i++){const l=r[i];o[i]<0&&(o[i]+=l),o[i]=aa(0,o[i],r[i])}return o}function xT(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function bT(n,e,t,s,r,o){let a=e[r];const i=t[r]||1;(n&1<<r||o&1<<r||a==null)&&(i>0?a=Number.MIN_SAFE_INTEGER:a=Number.MAX_SAFE_INTEGER);const l=s[r];return a<0&&(a+=l),a=aa(0,a,l-1),a}function wT(n,e,t,s,r,o){let a=e[r];const i=t[r]||1;(n&1<<r||o&1<<r||a==null)&&(i>0?a=Number.MAX_SAFE_INTEGER:a=Number.MIN_SAFE_INTEGER);const l=s[r];return a<0&&(a+=l),i>0?a=aa(0,a,l):a=aa(-1,a,l-1),a}function V1(n,e,t){let s=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){s=r;break}for(let r=s+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function W1(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function hy(n,e,t){let s;const r=n.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(a=>{A(a!==-1,()=>"slice() does not support negative begin indexing.")});let o;return t==null?o=new Array(r).fill(-1):typeof t=="number"?o=[t,...new Array(r-1).fill(-1)]:t.length<r?o=t.concat(new Array(r-t.length).fill(-1)):o=t,o=o.map((a,i)=>a>=0?a:(A(a===-1,()=>`Negative size values should be exactly -1 but got ${a} for the slice() size at index ${i}.`),n.shape[i]-s[i])),[s,o]}function U1(n,e,t,s,r,o,a,i,l){let c;if(s==null?(c=new Array(e.length),c.fill(1)):c=s,a!=null&&(a&a-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let h=!1;const p={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:c.slice(),beginMask:r,endMask:o,ellipsisMask:a,newAxisMask:i,shrinkAxisMask:l};for(let I=0;I<p.dims;I++)h&&(1<<I&i)!==0&&p.numAddAxisAfterEllipsis++,1<<I&a&&(h=!0);h||(p.ellipsisMask|=1<<p.dims,p.dims++);const f={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};pU(p,f);let g=!0,y=!0,w=!0;const x=[],v=[];for(let I=0;I<n.length;++I){if(f.strides[I]===0)throw Error(`strides[${I}] must be non-zero`);const N=!!(f.shrinkAxisMask&1<<I),T=n[I];if(T===-1){x.push(N?1:-1);continue}const D=[f.beginMask&1<<I,f.endMask&1<<I],P=[f.strides[I]>0?0:-1,f.strides[I]>0?T:T-1];if(N&&f.strides[I]<=0)throw Error("only stride 1 allowed on non-range indexing.");w=w&&f.strides[I]===1;const z=!!(f.beginMask&1<<I&&f.endMask&1<<I);if(f.beginValid&&f.endValid){if(N){const j=f.begin[I]<0?T+f.begin[I]:f.begin[I];if(f.begin[I]=j,f.end[I]=f.begin[I]+1,j<0||j>=T)throw Error(`slice index ${f.begin[I]} of dimension ${I} out of bounds.`)}else f.begin[I]=IC(f.begin[I],0,f.strides[I],T,D,P),f.end[I]=IC(f.end[I],1,f.strides[I],T,D,P);const E=f.strides[I]===1&&f.begin[I]===0&&f.end[I]===T;g=g&&E,y=y&&(I===0&&f.strides[I]===1||E)}else g=g&&f.strides[I]===1&&z,y=y&&(I===0&&f.strides[I]===1||z);let F,L=!1;if(f.beginValid&&f.endValid?(F=f.end[I]-f.begin[I],L=!0):N?(F=1,L=!0):z&&T>=0&&(f.strides[I]<0?F=-T:F=T,L=!0),L){let E;F===0||F<0!=f.strides[I]<0?E=0:E=Math.trunc(F/f.strides[I])+(F%f.strides[I]!==0?1:0),x.push(E)}else x.push(-1)}for(let I=0;I<f.finalShapeGatherIndices.length;++I){const N=f.finalShapeGatherIndices[I];N>=0?v.push(x[N]):N===Eb&&v.push(1)}return{finalShapeSparse:v.filter((I,N)=>f.finalShapeGatherIndices[N]!==Eb),finalShape:v,isIdentity:g,sliceDim0:y,isSimpleSlice:w,begin:f.begin,end:f.end,strides:f.strides}}function pU(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(Eb),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(cU),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function IC(n,e,t,s,r,o){if(r[e])return t>0?o[e]:o[e+1&1];{const a=n<0?s+n:n;return a<o[0]?o[0]:a>o[1]?o[1]:a}}const vT=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:M1,computeFlatOffset:W1,computeOutShape:B1,getNormalizedAxes:hU,isSliceContinous:V1,maskToAxes:dU,parseSliceParams:hy,sliceInfo:U1,startForAxis:bT,startIndicesWithElidedDims:gT,stopForAxis:wT,stopIndicesWithElidedDims:yT,stridesForAxis:xT,stridesWithElidedDims:pT},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. */const fU="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kT{static sgd(e){return new cy(e)}static momentum(e,t,s=!1){return new O1(e,t,s)}static rmsprop(e,t=.9,s=0,r=null,o=!1){return new F1(e,t,s,r,o)}static adam(e=.001,t=.9,s=.999,r=null){return new D1(e,t,s,r)}static adadelta(e=.001,t=.95,s=null){return new R1(e,t,s)}static adamax(e=.002,t=.9,s=.999,r=null,o=0){return new _1(e,t,s,r,o)}static adagrad(e,t=.1){return new A1(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qa=kT;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mU=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function j1(){return new Promise(n=>mU(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G1(n,e){const t=n[0].length;n.forEach((r,o)=>{A(r.length===t,()=>`Error in concat${t}D: rank of tensors[${o}] must be the same as the rank of the rest (${t})`)}),A(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((r,o)=>{for(let a=0;a<t;a++)A(a===e||r[a]===s[a],()=>`Error in concat${t}D: Shape of tensors[${o}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${o}.`)})}function Br(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var gr;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(gr||(gr={}));function ST(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let r=1;r<t.length;++r){const o=t[r],a=s[s.length-t.length+r],i=s[a];if(o>=0)if(i>=0){if(i!==o)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${o} but shape[${r+n}] = ${i}`)}else s[a]=o}return s}function NT(n){const e={FIRST_DIM_SIZE:gr.FIRST_DIM_SIZE,VALUE_ROWIDS:gr.VALUE_ROWIDS,ROW_LENGTHS:gr.ROW_LENGTHS,ROW_SPLITS:gr.ROW_SPLITS,ROW_LIMITS:gr.ROW_LIMITS,ROW_STARTS:gr.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function CT(n){return n.length===0?0:n[0]===gr.FIRST_DIM_SIZE?n.length-1:n.length}function IT(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(t,s-1);++r){const o=n[r],a=e[r+1];if(o>=0&&a>=0&&o!==1&&o!==a)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${o} but ragged tensor input.flatValues.shape[${r-n.length}] = ${a}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H1=30;function py(n){return n<=H1?n:Wf(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q1(n,e,t){const s=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ph(n,e,t,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const o=e.length;for(let a=0;a<o;++a)r=r.concat([n[a+1]/e[a],e[a]]);r=r.concat(n.slice(o+1))}return r}function zh(n,e,t=!0){const s=[];if(t){s.push(e);for(let r=e+1;r<n;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],o=[];for(let a=1;a<n;++a)a>=e*2+1||a%2===1?o.push(a):r.push(a);s.push(...r),s.push(0),s.push(...o)}return s}function Mh(n,e,t,s=!0){const r=[];s?r.push(n[0]/t):r.push(n[0]*t);for(let o=1;o<n.length;++o)o<=e.length?s?r.push(e[o-1]*n[o]):r.push(n[o]/e[o-1]):r.push(n[o]);return r}function K1(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function X1(n,e,t){const s=n.slice(0,1);for(let r=0;r<t;++r)s.push(n[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fy=1.7580993408473768,my=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y1=.3275911,Q1=.254829592,Z1=-.284496736,J1=1.421413741,ev=-1.453152027,tv=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yo(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function $T(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function TT(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function ET(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function nv(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function RT(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function AT(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const o=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(o),s[r]=Math.sin(o)}return{real:t,imag:s}}function DT(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),r=Math.cos(s),o=Math.sin(s);return{real:r,imag:o}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mx="->",gU=/->/g,$C=",",TC="...";function sv(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(gU,"").length)/Mx.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${Mx}").`);const[s,r]=n.split(Mx);A(s.indexOf(TC)===-1,()=>`The ellipsis notation ("${TC}") is not supported yet.`);const o=s.split($C),a=o.length;if(e!==a)throw new Error(`Expected ${a} input tensors, received ${e}`);if(a>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const i=[];for(let f=0;f<r.length;++f){const g=r[f];if(!o.some(y=>y.indexOf(g)!==-1))throw new Error(`Output subscripts contain the label ${g} not present in the input subscripts.`);i.indexOf(g)===-1&&i.push(g)}for(let f=0;f<s.length;++f){const g=s[f];i.indexOf(g)===-1&&g!==$C&&i.push(g)}const l=new Array(o.length);for(let f=0;f<a;++f){if(new Set(o[f].split("")).size!==o[f].length)throw new Error(`Found duplicate axes in input component ${o[f]}. Support for duplicate axes in input is not implemented yet.`);l[f]=[];for(let g=0;g<o[f].length;++g)l[f].push(i.indexOf(o[f][g]))}const c=i.length,h=r.length,p=[];for(let f=h;f<c;++f)p.push(f);return{allDims:i,summedDims:p,idDims:l}}function rv(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const s=[];for(let r=0;r<n;++r)t[r]===-1&&s.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:s}}function ov(n,e,t){const s=new Array(n);for(let r=0;r<t.length;++r){const o=t[r].shape;for(let a=0;a<e[r].length;++a)s[e[r][a]]===void 0?s[e[r][a]]=o[a]:A(s[e[r][a]]===o[a],()=>`Expected dimension ${s[e[r][a]]} at axis ${a} of input shaped ${JSON.stringify(o)}, but got dimension ${o[a]}`)}}function av(n,e){const t=n,s=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let a=0;a<r;++a)s.push([]);const o=[];for(let a=0;a<t.length;++a){const i=t[a],l=yU(e,i);for(const c of l)o.indexOf(c)===-1&&(s[a].push(c),o.push(c))}return{path:t,steps:s}}function iv(n){return n.every((e,t)=>e===t)}function yU(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function lv(n,e,t=0){let s=[];if(typeof e=="number")A(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((a,i)=>(i===-1&&(a+=1),a),0);A(r<=1,()=>"There should be only one negative value in split array.");const o=e.indexOf(-1);if(o!==-1){const a=e.reduce((i,l)=>l>0?i+l:i);e[o]=n.shape[t]-a}A(n.shape[t]===e.reduce((a,i)=>a+i),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _T(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function OT(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function FT(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LT(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function PT(n,e){return`size ${n} must be non-negative, not ${e}`}function zT(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function MT(n,e){const t=ce(n),s=ce(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function BT(n,e){const t=ce(n),s=ce(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rb(){return"segment ids must be >= 0"}function VT(){return"segment ids are not increasing"}function WT(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function UT(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jT(n,e){let t=!1,s;for(n<=H1?(s=n,t=!0):s=Wf(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=Wf(n,s+1);return s}function GT(n,e,t){const s=[],r=n.length;for(let o=0;o<r;o++)o!==e?s.push(n[o]):s.push(t);return s}function uv(n,e,t,s){const r=e.shape.length,o=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>o)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${o}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let p=0;p<s;++p)if(n.shape[p]!==e.shape[p])throw new Error(`x.shape[${p}]: ${n.shape[p]} should be equal to indices.shape[${p}]: ${e.shape[p]}.`);const a=n.shape[t],i=[];let l=1,c=1,h=1;for(let p=0;p<s;++p)i.push(n.shape[p]),l*=n.shape[p];for(let p=s;p<t;p++)i.push(n.shape[p]),c*=n.shape[p];for(let p=s;p<r;p++)i.push(e.shape[p]);for(let p=t+1;p<o;p++)i.push(n.shape[p]),h*=n.shape[p];return{batchSize:l,sliceSize:h,outerSize:c,dimSize:a,outputShape:i}}const xU=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:uv,computeOutShape:GT,segOpComputeOptimalWindowSize:jT},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xo(n){try{return n.map(e=>fo(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function HT(n){return n.map(e=>zr(e))}const qT=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:Q1,ERF_A2:Z1,ERF_A3:J1,ERF_A4:ev,ERF_A5:tv,ERF_P:Y1,PARALLELIZE_THRESHOLD:H1,get RowPartitionType(){return gr},SELU_SCALE:my,SELU_SCALEALPHA:fy,applyActivation:oy,assertAndGetBroadcastShape:He,assertAxesAreInnerMostDims:Cn,assertParamsConsistent:G1,assignToTypedArray:RT,axesAreInnerMostDims:Zw,calculateShapes:Na,checkEinsumDimSizes:ov,checkPadOnDimRoundingMode:Gn,combineLocations:i$,combineRaggedTensorToTensorShapes:ST,complexWithEvenIndex:TT,complexWithOddIndex:ET,computeConv2DInfo:fn,computeConv3DInfo:wa,computeDefaultPad:Ow,computeDilation2DInfo:wh,computeOptimalWindowSize:py,computeOutAndReduceShapes:mn,computeOutShape:Br,computePool2DInfo:er,computePool3DInfo:vo,convertConv2DDataFormat:ko,decodeEinsumEquation:sv,eitherStridesOrDilationsAreOne:Nn,expandShapeToKeepDim:Ut,exponent:DT,exponents:AT,fromStringArrayToUint8:HT,fromUint8ToStringArray:xo,getAxesPermutation:Lt,getBroadcastDims:pi,getComplexWithIndex:nv,getEinsumComputePath:av,getEinsumPermutation:rv,getFusedBiasGradient:ry,getFusedDyActivation:sy,getImageCenter:q1,getInnerMostAxes:jt,getPermuted:zh,getRaggedRank:CT,getReductionAxes:Qt,getReshaped:Ph,getReshapedPermuted:Mh,getRowPartitionTypesHelper:NT,getSliceBeginCoords:K1,getSliceSize:X1,getSparseFillEmptyRowsIndicesDenseShapeMismatch:_T,getSparseFillEmptyRowsNegativeIndexErrorMessage:OT,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:FT,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:zT,getSparseReshapeInputOutputMismatchErrorMessage:BT,getSparseReshapeInputOutputMultipleErrorMessage:MT,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:LT,getSparseReshapeNegativeOutputDimErrorMessage:PT,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:UT,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Rb,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:VT,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:WT,getUndoAxesPermutation:va,isIdentityPermutation:iv,log:uL,mergeRealAndImagArrays:yo,prepareAndValidate:dy,prepareSplitSize:lv,segment_util:xU,shouldFuse:ay,slice_util:vT,splitRealAndImagArrays:$T,stridesOrDilationsArePositive:hi,tupleValuesAreOne:ca,upcastType:Jn,validateDefaultValueShape:IT,validateInput:Zg,validateUpdateShape:w1,warn:Ts},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bU=Object.freeze(Object.defineProperty({__proto__:null,nonMaxSuppressionV3Impl:iy,nonMaxSuppressionV4Impl:ly,nonMaxSuppressionV5Impl:uy,whereImpl:ty},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */_W();const wU=Object.freeze(Object.defineProperty({__proto__:null,Abs:md,Acos:Ll,Acosh:Pl,AdadeltaOptimizer:R1,AdagradOptimizer:A1,AdamOptimizer:D1,AdamaxOptimizer:_1,Add:$i,AddN:gd,All:vm,Any:km,ArgMax:yd,ArgMin:xd,Asin:zl,Asinh:Ml,Atan:Bl,Atan2:Wl,Atanh:Vl,AvgPool:bd,AvgPool3D:wd,AvgPool3DGrad:Nm,AvgPoolGrad:Sm,BatchMatMul:vd,BatchToSpaceND:kd,Bincount:Cm,BitwiseAnd:Sd,BroadcastArgs:Im,BroadcastTo:S2,Cast:Ul,Ceil:jl,ClipByValue:Gl,Complex:$m,ComplexAbs:Nd,Concat:Cd,Conv2D:Id,Conv2DBackpropFilter:Tm,Conv2DBackpropInput:$d,Conv3D:Td,Conv3DBackpropFilterV2:Em,Conv3DBackpropInputV2:Rm,Cos:Hl,Cosh:ql,CropAndResize:Dm,Cumprod:Am,Cumsum:Ed,DataStorage:uw,DenseBincount:_m,DepthToSpace:Om,DepthwiseConv2dNative:Rd,DepthwiseConv2dNativeBackpropFilter:Fm,DepthwiseConv2dNativeBackpropInput:Lm,Diag:Pm,Dilation2D:Ad,Dilation2DBackpropFilter:jf,Dilation2DBackpropInput:Uf,Draw:zm,get ENV(){return fw},Einsum:Mm,Elu:Xl,EluGrad:Bm,Environment:v2,Equal:Dd,Erf:Yl,Exp:Ql,ExpandDims:_d,Expm1:Zl,FFT:Vm,Fill:Wm,FlipLeftRight:Um,Floor:Jl,FloorDiv:eu,FromPixels:Gf,FusedBatchNorm:Od,FusedConv2D:Kc,FusedDepthwiseConv2D:Xc,GatherNd:jm,GatherV2:Fd,Greater:Ld,GreaterEqual:tu,IFFT:Gm,Identity:nu,Imag:Hm,IsFinite:su,IsInf:ru,IsNan:ou,KernelBackend:xm,LRN:Ud,LRNGrad:Km,LeakyRelu:Pd,Less:zd,LessEqual:Md,LinSpace:qm,Log:au,Log1p:iu,LogSoftmax:N2,LogicalAnd:Bd,LogicalNot:Vd,LogicalOr:Wd,LogicalXor:rL,LowerBound:oL,MatrixBandPart:aL,Max:jd,MaxPool:Gd,MaxPool3D:Hd,MaxPool3DGrad:Ym,MaxPoolGrad:Xm,MaxPoolWithArgmax:Qm,Maximum:lu,Mean:qd,Min:Kd,Minimum:uu,MirrorPad:Xd,Mod:cu,MomentumOptimizer:O1,Multinomial:Zm,Multiply:du,Neg:Yd,NonMaxSuppressionV3:Jm,NonMaxSuppressionV4:eg,NonMaxSuppressionV5:tg,NotEqual:Qd,OP_SCOPE_SUFFIX:ww,OneHot:Jd,OnesLike:Zd,Optimizer:$o,OptimizerConstructors:kT,Pack:eh,PadV2:th,Pool:iL,Pow:hu,Prelu:nh,Prod:sh,RMSPropOptimizer:F1,RaggedGather:ng,RaggedRange:sg,RaggedTensorToTensor:rg,Range:og,get Rank(){return hb},Real:ag,RealDiv:Kl,Reciprocal:pu,get Reduction(){return Wn},Relu:fu,Relu6:mu,Reshape:rh,ResizeBilinear:ah,ResizeBilinearGrad:lg,ResizeNearestNeighbor:oh,ResizeNearestNeighborGrad:ig,Reverse:ih,RotateWithOffset:Cg,Round:gu,Rsqrt:yu,SGDOptimizer:cy,ScatterNd:ug,SearchSorted:dg,Select:lh,Selu:xu,Sigmoid:ku,Sign:vu,Sin:bu,Sinh:wu,Slice:uh,Softmax:ph,Softplus:Su,SpaceToBatchND:dh,SparseFillEmptyRows:hg,SparseReshape:pg,SparseSegmentMean:fg,SparseSegmentSum:mg,SparseToDense:gg,SplitV:hh,Sqrt:Nu,Square:yg,SquaredDifference:Cu,StaticRegexReplace:fh,Step:Ru,StridedSlice:xg,StringNGrams:bg,StringSplit:wg,StringToHashBucketFast:vg,Sub:Iu,Sum:ch,Tan:$u,Tanh:Tu,Tensor:dt,TensorBuffer:Yt,TensorScatterUpdate:cg,Tile:Eu,TopK:kg,Transform:Sg,Transpose:si,Unique:Ng,Unpack:mh,UnsortedSegmentSum:gh,UpperBound:lL,Variable:Zc,ZerosLike:yh,_FusedMatMul:qc,abs:Xt,acos:Iw,acosh:$w,add:fe,addN:e$,all:Eg,any:ed,argMax:di,argMin:Tw,asin:Ew,asinh:Rw,atan:Aw,atan2:Dw,atanh:_w,avgPool:vh,avgPool3d:Fw,backend:kw,backend_util:qT,basicLSTMCell:t$,batchNorm:Au,batchNorm2d:Lw,batchNorm3d:Pw,batchNorm4d:zw,batchToSpaceND:kh,bincount:Mw,bitwiseAnd:n$,booleanMaskAsync:B$,broadcastArgs:s$,broadcastTo:ri,broadcast_util:Wz,browser:lU,buffer:qe,cast:ke,ceil:Bw,clipByValue:ts,clone:Mr,complex:mo,concat:Wt,concat1d:Vw,concat2d:Ww,concat3d:Uw,concat4d:jw,conv1d:Rg,conv2d:go,conv2dTranspose:Ag,conv3d:Hw,conv3dTranspose:qw,copyRegisteredKernels:hL,cos:Sh,cosh:Dg,cosineWindow:ny,cumprod:sd,cumsum:_g,customGrad:Hr,denseBincount:qf,deprecationWarn:GL,depthToSpace:Kw,depthwiseConv2d:Du,device_util:ML,diag:o$,dilation2d:Xw,disableDeprecationWarnings:jL,dispose:Ye,disposeVariables:HL,div:Fe,divNoNan:Yw,dot:Qw,dropout:C1,einsum:Xa,elu:_u,enableDebugMode:UL,enableProdMode:WL,enclosingPowerOfTwo:I1,engine:fr,ensureShape:a$,env:oe,equal:Js,erf:Og,euclideanNorm:Jw,exp:ns,expandDims:An,expm1:e1,eye:Fg,fft:Fh,fill:Ti,findBackend:ZL,findBackendFactory:JL,floor:Fu,floorDiv:Tg,fused:X$,gather:Lu,gatherND:j$,gather_util:uU,getBackend:M2,getGradient:cb,getKernel:Qc,getKernelsForBackend:Hf,grad:C4,grads:I4,greater:os,greaterEqual:So,ifft:$l,imag:Nh,image:Xs,inTopKAsync:G$,io:z1,irfft:Yg,isFinite:t1,isInf:n1,isNaN:s1,keep:Jt,kernel_impls:bU,leakyRelu:Ch,less:Sl,lessEqual:ka,linalg:E1,linspace:u$,localResponseNormalization:r1,log:ys,log1p:Ih,logSigmoid:o1,logSoftmax:Pg,logSumExp:$h,logicalAnd:wr,logicalNot:Th,logicalOr:zg,logicalXor:a1,losses:nT,lowerBound:d$,matMul:Xe,math:JW,max:_s,maxPool:Eh,maxPool3d:i1,maxPoolWithArgmax:h$,maximum:Xr,mean:_t,memory:xb,meshgrid:p$,min:kl,minimum:ha,mirrorPad:l1,mod:u1,moments:Rh,movingAverage:V$,mul:G,multiRNNCell:f$,multinomial:m$,neg:St,nextFrame:j1,norm:Ou,notEqual:fi,oneHot:Nl,ones:Qn,onesLike:xs,op:U,outerProduct:g$,pad:No,pad1d:y$,pad2d:x$,pad3d:b$,pad4d:w$,pool:c1,pow:Gr,prelu:Dh,print:Cw,prod:d1,profile:qL,raggedGather:v$,raggedRange:k$,raggedTensorToTensor:S$,rand:N$,randomGamma:$$,randomNormal:Vg,randomStandardNormal:T$,randomUniform:Sa,randomUniformInt:E$,range:mi,ready:YL,real:Cl,reciprocal:m1,registerBackend:vw,registerGradient:C2,registerKernel:Ig,relu:Cr,relu6:Wg,removeBackend:QL,reshape:q,reverse:Os,reverse1d:R$,reverse2d:A$,reverse3d:D$,reverse4d:_$,rfft:Lh,round:Ug,rsqrt:jg,scalar:Me,scatterND:W$,scatter_util:RB,searchSorted:Mg,selu:Gg,separableConv2d:Hg,serialization:AW,setBackend:XL,setPlatform:eP,setdiff1dAsync:O$,sigmoid:xr,sign:g1,signal:tT,sin:qg,sinh:Kg,slice:tt,slice1d:_h,slice2d:Xg,slice3d:Oh,slice4d:Il,slice_util:vT,softmax:Pu,softplus:Ei,spaceToBatchND:Ah,sparse:sT,sparseToDense:U$,spectral:eT,split:Zn,sqrt:pn,square:gt,squaredDifference:Qg,squeeze:Co,stack:ss,step:Ri,stridedSlice:y1,string:rT,sub:Te,sum:Ae,sumOutType:$g,tan:x1,tanh:da,tensor:Zs,tensor1d:Dn,tensor2d:yl,tensor3d:b1,tensor4d:F$,tensor5d:L$,tensor6d:P$,tensorScatterUpdate:z$,tensor_util:OL,test_util:UM,tidy:re,tile:Rs,time:KL,topk:v1,train:qa,transpose:nt,truncatedNormal:Jg,unique:k1,unregisterGradient:dL,unregisterKernel:cL,unsortedSegmentSum:ey,unstack:Fs,upcastType:Jn,upperBound:M$,util:vL,valueAndGrad:$4,valueAndGrads:T4,variable:S1,variableGrads:c$,version_core:fU,where:vn,whereAsync:N1,zeros:Vt,zerosLike:st},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vU=oe();vU.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var fs;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(fs||(fs={}));var EC;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(EC||(EC={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kU={};function KT(n){return kU[n]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $(n,e,t,s,r){const o=e.inputParams[n];if(o&&o.inputIndexStart!==void 0){const i=o.inputIndexStart,l=o.inputIndexEnd===0?void 0:o.inputIndexEnd===void 0?i+1:o.inputIndexEnd,c=i<0?e.inputNames.length+i:i;if(o.type==="tensor")return bn(e.inputNames[c],t,s,r);if(o.type==="tensors"){const f=e.inputs.slice(i,l);return e.inputNames.slice(i,l).filter((y,w)=>{var x;return((x=f[w])===null||x===void 0?void 0:x.op)!=="NoOp"}).map(y=>bn(y,t,s,r))}const h=bn(e.inputNames[c],t,s,r),p=h.dataSync();return o.type==="number"?p[0]:Ds(h.shape,p)}const a=e.attrParams[n];return a&&a.value}function bn(n,e,t,s){const[r,o]=ms(n,t);if(s!=null){const i=s.getHashTableHandleByName(r);if(i!=null)return i}const a=t.currentContextIds.find(i=>!!e[Kf(r,i)]);return a!==void 0?e[Kf(r,a)][o]:void 0}function RC(n,e,t){return e[Kf(n,t.currentContextId)]}function io(n,e){const[t,s,r]=ms(n,e);return[Kf(t,e&&e.currentContextId),s,r]}function Kf(n,e){return e?`${n}-${e}`:n}function ms(n,e){if(n==="")return["",0,void 0];const t=e!=null&&e.parseNodeNameCache!=null;if(t){const o=e.parseNodeNameCache.get(n);if(o!=null)return o}const s=n.split(":");let r;if(s.length===1)r=[n,0,void 0];else{const o=s[0],a=s.length===3?s[1]:void 0,i=Number(s[s.length-1]);r=[o,i,a]}return t&&e.parseNodeNameCache.set(n,r),r}function Lf(n,e,t){let s=$("pad",n,e,t);if(s==="explicit"){s=$("explicitPaddings",n,e,t);const r=[[0,0],[0,0],[0,0],[0,0]];for(let o=0;o<4;o++)r[o][0]=s[o*2],r[o][1]=s[o*2+1];return r}return s}function lo(n){return n.kept?n:Mr(n)}/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SU=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],NU=Object.freeze(Object.defineProperty({__proto__:null,json:SU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CU=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],IU=Object.freeze(Object.defineProperty({__proto__:null,json:CU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $U=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],TU=Object.freeze(Object.defineProperty({__proto__:null,json:$U},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EU=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],RU=Object.freeze(Object.defineProperty({__proto__:null,json:EU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AU=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],DU=Object.freeze(Object.defineProperty({__proto__:null,json:AU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _U=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],OU=Object.freeze(Object.defineProperty({__proto__:null,json:_U},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FU=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],LU=Object.freeze(Object.defineProperty({__proto__:null,json:FU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PU=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],zU=Object.freeze(Object.defineProperty({__proto__:null,json:PU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MU=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],BU=Object.freeze(Object.defineProperty({__proto__:null,json:MU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VU=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],WU=Object.freeze(Object.defineProperty({__proto__:null,json:VU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UU=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],jU=Object.freeze(Object.defineProperty({__proto__:null,json:UU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GU=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],HU=Object.freeze(Object.defineProperty({__proto__:null,json:GU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qU=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],KU=Object.freeze(Object.defineProperty({__proto__:null,json:qU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XU=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],YU=Object.freeze(Object.defineProperty({__proto__:null,json:XU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QU=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],ZU=Object.freeze(Object.defineProperty({__proto__:null,json:QU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JU=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],ej=Object.freeze(Object.defineProperty({__proto__:null,json:JU},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tj=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],nj=Object.freeze(Object.defineProperty({__proto__:null,json:tj},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sj=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],rj=Object.freeze(Object.defineProperty({__proto__:null,json:sj},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oj=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],aj=Object.freeze(Object.defineProperty({__proto__:null,json:oj},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AC{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[NU,IU,TU,RU,DU,OU,LU,zU,BU,WU,jU,HU,KU,YU,ZU,ej,nj,rj,aj],t=[].concat(...e.map(s=>s.json));this.opMappers=t.reduce((s,r)=>(s[r.tfOpName]=r,s),{})}transformGraph(e,t={}){const s=e.node,r=[],o=[],a=[],i=s.reduce((w,x)=>(w[x.name]=this.mapNode(x),x.op.startsWith("Placeholder")?r.push(w[x.name]):x.op==="Const"?o.push(w[x.name]):(x.input==null||x.input.length===0)&&a.push(w[x.name]),w),{});let l=[];const c=[];let h={},p={};t!=null&&(h=this.mapSignatureEntries(t.inputs),p=this.mapSignatureEntries(t.outputs));const f=Object.keys(i);f.forEach(w=>{const x=i[w];x.inputNames.forEach((v,k)=>{const[I,,N]=io(v),T=i[I];if(T.outputs!=null){const D=T.outputs.indexOf(N);if(D!==-1){const P=`${I}:${D}`;x.inputNames[k]=P}}x.inputs.push(T),T.children.push(x)})}),Object.keys(p).length===0?f.forEach(w=>{const x=i[w];x.children.length===0&&c.push(x)}):Object.keys(p).forEach(w=>{const[x]=io(w),v=i[x];v!=null&&(v.signatureKey=p[w],c.push(v))}),Object.keys(h).length>0?Object.keys(h).forEach(w=>{const[x]=io(w),v=i[x];v&&(v.signatureKey=h[w],l.push(v))}):l=r;let g={};e.library!=null&&e.library.function!=null&&(g=e.library.function.reduce((w,x)=>(w[x.signature.name]=this.mapFunction(x),w),{}));const y={nodes:i,inputs:l,outputs:c,weights:o,placeholders:r,signature:t,functions:g};return a.length>0&&(y.initNodes=a),y}mapSignatureEntries(e){return Object.keys(e||{}).reduce((t,s)=>(t[e[s].name]=s,t),{})}mapNode(e){const t=KT(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});const s={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(r=>r.startsWith("^")?r.slice(1):r),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return t.inputs!=null&&(s.inputParams=t.inputs.reduce((r,o)=>(r[o.name]={type:o.type,inputIndexStart:o.start,inputIndexEnd:o.end},r),{})),t.attrs!=null&&(s.attrParams=t.attrs.reduce((r,o)=>{const a=o.type;let i;switch(o.type){case"string":i=Ab(e.attr,o.tfName,o.defaultValue),i===void 0&&o.tfDeprecatedName&&(i=Ab(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"string[]":i=zb(e.attr,o.tfName,o.defaultValue),i===void 0&&o.tfDeprecatedName&&(i=zb(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"number":i=_b(e.attr,o.tfName,o.defaultValue||0),i===void 0&&o.tfDeprecatedName&&(i=_b(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"number[]":i=Pb(e.attr,o.tfName,o.defaultValue),i===void 0&&o.tfDeprecatedName&&(i=Pb(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"bool":i=Db(e.attr,o.tfName,o.defaultValue),i===void 0&&o.tfDeprecatedName&&(i=Db(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"bool[]":i=Bb(e.attr,o.tfName,o.defaultValue),i===void 0&&o.tfDeprecatedName&&(i=Bb(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"shape":i=Lb(e.attr,o.tfName,o.defaultValue),i===void 0&&o.tfDeprecatedName&&(i=Lb(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"shape[]":i=Mb(e.attr,o.tfName,o.defaultValue),i===void 0&&o.tfDeprecatedName&&(i=Mb(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"dtype":i=Ob(e.attr,o.tfName,o.defaultValue),i===void 0&&o.tfDeprecatedName&&(i=Ob(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"dtype[]":i=Fb(e.attr,o.tfName,o.defaultValue),i===void 0&&o.tfDeprecatedName&&(i=Fb(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"func":i=DC(e.attr,o.tfName,o.defaultValue),i===void 0&&o.tfDeprecatedName&&(i=DC(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${o.type} for op: ${e.op}`)}return r[o.name]={value:i,type:a},r},{})),s}mapFunction(e){const t=e.nodeDef,s=[],r=[];let o={};t!=null&&(o=t.reduce((p,f)=>(p[f.name]=this.mapNode(f),f.op==="Const"&&r.push(p[f.name]),p),{}));const a=[],i=[];e.signature.inputArg.forEach(p=>{const[f]=io(p.name),g={name:f,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:cv(p.type),type:"dtype"}},children:[]};g.signatureKey=p.name,a.push(g),o[f]=g}),Object.keys(o).forEach(p=>{const f=o[p];f.inputNames.forEach((g,y)=>{const[w,,x]=io(g),v=o[w];if(v.outputs!=null){const k=v.outputs.indexOf(x);if(k!==-1){const I=`${w}:${k}`;f.inputNames[y]=I}}f.inputs.push(v),v.children.push(f)})});const c=e.ret;e.signature.outputArg.forEach(p=>{const[f,g]=io(c[p.name]),y=o[f];y!=null&&(y.defaultOutput=g,i.push(y))});const h=this.mapArgsToSignature(e);return{nodes:o,inputs:a,outputs:i,weights:r,placeholders:s,signature:h}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((t,s)=>(t[s.name]=this.mapArgToTensorInfo(s),t),{}),outputs:e.signature.outputArg.reduce((t,s)=>(t[s.name]=this.mapArgToTensorInfo(s,e.ret),t),{})}}mapArgToTensorInfo(e,t){let s=e.name;return t!=null&&(s=t[s]),{name:s,dtype:e.type}}}function ij(n){const e=oe().global;if(typeof e.atob<"u")return e.atob(n);if(typeof Buffer<"u")return new Buffer(n,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function XT(n,e){const t=Array.isArray(n)?String.fromCharCode.apply(null,n):ij(n);return e?t:t.toLowerCase()}function Ab(n,e,t,s=!1){const r=n[e];return r!=null?XT(r.s,s):t}function Db(n,e,t){const s=n[e];return s?s.b:t}function _b(n,e,t){const s=n[e]||{},r=s.i!=null?s.i:s.f!=null?s.f:t;return typeof r=="number"?r:parseInt(r,10)}function cv(n){switch(typeof n=="string"&&(n=fs[n]),n){case fs.DT_FLOAT:case fs.DT_HALF:return"float32";case fs.DT_INT32:case fs.DT_INT64:case fs.DT_INT8:case fs.DT_UINT8:return"int32";case fs.DT_BOOL:return"bool";case fs.DT_DOUBLE:return"float32";case fs.DT_STRING:return"string";case fs.DT_COMPLEX64:case fs.DT_COMPLEX128:return"complex64";default:return null}}function DC(n,e,t){const s=n[e];return s&&s.func?s.func.name:t}function Ob(n,e,t){const s=n[e];return s&&s.type?cv(s.type):t}function Fb(n,e,t){const s=n[e];return s&&s.list&&s.list.type?s.list.type.map(r=>cv(r)):t}function YT(n){if(!n.unknownRank)return n.dim!=null?n.dim.map(e=>typeof e.size=="number"?e.size:parseInt(e.size,10)):[]}function Lb(n,e,t){const s=n[e];return s&&s.shape?YT(s.shape):t}function Pb(n,e,t){const s=n[e];return s?((s.list.f&&s.list.f.length?s.list.f:s.list.i)||[]).map(r=>typeof r=="number"?r:parseInt(r,10)):t}function zb(n,e,t,s=!1){const r=n[e];return r&&r.list&&r.list.s?r.list.s.map(o=>XT(o,s)):t}function Mb(n,e,t){const s=n[e];return s&&s.list&&s.list.shape?s.list.shape.map(r=>YT(r)):t}function Bb(n,e,t){const s=n[e];return s&&s.list&&s.list.b?s.list.b:t}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lj{constructor(e,t,s){this.node=e,this.tensorMap=t,this.context=s,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(r=>this.getInput(r)),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce((r,o)=>(r[o]=this.getAttr(o),r),{}))}getInput(e){return bn(e,this.tensorMap,this.context)}getAttr(e,t){const s=this.node.rawAttrs[e];if(s.tensor!=null)return bn(e,this.tensorMap,this.context);if(s.i!=null||s.f!=null)return _b(this.node.rawAttrs,e,t);if(s.s!=null)return Ab(this.node.rawAttrs,e,t);if(s.b!=null)return Db(this.node.rawAttrs,e,t);if(s.shape!=null)return Lb(this.node.rawAttrs,e,t);if(s.type!=null)return Ob(this.node.rawAttrs,e,t);if(s.list!=null){if(s.list.i!=null||s.list.f!=null)return Pb(this.node.rawAttrs,e,t);if(s.list.s!=null)return zb(this.node.rawAttrs,e,t);if(s.list.shape!=null)return Mb(this.node.rawAttrs,e,t);if(s.list.b!=null)return Bb(this.node.rawAttrs,e,t);if(s.list.type!=null)return Fb(this.node.rawAttrs,e,t)}return t}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const In=Object.freeze(Object.defineProperty({__proto__:null,OP_SCOPE_SUFFIX:ww,abs:Xt,acos:Iw,acosh:$w,add:fe,addN:e$,all:Eg,any:ed,argMax:di,argMin:Tw,asin:Ew,asinh:Rw,atan:Aw,atan2:Dw,atanh:_w,avgPool:vh,avgPool3d:Fw,basicLSTMCell:t$,batchNorm:Au,batchNorm2d:Lw,batchNorm3d:Pw,batchNorm4d:zw,batchToSpaceND:kh,bincount:Mw,bitwiseAnd:n$,booleanMaskAsync:B$,broadcastArgs:s$,broadcastTo:ri,buffer:qe,cast:ke,ceil:Bw,clipByValue:ts,clone:Mr,complex:mo,concat:Wt,concat1d:Vw,concat2d:Ww,concat3d:Uw,concat4d:jw,conv1d:Rg,conv2d:go,conv2dTranspose:Ag,conv3d:Hw,conv3dTranspose:qw,cos:Sh,cosh:Dg,cosineWindow:ny,cumprod:sd,cumsum:_g,denseBincount:qf,depthToSpace:Kw,depthwiseConv2d:Du,diag:o$,dilation2d:Xw,div:Fe,divNoNan:Yw,dot:Qw,dropout:C1,einsum:Xa,elu:_u,enclosingPowerOfTwo:I1,ensureShape:a$,equal:Js,erf:Og,euclideanNorm:Jw,exp:ns,expandDims:An,expm1:e1,eye:Fg,fft:Fh,fill:Ti,floor:Fu,floorDiv:Tg,fused:X$,gather:Lu,gatherND:j$,greater:os,greaterEqual:So,ifft:$l,imag:Nh,image:Xs,inTopKAsync:G$,irfft:Yg,isFinite:t1,isInf:n1,isNaN:s1,leakyRelu:Ch,less:Sl,lessEqual:ka,linalg:E1,linspace:u$,localResponseNormalization:r1,log:ys,log1p:Ih,logSigmoid:o1,logSoftmax:Pg,logSumExp:$h,logicalAnd:wr,logicalNot:Th,logicalOr:zg,logicalXor:a1,losses:nT,lowerBound:d$,matMul:Xe,max:_s,maxPool:Eh,maxPool3d:i1,maxPoolWithArgmax:h$,maximum:Xr,mean:_t,meshgrid:p$,min:kl,minimum:ha,mirrorPad:l1,mod:u1,moments:Rh,movingAverage:V$,mul:G,multiRNNCell:f$,multinomial:m$,neg:St,norm:Ou,notEqual:fi,oneHot:Nl,ones:Qn,onesLike:xs,op:U,outerProduct:g$,pad:No,pad1d:y$,pad2d:x$,pad3d:b$,pad4d:w$,pool:c1,pow:Gr,prelu:Dh,print:Cw,prod:d1,raggedGather:v$,raggedRange:k$,raggedTensorToTensor:S$,rand:N$,randomGamma:$$,randomNormal:Vg,randomStandardNormal:T$,randomUniform:Sa,randomUniformInt:E$,range:mi,real:Cl,reciprocal:m1,relu:Cr,relu6:Wg,reshape:q,reverse:Os,reverse1d:R$,reverse2d:A$,reverse3d:D$,reverse4d:_$,rfft:Lh,round:Ug,rsqrt:jg,scalar:Me,scatterND:W$,searchSorted:Mg,selu:Gg,separableConv2d:Hg,setdiff1dAsync:O$,sigmoid:xr,sign:g1,signal:tT,sin:qg,sinh:Kg,slice:tt,slice1d:_h,slice2d:Xg,slice3d:Oh,slice4d:Il,softmax:Pu,softplus:Ei,spaceToBatchND:Ah,sparse:sT,sparseToDense:U$,spectral:eT,split:Zn,sqrt:pn,square:gt,squaredDifference:Qg,squeeze:Co,stack:ss,step:Ri,stridedSlice:y1,string:rT,sub:Te,sum:Ae,tan:x1,tanh:da,tensor:Zs,tensor1d:Dn,tensor2d:yl,tensor3d:b1,tensor4d:F$,tensor5d:L$,tensor6d:P$,tensorScatterUpdate:z$,tile:Rs,topk:v1,transpose:nt,truncatedNormal:Jg,unique:k1,unsortedSegmentSum:ey,unstack:Fs,upperBound:M$,variable:S1,where:vn,whereAsync:N1,zeros:Vt,zerosLike:st},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uj=(n,e,t,s=In)=>{switch(n.op){case"BiasAdd":case"AddV2":case"Add":return[s.add($("a",n,e,t),$("b",n,e,t))];case"AddN":return[s.addN($("tensors",n,e,t))];case"FloorMod":case"Mod":return[s.mod($("a",n,e,t),$("b",n,e,t))];case"Mul":return[s.mul($("a",n,e,t),$("b",n,e,t))];case"RealDiv":case"Div":return[s.div($("a",n,e,t),$("b",n,e,t))];case"DivNoNan":return[s.divNoNan($("a",n,e,t),$("b",n,e,t))];case"FloorDiv":return[s.floorDiv($("a",n,e,t),$("b",n,e,t))];case"Sub":return[s.sub($("a",n,e,t),$("b",n,e,t))];case"Minimum":return[s.minimum($("a",n,e,t),$("b",n,e,t))];case"Maximum":return[s.maximum($("a",n,e,t),$("b",n,e,t))];case"Pow":return[s.pow($("a",n,e,t),$("b",n,e,t))];case"SquaredDifference":return[s.squaredDifference($("a",n,e,t),$("b",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cj=(n,e,t,s=In)=>{switch(n.op){case"Abs":case"ComplexAbs":return[s.abs($("x",n,e,t))];case"Acos":return[s.acos($("x",n,e,t))];case"Acosh":return[s.acosh($("x",n,e,t))];case"Asin":return[s.asin($("x",n,e,t))];case"Asinh":return[s.asinh($("x",n,e,t))];case"Atan":return[s.atan($("x",n,e,t))];case"Atan2":return[s.atan2($("x",n,e,t),$("y",n,e,t))];case"Atanh":return[s.atanh($("x",n,e,t))];case"Ceil":return[s.ceil($("x",n,e,t))];case"Complex":return[s.complex($("real",n,e,t),$("imag",n,e,t))];case"Cos":return[s.cos($("x",n,e,t))];case"Cosh":return[s.cosh($("x",n,e,t))];case"Elu":return[s.elu($("x",n,e,t))];case"Erf":return[s.erf($("x",n,e,t))];case"Exp":return[s.exp($("x",n,e,t))];case"Expm1":return[s.expm1($("x",n,e,t))];case"Floor":return[s.floor($("x",n,e,t))];case"Log":return[s.log($("x",n,e,t))];case"Log1p":return[s.log1p($("x",n,e,t))];case"Imag":return[s.imag($("x",n,e,t))];case"Neg":return[s.neg($("x",n,e,t))];case"Reciprocal":return[s.reciprocal($("x",n,e,t))];case"Real":return[s.real($("x",n,e,t))];case"Relu":return[s.relu($("x",n,e,t))];case"Round":return[s.round($("x",n,e,t))];case"Selu":return[s.selu($("x",n,e,t))];case"Sigmoid":return[s.sigmoid($("x",n,e,t))];case"Sin":return[s.sin($("x",n,e,t))];case"Sign":return[s.sign($("x",n,e,t))];case"Sinh":return[s.sinh($("x",n,e,t))];case"Softplus":return[s.softplus($("x",n,e,t))];case"Sqrt":return[s.sqrt($("x",n,e,t))];case"Square":return[s.square($("x",n,e,t))];case"Tanh":return[s.tanh($("x",n,e,t))];case"Tan":return[s.tan($("x",n,e,t))];case"ClipByValue":return[s.clipByValue($("x",n,e,t),$("clipValueMin",n,e,t),$("clipValueMax",n,e,t))];case"Relu6":return[s.relu6($("x",n,e,t))];case"Rsqrt":return[s.rsqrt(bn(n.inputNames[0],e,t))];case"LeakyRelu":return[s.leakyRelu($("x",n,e,t),$("alpha",n,e,t))];case"Prelu":return[s.prelu($("x",n,e,t),$("alpha",n,e,t))];case"IsNan":return[s.isNaN(bn(n.inputNames[0],e,t))];case"IsInf":return[s.isInf(bn(n.inputNames[0],e,t))];case"IsFinite":return[s.isFinite(bn(n.inputNames[0],e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ks(n,e,t=""){if(!(typeof n=="number"||typeof e=="number")){A(n.length===e.length,()=>t+` Shapes ${n} and ${e} must match`);for(let s=0;s<n.length;s++){const r=n[s],o=e[s];A(r<0||o<0||r===o,()=>t+` Shapes ${n} and ${e} must match`)}}}function _C(n){return!(typeof n=="number"||n.some(e=>e<0))}function Dc(n,e,t){let s=Vb(n,t);const r=!_C(s);if(r&&e.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${s}`);if(r&&e.forEach(o=>{s=Vb(o.shape,s)}),!_C(s))throw new Error(`Non-fully-defined elementShape: ${s}`);return s}function Vb(n,e){if(typeof n=="number")return e;if(typeof e=="number")return n;if(n.length!==e.length)throw new Error(`Incompatible ranks during merge: ${n} vs. ${e}`);const t=[];for(let s=0;s<n.length;++s){const r=n[s],o=e[s];if(r>=0&&o>=0&&r!==o)throw new Error(`Incompatible shape during merge: ${n} vs. ${e}`);t[s]=r>=0?r:o}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dj{constructor(e,t,s,r,o,a,i){this.name=e,this.dtype=t,this.maxSize=s,this.elementShape=r,this.identicalElementShapes=o,this.dynamicSize=a,this.clearAfterRead=i,this.tensors=[],this.closed_=!1,this.idTensor=Me(0),Jt(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(t=>{(e==null||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const t=this.tensors[e];if(t.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}readMany(e){return e.map(t=>this.read(t))}write(e,t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const s=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},
          because the value dtype is ${t.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=t.shape),Ks(this.elementShape,t.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),s.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(s.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);s.tensor=t,Jt(t),s.written=!0,this.tensors[e]=s}writeMany(e,t){if(e.length!==t.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${t.length}.`);e.forEach((s,r)=>this.write(s,t[r]))}gather(e,t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${t}`);if(e)e=e.slice(0,this.size());else{e=[];for(let r=0;r<this.size();r++)e.push(r)}if(e.length===0)return Zs([],[0].concat(this.elementShape));const s=this.readMany(e);return Ks(this.elementShape,s[0].shape,"TensorArray shape mismatch: "),ss(s,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(this.size()===0)return Zs([],[0].concat(this.elementShape));const t=[];for(let r=0;r<this.size();r++)t.push(r);const s=this.readMany(t);return Ks(this.elementShape,s[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${s[0].shape})`),Wt(s,0)}scatter(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const s=Math.max(...e);if(!this.dynamicSize&&s>=this.maxSize)throw new Error(`Max index must be < array size (${s}  vs. ${this.maxSize})`);this.writeMany(e,Fs(t,0))}split(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);let s=0;const r=e.map(l=>(s+=l,s));if(s!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${t.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const o=s===0?0:t.size/s,a=[];re(()=>{t=q(t,[1,s,o]);for(let l=0;l<e.length;++l){const h=[0,l===0?0:r[l-1],0],p=[1,e[l],o];a[l]=q(tt(t,h,p),this.elementShape)}return a});const i=[];for(let l=0;l<e.length;l++)i[l]=l;this.writeMany(i,a)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yi{get id(){return this.idTensor.id}constructor(e,t,s,r=-1){this.tensors=e,this.elementShape=t,this.elementDtype=s,e!=null&&e.forEach(o=>{if(s!==o.dtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${o.dtype}`);Ks(t,o.shape,"TensorList shape mismatch: "),Jt(o)}),this.idTensor=Me(0),this.maxNumElements=r,Jt(this.idTensor)}copy(){return new yi([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(t=>{(e==null||!e.has(t.id))&&t.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,t,s=-1){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(s!==-1&&this.tensors.length!==s)throw new Error(`Operation expected a list with ${s} elements but got a list with ${this.tensors.length} elements.`);Ks(e,this.elementShape,"TensorList shape mismatch: ");const r=Dc(this.elementShape,this.tensors,e);return re(()=>{const o=this.tensors.map(a=>q(a,r));return ss(o,0)})}popBack(e,t){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");const s=Dc(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,Ks(r.shape,e,"TensorList shape mismatch: "),q(r,s)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(Ks(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Jt(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);const t=new yi([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(let s=0;s<Math.min(this.tensors.length,e);++s)t.tensors[s]=this.tensors[s];return t}getItem(e,t,s){if(s!==this.elementDtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(this.tensors[e]==null)throw new Error(`element at index ${e} is null.`);Ks(this.tensors[e].shape,t,"TensorList shape mismatch: ");const r=Dc(this.elementShape,this.tensors,t);return q(this.tensors[e],r)}setItem(e,t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);Ks(this.elementShape,t.shape,"TensorList shape mismatch: "),Jt(t),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=t}gather(e,t,s){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);Ks(this.elementShape,s,"TensorList shape mismatch: "),e=e.slice(0,this.size());const r=Dc(this.elementShape,this.tensors,s);return e.length===0?Zs([],[0].concat(r)):re(()=>{const o=e.map(a=>q(this.tensors[a],r));return ss(o,0)})}concat(e,t){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);Ks(this.elementShape,t,"TensorList shape mismatch: ");const s=Dc(this.elementShape,this.tensors,t);return this.size()===0?Zs([],[0].concat(s)):re(()=>{const r=this.tensors.map(o=>q(o,s));return Wt(r,0)})}}function hj(n,e,t){const s=n.dtype;if(n.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${n.shape}`);if(n.dtype!==t)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${t}`);const r=n.shape.slice(1);Ks(r,e,"TensorList shape mismatch: ");const o=Fs(n);return new yi(o,e,s)}function pj(n,e,t,s){return new yi([],n,e,s)}function fj(n,e,t,s){if(e.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${n.shape[0]}`);const r=Math.max(...e);if(s!=null&&s!==-1&&r>=s)throw new Error(`Max index must be < array size (${r}  vs. ${s})`);const o=new yi([],t,n.dtype,s),a=Fs(n,0);return e.forEach((i,l)=>{o.setItem(i,a[l])}),o}function mj(n,e,t){let s=0;const r=e.map(h=>(s+=h,s));if(s!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${n.shape}`);const o=n.shape.slice(1),a=Vb(o,t),i=s===0?0:n.size/s,l=re(()=>{const h=[];n=q(n,[1,s,i]);for(let p=0;p<e.length;++p){const g=[0,p===0?0:r[p-1],0],y=[1,e[p],i];h[p]=q(tt(n,g,y),a)}return n.dispose(),h}),c=new yi([],t,n.dtype,e.length);for(let h=0;h<l.length;h++)c.setItem(h,l[h]);return c}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gj=async(n,e,t)=>{switch(n.op){case"If":case"StatelessIf":{const s=$("thenBranch",n,e,t),r=$("elseBranch",n,e,t),o=$("cond",n,e,t),a=$("args",n,e,t);return(await o.data())[0]?t.functionMap[s].executeFunctionAsync(a,t.tensorArrayMap,t.tensorListMap):t.functionMap[r].executeFunctionAsync(a,t.tensorArrayMap,t.tensorListMap)}case"While":case"StatelessWhile":{const s=$("body",n,e,t),r=$("cond",n,e,t),o=$("args",n,e,t),a=await t.functionMap[r].executeFunctionAsync(o,t.tensorArrayMap,t.tensorListMap),i=o.map(h=>h.id);let l=await a[0].data();a.forEach(h=>{!h.kept&&i.indexOf(h.id)===-1&&h.dispose()});let c=o;for(;l[0];){const h=c;c=await t.functionMap[s].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap);const p=c.map(g=>g.id);h.forEach(g=>{!g.kept&&i.indexOf(g.id)===-1&&p.indexOf(g.id)===-1&&g.dispose()});const f=await t.functionMap[r].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap);l=await f[0].data(),f.forEach(g=>{!g.kept&&i.indexOf(g.id)===-1&&p.indexOf(g.id)===-1&&g.dispose()})}return c}case"LoopCond":{const s=$("pred",n,e,t);return[lo(s)]}case"Switch":{const s=$("pred",n,e,t);let r=$("data",n,e,t);return r.kept||(r=lo(r)),(await s.data())[0]?[void 0,r]:[r,void 0]}case"Merge":{const s=n.inputNames.find(r=>bn(r,e,t)!==void 0);if(s){const r=bn(s,e,t);return[lo(r)]}return}case"Enter":{const s=$("frameName",n,e,t),r=$("tensor",n,e,t);return t.enterFrame(s),[lo(r)]}case"Exit":{const s=$("tensor",n,e,t);return t.exitFrame(),[lo(s)]}case"NextIteration":{const s=$("tensor",n,e,t);return t.nextIteration(),[lo(s)]}case"TensorArrayV3":{const s=$("size",n,e,t),r=$("dtype",n,e,t),o=$("elementShape",n,e,t),a=$("dynamicSize",n,e,t),i=$("clearAfterRead",n,e,t),l=$("identicalElementShapes",n,e,t),c=$("name",n,e,t),h=new dj(c,r,s,o,l,a,i);return t.addTensorArray(h),[h.idTensor,Me(1)]}case"TensorArrayWriteV3":{const s=$("tensorArrayId",n,e,t),r=$("index",n,e,t),o=$("tensor",n,e,t),a=t.getTensorArray(s.id);return a.write(r,o),[a.idTensor]}case"TensorArrayReadV3":{const s=$("tensorArrayId",n,e,t),r=$("index",n,e,t);return[t.getTensorArray(s.id).read(r)]}case"TensorArrayGatherV3":{const s=$("tensorArrayId",n,e,t),r=$("indices",n,e,t),o=$("dtype",n,e,t);return[t.getTensorArray(s.id).gather(r,o)]}case"TensorArrayScatterV3":{const s=$("tensorArrayId",n,e,t),r=$("indices",n,e,t),o=$("tensor",n,e,t),a=t.getTensorArray(s.id);return a.scatter(r,o),[a.idTensor]}case"TensorArrayConcatV3":{const s=$("tensorArrayId",n,e,t),r=t.getTensorArray(s.id),o=$("dtype",n,e,t);return[r.concat(o)]}case"TensorArraySplitV3":{const s=$("tensorArrayId",n,e,t),r=$("tensor",n,e,t),o=$("lengths",n,e,t),a=t.getTensorArray(s.id);return a.split(o,r),[a.idTensor]}case"TensorArraySizeV3":{const s=$("tensorArrayId",n,e,t),r=t.getTensorArray(s.id);return[Me(r.size(),"int32")]}case"TensorArrayCloseV3":{const s=$("tensorArrayId",n,e,t),r=t.getTensorArray(s.id);return r.clearAndClose(),[r.idTensor]}case"TensorListSetItem":{const s=$("tensorListId",n,e,t),r=$("index",n,e,t),o=$("tensor",n,e,t),a=t.getTensorList(s.id);return a.setItem(r,o),[a.idTensor]}case"TensorListGetItem":{const s=$("tensorListId",n,e,t),r=$("index",n,e,t),o=$("elementShape",n,e,t),a=$("elementDType",n,e,t);return[t.getTensorList(s.id).getItem(r,o,a)]}case"TensorListScatterV2":case"TensorListScatter":{const s=$("indices",n,e,t),r=$("tensor",n,e,t),o=$("elementShape",n,e,t),a=$("numElements",n,e,t),i=fj(r,s,o,a);return t.addTensorList(i),[i.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const s=$("elementShape",n,e,t),r=$("elementDType",n,e,t);let o;n.op==="TensorListReserve"?o="numElements":o="maxNumElements";const a=$(o,n,e,t),i=n.op==="TensorListReserve"?-1:a,l=pj(s,r,a,i);return t.addTensorList(l),[l.idTensor]}case"TensorListGather":{const s=$("tensorListId",n,e,t),r=$("indices",n,e,t),o=$("elementShape",n,e,t),a=$("elementDType",n,e,t);return[t.getTensorList(s.id).gather(r,a,o)]}case"TensorListStack":{const s=$("tensorListId",n,e,t),r=$("elementShape",n,e,t),o=$("elementDType",n,e,t),a=$("numElements",n,e,t);return[t.getTensorList(s.id).stack(r,o,a)]}case"TensorListFromTensor":{const s=$("tensor",n,e,t),r=$("elementShape",n,e,t),o=$("elementDType",n,e,t),a=hj(s,r,o);return t.addTensorList(a),[a.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const s=$("tensorListId",n,e,t),r=t.getTensorList(s.id),o=$("dtype",n,e,t),a=$("elementShape",n,e,t);return[r.concat(o,a)]}case"TensorListPushBack":{const s=$("tensorListId",n,e,t),r=$("tensor",n,e,t),o=t.getTensorList(s.id);return o.pushBack(r),[o.idTensor]}case"TensorListPopBack":{const s=$("tensorListId",n,e,t),r=$("elementShape",n,e,t),o=$("elementDType",n,e,t);return[t.getTensorList(s.id).popBack(r,o)]}case"TensorListSplit":{const s=$("tensor",n,e,t),r=$("elementShape",n,e,t),o=$("lengths",n,e,t),a=mj(s,o,r);return t.addTensorList(a),[a.idTensor]}case"TensorListLength":{const s=$("tensorListId",n,e,t),r=t.getTensorList(s.id);return[Me(r.size(),"int32")]}case"TensorListResize":{const s=$("tensorListId",n,e,t),r=$("size",n,e,t),a=t.getTensorList(s.id).resize(r);return t.addTensorList(a),[a.idTensor]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OC(n,e,t){const[s,r]=$("fusedOps",n,e,t),o=s==="biasadd",a=!o,i=r==="prelu",l=s==="fusedbatchnorm",c=$("numArgs",n,e,t);if(o){if(i&&c!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!i&&o&&c!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const h=$("strides",n,e,t),p=Lf(n,e,t),f=$("dataFormat",n,e,t).toUpperCase(),g=$("dilations",n,e,t);let[y,w]=$("args",n,e,t);a&&(w=y,y=void 0);const x=$("leakyreluAlpha",n,e,t);return{stride:h,pad:p,dataFormat:f,dilations:g,biasArg:y,preluArg:w,activationFunc:r,leakyreluAlpha:x}}const yj=(n,e,t,s=In)=>{switch(n.op){case"Conv1D":{const r=$("stride",n,e,t),o=$("pad",n,e,t),a=$("dataFormat",n,e,t).toUpperCase(),i=$("dilation",n,e,t);return[s.conv1d($("x",n,e,t),$("filter",n,e,t),r,o,a,i)]}case"Conv2D":{const r=$("strides",n,e,t),o=Lf(n,e,t),a=$("dataFormat",n,e,t).toUpperCase(),i=$("dilations",n,e,t);return[s.conv2d($("x",n,e,t),$("filter",n,e,t),[r[1],r[2]],o,a,[i[1],i[2]])]}case"_FusedConv2D":{const{stride:r,pad:o,dataFormat:a,dilations:i,biasArg:l,preluArg:c,activationFunc:h,leakyreluAlpha:p}=OC(n,e,t);return[s.fused.conv2d({x:$("x",n,e,t),filter:$("filter",n,e,t),strides:[r[1],r[2]],pad:o,dataFormat:a,dilations:[i[1],i[2]],bias:l,activation:h,preluActivationWeights:c,leakyreluAlpha:p})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:o,dataFormat:a,dilations:i,biasArg:l,preluArg:c,activationFunc:h,leakyreluAlpha:p}=OC(n,e,t);return[s.fused.depthwiseConv2d({x:$("x",n,e,t),filter:$("filter",n,e,t),strides:[r[1],r[2]],pad:o,dataFormat:a,dilations:[i[1],i[2]],bias:l,activation:h,preluActivationWeights:c,leakyreluAlpha:p})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=$("outputShape",n,e,t),o=$("strides",n,e,t),a=Lf(n,e,t);return[s.conv2dTranspose($("x",n,e,t),$("filter",n,e,t),r,[o[1],o[2]],a)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=$("strides",n,e,t),o=Lf(n,e,t),a=$("dilations",n,e,t),i=$("dataFormat",n,e,t).toUpperCase();return[s.depthwiseConv2d($("input",n,e,t),$("filter",n,e,t),[r[1],r[2]],o,i,[a[1],a[2]])]}case"Conv3D":{const r=$("strides",n,e,t),o=$("pad",n,e,t),a=$("dataFormat",n,e,t).toUpperCase(),i=$("dilations",n,e,t);return[s.conv3d($("x",n,e,t),$("filter",n,e,t),[r[1],r[2],r[3]],o,a,[i[1],i[2],i[3]])]}case"AvgPool":{const r=$("strides",n,e,t),o=$("pad",n,e,t),a=$("kernelSize",n,e,t);return[s.avgPool($("x",n,e,t),[a[1],a[2]],[r[1],r[2]],o)]}case"MaxPool":{const r=$("strides",n,e,t),o=$("pad",n,e,t),a=$("kernelSize",n,e,t);return[s.maxPool($("x",n,e,t),[a[1],a[2]],[r[1],r[2]],o)]}case"MaxPoolWithArgmax":{const r=$("strides",n,e,t),o=$("pad",n,e,t),a=$("kernelSize",n,e,t),i=$("includeBatchInIndex",n,e,t),{result:l,indexes:c}=s.maxPoolWithArgmax($("x",n,e,t),[a[1],a[2]],[r[1],r[2]],o,i);return[l,c]}case"AvgPool3D":{const r=$("strides",n,e,t),o=$("pad",n,e,t),a=$("kernelSize",n,e,t);return[s.avgPool3d($("x",n,e,t),[a[1],a[2],a[3]],[r[1],r[2],r[3]],o)]}case"MaxPool3D":{const r=$("strides",n,e,t),o=$("pad",n,e,t),a=$("kernelSize",n,e,t);return[s.maxPool3d($("x",n,e,t),[a[1],a[2],a[3]],[r[1],r[2],r[3]],o)]}case"Dilation2D":{const r=$("strides",n,e,t),o=$("pad",n,e,t),a=$("dilations",n,e,t),i=r[1],l=r[2],c=a[1],h=a[2];return[s.dilation2d($("x",n,e,t),$("filter",n,e,t),[i,l],o,[c,h],"NHWC")]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xj=(n,e,t,s=In)=>{switch(n.op){case"Fill":{const r=$("shape",n,e,t),o=$("dtype",n,e,t),a=$("value",n,e,t);return[s.fill(r,a,o)]}case"LinSpace":{const r=$("start",n,e,t),o=$("stop",n,e,t),a=$("num",n,e,t);return[s.linspace(r,o,a)]}case"Multinomial":{const r=$("logits",n,e,t),o=$("numSamples",n,e,t),a=$("seed",n,e,t);return[s.multinomial(r,o,a)]}case"OneHot":{const r=$("indices",n,e,t),o=$("depth",n,e,t),a=$("onValue",n,e,t),i=$("offValue",n,e,t),l=$("dtype",n,e,t);return[s.oneHot(r,o,a,i,l)]}case"Ones":return[s.ones($("shape",n,e,t),$("dtype",n,e,t))];case"OnesLike":return[s.onesLike($("x",n,e,t))];case"RandomStandardNormal":return[s.randomStandardNormal($("shape",n,e,t),$("dtype",n,e,t),$("seed",n,e,t))];case"RandomUniform":return[s.randomUniform($("shape",n,e,t),$("minval",n,e,t),$("maxval",n,e,t),$("dtype",n,e,t))];case"RandomUniformInt":return[s.randomUniformInt($("shape",n,e,t),$("minval",n,e,t),$("maxval",n,e,t),$("seed",n,e,t))];case"Range":{const r=$("start",n,e,t),o=$("stop",n,e,t),a=$("step",n,e,t);return[s.range(r,o,a,$("dtype",n,e,t))]}case"TruncatedNormal":{const r=$("shape",n,e,t),o=$("mean",n,e,t),a=$("stdDev",n,e,t),i=$("seed",n,e,t);return[s.truncatedNormal(r,o,a,$("dtype",n,e,t),i)]}case"Zeros":return[s.zeros($("shape",n,e,t),$("dtype",n,e,t))];case"ZerosLike":return[s.zerosLike($("x",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bx(n,e,t){const s=$("boxes",n,e,t),r=$("scores",n,e,t),o=$("maxOutputSize",n,e,t),a=$("iouThreshold",n,e,t),i=$("scoreThreshold",n,e,t),l=$("softNmsSigma",n,e,t);return{boxes:s,scores:r,maxOutputSize:o,iouThreshold:a,scoreThreshold:i,softNmsSigma:l}}const bj=async(n,e,t,s,r=In)=>{switch(n.op){case"NonMaxSuppressionV5":{const{boxes:o,scores:a,maxOutputSize:i,iouThreshold:l,scoreThreshold:c,softNmsSigma:h}=Bx(n,e,t),p=await r.image.nonMaxSuppressionWithScoreAsync(o,a,i,l,c,h);return[p.selectedIndices,p.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:o,scores:a,maxOutputSize:i,iouThreshold:l,scoreThreshold:c}=Bx(n,e,t),h=$("padToMaxOutputSize",n,e,t),p=await r.image.nonMaxSuppressionPaddedAsync(o,a,i,l,c,h);return[p.selectedIndices,p.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:o,scores:a,maxOutputSize:i,iouThreshold:l,scoreThreshold:c}=Bx(n,e,t);return[await r.image.nonMaxSuppressionAsync(o,a,i,l,c)]}case"Where":{const o=r.cast($("condition",n,e,t),"bool"),a=[await r.whereAsync(o)];return o.dispose(),a}case"ListDiff":return r.setdiff1dAsync($("x",n,e,t),$("y",n,e,t));default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wj=(n,e,t,s=In)=>{switch(n.op){case"LowerBound":{const r=$("sortedSequence",n,e,t),o=$("values",n,e,t);return[s.lowerBound(r,o)]}case"TopKV2":{const r=$("x",n,e,t),o=$("k",n,e,t),a=$("sorted",n,e,t),i=s.topk(r,o,a);return[i.values,i.indices]}case"UpperBound":{const r=$("sortedSequence",n,e,t),o=$("values",n,e,t);return[s.upperBound(r,o)]}case"Unique":{const r=$("x",n,e,t),o=s.unique(r);return[o.values,o.indices]}case"UniqueV2":{const r=$("x",n,e,t),o=$("axis",n,e,t),a=s.unique(r,o);return[a.values,a.indices]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vj=(n,e,t,s=In)=>{switch(n.op){case"Const":return e[n.name];case"PlaceholderWithDefault":const r=$("default",n,e,t);return[bn(n.name,e,t)||r];case"Placeholder":return[bn(n.name,e,t)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{const h=$("x",n,e,t);return[lo(h)]}case"IdentityN":return $("x",n,e,t).map(h=>lo(h));case"Snapshot":const o=$("x",n,e,t);return[lo(o)];case"Shape":return[s.tensor1d($("x",n,e,t).shape,"int32")];case"ShapeN":return $("x",n,e,t).map(h=>s.tensor1d(h.shape));case"Size":return[s.scalar($("x",n,e,t).size,"int32")];case"Rank":return[s.scalar($("x",n,e,t).rank,"int32")];case"NoOp":return[s.scalar(1)];case"Print":const a=$("x",n,e,t),i=$("data",n,e,t),l=$("message",n,e,t),c=$("summarize",n,e,t);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(l);for(let h=0;h<i.length;h++)console.log(Array.prototype.slice.call(i[h].dataSync()).slice(0,c));return[a];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kj{get id(){return this.handle.id}constructor(e,t){this.keyDType=e,this.valueDType=t,this.handle=Me(0),this.tensorMap=new Map,Jt(this.handle)}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Me(this.size(),"int32")}async import(e,t){this.checkKeyAndValueTensor(e,t);const s=await e.data();return this.tensorMap.forEach(r=>r.dispose()),this.tensorMap.clear(),re(()=>{const r=Fs(t),o=s.length,a=r.length;A(o===a,()=>`The number of elements doesn't match, keys has ${o} elements, the values has ${a} elements.`);for(let i=0;i<o;i++){const l=s[i],c=r[i];Jt(c),this.tensorMap.set(l,c)}return this.handle})}async find(e,t){this.checkKeyAndValueTensor(e,t);const s=await e.data();return re(()=>{const r=[];for(let o=0;o<s.length;o++){const a=s[o],i=this.findWithDefault(a,t);r.push(i)}return ss(r)})}findWithDefault(e,t){const s=this.tensorMap.get(e);return s??t}checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(t.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${t.dtype}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sj=async(n,e,t,s)=>{switch(n.op){case"HashTable":case"HashTableV2":{const r=s.getHashTableHandleByName(n.name);if(r!=null)return[r];{const o=$("keyDType",n,e,t),a=$("valueDType",n,e,t),i=new kj(o,a);return s.addHashTable(n.name,i),[i.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{const r=$("tableHandle",n,e,t,s),o=$("keys",n,e,t),a=$("values",n,e,t);return[await s.getHashTableById(r.id).import(o,a)]}case"LookupTableFind":case"LookupTableFindV2":{const r=$("tableHandle",n,e,t,s),o=$("keys",n,e,t),a=$("defaultValue",n,e,t);return[await s.getHashTableById(r.id).find(o,a)]}case"LookupTableSize":case"LookupTableSizeV2":{const r=$("tableHandle",n,e,t,s);return[s.getHashTableById(r.id).tensorSize()]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nj=(n,e,t,s=In)=>{switch(n.op){case"ResizeBilinear":{const r=$("images",n,e,t),o=$("size",n,e,t),a=$("alignCorners",n,e,t),i=$("halfPixelCenters",n,e,t);return[s.image.resizeBilinear(r,[o[0],o[1]],a,i)]}case"ResizeNearestNeighbor":{const r=$("images",n,e,t),o=$("size",n,e,t),a=$("alignCorners",n,e,t),i=$("halfPixelCenters",n,e,t);return[s.image.resizeNearestNeighbor(r,[o[0],o[1]],a,i)]}case"CropAndResize":{const r=$("image",n,e,t),o=$("boxes",n,e,t),a=$("boxInd",n,e,t),i=$("cropSize",n,e,t),l=$("method",n,e,t),c=$("extrapolationValue",n,e,t);return[s.image.cropAndResize(r,o,a,i,l,c)]}case"ImageProjectiveTransformV3":{const r=$("images",n,e,t),o=$("transforms",n,e,t),a=$("outputShape",n,e,t),i=$("fillValue",n,e,t),l=$("interpolation",n,e,t),c=$("fillMode",n,e,t);return[s.image.transform(r,o,l.toLowerCase(),c.toLowerCase(),i,a)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cj=(n,e,t,s=In)=>{switch(n.op){case"Equal":return[s.equal($("a",n,e,t),$("b",n,e,t))];case"NotEqual":return[s.notEqual($("a",n,e,t),$("b",n,e,t))];case"Greater":return[s.greater($("a",n,e,t),$("b",n,e,t))];case"GreaterEqual":return[s.greaterEqual($("a",n,e,t),$("b",n,e,t))];case"Less":return[s.less($("a",n,e,t),$("b",n,e,t))];case"LessEqual":return[s.lessEqual($("a",n,e,t),$("b",n,e,t))];case"LogicalAnd":return[s.logicalAnd($("a",n,e,t),$("b",n,e,t))];case"LogicalNot":return[s.logicalNot($("a",n,e,t))];case"LogicalOr":return[s.logicalOr($("a",n,e,t),$("b",n,e,t))];case"Select":case"SelectV2":return[s.where($("condition",n,e,t),$("a",n,e,t),$("b",n,e,t))];case"BitwiseAnd":return[s.bitwiseAnd($("a",n,e,t),$("b",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ij=(n,e,t,s=In)=>{switch(n.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[s.matMul($("a",n,e,t),$("b",n,e,t),$("transposeA",n,e,t),$("transposeB",n,e,t))];case"Einsum":return[s.einsum($("equation",n,e,t),...$("tensors",n,e,t))];case"Transpose":return[s.transpose($("x",n,e,t),$("perm",n,e,t))];case"_FusedMatMul":const[r,o]=$("fusedOps",n,e,t),a=r==="biasadd",i=o==="prelu",l=$("numArgs",n,e,t),c=$("leakyreluAlpha",n,e,t);if(a){if(i&&l!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!i&&l!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[h,p]=$("args",n,e,t);return[s.fused.matMul({a:$("a",n,e,t),b:$("b",n,e,t),transposeA:$("transposeA",n,e,t),transposeB:$("transposeB",n,e,t),bias:h,activation:o,preluActivationWeights:p,leakyreluAlpha:c})];case"MatrixBandPart":return[s.linalg.bandPart($("a",n,e,t),$("numLower",n,e,t),$("numUpper",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $j=(n,e,t,s=In)=>{switch(n.op){case"EuclideanNorm":return[s.euclideanNorm($("x",n,e,t),$("axis",n,e,t),$("keepDims",n,e,t))];case"FusedBatchNorm":case"FusedBatchNormV2":return[s.batchNorm($("x",n,e,t),$("mean",n,e,t),$("variance",n,e,t),$("offset",n,e,t),$("scale",n,e,t),$("epsilon",n,e,t))];case"FusedBatchNormV3":return[s.batchNorm($("x",n,e,t),$("mean",n,e,t),$("variance",n,e,t),$("offset",n,e,t),$("scale",n,e,t),$("epsilon",n,e,t))];case"LRN":return[s.localResponseNormalization($("x",n,e,t),$("radius",n,e,t),$("bias",n,e,t),$("alpha",n,e,t),$("beta",n,e,t))];case"Softmax":return[s.softmax($("x",n,e,t))];case"LogSoftmax":return[s.logSoftmax($("x",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tj=(n,e,t,s=In)=>{switch(n.op){case"RaggedGather":{const{outputNestedSplits:r,outputDenseValues:o}=s.raggedGather($("paramsNestedSplits",n,e,t),$("paramsDenseValues",n,e,t),$("indices",n,e,t),$("outputRaggedRank",n,e,t));return r.concat(o)}case"RaggedRange":{const{rtNestedSplits:r,rtDenseValues:o}=s.raggedRange($("starts",n,e,t),$("limits",n,e,t),$("splits",n,e,t));return[r,o]}case"RaggedTensorToTensor":return[s.raggedTensorToTensor($("shape",n,e,t),$("values",n,e,t),$("defaultValue",n,e,t),$("rowPartitionTensors",n,e,t),$("rowPartitionTypes",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ej=(n,e,t,s=In)=>{switch(n.op){case"Max":{const i=$("axis",n,e,t),l=$("keepDims",n,e,t);return[s.max($("x",n,e,t),i,l)]}case"Mean":{const i=$("axis",n,e,t),l=$("keepDims",n,e,t);return[s.mean($("x",n,e,t),i,l)]}case"Min":{const i=$("axis",n,e,t),l=$("keepDims",n,e,t);return[s.min($("x",n,e,t),i,l)]}case"Sum":{const i=$("axis",n,e,t),l=$("keepDims",n,e,t);return[s.sum($("x",n,e,t),i,l)]}case"All":{const i=$("axis",n,e,t),l=$("keepDims",n,e,t);return[s.all($("x",n,e,t),i,l)]}case"Any":{const i=$("axis",n,e,t),l=$("keepDims",n,e,t);return[s.any($("x",n,e,t),i,l)]}case"ArgMax":{const i=$("axis",n,e,t);return[s.argMax($("x",n,e,t),i)]}case"ArgMin":{const i=$("axis",n,e,t);return[s.argMin($("x",n,e,t),i)]}case"Prod":{const i=$("axis",n,e,t),l=$("keepDims",n,e,t);return[s.prod($("x",n,e,t),i,l)]}case"Cumprod":{const i=$("axis",n,e,t),l=$("exclusive",n,e,t),c=$("reverse",n,e,t);return[s.cumprod($("x",n,e,t),i,l,c)]}case"Cumsum":{const i=$("axis",n,e,t),l=$("exclusive",n,e,t),c=$("reverse",n,e,t);return[s.cumsum($("x",n,e,t),i,l,c)]}case"Bincount":const r=$("x",n,e,t),o=$("weights",n,e,t),a=$("size",n,e,t);return[s.bincount(r,o,a)];case"DenseBincount":{const i=$("x",n,e,t),l=$("weights",n,e,t),c=$("size",n,e,t),h=$("binaryOutput",n,e,t);return[s.denseBincount(i,l,c,h)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rj=(n,e,t,s=In)=>{switch(n.op){case"ConcatV2":case"Concat":{const r=$("n",n,e,t),o=$("axis",n,e,t);let a=$("tensors",n,e,t);return a=a.slice(0,r),[s.concat(a,o)]}case"Gather":{const r=$("x",n,e,t),o=$("indices",n,e,t);return[s.gather(r,s.cast(o,"int32"),0)]}case"GatherV2":{const r=$("axis",n,e,t),o=$("batchDims",n,e,t),a=$("x",n,e,t),i=$("indices",n,e,t);return[s.gather(a,s.cast(i,"int32"),r,o)]}case"Reverse":{const r=$("dims",n,e,t),o=[];for(let i=0;i<r.length;i++)r[i]&&o.push(i);const a=$("x",n,e,t);return[s.reverse(a,o)]}case"ReverseV2":{const r=$("axis",n,e,t),o=$("x",n,e,t);return[s.reverse(o,r)]}case"Slice":{const r=$("begin",n,e,t),o=$("size",n,e,t);return[s.slice($("x",n,e,t),r,o)]}case"StridedSlice":{const r=$("begin",n,e,t),o=$("end",n,e,t),a=$("strides",n,e,t),i=$("beginMask",n,e,t),l=$("endMask",n,e,t),c=$("ellipsisMask",n,e,t),h=$("newAxisMask",n,e,t),p=$("shrinkAxisMask",n,e,t),f=$("x",n,e,t);return[s.stridedSlice(f,r,o,a,i,l,c,h,p)]}case"Pack":return re(()=>{const r=$("axis",n,e,t),o=$("tensors",n,e,t),a=o[0].shape,i=s.squeeze(o[0]).shape,l=o.map(c=>{const h=Je(c.shape,a);if(!h&&!Je(s.squeeze(c).shape,i))throw new Error("the input tensors shape does not match");return h?c:s.reshape(c,a)});return[s.stack(l,r)]});case"Unpack":{const r=$("axis",n,e,t),o=$("tensor",n,e,t);return s.unstack(o,r)}case"Tile":{const r=$("reps",n,e,t);return[s.tile($("x",n,e,t),r)]}case"Split":case"SplitV":{const r=$("axis",n,e,t),o=$("numOrSizeSplits",n,e,t),a=$("x",n,e,t);return s.split(a,o,r)}case"ScatterNd":{const r=$("indices",n,e,t),o=$("values",n,e,t),a=$("shape",n,e,t);return[s.scatterND(r,o,a)]}case"GatherNd":{const r=$("x",n,e,t),o=$("indices",n,e,t);return[s.gatherND(r,o)]}case"SparseToDense":{const r=$("sparseIndices",n,e,t),o=$("outputShape",n,e,t),a=$("sparseValues",n,e,t),i=$("defaultValue",n,e,t);return[s.sparseToDense(r,a,o,a.dtype===i.dtype?i:s.cast(i,a.dtype))]}case"TensorScatterUpdate":{const r=$("indices",n,e,t),o=$("values",n,e,t),a=$("tensor",n,e,t);return[s.tensorScatterUpdate(a,r,o)]}default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aj=(n,e,t,s=In)=>{switch(n.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:o,emptyRowIndicator:a,reverseIndexMap:i}=s.sparse.sparseFillEmptyRows($("indices",n,e,t),$("values",n,e,t),$("denseShape",n,e,t),$("defaultValue",n,e,t));return[r,o,a,i]}case"SparseReshape":{const{outputIndices:r,outputShape:o}=s.sparse.sparseReshape($("inputIndices",n,e,t),$("inputShape",n,e,t),$("newShape",n,e,t));return[r,o]}case"SparseSegmentMean":return[s.sparse.sparseSegmentMean($("data",n,e,t),$("indices",n,e,t),$("segmentIds",n,e,t))];case"SparseSegmentSum":return[s.sparse.sparseSegmentSum($("data",n,e,t),$("indices",n,e,t),$("segmentIds",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dj=(n,e,t,s=In)=>{switch(n.op){case"FFT":return[s.fft($("x",n,e,t))];case"IFFT":return[s.ifft($("x",n,e,t))];case"RFFT":return[s.rfft($("x",n,e,t))];case"IRFFT":return[s.irfft($("x",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _j=(n,e,t,s=In)=>{switch(n.op){case"StaticRegexReplace":return[s.string.staticRegexReplace($("input",n,e,t),$("pattern",n,e,t),$("rewrite",n,e,t),$("replaceGlobal",n,e,t))];case"StringNGrams":{const{nGrams:r,nGramsSplits:o}=s.string.stringNGrams($("data",n,e,t),$("dataSplits",n,e,t),$("separator",n,e,t),$("nGramWidths",n,e,t),$("leftPad",n,e,t),$("rightPad",n,e,t),$("padWidth",n,e,t),$("preserveShortSequences",n,e,t));return[r,o]}case"StringSplit":{const{indices:r,values:o,shape:a}=s.string.stringSplit($("input",n,e,t),$("delimiter",n,e,t),$("skipEmpty",n,e,t));return[r,o,a]}case"StringToHashBucketFast":return[s.string.stringToHashBucketFast($("input",n,e,t),$("numBuckets",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oj=(n,e,t,s=In)=>{switch(n.op){case"Cast":return[s.cast($("x",n,e,t),$("dtype",n,e,t))];case"ExpandDims":{const r=$("axis",n,e,t);return[s.expandDims($("x",n,e,t),r)]}case"Squeeze":{const r=$("axis",n,e,t);return[s.squeeze($("x",n,e,t),r)]}case"Reshape":return[s.reshape($("x",n,e,t),$("shape",n,e,t))];case"EnsureShape":return[s.ensureShape($("x",n,e,t),$("shape",n,e,t))];case"MirrorPad":return[s.mirrorPad($("x",n,e,t),$("padding",n,e,t),$("mode",n,e,t))];case"PadV2":case"Pad":return[s.pad($("x",n,e,t),$("padding",n,e,t),$("constantValue",n,e,t))];case"SpaceToBatchND":{const r=$("blockShape",n,e,t),o=$("paddings",n,e,t);return[s.spaceToBatchND($("x",n,e,t),r,o)]}case"BatchToSpaceND":{const r=$("blockShape",n,e,t),o=$("crops",n,e,t);return[s.batchToSpaceND($("x",n,e,t),r,o)]}case"DepthToSpace":{const r=$("blockSize",n,e,t),o=$("dataFormat",n,e,t).toUpperCase();return[s.depthToSpace($("x",n,e,t),r,o)]}case"BroadcastTo":return[s.broadcastTo($("x",n,e,t),$("shape",n,e,t))];case"BroadcastArgs":return[s.broadcastArgs($("s0",n,e,t),$("s1",n,e,t))];default:throw TypeError(`Node type ${n.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FC(n,e,t,s,r=re){const o=((a,i,l)=>{switch(a.category){case"arithmetic":return r(()=>uj(a,i,l));case"basic_math":return r(()=>cj(a,i,l));case"control":return gj(a,i,l);case"convolution":return r(()=>yj(a,i,l));case"creation":return r(()=>xj(a,i,l));case"dynamic":return bj(a,i,l);case"evaluation":return r(()=>wj(a,i,l));case"image":return r(()=>Nj(a,i,l));case"graph":return r(()=>vj(a,i,l));case"logical":return r(()=>Cj(a,i,l));case"matrices":return r(()=>Ij(a,i,l));case"normalization":return r(()=>$j(a,i,l));case"ragged":return r(()=>Tj(a,i,l));case"reduction":return r(()=>Ej(a,i,l));case"slice_join":return r(()=>Rj(a,i,l));case"sparse":return r(()=>Aj(a,i,l));case"spectral":return r(()=>Dj(a,i,l));case"string":return r(()=>_j(a,i,l));case"transformation":return r(()=>Oj(a,i,l));case"hash_table":return Sj(a,i,l,s);case"custom":const c=KT(a.op);if(c&&c.customExecutor)return c.customExecutor(new lj(a,i,l));throw TypeError(`Custom op ${a.op} is not registered.`);default:throw TypeError(`Unknown op '${a.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(n,e,t);return la(o)?o.then(a=>[].concat(a)):[].concat(o)}class LC{constructor(e={},t={},s={},r={},o){this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=s,this.functionMap=r,this.parseNodeNameCache=o,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,t){return{id:e,frameName:t,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let t=0;t<this.contexts.length-1;t++){const s=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(s))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(t=>t.id===0&&t.iterationId===0?"":`${t.frameName}-${t.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(const t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PC(n,e,t,s){const r=new Set,o=[];let a=null,i=null;const l=new Set,c=new Set(Object.keys(n).map(f=>ms(f)[0]));s=s||[];const h=new Set(s.map(f=>ms(f.name)[0])),p=[...e];for(;p.length>0;){const f=p.pop();if((Ya(f)||Wj(f)||Uj(f))&&a==null&&(a=f,i=a.children.map(g=>g.name).filter(g=>r.has(g))),r.add(f.name),t[f.name]==null&&!c.has(f.name)&&!h.has(f.name)){if(f.inputs.length===0){o.push(f.name);continue}f.inputs.forEach(g=>{l.has(g.name)||(l.add(g.name),p.push(g))})}}return{inputs:n,outputs:e,usedNodes:r,missingInputs:o,dynamicNode:a,syncInputs:i}}function Fj(n,e){const{usedNodes:t,inputs:s}=e,r=Object.keys(s).map(x=>ms(x)[0]).map(x=>n.nodes[x]),o=n.initNodes||[],a=x=>t.has(typeof x=="string"?x:x.name);function i(x){return[...new Map(x.map(v=>[v.name,v])).values()]}const l=i([...r,...n.weights,...o]).filter(a),c=i([...l,...Object.values(n.nodes)]).filter(a),h=new Map(c.map(x=>[x.name,x])),p={};for(const x of c){p[x.name]=p[x.name]||0;for(const v of x.children)a(v)||(p[v.name]=Number.POSITIVE_INFINITY),p[v.name]=(p[v.name]||0)+1}const f=Object.entries(p).filter(([,x])=>x===0).map(([x])=>x),g=[...f];for(;f.length>0;){const x=f.pop(),v=h.get(x);for(const k of v.children.filter(a))--p[k.name]===0&&(g.push(k.name),f.push(k.name))}const y=g.map(x=>h.get(x)),w=Lj(y,l);return Pj(w,l),w}function Lj(n,e){const t=new Map(n.map(a=>[a.name,a])),s=e.map(a=>a.name),r=new Set(s);for(;s.length>0;){const a=s.pop(),i=t.get(a);for(const l of i.children)!t.has(l.name)||r.has(l.name)||(r.add(l.name),s.push(l.name))}return n.filter(a=>r.has(a.name))}class hf extends Error{constructor(e){super(`NodesExecutionOrderError: ${e}`)}}function Pj(n,e){const t=new Map(n.map((i,l)=>[i.name,l])),s=new Set(e.map(i=>i.name)),r=i=>s.has(typeof i=="string"?i:i.name),o=new Set(n.map(i=>i.name)),a=i=>o.has(typeof i=="string"?i:i.name);for(const i of n){for(const l of i.children.filter(a)){if(!t.has(l.name))throw new hf(`Child ${l.name} of node ${i.name} is unreachable.`);if(t.get(i.name)>t.get(l.name))throw new hf(`Node ${i.name} is scheduled to run after its child ${l.name}.`)}if(!r(i))for(const l of i.inputs){if(!t.has(l.name))throw new hf(`Input ${l.name} of node ${i.name} is unreachable.`);if(t.get(l.name)>t.get(i.name))throw new hf(`Node ${i.name} is scheduled to run before its input ${l.name}.`)}}}function zj(n){const e=new Map(n.map((i,l)=>[i.name,l])),t=Number.MAX_SAFE_INTEGER,s=n.map((i,l)=>Ya(i)?t:l),r=i=>{const l=s[e.get(i.name)];return l??-1},o=n.map((i,l)=>i.children.map(r).reduce((c,h)=>Math.max(c,h),s[l])),a=new Map;for(let i=0;i<n.length;++i){const l=o[i];if(l===t)continue;const c=n[i],h=n[l];a.has(h.name)||a.set(h.name,[]),a.get(h.name).push(c)}return a}const Mj=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),Bj=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),Vj=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function Ya(n){return Mj.has(n.op)}function Wj(n){return Bj.has(n.op)}function Uj(n){return Vj.has(n.op)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xf{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const t=Object.keys(e).map(s=>e[s].map(r=>r.id));this._weightIds=[].concat(...t),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{const t=e.signatureKey||e.name;return e.defaultOutput?`${t}:${e.defaultOutput}`:t})}get functions(){return Object.keys(this._functions).reduce((e,t)=>(e[t]=this._functions[t].signature,e),{})}constructor(e,t){this.graph=e,this.parent=t,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(s=>{this._functionExecutorMap[s]=new Xf(e.functions[s],this)})}getCompilationKey(e,t){const s=e.map(o=>o.name).sort(),r=t.map(o=>o.name).sort();return s.join(this.SEPARATOR)+"--"+r.join(this.SEPARATOR)}compile(e,t){const s=PC(e,t,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:o,syncInputs:a}=s;if(o!=null)throw new Error(`This execution contains the node '${o.name}', which has the dynamic op '${o.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${a}]`);if(r.length>0){const c=t.map(p=>p.name),h=Object.keys(e);throw new Error(`Cannot compute the outputs [${c}] from the provided inputs [${h}]. Missing the following inputs: [${r}]`)}const i=Fj(this.graph,s),l=zj(i);return{orderedNodes:i,nodeLiveUntilMap:l}}cloneAndKeepTensor(e){if(e==null)return null;const t=e.clone();return Jt(t),t}cloneTensorList(e){return e?e.map(s=>this.cloneAndKeepTensor(s)):null}cloneTensorMap(e){return Object.fromEntries(Object.entries(e).map(([t,s])=>[t,this.cloneTensorList(s)]))}execute(e,t){this.disposeIntermediateTensors(),e=this.mapInputs(e);const s=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);const r=s.map(f=>this.graph.nodes[ms(f)[0]]),o=t.map(f=>ms(f)[0]),a=new Set(o);let i=o.map(f=>this.graph.nodes[f]);i.length===0&&(i=this._outputs);const l=this.getCompilationKey(r,i);let c=this.compiledMap.get(l);c==null&&(c=this.compile(e,i),this.compiledMap.set(l,c));try{this.keepIntermediateTensors=oe().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(f){this.keepIntermediateTensors=!1,console.warn(f.message)}const h={},p={};return re(()=>{const f=new LC(this.weightMap,h,p,this.functionExecutorMap,this.parseNodeNameCache),g=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(e).forEach(v=>{const[k,I]=ms(v,f),N=[];N[I]=e[v],g[k]=N,this.keepIntermediateTensors&&(this.clonedTensorsMap[k]=this.cloneTensorList(N))});const y=this.getFrozenTensorIds(g),{orderedNodes:w,nodeLiveUntilMap:x}=c;for(const v of w){if(g[v.name])continue;const k=FC(v,g,f,this._resourceManager);if(la(k))throw new Error(`The execution of the op '${v.op}' returned a promise. Please use model.executeAsync() instead.`);g[v.name]=k,this.keepIntermediateTensors&&(this.clonedTensorsMap[v.name]=this.cloneTensorList(k)),this.checkTensorForDisposalWithNodeLiveUntilInfo(v,g,f,y,a,x.get(v.name))}return this.parent==null&&f.dispose(y),t.map(v=>bn(v,g,f))})}getFrozenTensorIds(e){const t=[].concat.apply([],Object.keys(e).map(s=>e[s]).map(s=>s.map(r=>r.id)));return new Set(t)}checkTensorForDisposal(e,t,s,r,o,a,i){if(!(Ya(t)||a.has(e))){for(const l of s[e])l!=null&&(i[l.id]=(i[l.id]||0)+t.children.length);for(const l of t.inputs){if(Ya(l))continue;const c=RC(l.name,s,r);if(c!=null)for(const h of c){if(!h||h.kept||o.has(h.id))continue;const p=i[h.id];p===1?(h.dispose(),delete i[h.id]):p!=null&&i[h.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(e,t,s,r,o,a){function i(l){return Ya(l)||o.has(l.name)}if(!(Ya(e)||a==null))for(const l of a){if(i(l))continue;const c=RC(l.name,t,s);for(const h of c)!h||h.kept||r.has(h.id)||h.dispose()}}async executeAsync(e,t){return this._executeAsync(e,t)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(e=>{for(const t of e)t&&!t.isDisposed&&t.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(e,t,s=!1,r={},o={}){this.disposeIntermediateTensors(),s||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepIntermediateTensors=oe().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(f){this.keepIntermediateTensors=!1,console.warn(f.message)}const a=new LC(this.weightMap,r,o,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));const i=await this.executeWithControlFlow(e,a,t,s),l=t.map(f=>bn(f,i,a)),c=l.map(f=>f.id),h=Object.keys(e).map(f=>e[f].id),p=new Set([...c,...h,...this.weightIds]);return Object.values(i).forEach(f=>{f.forEach(g=>{g&&!g.isDisposed&&!p.has(g.id)&&g.dispose()})}),this.parent==null&&a.dispose(p),l}async executeFunctionAsync(e,t,s){const r=e.reduce((o,a,i)=>(o[this.inputs[i].name]=a,o),{});return this._executeAsync(r,this.outputNodes,!0,t,s)}async executeWithControlFlow(e,t,s,r){const o=Object.keys(e),a=o.map(N=>this.graph.nodes[ms(N)[0]]),i=s.map(N=>ms(N)[0]),l=new Set(i);let c=i.map(N=>this.graph.nodes[N]);c.length===0&&(c=this._outputs);const{usedNodes:h,missingInputs:p,dynamicNode:f,syncInputs:g}=PC(e,c,this.weightMap,this._initNodes),y=[...a,...this.graph.weights,...this._initNodes||[]].map(N=>({node:N,contexts:t.currentContext})),w=Object.assign({},this.weightMap);Object.keys(e).forEach(N=>{const[T,D]=ms(N),P=[];P[D]=e[N],w[T]=P});const x={},v=this.getFrozenTensorIds(w),k={};for(;y.length>0;){const N=this.processStack(a,y,t,w,k,v,l,x,h);await Promise.all(N)}f==null&&!r&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const I=c.filter(N=>!Ya(N)&&!bn(N.name,w,t)).map(N=>N.name);if(I.length>0){let N="";throw f!=null&&(N=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${g}]`),new Error(`Cannot compute the outputs [${I}] from the provided inputs [${o}]. Consider providing the following inputs: [${p}]. ${N}`)}return w}processStack(e,t,s,r,o,a,i,l,c){const h=[];for(;t.length>0;){const p=t.pop();s.currentContext=p.contexts;let f="";if(p.node.op==="Enter"&&$("isConstant",p.node,r,s)&&([f]=io(p.node.name,s)),r[p.node.name]==null){const g=FC(p.node,r,s,this._resourceManager);f||([f]=io(p.node.name,s));const y=s.currentContext;la(g)?h.push(g.then(w=>(r[f]=w,this.keepIntermediateTensors&&(this.clonedTensorsMap[f]=this.cloneTensorList(w)),s.currentContext=y,this.checkTensorForDisposal(f,p.node,r,s,a,i,l),this.processChildNodes(p.node,t,s,r,o,c),w))):(r[f]=g,this.keepIntermediateTensors&&(this.clonedTensorsMap[f]=this.cloneTensorList(g)),this.checkTensorForDisposal(f,p.node,r,s,a,i,l),this.processChildNodes(p.node,t,s,r,o,c))}else this.processChildNodes(p.node,t,s,r,o,c)}return h}processChildNodes(e,t,s,r,o,a){e.children.forEach(i=>{const[l]=io(i.name,s);o[l]||!a.has(i.name)||(i.op==="Merge"?i.inputNames.some(c=>!!bn(c,r,s))&&(o[l]=!0,t.push({contexts:s.currentContext,node:i})):i.inputNames.every(c=>!!bn(c,r,s))&&(o[l]=!0,t.push({contexts:s.currentContext,node:i})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(t=>t.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(t=>{const s=e[t],[r]=ms(t),o=this.graph.nodes[r];if(o.attrParams.shape&&o.attrParams.shape.value){const a=o.attrParams.shape.value,i=a.length===s.shape.length&&s.shape.every((l,c)=>a[c]===-1||a[c]===l);A(i,()=>`The shape of dict['${o.name}'] provided in model.execute(dict) must be [${a}], but was [${s.shape}]`)}o.attrParams.dtype&&o.attrParams.dtype.value&&A(s.dtype===o.attrParams.dtype.value,()=>`The dtype of dict['${o.name}'] provided in model.execute(dict) must be ${o.attrParams.dtype.value}, but was ${s.dtype}`)})}mapInputs(e){var t,s;const r={};for(const o in e){const a=(s=(t=this._signature)===null||t===void 0?void 0:t.inputs)===null||s===void 0?void 0:s[o];a!=null?r[a.name]=e[o]:r[o]=e[o]}return r}checkInputs(e){const t=Object.keys(e).filter(s=>{const[r]=ms(s);return this.graph.nodes[r]==null});if(t.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${t}] that are not part of graph`)}mapOutputs(e){return e.map(t=>{var s,r;const o=(r=(s=this._signature)===null||s===void 0?void 0:s.outputs)===null||r===void 0?void 0:r[t];return o!=null?o.name:t},{})}checkOutputs(e){e.forEach(t=>{const[s]=ms(t);if(!this.graph.nodes[s])throw new Error(`The output '${t}' is not found in the graph`)})}}class jj{constructor(e={},t={}){this.hashTableNameToHandle=e,this.hashTableMap=t}addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gj="?tfjs-format=file",Hj="model.json";class qj{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e,t={},s=z1){this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=s,t==null&&(this.loadOptions={}),this.resourceManager=new jj}findIOHandler(){const e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{const t=this.io.getLoadHandlers(e,this.loadOptions);if(t.length===0)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error(`Found more than one (${t.length}) load handlers for URL '${[e]}'`);this.handler=t[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return la(e)?e.then(t=>t.getWeightStream==null?this.loadSync(t):this.loadStreaming(t)):this.loadSync(e)}loadSync(e){const t=this.io.decodeWeights(e.weightData,e.weightSpecs);return this.loadWithWeightMap(e,t)}async loadStreaming(e){if(e.getWeightStream==null)throw new Error("Model artifacts missing streamWeights function");const t=await W2(e.getWeightStream(),e.weightSpecs);return this.loadWithWeightMap(e,t)}loadWithWeightMap(e,t){this.artifacts=e;const s=this.artifacts.modelTopology;let r=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){const o=this.artifacts.userDefinedMetadata;o.signature!=null&&(r=o.signature),o.structuredOutputKeys!=null&&(this.structuredOutputKeys=o.structuredOutputKeys)}if(this.signature=r,this.version=`${s.versions.producer}.${s.versions.minConsumer}`,this.executor=new Xf(AC.Instance.transformGraph(s,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(t),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){const o=AC.Instance.transformGraph(e.modelInitializer);this.initializer=new Xf(o),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,t){if(typeof e=="string"){const s=this.io.getSaveHandlers(e);if(s.length===0)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(s.length>1)throw new Error(`Found more than one (${s.length}) save handlers for URL '${e}'`);e=s[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){const t=e instanceof dt?[e]:e,s={};return t.forEach((r,o)=>s[this.structuredOutputKeys[o]]=r),s}return e}predict(e,t){const s=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(s)}async predictAsync(e,t){const s=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(s)}normalizeInputs(e){var t;if(!(e instanceof dt)&&!Array.isArray(e)){const o=(t=this.signature)===null||t===void 0?void 0:t.inputs;if(o!=null)for(const a in o){const i=o[a];i.resourceId!=null&&(e[a]=this.resourceIdToCapturedInput[i.resourceId])}return e}e=Array.isArray(e)?e:[e];const s=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+s!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-s} non-resource placeholders, while there are ${e.length} input tensors provided.`);let r=0;return this.inputNodes.reduce((o,a)=>{var i,l,c;const h=(c=(l=(i=this.signature)===null||i===void 0?void 0:i.inputs)===null||l===void 0?void 0:l[a])===null||c===void 0?void 0:c.resourceId;return h!=null?o[a]=this.resourceIdToCapturedInput[h]:o[a]=e[r++],o},{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){const t=this.initializerSignature.outputs,s=Object.keys(t);for(let r=0;r<s.length;r++){const o=s[r],a=t[o];this.resourceIdToCapturedInput[a.resourceId]=e[r]}}}execute(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const s=this.executor.execute(e,t);return s.length>1?s:s[0]}async executeAsync(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);const s=await this.executor.executeAsync(e,t);return s.length>1?s:s[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((t,s)=>(t[s]=[e[s]],t),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&Ye(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}async function zC(n,e={},t=z1){if(n==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");e==null&&(e={}),e.fromTFHub&&typeof n=="string"&&(n=Kj(n));const s=new qj(n,e,t);return await s.load(),s}function Kj(n){return n.endsWith("/")||(n=n+"/"),`${n}${Hj}${Gj}`}/**
    * @license
    * Copyright 2023 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function Yf(n,e,t,s){return new(t||(t=Promise))(function(r,o){function a(c){try{l(s.next(c))}catch(h){o(h)}}function i(c){try{l(s.throw(c))}catch(h){o(h)}}function l(c){var h;c.done?r(c.value):(h=c.value,h instanceof t?h:new t(function(p){p(h)})).then(a,i)}l((s=s.apply(n,[])).next())})}function Qf(n,e){var t,s,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function i(l){return function(c){return function(h){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,s&&(r=2&h[0]?s.return:h[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,h[1])).done)return r;switch(s=0,r&&(h=[2&h[0],r.value]),h[0]){case 0:case 1:r=h;break;case 4:return a.label++,{value:h[1],done:!1};case 5:a.label++,s=h[1],h=[0];continue;case 7:h=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(h[0]===6||h[0]===2)){a=0;continue}if(h[0]===3&&(!r||h[1]>r[0]&&h[1]<r[3])){a.label=h[1];break}if(h[0]===6&&a.label<r[1]){a.label=r[1],r=h;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(h);break}r[2]&&a.ops.pop(),a.trys.pop();continue}h=e.call(n,a)}catch(p){h=[6,p],s=0}finally{t=r=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([l,c])}}}var Xj={0:"tench, Tinca tinca",1:"goldfish, Carassius auratus",2:"great white shark, white shark, man-eater, man-eating shark, Carcharodon carcharias",3:"tiger shark, Galeocerdo cuvieri",4:"hammerhead, hammerhead shark",5:"electric ray, crampfish, numbfish, torpedo",6:"stingray",7:"cock",8:"hen",9:"ostrich, Struthio camelus",10:"brambling, Fringilla montifringilla",11:"goldfinch, Carduelis carduelis",12:"house finch, linnet, Carpodacus mexicanus",13:"junco, snowbird",14:"indigo bunting, indigo finch, indigo bird, Passerina cyanea",15:"robin, American robin, Turdus migratorius",16:"bulbul",17:"jay",18:"magpie",19:"chickadee",20:"water ouzel, dipper",21:"kite",22:"bald eagle, American eagle, Haliaeetus leucocephalus",23:"vulture",24:"great grey owl, great gray owl, Strix nebulosa",25:"European fire salamander, Salamandra salamandra",26:"common newt, Triturus vulgaris",27:"eft",28:"spotted salamander, Ambystoma maculatum",29:"axolotl, mud puppy, Ambystoma mexicanum",30:"bullfrog, Rana catesbeiana",31:"tree frog, tree-frog",32:"tailed frog, bell toad, ribbed toad, tailed toad, Ascaphus trui",33:"loggerhead, loggerhead turtle, Caretta caretta",34:"leatherback turtle, leatherback, leathery turtle, Dermochelys coriacea",35:"mud turtle",36:"terrapin",37:"box turtle, box tortoise",38:"banded gecko",39:"common iguana, iguana, Iguana iguana",40:"American chameleon, anole, Anolis carolinensis",41:"whiptail, whiptail lizard",42:"agama",43:"frilled lizard, Chlamydosaurus kingi",44:"alligator lizard",45:"Gila monster, Heloderma suspectum",46:"green lizard, Lacerta viridis",47:"African chameleon, Chamaeleo chamaeleon",48:"Komodo dragon, Komodo lizard, dragon lizard, giant lizard, Varanus komodoensis",49:"African crocodile, Nile crocodile, Crocodylus niloticus",50:"American alligator, Alligator mississipiensis",51:"triceratops",52:"thunder snake, worm snake, Carphophis amoenus",53:"ringneck snake, ring-necked snake, ring snake",54:"hognose snake, puff adder, sand viper",55:"green snake, grass snake",56:"king snake, kingsnake",57:"garter snake, grass snake",58:"water snake",59:"vine snake",60:"night snake, Hypsiglena torquata",61:"boa constrictor, Constrictor constrictor",62:"rock python, rock snake, Python sebae",63:"Indian cobra, Naja naja",64:"green mamba",65:"sea snake",66:"horned viper, cerastes, sand viper, horned asp, Cerastes cornutus",67:"diamondback, diamondback rattlesnake, Crotalus adamanteus",68:"sidewinder, horned rattlesnake, Crotalus cerastes",69:"trilobite",70:"harvestman, daddy longlegs, Phalangium opilio",71:"scorpion",72:"black and gold garden spider, Argiope aurantia",73:"barn spider, Araneus cavaticus",74:"garden spider, Aranea diademata",75:"black widow, Latrodectus mactans",76:"tarantula",77:"wolf spider, hunting spider",78:"tick",79:"centipede",80:"black grouse",81:"ptarmigan",82:"ruffed grouse, partridge, Bonasa umbellus",83:"prairie chicken, prairie grouse, prairie fowl",84:"peacock",85:"quail",86:"partridge",87:"African grey, African gray, Psittacus erithacus",88:"macaw",89:"sulphur-crested cockatoo, Kakatoe galerita, Cacatua galerita",90:"lorikeet",91:"coucal",92:"bee eater",93:"hornbill",94:"hummingbird",95:"jacamar",96:"toucan",97:"drake",98:"red-breasted merganser, Mergus serrator",99:"goose",100:"black swan, Cygnus atratus",101:"tusker",102:"echidna, spiny anteater, anteater",103:"platypus, duckbill, duckbilled platypus, duck-billed platypus, Ornithorhynchus anatinus",104:"wallaby, brush kangaroo",105:"koala, koala bear, kangaroo bear, native bear, Phascolarctos cinereus",106:"wombat",107:"jelly fish",108:"sea anemone, anemone",109:"brain coral",110:"flatworm, platyhelminth",111:"nematode, nematode worm, roundworm",112:"conch",113:"snail",114:"slug",115:"sea slug, nudibranch",116:"chiton, coat-of-mail shell, sea cradle, polyplacophore",117:"chambered nautilus, pearly nautilus, nautilus",118:"Dungeness crab, Cancer magister",119:"rock crab, Cancer irroratus",120:"fiddler crab",121:"king crab, Alaska crab, Alaskan king crab, Alaska king crab, Paralithodes camtschatica",122:"American lobster, Northern lobster, Maine lobster, Homarus americanus",123:"spiny lobster, langouste, rock lobster, crawfish, crayfish, sea crawfish",124:"crayfish, crawfish, crawdad, crawdaddy",125:"hermit crab",126:"isopod",127:"white stork, Ciconia ciconia",128:"black stork, Ciconia nigra",129:"spoonbill",130:"flamingo",131:"little blue heron, Egretta caerulea",132:"American egret, great white heron, Egretta albus",133:"bittern",134:"crane",135:"limpkin, Aramus pictus",136:"European gallinule, Porphyrio porphyrio",137:"American coot, marsh hen, mud hen, water hen, Fulica americana",138:"bustard",139:"ruddy turnstone, Arenaria interpres",140:"red-backed sandpiper, dunlin, Erolia alpina",141:"redshank, Tringa totanus",142:"dowitcher",143:"oystercatcher, oyster catcher",144:"pelican",145:"king penguin, Aptenodytes patagonica",146:"albatross, mollymawk",147:"grey whale, gray whale, devilfish, Eschrichtius gibbosus, Eschrichtius robustus",148:"killer whale, killer, orca, grampus, sea wolf, Orcinus orca",149:"dugong, Dugong dugon",150:"sea lion",151:"Chihuahua",152:"Japanese spaniel",153:"Maltese dog, Maltese terrier, Maltese",154:"Pekinese, Pekingese, Peke",155:"Shih-Tzu",156:"Blenheim spaniel",157:"papillon",158:"toy terrier",159:"Rhodesian ridgeback",160:"Afghan hound, Afghan",161:"basset, basset hound",162:"beagle",163:"bloodhound, sleuthhound",164:"bluetick",165:"black-and-tan coonhound",166:"Walker hound, Walker foxhound",167:"English foxhound",168:"redbone",169:"borzoi, Russian wolfhound",170:"Irish wolfhound",171:"Italian greyhound",172:"whippet",173:"Ibizan hound, Ibizan Podenco",174:"Norwegian elkhound, elkhound",175:"otterhound, otter hound",176:"Saluki, gazelle hound",177:"Scottish deerhound, deerhound",178:"Weimaraner",179:"Staffordshire bullterrier, Staffordshire bull terrier",180:"American Staffordshire terrier, Staffordshire terrier, American pit bull terrier, pit bull terrier",181:"Bedlington terrier",182:"Border terrier",183:"Kerry blue terrier",184:"Irish terrier",185:"Norfolk terrier",186:"Norwich terrier",187:"Yorkshire terrier",188:"wire-haired fox terrier",189:"Lakeland terrier",190:"Sealyham terrier, Sealyham",191:"Airedale, Airedale terrier",192:"cairn, cairn terrier",193:"Australian terrier",194:"Dandie Dinmont, Dandie Dinmont terrier",195:"Boston bull, Boston terrier",196:"miniature schnauzer",197:"giant schnauzer",198:"standard schnauzer",199:"Scotch terrier, Scottish terrier, Scottie",200:"Tibetan terrier, chrysanthemum dog",201:"silky terrier, Sydney silky",202:"soft-coated wheaten terrier",203:"West Highland white terrier",204:"Lhasa, Lhasa apso",205:"flat-coated retriever",206:"curly-coated retriever",207:"golden retriever",208:"Labrador retriever",209:"Chesapeake Bay retriever",210:"German short-haired pointer",211:"vizsla, Hungarian pointer",212:"English setter",213:"Irish setter, red setter",214:"Gordon setter",215:"Brittany spaniel",216:"clumber, clumber spaniel",217:"English springer, English springer spaniel",218:"Welsh springer spaniel",219:"cocker spaniel, English cocker spaniel, cocker",220:"Sussex spaniel",221:"Irish water spaniel",222:"kuvasz",223:"schipperke",224:"groenendael",225:"malinois",226:"briard",227:"kelpie",228:"komondor",229:"Old English sheepdog, bobtail",230:"Shetland sheepdog, Shetland sheep dog, Shetland",231:"collie",232:"Border collie",233:"Bouvier des Flandres, Bouviers des Flandres",234:"Rottweiler",235:"German shepherd, German shepherd dog, German police dog, alsatian",236:"Doberman, Doberman pinscher",237:"miniature pinscher",238:"Greater Swiss Mountain dog",239:"Bernese mountain dog",240:"Appenzeller",241:"EntleBucher",242:"boxer",243:"bull mastiff",244:"Tibetan mastiff",245:"French bulldog",246:"Great Dane",247:"Saint Bernard, St Bernard",248:"Eskimo dog, husky",249:"malamute, malemute, Alaskan malamute",250:"Siberian husky",251:"dalmatian, coach dog, carriage dog",252:"affenpinscher, monkey pinscher, monkey dog",253:"basenji",254:"pug, pug-dog",255:"Leonberg",256:"Newfoundland, Newfoundland dog",257:"Great Pyrenees",258:"Samoyed, Samoyede",259:"Pomeranian",260:"chow, chow chow",261:"keeshond",262:"Brabancon griffon",263:"Pembroke, Pembroke Welsh corgi",264:"Cardigan, Cardigan Welsh corgi",265:"toy poodle",266:"miniature poodle",267:"standard poodle",268:"Mexican hairless",269:"timber wolf, grey wolf, gray wolf, Canis lupus",270:"white wolf, Arctic wolf, Canis lupus tundrarum",271:"red wolf, maned wolf, Canis rufus, Canis niger",272:"coyote, prairie wolf, brush wolf, Canis latrans",273:"dingo, warrigal, warragal, Canis dingo",274:"dhole, Cuon alpinus",275:"African hunting dog, hyena dog, Cape hunting dog, Lycaon pictus",276:"hyena, hyaena",277:"red fox, Vulpes vulpes",278:"kit fox, Vulpes macrotis",279:"Arctic fox, white fox, Alopex lagopus",280:"grey fox, gray fox, Urocyon cinereoargenteus",281:"tabby, tabby cat",282:"tiger cat",283:"Persian cat",284:"Siamese cat, Siamese",285:"Egyptian cat",286:"cougar, puma, catamount, mountain lion, painter, panther, Felis concolor",287:"lynx, catamount",288:"leopard, Panthera pardus",289:"snow leopard, ounce, Panthera uncia",290:"jaguar, panther, Panthera onca, Felis onca",291:"lion, king of beasts, Panthera leo",292:"tiger, Panthera tigris",293:"cheetah, chetah, Acinonyx jubatus",294:"brown bear, bruin, Ursus arctos",295:"American black bear, black bear, Ursus americanus, Euarctos americanus",296:"ice bear, polar bear, Ursus Maritimus, Thalarctos maritimus",297:"sloth bear, Melursus ursinus, Ursus ursinus",298:"mongoose",299:"meerkat, mierkat",300:"tiger beetle",301:"ladybug, ladybeetle, lady beetle, ladybird, ladybird beetle",302:"ground beetle, carabid beetle",303:"long-horned beetle, longicorn, longicorn beetle",304:"leaf beetle, chrysomelid",305:"dung beetle",306:"rhinoceros beetle",307:"weevil",308:"fly",309:"bee",310:"ant, emmet, pismire",311:"grasshopper, hopper",312:"cricket",313:"walking stick, walkingstick, stick insect",314:"cockroach, roach",315:"mantis, mantid",316:"cicada, cicala",317:"leafhopper",318:"lacewing, lacewing fly",319:"dragonfly, darning needle, devil's darning needle, sewing needle, snake feeder, snake doctor, mosquito hawk, skeeter hawk",320:"damselfly",321:"admiral",322:"ringlet, ringlet butterfly",323:"monarch, monarch butterfly, milkweed butterfly, Danaus plexippus",324:"cabbage butterfly",325:"sulphur butterfly, sulfur butterfly",326:"lycaenid, lycaenid butterfly",327:"starfish, sea star",328:"sea urchin",329:"sea cucumber, holothurian",330:"wood rabbit, cottontail, cottontail rabbit",331:"hare",332:"Angora, Angora rabbit",333:"hamster",334:"porcupine, hedgehog",335:"fox squirrel, eastern fox squirrel, Sciurus niger",336:"marmot",337:"beaver",338:"guinea pig, Cavia cobaya",339:"sorrel",340:"zebra",341:"hog, pig, grunter, squealer, Sus scrofa",342:"wild boar, boar, Sus scrofa",343:"warthog",344:"hippopotamus, hippo, river horse, Hippopotamus amphibius",345:"ox",346:"water buffalo, water ox, Asiatic buffalo, Bubalus bubalis",347:"bison",348:"ram, tup",349:"bighorn, bighorn sheep, cimarron, Rocky Mountain bighorn, Rocky Mountain sheep, Ovis canadensis",350:"ibex, Capra ibex",351:"hartebeest",352:"impala, Aepyceros melampus",353:"gazelle",354:"Arabian camel, dromedary, Camelus dromedarius",355:"llama",356:"weasel",357:"mink",358:"polecat, fitch, foulmart, foumart, Mustela putorius",359:"black-footed ferret, ferret, Mustela nigripes",360:"otter",361:"skunk, polecat, wood pussy",362:"badger",363:"armadillo",364:"three-toed sloth, ai, Bradypus tridactylus",365:"orangutan, orang, orangutang, Pongo pygmaeus",366:"gorilla, Gorilla gorilla",367:"chimpanzee, chimp, Pan troglodytes",368:"gibbon, Hylobates lar",369:"siamang, Hylobates syndactylus, Symphalangus syndactylus",370:"guenon, guenon monkey",371:"patas, hussar monkey, Erythrocebus patas",372:"baboon",373:"macaque",374:"langur",375:"colobus, colobus monkey",376:"proboscis monkey, Nasalis larvatus",377:"marmoset",378:"capuchin, ringtail, Cebus capucinus",379:"howler monkey, howler",380:"titi, titi monkey",381:"spider monkey, Ateles geoffroyi",382:"squirrel monkey, Saimiri sciureus",383:"Madagascar cat, ring-tailed lemur, Lemur catta",384:"indri, indris, Indri indri, Indri brevicaudatus",385:"Indian elephant, Elephas maximus",386:"African elephant, Loxodonta africana",387:"lesser panda, red panda, panda, bear cat, cat bear, Ailurus fulgens",388:"giant panda, panda, panda bear, coon bear, Ailuropoda melanoleuca",389:"barracouta, snoek",390:"eel",391:"coho, cohoe, coho salmon, blue jack, silver salmon, Oncorhynchus kisutch",392:"rock beauty, Holocanthus tricolor",393:"anemone fish",394:"sturgeon",395:"gar, garfish, garpike, billfish, Lepisosteus osseus",396:"lionfish",397:"puffer, pufferfish, blowfish, globefish",398:"abacus",399:"abaya",400:"academic gown, academic robe, judge's robe",401:"accordion, piano accordion, squeeze box",402:"acoustic guitar",403:"aircraft carrier, carrier, flattop, attack aircraft carrier",404:"airliner",405:"airship, dirigible",406:"altar",407:"ambulance",408:"amphibian, amphibious vehicle",409:"analog clock",410:"apiary, bee house",411:"apron",412:"ashcan, trash can, garbage can, wastebin, ash bin, ash-bin, ashbin, dustbin, trash barrel, trash bin",413:"assault rifle, assault gun",414:"backpack, back pack, knapsack, packsack, rucksack, haversack",415:"bakery, bakeshop, bakehouse",416:"balance beam, beam",417:"balloon",418:"ballpoint, ballpoint pen, ballpen, Biro",419:"Band Aid",420:"banjo",421:"bannister, banister, balustrade, balusters, handrail",422:"barbell",423:"barber chair",424:"barbershop",425:"barn",426:"barometer",427:"barrel, cask",428:"barrow, garden cart, lawn cart, wheelbarrow",429:"baseball",430:"basketball",431:"bassinet",432:"bassoon",433:"bathing cap, swimming cap",434:"bath towel",435:"bathtub, bathing tub, bath, tub",436:"beach wagon, station wagon, wagon, estate car, beach waggon, station waggon, waggon",437:"beacon, lighthouse, beacon light, pharos",438:"beaker",439:"bearskin, busby, shako",440:"beer bottle",441:"beer glass",442:"bell cote, bell cot",443:"bib",444:"bicycle-built-for-two, tandem bicycle, tandem",445:"bikini, two-piece",446:"binder, ring-binder",447:"binoculars, field glasses, opera glasses",448:"birdhouse",449:"boathouse",450:"bobsled, bobsleigh, bob",451:"bolo tie, bolo, bola tie, bola",452:"bonnet, poke bonnet",453:"bookcase",454:"bookshop, bookstore, bookstall",455:"bottlecap",456:"bow",457:"bow tie, bow-tie, bowtie",458:"brass, memorial tablet, plaque",459:"brassiere, bra, bandeau",460:"breakwater, groin, groyne, mole, bulwark, seawall, jetty",461:"breastplate, aegis, egis",462:"broom",463:"bucket, pail",464:"buckle",465:"bulletproof vest",466:"bullet train, bullet",467:"butcher shop, meat market",468:"cab, hack, taxi, taxicab",469:"caldron, cauldron",470:"candle, taper, wax light",471:"cannon",472:"canoe",473:"can opener, tin opener",474:"cardigan",475:"car mirror",476:"carousel, carrousel, merry-go-round, roundabout, whirligig",477:"carpenter's kit, tool kit",478:"carton",479:"car wheel",480:"cash machine, cash dispenser, automated teller machine, automatic teller machine, automated teller, automatic teller, ATM",481:"cassette",482:"cassette player",483:"castle",484:"catamaran",485:"CD player",486:"cello, violoncello",487:"cellular telephone, cellular phone, cellphone, cell, mobile phone",488:"chain",489:"chainlink fence",490:"chain mail, ring mail, mail, chain armor, chain armour, ring armor, ring armour",491:"chain saw, chainsaw",492:"chest",493:"chiffonier, commode",494:"chime, bell, gong",495:"china cabinet, china closet",496:"Christmas stocking",497:"church, church building",498:"cinema, movie theater, movie theatre, movie house, picture palace",499:"cleaver, meat cleaver, chopper",500:"cliff dwelling",501:"cloak",502:"clog, geta, patten, sabot",503:"cocktail shaker",504:"coffee mug",505:"coffeepot",506:"coil, spiral, volute, whorl, helix",507:"combination lock",508:"computer keyboard, keypad",509:"confectionery, confectionary, candy store",510:"container ship, containership, container vessel",511:"convertible",512:"corkscrew, bottle screw",513:"cornet, horn, trumpet, trump",514:"cowboy boot",515:"cowboy hat, ten-gallon hat",516:"cradle",517:"crane",518:"crash helmet",519:"crate",520:"crib, cot",521:"Crock Pot",522:"croquet ball",523:"crutch",524:"cuirass",525:"dam, dike, dyke",526:"desk",527:"desktop computer",528:"dial telephone, dial phone",529:"diaper, nappy, napkin",530:"digital clock",531:"digital watch",532:"dining table, board",533:"dishrag, dishcloth",534:"dishwasher, dish washer, dishwashing machine",535:"disk brake, disc brake",536:"dock, dockage, docking facility",537:"dogsled, dog sled, dog sleigh",538:"dome",539:"doormat, welcome mat",540:"drilling platform, offshore rig",541:"drum, membranophone, tympan",542:"drumstick",543:"dumbbell",544:"Dutch oven",545:"electric fan, blower",546:"electric guitar",547:"electric locomotive",548:"entertainment center",549:"envelope",550:"espresso maker",551:"face powder",552:"feather boa, boa",553:"file, file cabinet, filing cabinet",554:"fireboat",555:"fire engine, fire truck",556:"fire screen, fireguard",557:"flagpole, flagstaff",558:"flute, transverse flute",559:"folding chair",560:"football helmet",561:"forklift",562:"fountain",563:"fountain pen",564:"four-poster",565:"freight car",566:"French horn, horn",567:"frying pan, frypan, skillet",568:"fur coat",569:"garbage truck, dustcart",570:"gasmask, respirator, gas helmet",571:"gas pump, gasoline pump, petrol pump, island dispenser",572:"goblet",573:"go-kart",574:"golf ball",575:"golfcart, golf cart",576:"gondola",577:"gong, tam-tam",578:"gown",579:"grand piano, grand",580:"greenhouse, nursery, glasshouse",581:"grille, radiator grille",582:"grocery store, grocery, food market, market",583:"guillotine",584:"hair slide",585:"hair spray",586:"half track",587:"hammer",588:"hamper",589:"hand blower, blow dryer, blow drier, hair dryer, hair drier",590:"hand-held computer, hand-held microcomputer",591:"handkerchief, hankie, hanky, hankey",592:"hard disc, hard disk, fixed disk",593:"harmonica, mouth organ, harp, mouth harp",594:"harp",595:"harvester, reaper",596:"hatchet",597:"holster",598:"home theater, home theatre",599:"honeycomb",600:"hook, claw",601:"hoopskirt, crinoline",602:"horizontal bar, high bar",603:"horse cart, horse-cart",604:"hourglass",605:"iPod",606:"iron, smoothing iron",607:"jack-o'-lantern",608:"jean, blue jean, denim",609:"jeep, landrover",610:"jersey, T-shirt, tee shirt",611:"jigsaw puzzle",612:"jinrikisha, ricksha, rickshaw",613:"joystick",614:"kimono",615:"knee pad",616:"knot",617:"lab coat, laboratory coat",618:"ladle",619:"lampshade, lamp shade",620:"laptop, laptop computer",621:"lawn mower, mower",622:"lens cap, lens cover",623:"letter opener, paper knife, paperknife",624:"library",625:"lifeboat",626:"lighter, light, igniter, ignitor",627:"limousine, limo",628:"liner, ocean liner",629:"lipstick, lip rouge",630:"Loafer",631:"lotion",632:"loudspeaker, speaker, speaker unit, loudspeaker system, speaker system",633:"loupe, jeweler's loupe",634:"lumbermill, sawmill",635:"magnetic compass",636:"mailbag, postbag",637:"mailbox, letter box",638:"maillot",639:"maillot, tank suit",640:"manhole cover",641:"maraca",642:"marimba, xylophone",643:"mask",644:"matchstick",645:"maypole",646:"maze, labyrinth",647:"measuring cup",648:"medicine chest, medicine cabinet",649:"megalith, megalithic structure",650:"microphone, mike",651:"microwave, microwave oven",652:"military uniform",653:"milk can",654:"minibus",655:"miniskirt, mini",656:"minivan",657:"missile",658:"mitten",659:"mixing bowl",660:"mobile home, manufactured home",661:"Model T",662:"modem",663:"monastery",664:"monitor",665:"moped",666:"mortar",667:"mortarboard",668:"mosque",669:"mosquito net",670:"motor scooter, scooter",671:"mountain bike, all-terrain bike, off-roader",672:"mountain tent",673:"mouse, computer mouse",674:"mousetrap",675:"moving van",676:"muzzle",677:"nail",678:"neck brace",679:"necklace",680:"nipple",681:"notebook, notebook computer",682:"obelisk",683:"oboe, hautboy, hautbois",684:"ocarina, sweet potato",685:"odometer, hodometer, mileometer, milometer",686:"oil filter",687:"organ, pipe organ",688:"oscilloscope, scope, cathode-ray oscilloscope, CRO",689:"overskirt",690:"oxcart",691:"oxygen mask",692:"packet",693:"paddle, boat paddle",694:"paddlewheel, paddle wheel",695:"padlock",696:"paintbrush",697:"pajama, pyjama, pj's, jammies",698:"palace",699:"panpipe, pandean pipe, syrinx",700:"paper towel",701:"parachute, chute",702:"parallel bars, bars",703:"park bench",704:"parking meter",705:"passenger car, coach, carriage",706:"patio, terrace",707:"pay-phone, pay-station",708:"pedestal, plinth, footstall",709:"pencil box, pencil case",710:"pencil sharpener",711:"perfume, essence",712:"Petri dish",713:"photocopier",714:"pick, plectrum, plectron",715:"pickelhaube",716:"picket fence, paling",717:"pickup, pickup truck",718:"pier",719:"piggy bank, penny bank",720:"pill bottle",721:"pillow",722:"ping-pong ball",723:"pinwheel",724:"pirate, pirate ship",725:"pitcher, ewer",726:"plane, carpenter's plane, woodworking plane",727:"planetarium",728:"plastic bag",729:"plate rack",730:"plow, plough",731:"plunger, plumber's helper",732:"Polaroid camera, Polaroid Land camera",733:"pole",734:"police van, police wagon, paddy wagon, patrol wagon, wagon, black Maria",735:"poncho",736:"pool table, billiard table, snooker table",737:"pop bottle, soda bottle",738:"pot, flowerpot",739:"potter's wheel",740:"power drill",741:"prayer rug, prayer mat",742:"printer",743:"prison, prison house",744:"projectile, missile",745:"projector",746:"puck, hockey puck",747:"punching bag, punch bag, punching ball, punchball",748:"purse",749:"quill, quill pen",750:"quilt, comforter, comfort, puff",751:"racer, race car, racing car",752:"racket, racquet",753:"radiator",754:"radio, wireless",755:"radio telescope, radio reflector",756:"rain barrel",757:"recreational vehicle, RV, R.V.",758:"reel",759:"reflex camera",760:"refrigerator, icebox",761:"remote control, remote",762:"restaurant, eating house, eating place, eatery",763:"revolver, six-gun, six-shooter",764:"rifle",765:"rocking chair, rocker",766:"rotisserie",767:"rubber eraser, rubber, pencil eraser",768:"rugby ball",769:"rule, ruler",770:"running shoe",771:"safe",772:"safety pin",773:"saltshaker, salt shaker",774:"sandal",775:"sarong",776:"sax, saxophone",777:"scabbard",778:"scale, weighing machine",779:"school bus",780:"schooner",781:"scoreboard",782:"screen, CRT screen",783:"screw",784:"screwdriver",785:"seat belt, seatbelt",786:"sewing machine",787:"shield, buckler",788:"shoe shop, shoe-shop, shoe store",789:"shoji",790:"shopping basket",791:"shopping cart",792:"shovel",793:"shower cap",794:"shower curtain",795:"ski",796:"ski mask",797:"sleeping bag",798:"slide rule, slipstick",799:"sliding door",800:"slot, one-armed bandit",801:"snorkel",802:"snowmobile",803:"snowplow, snowplough",804:"soap dispenser",805:"soccer ball",806:"sock",807:"solar dish, solar collector, solar furnace",808:"sombrero",809:"soup bowl",810:"space bar",811:"space heater",812:"space shuttle",813:"spatula",814:"speedboat",815:"spider web, spider's web",816:"spindle",817:"sports car, sport car",818:"spotlight, spot",819:"stage",820:"steam locomotive",821:"steel arch bridge",822:"steel drum",823:"stethoscope",824:"stole",825:"stone wall",826:"stopwatch, stop watch",827:"stove",828:"strainer",829:"streetcar, tram, tramcar, trolley, trolley car",830:"stretcher",831:"studio couch, day bed",832:"stupa, tope",833:"submarine, pigboat, sub, U-boat",834:"suit, suit of clothes",835:"sundial",836:"sunglass",837:"sunglasses, dark glasses, shades",838:"sunscreen, sunblock, sun blocker",839:"suspension bridge",840:"swab, swob, mop",841:"sweatshirt",842:"swimming trunks, bathing trunks",843:"swing",844:"switch, electric switch, electrical switch",845:"syringe",846:"table lamp",847:"tank, army tank, armored combat vehicle, armoured combat vehicle",848:"tape player",849:"teapot",850:"teddy, teddy bear",851:"television, television system",852:"tennis ball",853:"thatch, thatched roof",854:"theater curtain, theatre curtain",855:"thimble",856:"thresher, thrasher, threshing machine",857:"throne",858:"tile roof",859:"toaster",860:"tobacco shop, tobacconist shop, tobacconist",861:"toilet seat",862:"torch",863:"totem pole",864:"tow truck, tow car, wrecker",865:"toyshop",866:"tractor",867:"trailer truck, tractor trailer, trucking rig, rig, articulated lorry, semi",868:"tray",869:"trench coat",870:"tricycle, trike, velocipede",871:"trimaran",872:"tripod",873:"triumphal arch",874:"trolleybus, trolley coach, trackless trolley",875:"trombone",876:"tub, vat",877:"turnstile",878:"typewriter keyboard",879:"umbrella",880:"unicycle, monocycle",881:"upright, upright piano",882:"vacuum, vacuum cleaner",883:"vase",884:"vault",885:"velvet",886:"vending machine",887:"vestment",888:"viaduct",889:"violin, fiddle",890:"volleyball",891:"waffle iron",892:"wall clock",893:"wallet, billfold, notecase, pocketbook",894:"wardrobe, closet, press",895:"warplane, military plane",896:"washbasin, handbasin, washbowl, lavabo, wash-hand basin",897:"washer, automatic washer, washing machine",898:"water bottle",899:"water jug",900:"water tower",901:"whiskey jug",902:"whistle",903:"wig",904:"window screen",905:"window shade",906:"Windsor tie",907:"wine bottle",908:"wing",909:"wok",910:"wooden spoon",911:"wool, woolen, woollen",912:"worm fence, snake fence, snake-rail fence, Virginia fence",913:"wreck",914:"yawl",915:"yurt",916:"web site, website, internet site, site",917:"comic book",918:"crossword puzzle, crossword",919:"street sign",920:"traffic light, traffic signal, stoplight",921:"book jacket, dust cover, dust jacket, dust wrapper",922:"menu",923:"plate",924:"guacamole",925:"consomme",926:"hot pot, hotpot",927:"trifle",928:"ice cream, icecream",929:"ice lolly, lolly, lollipop, popsicle",930:"French loaf",931:"bagel, beigel",932:"pretzel",933:"cheeseburger",934:"hotdog, hot dog, red hot",935:"mashed potato",936:"head cabbage",937:"broccoli",938:"cauliflower",939:"zucchini, courgette",940:"spaghetti squash",941:"acorn squash",942:"butternut squash",943:"cucumber, cuke",944:"artichoke, globe artichoke",945:"bell pepper",946:"cardoon",947:"mushroom",948:"Granny Smith",949:"strawberry",950:"orange",951:"lemon",952:"fig",953:"pineapple, ananas",954:"banana",955:"jackfruit, jak, jack",956:"custard apple",957:"pomegranate",958:"hay",959:"carbonara",960:"chocolate sauce, chocolate syrup",961:"dough",962:"meat loaf, meatloaf",963:"pizza, pizza pie",964:"potpie",965:"burrito",966:"red wine",967:"espresso",968:"cup",969:"eggnog",970:"alp",971:"bubble",972:"cliff, drop, drop-off",973:"coral reef",974:"geyser",975:"lakeside, lakeshore",976:"promontory, headland, head, foreland",977:"sandbar, sand bar",978:"seashore, coast, seacoast, sea-coast",979:"valley, vale",980:"volcano",981:"ballplayer, baseball player",982:"groom, bridegroom",983:"scuba diver",984:"rapeseed",985:"daisy",986:"yellow lady's slipper, yellow lady-slipper, Cypripedium calceolus, Cypripedium parviflorum",987:"corn",988:"acorn",989:"hip, rose hip, rosehip",990:"buckeye, horse chestnut, conker",991:"coral fungus",992:"agaric",993:"gyromitra",994:"stinkhorn, carrion fungus",995:"earthstar",996:"hen-of-the-woods, hen of the woods, Polyporus frondosus, Grifola frondosa",997:"bolete",998:"ear, spike, capitulum",999:"toilet tissue, toilet paper, bathroom tissue"},Yo=224,Yj={"1.00":"module_apply_default/MobilenetV1/Logits/global_pool","2.00":"module_apply_default/MobilenetV2/Logits/AvgPool"},fl={"1.00":{.25:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_025_224/classification/1",inputRange:[0,1]},"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_050_224/classification/1",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_075_224/classification/1",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v1_100_224/classification/1",inputRange:[0,1]}},"2.00":{"0.50":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_050_224/classification/2",inputRange:[0,1]},.75:{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_075_224/classification/2",inputRange:[0,1]},"1.00":{url:"https://tfhub.dev/google/imagenet/mobilenet_v2_100_224/classification/2",inputRange:[0,1]}}};function Qj(n){return n===void 0&&(n={version:1,alpha:1}),Yf(this,void 0,void 0,function(){var e,t,s,r,o,a,i;return Qf(this,function(l){switch(l.label){case 0:if(wU==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");if(e=n.version.toFixed(2),t=n.alpha?n.alpha.toFixed(2):"",s=-1,r=1,n.modelUrl==null){if(!(e in fl))throw new Error("Invalid version of MobileNet. Valid versions are: "+Object.keys(fl));if(!(t in fl[e]))throw new Error("MobileNet constructed with invalid alpha "+n.alpha+". Valid multipliers for this version are: "+Object.keys(fl[e])+".");a=fl[e][t].inputRange,s=a[0],r=a[1]}return n.inputRange!=null&&(i=n.inputRange,s=i[0],r=i[1]),[4,(o=new Zj(e,t,n.modelUrl,s,r)).load()];case 1:return l.sent(),[2,o]}})})}var Zj=function(){function n(e,t,s,r,o){r===void 0&&(r=-1),o===void 0&&(o=1),this.version=e,this.alpha=t,this.modelUrl=s,this.inputMin=r,this.inputMax=o,this.normalizationConstant=(o-r)/255}return n.prototype.load=function(){return Yf(this,void 0,void 0,function(){var e,t,s,r,o=this;return Qf(this,function(a){switch(a.label){case 0:return this.modelUrl?(e=this,[4,zC(this.modelUrl)]):[3,2];case 1:return e.model=a.sent(),[3,4];case 2:return t=fl[this.version][this.alpha].url,s=this,[4,zC(t,{fromTFHub:!0})];case 3:s.model=a.sent(),a.label=4;case 4:return[4,(r=re(function(){return o.model.predict(Vt([1,Yo,Yo,3]))})).data()];case 5:return a.sent(),r.dispose(),[2]}})})},n.prototype.infer=function(e,t){var s=this;return t===void 0&&(t=!1),re(function(){e instanceof dt||(e=hT(e));var r=fe(G(ke(e,"float32"),s.normalizationConstant),s.inputMin),o=r;(e.shape[0]!==Yo||e.shape[1]!==Yo)&&(o=Xs.resizeBilinear(r,[Yo,Yo],!0));var a,i=q(o,[-1,Yo,Yo,3]);if(t){var l=Yj[s.version],c=s.model.execute(i,l);a=Co(c,[1,2])}else{var h=s.model.predict(i);a=tt(h,[0,1],[-1,1e3])}return a})},n.prototype.classify=function(e,t){return t===void 0&&(t=3),Yf(this,void 0,void 0,function(){var s,r;return Qf(this,function(o){switch(o.label){case 0:return[4,Jj(s=this.infer(e),t)];case 1:return r=o.sent(),s.dispose(),[2,r]}})})},n}();function Jj(n,e){return Yf(this,void 0,void 0,function(){var t,s,r,o,a,i,l;return Qf(this,function(c){switch(c.label){case 0:return[4,(t=Pu(n)).data()];case 1:for(s=c.sent(),t.dispose(),r=[],l=0;l<s.length;l++)r.push({value:s[l],index:l});for(r.sort(function(h,p){return p.value-h.value}),o=new Float32Array(e),a=new Int32Array(e),l=0;l<e;l++)o[l]=r[l].value,a[l]=r[l].index;for(i=[],l=0;l<a.length;l++)i.push({className:Xj[a[l]],probability:o[l]});return[2,i]}})})}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QT={kernelName:md,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>G(n,Ri(ke(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eG={kernelName:Ll,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=gt(ke(t,"float32")),r=pn(Te(Me(1),s));return St(Fe(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tG={kernelName:Pl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=pn(Te(gt(ke(t,"float32")),1));return Fe(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nG={kernelName:$i,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=He(t.shape,s.shape);return{a:()=>{let i=n;const l=Qt(t.shape,r);return l.length>0&&(i=Ae(i,l)),q(i,t.shape)},b:()=>{let i=n;const l=Qt(s.shape,r);return l.length>0&&(i=Ae(i,l)),q(i,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sG={kernelName:gd,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((s,r)=>{t[r]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rG={kernelName:yd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>st(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oG={kernelName:xd,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>st(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aG={kernelName:zl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Fe(n,pn(Te(Me(1),gt(ke(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iG={kernelName:Ml,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=pn(fe(Me(1),gt(ke(t,"float32"))));return Fe(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lG={kernelName:Wl,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=He(t.shape,s.shape);return{a:()=>{const i=fe(gt(t),gt(s));let l=G(n,Fe(s,i));const c=Qt(t.shape,r);return c.length>0&&(l=Ae(l,c)),q(l,t.shape)},b:()=>{const i=fe(gt(t),gt(s));let l=St(G(n,Fe(t,i)));const c=Qt(s.shape,r);return c.length>0&&(l=Ae(l,c)),q(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uG={kernelName:Bl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Fe(n,fe(gt(ke(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cG={kernelName:Vl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Fe(n,Te(Me(1),gt(ke(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dG(n,e,t,s,r,o){const a=_(n,"dy","avgPool3dGrad"),i=_(e,"input","avgPool3dGrad");let l=a,c=i,h=!1;i.rank===4&&(h=!0,l=q(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),c=q(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),A(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),A(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),Gn("avgPool3dGrad",r,o);const p={dy:l,input:c},f={filterSize:t,strides:s,pad:r,dimRoundingMode:o},g=W.runKernel(Nm,p,f);return h?q(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const hG=U({avgPool3dGrad_:dG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pG={kernelName:wd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:o,pad:a,dimRoundingMode:i}=t;return{x:()=>hG(n,s,r,o,a,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fG(n,e,t,s,r){const o=_(n,"dy","avgPoolGrad"),a=_(e,"input","avgPoolGrad");A(a.rank===o.rank,()=>`Rank of input (${a.rank}) does not match rank of dy (${o.rank})`);let i=a,l=o,c=!1;a.rank===3&&(c=!0,i=q(a,[1,a.shape[0],a.shape[1],a.shape[2]]),l=q(o,[1,o.shape[0],o.shape[1],o.shape[2]])),A(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),A(i.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${i.rank}.`);const h={dy:l,input:i},p={filterSize:t,strides:s,pad:r},f=W.runKernel(Sm,h,p);return c?q(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const mG=U({avgPoolGrad_:fG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gG={kernelName:bd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:o,pad:a}=t;return{x:()=>mG(n,s,r,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yG={kernelName:vd,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[s,r]=e,{transposeA:o,transposeB:a}=t;return!o&&!a?{a:()=>Xe(n,r,!1,!0),b:()=>Xe(s,n,!0,!1)}:!o&&a?{a:()=>Xe(n,r,!1,!1),b:()=>Xe(n,s,!0,!1)}:o&&!a?{a:()=>Xe(r,n,!1,!0),b:()=>Xe(s,n,!1,!1)}:{a:()=>Xe(r,n,!0,!0),b:()=>Xe(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xG={kernelName:kd,gradFunc:(n,e,t)=>{const{blockShape:s,crops:r}=t;return{x:()=>Ah(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bG={kernelName:S2,gradFunc:(n,e,t)=>{const s=t,r=s.inputShape,o=s.shape,a=Array.from(o);for(let l=r.length-1;l>=0;l--)if(r[l]===o[l])a[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${o}].`);const i=[];for(let l=0;l<a.length;l++)a[l]>1&&i.push(l);return{x:()=>Ae(n,i,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wG={kernelName:Ul,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vG={kernelName:jl,gradFunc:n=>({x:()=>st(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kG={kernelName:Gl,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{clipValueMin:r,clipValueMax:o}=t;return{x:()=>vn(wr(So(s,r),ka(s,o)),n,st(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SG={kernelName:Nd,inputsToSave:["x"],gradFunc:QT.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NG={kernelName:Cd,saveAllInputs:!0,gradFunc:(n,e,t)=>{const s=e.map(l=>l.shape),{axis:r}=t,o=Qe(r,e[0].shape)[0],a=s.map(l=>l[o]);return Zn(n,a,o).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CG={kernelName:Id,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{dilations:o,strides:a,pad:i,dataFormat:l}=t;return A(ca(o),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`),{x:()=>Gw(s.shape,n,r,a,i,l),filter:()=>$1(s,n,r.shape,a,i,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IG={kernelName:$d,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{strides:o,pad:a,dataFormat:i,dimRoundingMode:l}=t;return{dy:()=>go(n,r,o,a,i,1,l),filter:()=>$1(n,s,r.shape,o,a,i,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $G(n,e,t,s,r){let o=n;n.rank===4&&(o=q(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let a=e;a.rank===4&&(a=q(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),A(o.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`),A(a.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${a.shape}.`),A(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),A(o.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${t[3]}.`),A(a.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${a.shape[4]}) must match output depth for filter (${t[4]}).`);const i={x:o,dy:a},l={strides:s,pad:r,filterShape:t};return W.runKernel(Em,i,l)}const TG=U({conv3DBackpropFilter_:$G});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EG={kernelName:Td,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:o}=t;A(ca(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[a,i]=e;return{x:()=>r$(a.shape,n,i,r,o),filter:()=>TG(a,n,i.shape,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RG={kernelName:Hl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>G(St(qg(ke(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AG={kernelName:ql,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>G(Kg(ke(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DG={kernelName:Ed,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r,exclusive:o,reverse:a}=t;return{x:()=>{const i=Lt([r],s.rank);let l=_g(n,r,o,!a);return i!=null&&(l=nt(l,i)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _G={kernelName:Rd,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:o,dimRoundingMode:a}=t,i=s??[1,1];A(ca(i),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`);const[l,c]=e;return A(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),A(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),A(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),A(Nn(r,i),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${i}'.`),Gn("depthwiseConv2d",o,a),{x:()=>K$(l.shape,n,c,r,o,i,a),filter:()=>q$(l,n,c.shape,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OG={kernelName:Ad,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,o={x:s,filter:r,dy:n},a={x:s,filter:r,dy:n};return{x:()=>W.runKernel(Uf,o,t),filter:()=>W.runKernel(jf,a,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FG={kernelName:Xl,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,s={dy:n,y:t};return{x:()=>W.runKernel(Bm,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LG={kernelName:Yl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=G(ns(St(gt(t))),2/Math.sqrt(Math.PI));return{x:()=>G(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PG={kernelName:Ql,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>G(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zG={kernelName:_d,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>q(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MG={kernelName:Zl,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>G(n,ns(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BG={kernelName:Jl,gradFunc:n=>({x:()=>st(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VG={kernelName:eu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=He(t.shape,s.shape);return{a:()=>{const i=Fe(n,ke(s,"float32")),l=Qt(t.shape,r);return l.length>0?q(Ae(i,l),t.shape):i},b:()=>{let i=G(n,ke(t,"float32"));const l=Qt(s.shape,r);l.length>0&&(i=q(Ae(i,l),s.shape));const c=gt(s);return St(Fe(i,ke(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WG={kernelName:Od,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:s}=t,[r,o,a,i]=e,l=i??Me(1),c=Qt(o.shape,r.shape),h=[];if(o.rank===1){for(let N=0;N<r.shape.length-1;++N)h.push(r.shape[N]);h.push(1)}const p=Te(r,o),f=G(n,l),g=jg(fe(a,Me(s))),y=G(G(G(g,g),g),Me(-.5));return{x:()=>o.rank===1?q(G(G(n,Rs(q(g,[1,1,1,o.shape[0]]),h)),l),r.shape):q(G(G(n,g),l),r.shape),mean:()=>{let N=G(G(g,Me(-1)),f);return o.rank===1&&(N=Ae(N,c)),q(N,o.shape)},variance:()=>{let N=G(G(y,p),f);return o.rank===1&&(N=Ae(N,c)),q(N,o.shape)},scale:()=>{const N=G(p,g);let T=G(n,N);return o.rank===1&&(T=Ae(T,c)),q(T,o.shape)},offset:()=>{let N=n;return o.rank===1&&(N=Ae(N,c)),q(N,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UG={kernelName:Fd,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[s,r]=e,{axis:o,batchDims:a}=t,i=Qe(o,s.shape)[0],l=(c,h,p)=>()=>{const f=c.shape,g=h.size,y=f.slice(0,i),w=y.length,x=f.slice(o,f.length).slice(1),v=x.length,k=MC(0,w),I=MC(w+1,w+1+v),N=BC([y,[g],x]),T=q(p,N),D=q(h,[g]),P=BC([[w],k,I]),z=nt(T,P);let F=ey(z,D,c.shape[i]);const L=va(P);return F=nt(F,L),F};if(a===1){const c=s.shape[0],h=s.split(c,0);return{x:()=>ss(h.map((g,y)=>l(g,r.slice(y,1),n.slice(y,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,n),indices:()=>r}}};function MC(n,e){const t=[];for(let s=n;s<e;++s)t.push(s);return t}function BC(n){const e=[];for(let t=0;t<n.length;++t)for(let s=0;s<n[t].length;++s)e.push(n[t][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jG={kernelName:tu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>st(t),b:()=>st(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GG={kernelName:nu,gradFunc:n=>({x:()=>ke(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HG={kernelName:su,gradFunc:n=>({x:()=>st(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qG={kernelName:ru,gradFunc:n=>({x:()=>st(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KG={kernelName:ou,gradFunc:n=>({x:()=>st(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XG={kernelName:Pd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{alpha:r}=t,o=os(s,0);return{x:()=>vn(o,n,G(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YG={kernelName:iu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Fe(n,fe(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QG={kernelName:au,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Fe(n,ke(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZG={kernelName:N2,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;return{logits:()=>{const a=ns(s);return Te(n,G(Ae(n,r,!0),a))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JG(n,e,t,s=5,r=1,o=1,a=.5){const i={x:n,y:e,dy:t},l={depthRadius:s,bias:r,alpha:o,beta:a};return W.runKernel(Km,i,l)}const e6=U({localResponseNormalizationBackprop_:JG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t6={kernelName:Ud,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{depthRadius:o,bias:a,alpha:i,beta:l}=t;return{x:()=>e6(s,r,n,o,a,i,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZT(n,e,t,s){return e.rank<t.rank&&(e=q(e,Ut(e.shape,s))),n.rank<t.rank&&(n=q(n,Ut(n.shape,s))),{x:()=>G(n,ke(Js(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VC={kernelName:jd,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{reductionIndices:r}=s,o=e[0],a=e[1],i=Qe(r,o.shape),l=ZT(n,a,o,i);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n6={kernelName:lu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>G(n,ke(So(t,s),"float32")),b:()=>G(n,ke(Sl(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s6(n,e,t,s,r,o,a){const i=_(n,"dy","maxPool3dGrad"),l=_(e,"input","maxPool3dGrad"),c=_(t,"output","maxPool3dGrad");let h=i,p=l,f=c,g=!1;l.rank===4&&(g=!0,h=q(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),p=q(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),f=q(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),A(h.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${h.rank}.`),A(p.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${p.rank}.`),A(f.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${f.rank}.`),Gn("maxPool3dGrad",o,a);const y={dy:h,input:p,output:f},w={filterSize:s,strides:r,pad:o,dimRoundingMode:a},x=W.runKernel(Ym,y,w);return g?q(x,[x.shape[1],x.shape[2],x.shape[3],x.shape[4]]):x}const r6=U({maxPool3dGrad_:s6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o6={kernelName:Hd,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:o,strides:a,pad:i,dimRoundingMode:l}=t;return{x:()=>r6(n,s,r,o,a,i,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a6(n,e,t,s,r,o,a){const i=_(n,"dy","maxPoolGrad"),l=_(e,"input","maxPoolGrad"),c=_(t,"output","maxPoolGrad");A(l.rank===i.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${i.rank})`),A(i.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${i.rank}.`),A(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),Gn("maxPoolGrad",o,a);const h={dy:i,input:l,output:c},p={filterSize:s,strides:r,pad:o,dimRoundingMode:a};return W.runKernel(Xm,h,p)}const i6=U({maxPoolGrad_:a6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l6={kernelName:Gd,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:o,strides:a,pad:i}=t;return{x:()=>i6(n,s,r,o,a,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u6={kernelName:qd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t,o=Qe(r,s.shape),i=mn(s.shape,o)[1],l=ce(i);return{x:()=>{const h=s.shape.slice();o.forEach(g=>{h[g]=1});const p=q(n,h);return Fe(G(p,Qn(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c6={kernelName:Kd,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{axis:r}=s,[o,a]=e,i=Qe(r,o.shape),l=ZT(n,a,o,i);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d6={kernelName:uu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>G(n,ke(ka(t,s),"float32")),b:()=>G(n,ke(os(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h6={kernelName:Xd,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,o=r.map(a=>a[0]);return{x:()=>tt(n,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p6={kernelName:cu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=He(t.shape,s.shape);return{a:()=>{const i=Qt(t.shape,r);return i.length>0?q(Ae(n,i),t.shape):n},b:()=>{const i=G(n,St(Fu(Fe(t,s)))),l=Qt(s.shape,r);return l.length>0?q(Ae(i,l),s.shape):i}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f6={kernelName:du,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=He(t.shape,s.shape);return{a:()=>{const i=G(n,ke(s,"float32")),l=Qt(t.shape,r);return l.length>0?q(Ae(i,l),t.shape):i},b:()=>{const i=G(n,ke(t,"float32")),l=Qt(s.shape,r);return l.length>0?q(Ae(i,l),s.shape):i}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m6={kernelName:Yd,gradFunc:n=>({x:()=>St(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g6={kernelName:Jd,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>Vt(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y6={kernelName:Zd,gradFunc:n=>({x:()=>st(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x6={kernelName:eh,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:s}=t;return Fs(n,s).map(o=>()=>o)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WC={kernelName:th,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,o=r.map(a=>a[0]);return{x:()=>tt(n,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b6={kernelName:hu,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,s,r]=e,o=t,a=s,i=He(o.shape,a.shape);return{a:()=>{const h=ke(a,"float32");let p=G(n,G(h,Gr(o,Te(h,Me(1)))));const f=Qt(o.shape,i);return f.length>0&&(p=Ae(p,f)),q(p,o.shape)},b:()=>{const h=os(o,0),p=vn(h,ys(o),st(o));let f=G(n,G(r,p));const g=Qt(a.shape,i);return g.length>0&&(f=Ae(f,g)),q(f,a.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w6={kernelName:nh,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,s]=e,r=os(t,0);return{x:()=>vn(r,n,G(n,s)),alpha:()=>{let o=vn(r,st(n),G(n,t));const a=Qt(s.shape,n.shape);return a.length>0&&(o=Ae(o,a)),q(o,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v6(n,e,t){const s=n.shape.slice();s[t]=1;const r=q(e,s),o=sd(n,t,!0,!1),a=sd(n,t,!0,!0),i=G(o,a);return G(r,i)}function k6(n,e,t){const s=n.shape.length,r=s-t.length,o=Lt(t,s);let a=n;o!=null&&(a=nt(n,o));const i=a.shape.slice(),c=i.splice(s-t.length,t.length).reduce((f,g)=>f*g,1);i.push(c);const h=a.reshape(i);let p=v6(h,e,r);if(p=p.reshape(a.shape),o!=null){const f=va(o);p=nt(p,f)}return p}const S6={kernelName:sh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;let o=[];return r==null?o=s.shape.map((a,i)=>i):typeof r=="number"?o=[r]:o=r,{x:()=>k6(s,n,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N6={kernelName:Kl,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=He(t.shape,s.shape);return{a:()=>{const i=Fe(n,ke(s,"float32")),l=Qt(t.shape,r);return l.length>0?q(Ae(i,l),t.shape):i},b:()=>{let i=G(n,ke(t,"float32"));const l=Qt(s.shape,r);l.length>0&&(i=q(Ae(i,l),s.shape));const c=gt(s);return St(Fe(i,ke(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C6={kernelName:pu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Fe(n,St(gt(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I6={kernelName:mu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=G(ka(t,6),Ri(t));return{x:()=>G(n,ke(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $6={kernelName:fu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>G(n,ke(Ri(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T6={kernelName:rh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>q(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E6={kernelName:ah,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>W.runKernel(lg,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R6={kernelName:oh,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>W.runKernel(ig,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A6={kernelName:ih,gradFunc:(n,e,t)=>{const{dims:s}=t,r=Qe(s,n.shape);return{x:()=>Os(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D6={kernelName:gu,gradFunc:n=>({x:()=>st(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _6={kernelName:yu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>St(Fe(n,G(Gr(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O6={kernelName:lh,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>ke(st(t),"float32"),t:()=>G(n,ke(t,n.dtype)),e:()=>G(n,ke(Th(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F6={kernelName:xu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=os(t,Me(0)),r=Me(fy),o=Me(my),a=G(n,o),i=G(G(n,r),ns(ke(t,"float32")));return vn(s,a,i)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L6={kernelName:ku,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>G(n,G(t,Te(Me(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P6={kernelName:vu,gradFunc:n=>({x:()=>st(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z6={kernelName:bu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>G(Sh(ke(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M6={kernelName:wu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>G(Dg(ke(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B6={kernelName:uh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{begin:r,size:o}=t,a=s.shape,[i,l]=hy(s,r,o),c=[];for(let h=0;h<n.rank;h++)c.push([i[h],a[h]-i[h]-l[h]]);return{x:()=>No(n,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V6={kernelName:ph,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{dim:r}=t,o=!0,a=G(n,s);return{logits:()=>Te(a,G(Ae(a,[r],o),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W6={kernelName:Su,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>G(n,xr(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UC={kernelName:dh,gradFunc:(n,e,t)=>{const{blockShape:s,paddings:r}=t;return{x:()=>kh(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jC={kernelName:hh,gradFunc:(n,e,t)=>{const{axis:s}=t;return{x:()=>Wt(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U6={kernelName:Nu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Fe(n,G(pn(ke(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j6={kernelName:yg,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>G(n,G(ke(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G6={kernelName:Cu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Me(2);return{a:()=>G(n,G(r,Te(t,s))),b:()=>G(n,G(r,Te(s,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H6={kernelName:Ru,gradFunc:n=>({x:()=>st(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q6={kernelName:Iu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=He(t.shape,s.shape);return{a:()=>{let i=n;const l=Qt(t.shape,r);return l.length>0&&(i=Ae(i,l)),q(i,t.shape)},b:()=>{let i=n;const l=Qt(s.shape,r);return l.length>0&&(i=Ae(i,l)),q(St(i),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K6={kernelName:ch,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,r=s.shape.slice(),{axis:o}=t;Qe(o,s.shape).forEach(c=>{r[c]=1});const i=q(n,r),l=G(i,Qn(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X6={kernelName:$u,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Fe(n,gt(Sh(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y6={kernelName:Tu,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>G(Te(Me(1),gt(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q6={kernelName:Eu,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{reps:r}=t;return{x:()=>{let a=st(s);if(s.rank===1)for(let i=0;i<r[0];++i)a=fe(a,tt(n,[i*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let i=0;i<r[0];++i)for(let l=0;l<r[1];++l)a=fe(a,tt(n,[i*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let i=0;i<r[0];++i)for(let l=0;l<r[1];++l)for(let c=0;c<r[2];++c)a=fe(a,tt(n,[i*s.shape[0],l*s.shape[1],c*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let i=0;i<r[0];++i)for(let l=0;l<r[1];++l)for(let c=0;c<r[2];++c)for(let h=0;h<r[3];++h)a=fe(a,tt(n,[i*s.shape[0],l*s.shape[1],c*s.shape[2],h*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z6={kernelName:si,gradFunc:(n,e,t)=>{const s=t,{perm:r}=s,o=va(r);return{x:()=>nt(n,o)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J6={kernelName:mh,gradFunc:(n,e,t)=>{const s=t,{axis:r}=s;return{value:()=>ss(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e5={kernelName:gh,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>t5(n,t)}}};function t5(n,e){const t=Xr(e,st(e)),s=Lu(n,t);let r=So(e,Me(0,"int32"));const o=s.rank-r.rank;for(let i=0;i<o;++i)r=An(r,i+1);r=wr(r,Qn(s.shape,"bool"));const a=st(s);return vn(r,s,a)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n5={kernelName:yh,gradFunc:n=>({x:()=>st(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s5=[QT,eG,tG,nG,sG,rG,oG,aG,iG,lG,uG,cG,pG,gG,yG,xG,bG,wG,vG,kG,SG,NG,IG,CG,EG,RG,AG,DG,_G,OG,N6,FG,LG,PG,zG,MG,VG,BG,WG,UG,jG,GG,HG,qG,KG,XG,YG,QG,ZG,t6,VC,VC,n6,o6,l6,u6,c6,d6,h6,p6,f6,m6,g6,y6,x6,WC,WC,b6,w6,S6,C6,I6,$6,T6,E6,R6,A6,D6,_6,O6,F6,L6,P6,z6,M6,B6,V6,W6,UC,UC,jC,jC,U6,G6,j6,H6,q6,K6,X6,Y6,Q6,Z6,J6,e5,n5];for(const n of s5)C2(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.abs=function(){return this.throwIfDisposed(),Xt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.acos=function(){return this.throwIfDisposed(),Iw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.acosh=function(){return this.throwIfDisposed(),$w(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.add=function(n){return this.throwIfDisposed(),fe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.all=function(n,e){return this.throwIfDisposed(),Eg(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.any=function(n,e){return this.throwIfDisposed(),ed(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.argMax=function(n){return this.throwIfDisposed(),di(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.argMin=function(n){return this.throwIfDisposed(),Tw(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.asScalar=function(){return this.throwIfDisposed(),A(this.size===1,()=>"The array must have only 1 element."),q(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.asType=function(n){return this.throwIfDisposed(),ke(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.as1D=function(){return this.throwIfDisposed(),q(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.as2D=function(n,e){return this.throwIfDisposed(),q(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),q(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.as4D=function(n,e,t,s){return this.throwIfDisposed(),q(this,[n,e,t,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.as5D=function(n,e,t,s,r){return this.throwIfDisposed(),q(this,[n,e,t,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.asin=function(){return this.throwIfDisposed(),Ew(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.asinh=function(){return this.throwIfDisposed(),Rw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.atan=function(){return this.throwIfDisposed(),Aw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.atan2=function(n){return this.throwIfDisposed(),Dw(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.atanh=function(){return this.throwIfDisposed(),_w(this)};de().prototype.avgPool=function(n,e,t,s){return this.throwIfDisposed(),vh(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),kh(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.batchNorm=function(n,e,t,s,r){return this.throwIfDisposed(),Au(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.broadcastTo=function(n){return this.throwIfDisposed(),ri(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.cast=function(n){return this.throwIfDisposed(),ke(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.ceil=function(){return this.throwIfDisposed(),Bw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),ts(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof dt&&(n=[n]),Wt([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.conv1d=function(n,e,t,s,r,o){return this.throwIfDisposed(),Rg(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.conv2dTranspose=function(n,e,t,s,r){return this.throwIfDisposed(),Ag(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.conv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),go(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.cos=function(){return this.throwIfDisposed(),Sh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.cosh=function(){return this.throwIfDisposed(),Dg(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),sd(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),_g(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),Kw(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.depthwiseConv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),Du(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.dilation2d=function(n,e,t,s,r){return this.throwIfDisposed(),Xw(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.divNoNan=function(n){return this.throwIfDisposed(),Yw(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.div=function(n){return this.throwIfDisposed(),Fe(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.dot=function(n){return this.throwIfDisposed(),Qw(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.elu=function(){return this.throwIfDisposed(),_u(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.equal=function(n){return this.throwIfDisposed(),Js(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.erf=function(){return this.throwIfDisposed(),Og(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),Jw(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.exp=function(){return this.throwIfDisposed(),ns(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.expandDims=function(n){return this.throwIfDisposed(),An(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.expm1=function(){return this.throwIfDisposed(),e1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.fft=function(){return this.throwIfDisposed(),Fh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.flatten=function(){return this.throwIfDisposed(),q(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.floor=function(){return this.throwIfDisposed(),Fu(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.floorDiv=function(n){return this.throwIfDisposed(),Tg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.gather=function(n,e,t){return this.throwIfDisposed(),Lu(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.greaterEqual=function(n){return this.throwIfDisposed(),So(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.greater=function(n){return this.throwIfDisposed(),os(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.ifft=function(){return this.throwIfDisposed(),$l(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.irfft=function(){return this.throwIfDisposed(),Yg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.isFinite=function(){return this.throwIfDisposed(),t1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.isInf=function(){return this.throwIfDisposed(),n1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.isNaN=function(){return this.throwIfDisposed(),s1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.leakyRelu=function(n){return this.throwIfDisposed(),Ch(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.lessEqual=function(n){return this.throwIfDisposed(),ka(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.less=function(n){return this.throwIfDisposed(),Sl(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.localResponseNormalization=function(n,e,t,s){return this.throwIfDisposed(),r1(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logSigmoid=function(){return this.throwIfDisposed(),o1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logSoftmax=function(n){return this.throwIfDisposed(),Pg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),$h(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.log=function(){return this.throwIfDisposed(),ys(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.log1p=function(){return this.throwIfDisposed(),Ih(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logicalAnd=function(n){return this.throwIfDisposed(),wr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logicalNot=function(){return this.throwIfDisposed(),Th(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logicalOr=function(n){return this.throwIfDisposed(),zg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.logicalXor=function(n){return this.throwIfDisposed(),a1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),Xe(this,n,e,t)};de().prototype.maxPool=function(n,e,t,s){return this.throwIfDisposed(),Eh(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.max=function(n,e){return this.throwIfDisposed(),_s(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.maximum=function(n){return this.throwIfDisposed(),Xr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.mean=function(n,e){return this.throwIfDisposed(),_t(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.min=function(n,e){return this.throwIfDisposed(),kl(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.minimum=function(n){return this.throwIfDisposed(),ha(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),l1(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.mod=function(n){return this.throwIfDisposed(),u1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.mul=function(n){return this.throwIfDisposed(),G(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.neg=function(){return this.throwIfDisposed(),St(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.norm=function(n,e,t){return this.throwIfDisposed(),Ou(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.notEqual=function(n){return this.throwIfDisposed(),fi(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),Nl(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.onesLike=function(){return this.throwIfDisposed(),xs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.pad=function(n,e){return this.throwIfDisposed(),No(this,n,e)};de().prototype.pool=function(n,e,t,s,r,o){return this.throwIfDisposed(),c1(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.pow=function(n){return this.throwIfDisposed(),Gr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.prelu=function(n){return this.throwIfDisposed(),Dh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.prod=function(n,e){return this.throwIfDisposed(),d1(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.reciprocal=function(){return this.throwIfDisposed(),m1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.relu=function(){return this.throwIfDisposed(),Cr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.relu6=function(){return this.throwIfDisposed(),Wg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.reshapeAs=function(n){return this.throwIfDisposed(),q(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.reshape=function(n){return this.throwIfDisposed(),q(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),Z$(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),J$(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.reverse=function(n){return this.throwIfDisposed(),Os(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.rfft=function(){return this.throwIfDisposed(),Lh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.round=function(){return this.throwIfDisposed(),Ug(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.rsqrt=function(){return this.throwIfDisposed(),jg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.selu=function(){return this.throwIfDisposed(),Gg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.separableConv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),Hg(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sigmoid=function(){return this.throwIfDisposed(),xr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sign=function(){return this.throwIfDisposed(),g1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sin=function(){return this.throwIfDisposed(),qg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sinh=function(){return this.throwIfDisposed(),Kg(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.slice=function(n,e){return this.throwIfDisposed(),tt(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.softmax=function(n){return this.throwIfDisposed(),Pu(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.softplus=function(){return this.throwIfDisposed(),Ei(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),Ah(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.split=function(n,e){return this.throwIfDisposed(),Zn(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sqrt=function(){return this.throwIfDisposed(),pn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.square=function(){return this.throwIfDisposed(),gt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.squaredDifference=function(n){return this.throwIfDisposed(),Qg(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.squeeze=function(n){return this.throwIfDisposed(),Co(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof dt?[this,n]:[this,...n];return ss(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.step=function(n){return this.throwIfDisposed(),Ri(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.stridedSlice=function(n,e,t,s,r,o,a,i){return this.throwIfDisposed(),y1(this,n,e,t,s,r,o,a,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sub=function(n){return this.throwIfDisposed(),Te(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.sum=function(n,e){return this.throwIfDisposed(),Ae(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.tan=function(){return this.throwIfDisposed(),x1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.tanh=function(){return this.throwIfDisposed(),da(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.tile=function(n){return this.throwIfDisposed(),Rs(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.toBool=function(){return this.throwIfDisposed(),ke(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.toFloat=function(){return this.throwIfDisposed(),ke(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.toInt=function(){return this.throwIfDisposed(),ke(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.topk=function(n,e){return this.throwIfDisposed(),v1(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.transpose=function(n){return this.throwIfDisposed(),nt(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.unique=function(n){return this.throwIfDisposed(),k1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),ey(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.unstack=function(n){return this.throwIfDisposed(),Fs(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.where=function(n,e){return this.throwIfDisposed(),vn(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */de().prototype.zerosLike=function(){return this.throwIfDisposed(),st(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class _r extends Error{constructor(e){super(e),Object.setPrototypeOf(this,_r.prototype)}}class Ys extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ys.prototype)}}class Q extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Q.prototype)}}class Ke extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ke.prototype)}}class dv extends Error{constructor(e){super(e),Object.setPrototypeOf(this,dv.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class JT{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xi(n,e){if(Array.isArray(n)){let t=[];for(let s=0;s<e;s++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function Or(n,e){if(!n)throw new dv(e)}function GC(n,e){let t=0;for(const s of n)s===e&&t++;return t}function Yn(n){return n.length===1?n[0]:n}function pt(n){return Array.isArray(n)?n:[n]}function uo(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Qa(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let Gs={};function hv(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function Wb(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>Wb(e));else{const e=Object.keys(n);for(const t of e){const s=n[t];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[t]=s.value:Wb(s))}}}function Bh(n,e={},t={},s="object",r=!1){if(typeof n=="string"){const o=n;let a;if(o in t)a=t[o];else if(o in Gs)a=Gs[o];else if(a=e[o],a==null)throw new Q(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return a}else{const o=n;if(o.className==null||o.config==null)throw new Q(`${s}: Improper config format: ${JSON.stringify(o)}.
'className' and 'config' must set.`);const a=o.className;let i,l;if(a in t?[i,l]=t[a]:a in Gs?[i,l]=Gs.className:a in e&&([i,l]=e[a]),i==null)throw new Q(`Unknown ${s}: ${a}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const c={};for(const g of Object.keys(Gs))c[g]=Gs[g];for(const g of Object.keys(t))c[g]=t[g];const h=o.config;h.customObjects=c;const p=Object.assign({},Gs);for(const g of Object.keys(t))Gs[g]=t[g];Wb(o.config);const f=l(i,o.config,t,r);return Gs=Object.assign({},p),f}else{const c=Object.assign({},Gs);for(const p of Object.keys(t))Gs[p]=t[p];const h=new i(o.config);return Gs=Object.assign({},c),h}}}function r5(n,e){return n<e?-1:n>e?1:0}function pf(n,e){return-1*r5(n,e)}function ra(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function o5(n){if(n==null)throw new Q(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function Di(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new Q(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function pv(n,e,t=0,s=1/0){return Or(t>=0),Or(s>=t),Array.isArray(n)&&n.length>=t&&n.length<=s&&n.every(r=>typeof r===e)}function dn(n,e){Array.isArray(n)?(A(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,s)=>dn(t,`element ${s+1} of ${e}`))):A(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${eE(n)}.`)}function eE(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>eE(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function a5(n,e,t){let s=t!=null?t():Mn(),r;return(...a)=>{const i=t!=null?t():Mn();return i-s<e||(s=i,r=n(...a)),r}}function tE(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let i5=0;function nE(){return i5++}const ff={};function gy(n=""){return n in ff||(ff[n]=0),ff[n]+=1,n+ff[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const l5=["channelsFirst","channelsLast"],u5=["nearest","bilinear"],c5=["valid","same","causal"],d5=["max","avg"],h5=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const ul=new Map;function Gt(n){Di(l5,"DataFormat",n)}function p5(n){Di(u5,"InterpolationFormat",n)}function Ls(n){Di(c5,"PaddingMode",n)}function sE(n){Di(d5,"PoolMode",n)}const Wc=[],HC="/";function oi(n,e){Wc.push(n);try{const t=e();return Wc.pop(),t}catch(t){throw Wc.pop(),t}}function f5(){return Wc.length===0?"":Wc.join(HC)+HC}function rE(n){if(!aE(n))throw new Error("Not a valid tensor name: '"+n+"'");return f5()+n}function oE(n){if(!aE(n))throw new Error("Not a valid tensor name: '"+n+"'");ul.has(n)||ul.set(n,0);const e=ul.get(n);if(ul.set(n,ul.get(n)+1),e>0){const t=`${n}_${e}`;return ul.set(t,1),t}else return n}const m5=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function aE(n){return!!n.match(m5)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function g5(n){return n===parseInt(n.toString(),10)}function oa(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let s=1;for(let r=e;r<t;++r)s*=n[r];return s}function Tl(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s<e&&(e=s)}return e}function pa(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s>e&&(e=s)}return e}function vr(n,e){if(e<n)throw new Q(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let s=n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Vx;function en(){return Vx==null&&(Vx=kw().epsilon()),Vx}function kr(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Vr(n,e){return ke(n,e)}function Vh(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),q(n,t)}function y5(n,e){return re(()=>{if(n.shape.length!==2)throw new Q(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=Vh(n,1);return Ub(t,[1,e,1])})}function x5(n){const e=[oa(n.shape)];return q(n,e)}function b5(n){if(n.rank<=1)throw new Q(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],oa(n.shape,1)];return q(n,e)}function ai(n,e,t){return re(()=>{switch(n.rank){case 1:return _h(n,e,t);case 2:return Xg(n,[e,0],[t,n.shape[1]]);case 3:return Oh(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return Il(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return tt(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return tt(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new Q(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Wx(n,e,t){return re(()=>{switch(n.rank){case 1:return _h(n,e,t);case 2:return Xg(n,[0,e],[n.shape[0],t]);case 3:return Oh(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return Il(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new Q(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function mf(n,e,t,s){return re(()=>{switch(n.rank){case 1:return _h(n,e,t);case 2:switch(s){case 1:return ai(n,e,t);case 2:return Wx(n,e,t);default:throw new Q(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return ai(n,e,t);case 2:return Oh(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return Wx(n,e,t);default:throw new Q(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return ai(n,e,t);case 2:return Il(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return Il(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return Wx(n,e,t);default:throw new Q(`The axis is not within the rank of the tensor ${s}`)}default:throw new Q(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function fv(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),Wt(n,e)}function qC(n,e){switch(n.rank){case 1:return Vw([n,e]);case 2:return Ww([n,e],0);case 3:return Uw([n,e],0);case 4:return jw([n,e],0);default:throw new Q(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function Ub(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new Q(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return Rs(n,e)}function yy(n,e=0,t=1,s,r){return Vg(n,e,t,s,r)}function Wr(n,e,t,s){if(n.rank<2||e.rank<2)throw new Ke(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=n.shape.slice(-1)[0],o=e.shape.slice(-2)[0];if(r!==o)throw new Ke(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return Ib({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?jb(n.rank,s,kr()):null,activation:t});{const r=n.shape.slice(),o=r.pop();n=q(n,[-1,o]);const a=e.shape.slice(),i=a.pop(),l=a.pop(),c=[...a,i],h=Array.from({length:e.rank},(y,w)=>w===0?e.rank-2:w<=e.rank-2?w-1:w);e=q(nt(e,h),[l,-1]);const p=[...r,...c];return q(Ib({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?jb(n.rank,s,kr()):null,activation:t}),p)}}function iE(n,e,t){return re(()=>(Array.isArray(e)?e=Dn(e,"int32"):e=ke(e,"int32"),Lu(n,e,t)))}function Wh(n){return G(n,n)}function jb(n,e,t){const s=e.shape;if(e.rank!==1&&e.rank!==n)throw new Q(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return s.length===1?q(e,[1,s[0],1,1,1]):q(e,[1,s[3],s[0],s[1],s[2]]);if(t==="channelsLast")return s.length===1?q(e,[1,1,1,1,s[0]]):q(e,[1].concat(s))}else if(n===4){if(t==="channelsFirst")return s.length===1?q(e,[1,s[0],1,1]):q(e,[1,s[2],s[0],s[1]]);if(t==="channelsLast")return s.length===1?q(e,[1,1,1,s[0]]):q(e,[1].concat(s))}else if(n===3){if(t==="channelsFirst")return s.length===1?q(e,[1,s[0],1]):q(e,[1,s[1],s[0]]);if(t==="channelsLast")return s.length===1?q(e,[1,1,s[0]]):q(e,[1].concat(s))}else if(n<3)return e;throw new Q(`Unsupported input rank by biasAdd: ${e.rank}`)}function Ir(n,e,t){return re(()=>(t==null&&(t=kr()),Gt(t),fe(n,jb(n.rank,e,t))))}function w5(n,e=1){if(e!==1)throw new Ke(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return _u(n)}function v5(n){return re(()=>Fe(n,fe(Xt(n),1)))}function lE(n,e,t,s){return re(()=>C1(n,e,t,s))}function k5(n){return re(()=>{const e=fe(.5,G(.2,n));return ts(e,0,1)})}function Uh(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const S5=["fanIn","fanOut","fanAvg"],N5=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function C5(n){Di(S5,"FanMode",n)}function I5(n){Di(N5,"Distribution",n)}class tr extends Ai{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class uE extends tr{apply(e,t){return Vt(e,t)}}uE.className="Zeros";me(uE);class mv extends tr{apply(e,t){return Qn(e,t)}}mv.className="Ones";me(mv);class cE extends tr{constructor(e){if(super(),typeof e!="object")throw new Q(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new Q(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return re(()=>G(Me(this.value),Qn(e,t)))}getConfig(){return{value:this.value}}}cE.className="Constant";me(cE);class dE extends tr{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return Sa(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}dE.className="RandomUniform";me(dE);class hE extends tr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Ke(`randomNormal does not support dType ${t}.`);return yy(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}hE.className="RandomNormal";me(hE);class pE extends tr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Ke(`truncatedNormal does not support dType ${t}.`);return Jg(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}pE.className="TruncatedNormal";me(pE);class fE extends tr{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return re(()=>{if(e.length!==2||e[0]!==e[1])throw new Q("Identity matrix initializer can only be used for 2D square matrices.");return G(this.gain,Fg(e[0]))})}getConfig(){return{gain:this.gain}}}fE.className="Identity";me(fE);function $5(n,e="channelsLast"){let t,s;if(Gt(e),n.length===2)t=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const r=oa(n,2);t=n[1]*r,s=n[0]*r}else if(e==="channelsLast"){const r=oa(n,0,n.length-2);t=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=oa(n);t=Math.sqrt(r),s=Math.sqrt(r)}return[t,s]}class bs extends tr{constructor(e){if(super(),e.scale<0)throw new Q(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,C5(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,I5(this.distribution),this.seed=e.seed}apply(e,t){const s=$5(e),r=s[0],o=s[1];let a=this.scale;if(this.mode==="fanIn"?a/=Math.max(1,r):this.mode==="fanOut"?a/=Math.max(1,o):a/=Math.max(1,(r+o)/2),this.distribution==="normal"){const i=Math.sqrt(a);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Ke(`${this.getClassName()} does not support dType ${t}.`);return Jg(e,0,i,t,this.seed)}else{const i=Math.sqrt(3*a);return Sa(e,-i,i,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}bs.className="VarianceScaling";me(bs);class gv extends bs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return bs.className}}gv.className="GlorotUniform";me(gv);class yv extends bs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return bs.className}}yv.className="GlorotNormal";me(yv);class xv extends bs{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return bs.className}}xv.className="HeNormal";me(xv);class bv extends bs{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return bs.className}}bv.className="HeUniform";me(bv);class wv extends bs{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return bs.className}}wv.className="LeCunNormal";me(wv);class vv extends bs{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return bs.className}}vv.className="LeCunUniform";me(vv);class mE extends tr{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return re(()=>{if(e.length<2)throw new Ke("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const s=ce(e.slice(0,-1)),r=e[e.length-1],o=s*r;o>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${o}) elements: Slowness may result.`);const a=[Math.max(r,s),Math.min(r,s)],i=yy(a,0,1,t,this.seed),l=E1.qr(i,!1);let c=l[0];const p=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return c=G(c,p.sign()),s<r&&(c=c.transpose()),G(Me(this.gain),c.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}mE.className="Orthogonal";me(mE);const KC={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function XC(n,e={}){return Bh(n,Es.getMap().classNameMap,e,"initializer")}function Ot(n){return hv(n)}function Tt(n){if(typeof n=="string"){const e=n in KC?KC[n]:n;if(e==="GlorotNormal")return new yv;if(e==="GlorotUniform")return new gv;if(e==="HeNormal")return new xv;if(e==="HeUniform")return new bv;if(e==="LeCunNormal")return new wv;if(e==="LeCunUniform")return new vv;{const t={};return t.className=e,t.config={},XC(t)}}else return n instanceof tr?n:XC(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Gb(n){return Array.isArray(n)&&Array.isArray(n[0])}function Zf(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function Ue(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new Q(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function ot(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new Q(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Jf(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const YC="Variable";class T5{constructor(e,t="float32",s=YC,r=!0,o=null){this.dtype=t??"float32",this.shape=e.shape,this.id=nE(),s=s??YC,this.originalName=rE(s),this.name=oE(this.originalName),this.trainable_=r,this.constraint=o,this.val=S1(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),E5(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function E5(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function Hb(n){return n.map(e=>e.read())}function kv(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class tn{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class qr{constructor(e,t,s,r,o,a,i){this.dtype=e,this.shape=t,this.sourceLayer=s,this.inputs=r,this.callArgs=o,this.outputTensorIndex=i,this.id=nE(),a!=null&&(this.originalName=rE(a),this.name=oE(this.originalName)),this.rank=t.length}}let R5=0;class xy{constructor(e,t){this.callArgs=t,this.id=R5++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let A5=0;class Ze extends Ai{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=A5++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const s=this.getClassName();t=uo(s)+"_"+gy(s)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let o=null;e.batchSize!=null&&(o=e.batchSize),s=[o].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new Ys(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new Q(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Yn(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Yn(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new _r(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new _r(`Layer ${this.name} is not connected, no input to return.`);return Yn(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new _r(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new _r(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Yn(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=pt(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=pt(this.inputSpec);if(t.length!==s.length)throw new Q(`Layer ${this.name} expects ${s.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){const o=t[r],a=s[r];if(a==null)continue;const i=o.rank;if(a.ndim!=null&&i!==a.ndim)throw new Q(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${a.ndim}, found ndim=${i}`);if(a.maxNDim!=null&&i>a.maxNDim)throw new Q(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${a.maxNDim}, found ndim=${i}`);if(a.minNDim!=null&&i<a.minNDim)throw new Q(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${a.minNDim}, found ndim=${i}.`);if(a.dtype!=null&&o.dtype!==a.dtype)throw new Q(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${a.dtype}, found dtype=${o.dtype}.`);if(a.axes){const l=o.shape;for(const c in a.axes){const h=Number(c),p=a.axes[c],f=h>=0?l[h]:l[l.length+h];if(p!=null&&[p,null].indexOf(f)===-1)throw new Q(`Input ${r} is incompatible with layer ${this.name}: expected axis ${h} of input shape to have value ${p} but got shape ${l}.`)}}if(a.shape!=null)for(let l=0;l<a.shape.length;++l){const c=a.shape[l],h=o.shape[l];if(c!=null&&h!=null&&c!==h)throw new Q(`Input ${r} is incompatible with layer ${this.name}: expected shape=${a.shape}, found shape=${o.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const s=pt(e),r=O5(e),o=F5(e);if(r===o)throw new Q("Arguments to apply() must be all SymbolicTensors or all Tensors");return oi(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const a=[];for(const i of pt(e))a.push(i.shape);this.build(Yn(a)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&o&&(this._refCount=1)}if(this.assertInputCompatibility(e),o){let a=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,a);const i=pt(a),l=[];for(let c of i)s.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(a=Yn(l),this.activityRegularizer!=null)throw new Ke("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return a}else{const a=D5(e),i=this.computeOutputShape(a);let l;const c=_5(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?a[0]:a),i!=null&&i.length>0&&Array.isArray(i[0])?l=i.map((h,p)=>new qr(c,h,this,pt(e),t,this.name,p)):l=new qr(c,i,this,pt(e),t,this.name),this.addInboundNode(e,l,null,null,a,i,t),this._refCount++,this.activityRegularizer!=null)throw new Ke("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new _r(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const s=JSON.stringify(t.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new _r(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Ys(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Jf(this.weights)}build(e){this.built=!0}getWeights(e=!1){return Hb(e?this.trainableWeights:this.weights)}setWeights(e){re(()=>{const t=this.weights;if(t.length!==e.length)throw new Q(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const s=[],r=Hb(t);for(let o=0;o<r.length;++o){const a=r[o],i=t[o],l=e[o];if(!Je(a.shape,l.shape))throw new Q(`Layer weight shape ${a.shape} not compatible with provided weight shape ${l.shape}`);s.push([i,l])}kv(s)})}addWeight(e,t,s,r,o,a,i,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new Q(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():Tt("zeros"));const c=r.apply(t,s),h=new T5(c,s,e,a,i);return c.dispose(),o!=null&&this.addLoss(()=>o.apply(h.read())),a==null&&(a=!0),a?this._trainableWeights.push(h):this._nonTrainableWeights.push(h),h}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=pt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),o=pt(t),a=pt(r);if(o.length!==a.length)throw new Error(`${this.name} outputs ${o.length} tensors but ${o.length} masks for those tensors`);for(let i=0;i<o.length;i++)o[i].kerasMask=a[i]}addInboundNode(e,t,s,r,o,a,i=null){const l=pt(e);t=pt(t),s=pt(s),r=pt(r),o=Zf(o),a=Zf(a);const c=[],h=[],p=[];for(const f of l)c.push(f.sourceLayer),h.push(f.nodeIndex),p.push(f.tensorIndex);new xy({outboundLayer:this,inboundLayers:c,nodeIndices:h,tensorIndices:p,inputTensors:l,outputTensors:t,inputMasks:s,outputMasks:r,inputShapes:o,outputShapes:a},i);for(let f=0;f<t.length;f++)t[f].sourceLayer=this,t[f].nodeIndex=this.inboundNodes.length-1,t[f].tensorIndex=f}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function D5(n){n=pt(n);const e=[];for(const t of n)e.push(t.shape);return Yn(e)}function _5(n){return"float32"}function gE(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const s=e.inboundNodes[t];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let o=0;o<s.inboundLayers.length;o++){const a=s.inputTensors[o],i=s.inboundLayers[o],l=s.nodeIndices[o],c=gE(a,i,l);for(const h of c)r.indexOf(h)===-1&&r.push(h)}return r}}}function O5(n){let e=!0;for(const t of pt(n))if(!(t instanceof qr)){e=!1;break}return e}function F5(n){let e=!0;for(const t of pt(n))if(t instanceof qr){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class jh extends Ze{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:gy("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new Q("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new Q("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new Q("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=t,this.dtype=s,this.inputSpec=[{shape:t}];const r=new qr(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new xy({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new Q(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}jh.className="InputLayer";me(jh);function L5(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new Q("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new jh({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function P5(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return ke(e,n.dtype)}catch{throw new Q(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class ea{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof ea)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=P5(e,t),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new Q(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof qr){if(this.id2Value[e.id]==null)throw new Q(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new Q(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof qr){if(this.id2Value[e.id]==null)throw new Q(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new Q(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&Ye(this.id2Mask)}}const em=new JT,tm=new JT;function z5(n){em!=null&&em.setMaxEntries(n),tm!=null&&tm.setMaxEntries(n)}function Pc(n,e,t,s){const r=t==null?!1:t.training,o=Array.isArray(n),a=o?n:[n],i=a.map(y=>y.name),l=[],c=e.names();for(const y of i)c.indexOf(y)!==-1?l.push(e.getValue(y)):l.push(null);const h=i.join(",")+"|"+e.names().sort().join(",");let p=em.get(h),f;if(p==null){const y=M5(a,e);p=y.sorted,f=y.recipientCounts,em.put(h,p),tm.put(h,f)}f={},r||Object.assign(f,tm.get(h));const g=new ea(e);for(let y=0;y<p.length;++y){const w=p[y],x=w.sourceLayer;if(x instanceof jh)continue;const v=[],k=[],I=[];let N=!1;for(const F of w.inputs){const L=g.getValue(F),E=g.getMask(F);v.push(L),k.push(E),E!=null&&(N=!0),r||(f[F.name]--,f[F.name]===0&&!e.hasKey(F)&&i.indexOf(F.name)===-1&&!L.isDisposed&&F.sourceLayer.stateful!==!0&&I.push(L))}N&&(t=t||{},t.mask=k[0]);const T=pt(x.apply(v,t));let D=null;x.supportsMasking&&(D=x.computeMask(v,k));const P=V5(w),z=Array.isArray(P)?P:[P];for(let F=0;F<z.length;++F){g.hasKey(z[F])||g.add(z[F],T[F],Array.isArray(D)?D[0]:D);const L=i.indexOf(z[F].name);L!==-1&&(l[L]=T[F])}r||Ye(I)}return g.disposeMasks(),o?l:l[0]}function M5(n,e){A(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],s={};if(n.length===1){const r=QC(n[0],e);t=r.sorted,s=r.recipientMap}else{const r=new Set;for(const o of n){const{sorted:a,recipientMap:i}=QC(o,e);for(const l of a)r.has(l.name)||(t.push(l),r.add(l.name));for(const l in i)s[l]==null&&(s[l]=new Set),i[l].forEach(c=>s[l].add(c))}}return{sorted:t,recipientCounts:B5(s)}}function B5(n){const e={};for(const t in n)e[t]=n[t].size;return e}function QC(n,e){const t=new Set,s=[],r={};for(const i of e.names())t.add(i);const o=[],a=[];for(o.push(n);o.length>0;){const i=o[o.length-1];if(t.has(i.name)){o.pop();continue}const l=a[a.length-1]===o.length-1;if(i.inputs.length===0||l)o.pop(),s.push(i),t.add(i.name),l&&a.pop();else{a.push(o.length-1);for(const c of i.inputs)r[c.name]==null&&(r[c.name]=new Set),r[c.name].add(i.name),!t.has(c.name)&&o.push(c)}}return{sorted:s,recipientMap:r}}function V5(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){t=s;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W5=oe();W5.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,z5);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Sv(n,e){return re(()=>pn(Ae(G(n,n),e,!0)))}class Gh extends Ai{getConfig(){return{}}}class yE extends Gh{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return re(()=>{const t=Sv(e,this.axis),s=ts(t,0,this.maxValue);return G(e,Fe(s,fe(en(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}yE.className="MaxNorm";me(yE);class xE extends Gh{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return re(()=>Fe(e,fe(en(),Sv(e,this.axis))))}getConfig(){return{axis:this.axis}}}xE.className="UnitNorm";me(xE);class bE extends Gh{apply(e){return Cr(e)}}bE.className="NonNeg";me(bE);class wE extends Gh{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return re(()=>{const t=Sv(e,this.axis),s=fe(G(this.rate,ts(t,this.minValue,this.maxValue)),G(1-this.rate,t));return G(e,Fe(s,fe(en(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}wE.className="MinMaxNorm";me(wE);const ZC={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function sn(n){return hv(n)}function JC(n,e={}){return Bh(n,Es.getMap().classNameMap,e,"constraint")}function rn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in ZC?ZC[n]:n,config:{}};return JC(t)}else return n instanceof Gh?n:JC(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Ua(n){if(n==null)return;const e=[],t=[],s=[];for(const r in n){const o=n[r];if(typeof o!="number"){const a=o;e.push(a.data()),t.push(r),s.push(a)}}if(e.length>0){const r=await Promise.all(e);for(let o=0;o<r.length;++o)n[t[o]]=r[o][0];Ye(s)}}function vE(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var eI;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(eI||(eI={}));const U5=125;class rd{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class j5{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class G5 extends rd{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const s=t.size==null?0:t.size;this.seen+=s;for(const r in t){const o=t[r];if(typeof o=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+o*s;else{let a;r in this.totals?a=this.totals[r]:this.totals[r]=0;const i=re(()=>fe(this.totals[r],G(o,s)));this.totals[r]=i,a!=null&&a.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?t[s]=this.totals[s]/this.seen:re(()=>{const r=G(Fe(1,this.seen),this.totals[s]);t[s]=r,this.totals[s].dispose(),Jt(t[s])}))}}let H5=class extends rd{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const s in t)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(t[s])}async syncData(){const e=[],t=[],s=[];for(const o in this.history){const a=this.history[o];for(let i=0;i<a.length;++i)if(typeof a[i]!="number"){const l=a[i];e.push(l.data()),t.push(o),s.push(i)}}const r=await Promise.all(e);for(let o=0;o<r.length;++o)this.history[t[o]][s[o]].dispose(),this.history[t[o]][s[o]]=r[o][0]}};class q5 extends rd{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||j1,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=U5),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");Vf(this.yieldEvery)&&(this.maybeWait=a5(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,s){const r=[];this.yield!=null&&(await Ua(s),r.push(this.yield(e,t,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await Ua(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const s=[];this.epochEnd!=null&&(await Ua(t),s.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,t){this.batchBegin!=null&&(await Ua(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const s=[];this.batchEnd!=null&&(await Ua(t),s.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):Vf(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Ua(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Ua(e),await this.trainEnd(e))}}function kE(n,e){return n==null&&(n={}),n instanceof rd?[n]:Array.isArray(n)&&n[0]instanceof rd?n:pt(n).map(s=>new q5(s,e))}class qs{constructor(){}static registerCallbackConstructor(e,t){A(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),qs.checkForDuplicate(t),qs.constructors[e]==null&&(qs.constructors[e]=[]),qs.constructors[e].push(t)}static checkForDuplicate(e){for(const t in qs.constructors)qs.constructors[+t].forEach(r=>{if(r===e)throw new Q("Duplicate callback constructor.")})}static clear(){qs.constructors={}}static createCallbacks(e){const t=[];for(const s in qs.constructors){const r=+s;e>=r&&t.push(...qs.constructors[r])}return t.map(s=>new s)}}qs.constructors={};function SE(n,e,t,s,r,o,a,i,l){const c=new H5,h=[new G5,...qs.createCallbacks(e)];n!=null&&h.push(...n),h.push(c);const p=new j5(h);return p.setParams({epochs:t,initialEpoch:s,samples:r,steps:o,batchSize:a,verbose:e,doValidation:i,metrics:l}),{callbackList:p,history:c}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function po(n,e={},t=!1){return Bh(n,Es.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nm(n,e){return re(()=>{n.dtype!=="float32"&&(n=ke(n,"float32"));const t=Ae(Wh(n),e,!0),s=Ti(t.shape,en()),r=pn(Xr(t,s));return Fe(n,r)})}function by(n,e){return re(()=>_t(Wh(Te(e,n)),-1))}function Nv(n,e){return re(()=>_t(Xt(Te(e,n)),-1))}function Cv(n,e){return re(()=>{const t=Te(n,e),s=ts(Xt(n),en(),Number.MAX_VALUE),r=Xt(Fe(t,s));return G(100,_t(r,-1))})}function K5(n,e){return re(()=>{const t=ts(e,en(),Number.MAX_VALUE),s=ys(fe(1,t)),r=ts(n,en(),Number.MAX_VALUE),o=ys(fe(1,r));return _t(Wh(Te(s,o)),-1)})}function X5(n,e){return re(()=>{const t=Xr(0,Te(1,G(n,e)));return _t(Wh(t),-1)})}function Y5(n,e){return re(()=>{const t=Xr(0,Te(1,G(n,e)));return _t(t,-1)})}function Q5(n,e){return re(()=>{const t=Ae(G(n,e),-1),s=_s(G(Te(1,n),e),-1);return Xr(0,fe(1,Te(s,t)))})}function Z5(n,e){return re(()=>{const t=Math.log(2),s=Te(e,n),r=Te(fe(s,Ei(G(-2,s))),t);return _t(r,-1)})}function od(n,e,t=!1){return re(()=>{if(t)e=Pu(e);else{const s=Ae(e,e.shape.length-1,!0);e=Fe(e,s)}return e=ts(e,en(),1-en()),St(Ae(G(ke(n,"float32"),ys(e)),e.shape.length-1))})}function sm(n,e,t=!1){return re(()=>{const s=ke(Fu(x5(n)),"int32");e=ts(e,en(),1-en());const r=e.shape,o=q(Nl(s,r[r.length-1]),r);return od(o,e,t)})}function J5(n,e){if(!Je(n.shape,e.shape))throw new Q(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return re(()=>{const t=Cr(e),s=St(Xt(e));return fe(Te(t,G(e,n)),Ih(ns(s)))})}function wy(n,e){return re(()=>{let t;return t=ts(e,en(),1-en()),t=ys(Fe(t,Te(1,t))),_t(J5(n,t),-1)})}function eH(n,e){return re(()=>{const t=ts(n,en(),1),s=ts(e,en(),1);return Ae(G(n,ys(Fe(t,s))),-1)})}function tH(n,e){return re(()=>{const t=ys(fe(en(),e));return _t(Te(e,G(n,t)),-1)})}function NE(n,e){return re(()=>{const t=nm(n,-1),s=nm(e,-1),r=G(t,s);return St(Ae(r,-1))})}const rm={meanSquaredError:by,meanAbsoluteError:Nv,meanAbsolutePercentageError:Cv,meanSquaredLogarithmicError:K5,squaredHinge:X5,hinge:Y5,categoricalHinge:Q5,logcosh:Z5,categoricalCrossentropy:od,sparseCategoricalCrossentropy:sm,binaryCrossentropy:wy,kullbackLeiblerDivergence:eH,poisson:tH,cosineProximity:NE};function Ux(n){if(typeof n=="string"){if(n in rm)return rm[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new Q(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function CE(n,e){return re(()=>{const t=G(.5,xs(e)),s=Vr(os(e,t),n.dtype);return _t(Js(n,s),-1)})}function IE(n,e){return re(()=>Vr(Js(di(n,-1),di(e,-1)),"float32"))}function nH(n,e){return re(()=>ke(Ae(wr(Js(n,1),Js(e,1))),"float32"))}function sH(n,e){return re(()=>ke(Ae(wr(Js(n,0),Js(e,1))),"float32"))}function rH(n,e){return re(()=>{const t=nH(n,e),s=sH(n,e),r=fe(t,s);return ke(vn(os(r,0),Fe(t,r),0),"float32")})}function oH(n,e){return wy(n,e)}function aH(n,e){return n.rank===e.rank&&(n=Co(n,[n.rank-1])),e=di(e,-1),e.dtype!==n.dtype&&(e=ke(e,n.dtype)),ke(Js(n,e),"float32")}const iH=by,lH=by,uH=Nv,cH=Nv,dH=Cv,hH=Cv,$E=od,pH=NE,TE=sm,om={binaryAccuracy:CE,categoricalAccuracy:IE,precision:rH,categoricalCrossentropy:$E,sparseCategoricalCrossentropy:TE,mse:iH,MSE:lH,mae:uH,MAE:cH,mape:dH,MAPE:hH,cosine:pH};function fH(n){if(typeof n=="string"&&n in om)return om[n];if(typeof n!="string"&&n!=null)return n;throw new Q(`Unknown metric ${n}`)}function gf(n){if(Or(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(rm))if(rm[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(om))if(om[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mH(n){const e={Adagrad:()=>qa.adagrad(.01),Adadelta:()=>qa.adadelta(1,.95,en()),Adam:()=>qa.adam(.001,.9,.999,en()),Adamax:()=>qa.adamax(.002,.9,.999,en(),0),RMSProp:()=>qa.rmsprop(.001,.9,0,en()),SGD:()=>qa.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new Q(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const tI=1*1024*1024;function nI(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!qb(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const s=JSON.stringify(n);s.length>tI&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${tI}.`)}}function qb(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!qb(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!qb(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function gH(n,e,t,s=console.log){const r=xH(n),o=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(h=>Math.floor(e*h)));let a;if(!r){o.push("Receives inputs"),a=[];for(const h in n.nodesByDepth)a.push(...n.nodesByDepth[h])}s("_".repeat(e)),am(o,t,s),s("=".repeat(e));const i=n.layers;for(let h=0;h<i.length;++h)r?bH(i[h],t,s):wH(i[h],t,a,s),s((h===i.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const l=yH(n),c=Jf(n.nonTrainableWeights);s(`Total params: ${l+c}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${c}`),s("_".repeat(e))}function yH(n){let e;return n.collectedTrainableWeights!=null?e=Jf(n.collectedTrainableWeights):e=Jf(n.trainableWeights),e}function xH(n){let e=!0;const t=[],s=[];for(const r in n.nodesByDepth)t.push(n.nodesByDepth[r]);for(const r of t){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of n.layers){let o=!1;for(const a of r.inboundNodes)if(s.indexOf(a)!==-1)if(o){e=!1;break}else o=!0;if(!e)break}return e}function am(n,e,t=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);t(s)}function bH(n,e,t){let s,r;try{r=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const o=n.name,a=n.getClassName(),i=[`${o} (${a})`,r,s,n.countParams().toString()];am(i,e,t)}function wH(n,e,t,s){let r,o;try{o=n.inboundNodes.map(p=>JSON.stringify(p.inputShapes)).join(",")}catch{o="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const a=[];for(const p of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(p)===-1))for(let f=0;f<p.inboundLayers.length;++f){const g=p.inboundLayers[f].name,y=p.nodeIndices[f],w=p.tensorIndices[f];a.push(`${g}[${y}][${w}]`)}const i=n.name,l=n.getClassName(),c=a.length===0?"":a[0],h=[`${i} (${l})`,o,r,n.countParams().toString(),c];am(h,e,s);for(let p=1;p<a.length;++p)am(["","","","",a[p]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function EE(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function Kb(n,e){if(n===null)return null;if(typeof n=="string")return Qa(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const o=n[r];EE(e,r,o)?t.push(o):t.push(Kb(o,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")t[s]=r;else{const o=Qa(s);t[o]=Kb(r,o)}}return t}}function Xb(n,e){if(n==null)return null;if(typeof n=="string")return uo(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const o=n[r];EE(e,r,o)?t.push(o):t.push(Xb(o,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s],o=uo(s);(s==="name"||s==="className")&&typeof r=="string"?t[o]=r:t[o]=Xb(r,s)}return t}}/** @license See the LICENSE file. */const RE="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const vH=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class pr extends Ze{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const k=this.getClassName().toLowerCase();this.name=gy(k)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],ra(this.inputs).length!==this.inputs.length)throw new Q(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(k=>k.name)}`);ra(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(k=>k.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const k of this.outputs){const I=k.sourceLayer,N=k.nodeIndex,T=k.tensorIndex;this.outputLayers.push(I),this.outputLayersNodeIndices.push(N),this.outputLayersTensorIndices.push(T)}for(const k of this.inputs){const I=k.sourceLayer,N=k.nodeIndex,T=k.tensorIndex;Or(N===0,"input layer has >1 nodes"),Or(T===0,"input layer has >1 tensors"),this.inputLayers.push(I),this.inputLayersNodeIndices.push(N),this.inputLayersTensorIndices.push(T)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let k=0;k<this.inputLayers.length;k++){const I=this.inputLayers[k];if(!(I instanceof jh))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${k} (0-based) originates from layer type ${I.getClassName()}.`);this.inputNames.push(I.name),this.feedInputShapes.push(I.batchInputShape),this.feedInputNames.push(I.name)}for(const k of this.outputLayers)this.outputNames.push(k.name);this.internalInputShapes=this.inputs.map(k=>k.shape),this.internalOutputShapes=this.outputs.map(k=>k.shape);const t={},s={},r={},o={},a={},i=[],l=(k,I,N,T,D,P)=>{(T==null||D==null||P==null)&&(T=k.sourceLayer,D=k.nodeIndex,P=k.tensorIndex);const z=T.inboundNodes[D];if(N.indexOf(z)!==-1)throw new Ys(`The tensor ${k.name} at layer "${T.name}" is part of a cycle.`);if(I.indexOf(z)!==-1)return;this.containerNodes.add(pr.nodeKey(T,D)),T.id in a||(a[T.id]=Object.keys(a).length),N.indexOf(z)===-1&&N.push(z);const F=z.inboundLayers.length;for(let L=0;L<F;L++){const E=z.inputTensors[L],j=z.inboundLayers[L],Z=z.nodeIndices[L],ne=z.tensorIndices[L];l(E,I,N,j,Z,ne)}for(I.push(z);N.indexOf(z)>=0;)N.splice(N.indexOf(z),1);i.push(z)},c=[],h=[];for(const k of this.outputs)l(k,c,h);const p=i.slice().reverse();for(const k of p){s[k.id]=k,k.id in t||(t[k.id]=0);let I=t[k.id];const N=r[k.outboundLayer.id]==null?0:r[k.outboundLayer.id];I=Math.max(I,N),r[k.outboundLayer.id]=I,o[k.outboundLayer.id]=k.outboundLayer,t[k.id]=I;for(let T=0;T<k.inboundLayers.length;T++){const D=k.inboundLayers[T],P=k.nodeIndices[T],z=D.inboundNodes[P],F=t[z.id]==null?0:t[z.id];t[z.id]=Math.max(I+1,F),s[z.id]=z}}const f={};for(const k in t){const I=t[k];I in f||(f[I]=[]),f[I].push(s[k])}const g={};for(const k in r){const I=r[k];I in g||(g[I]=[]),g[I].push(o[k])}let y=Object.keys(g).map(k=>parseInt(k,10)).sort(pf);this.layers=[];for(const k of y){const I=g[k];I.sort((N,T)=>{const D=a[N.id],P=a[T.id];return D<P?-1:D>P?1:0});for(const N of I)N instanceof pr&&this.internalContainerRefs.push(N),this.layers.push(N)}this.layersByDepth=g,y=Object.keys(f).map(k=>parseInt(k,10)).sort(pf);const w=this.inputs.slice(),x=[];for(const k of y)for(const I of f[k]){const N=I.outboundLayer;if(N!=null){for(const T of I.inputTensors)if(w.indexOf(T)===-1)throw new Ys(`Graph disconnected: cannot obtain value for tensor ${T} at layer "${N.name}". The following previous layers were accessed without issue: ${x}`);for(const T of I.outputTensors)w.push(T);x.push(N.name)}}this.nodesByDepth=f;const v=this.layers.map(k=>k.name);for(const k of v){const I=v.filter(N=>N===k).length;if(I!==1)throw new Ys(`The name "${k}" is used ${I} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(v))}this.outboundNodes=[],this.inboundNodes=[],new xy({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(k=>null),outputMasks:this.outputs.map(k=>null),inputShapes:this.inputs.map(k=>k.shape),outputShapes:this.outputs.map(k=>k.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new Q("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.layers)t.push(...s.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const s={};let r=0;const o=vH(e);o&&this.parseWeights(e);for(const i of this.layers)for(const[l,c]of i.weights.entries()){const h=o?`${c.name.split("/").slice(0,-1).join("/")+"/"}${l}`:c.originalName;if(s[h]!=null)throw new Q(`Duplicate weight name: ${h}`);s[h]=c,r++}const a=[];for(const i in e){let l=i;if(s[i]==null){const c=i.split("/");l=c.slice(0,-2).concat([c[c.length-1]]).join("/")}if(s[l]!=null)a.push([s[l],e[i]]);else if(t)throw new Q(`Provided weight data has no target variable: ${i}`);delete s[l]}if(t){const i=[];for(const l in s)i.push(l);if(i.length>0)throw new Q(`${i.length} of ${r} weights are not set: ${i}`)}kv(a)}parseWeights(e){for(const t in Object.keys(e)){const s=t.split("/"),r=["vars","layer_checkpoint_dependencies"],o=s.map(a=>a.startsWith("_")?a.slice(1):a).filter(a=>!r.includes(a)).join("/");o!==t&&(e[o]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${RE}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const s=Xb(this.updatedConfig());return t?JSON.stringify(s):s}call(e,t){return re(()=>{e=pt(e);const s=new ea;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return Pc(this.outputs,s,t)})}computeMask(e,t){return re(()=>{e=pt(e);let s;return t==null?s=xi(null,e.length):s=pt(t),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const t=Zf(e);if(t.length!==this.inputLayers.length)throw new Q(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let i=0;i<t.length;i++){const l=this.inputLayers[i],c=t[i],h=l.name+"_0_0";s[h]=c}const r=Object.keys(this.nodesByDepth).map(i=>parseInt(i,10)).sort(pf);if(r.length>1)for(const i of r){const l=this.nodesByDepth[i];for(const c of l){const h=c.outboundLayer;if(this.inputLayers.map(w=>w.id).indexOf(h.id)!==-1)continue;const p=[];for(let w=0;w<c.inboundLayers.length;w++){const x=c.inboundLayers[w],v=c.nodeIndices[w],k=c.tensorIndices[w],I=`${x.name}_${v}_${k}`,N=s[I];p.push(N)}const f=h.computeOutputShape(Yn(p)),g=Zf(f),y=h.inboundNodes.indexOf(c);for(let w=0;w<g.length;w++){const x=`${h.name}_${y}_${w}`;s[x]=g[w]}}}const o=[],a=[];for(let i=0;i<this.outputLayers.length;i++){const l=this.outputLayers[i],c=this.outputLayersNodeIndices[i],h=this.outputLayersTensorIndices[i],p=`${l.name}_${c}_${h}`;a.push(p)}for(let i=0;i<a.length;i++){const l=a[i];Or(l in s),o.push(s[l])}return Yn(o)}runInternalGraph(e,t){t==null&&(t=xi(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const c=this.inputs[l],h=e[l],p=t[l];s[c.id]=[h,p]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(pf);for(const l of r){const c=this.nodesByDepth[l];for(const h of c){const p=h.outboundLayer,f=h.inputTensors,g=h.outputTensors,y=new Array;for(const w of f)w.id in s&&y.push(s[w.id]);if(y.length===f.length){let w={},x,v,k,I;if(h.callArgs!=null&&(w=h.callArgs),y.length===1){const[N,T]=y[0];w.mask==null&&(w.mask=T),k=pt(p.call(N,w)),I=pt(p.computeMask(N,T)),x=[N],v=[T]}else x=y.map(N=>N[0]),v=y.map(N=>N[1]),w.mask==null&&(w.mask=v),k=pt(p.call(x,w)),I=pt(p.computeMask(x,v));if(p.activityRegularizer)throw new Ke("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let N=0;N<g.length;++N){const T=g[N],D=k[N],P=I[N];s[T.id]=[D,P]}}}}const o=[],a=[],i=[];for(const l of this.outputs){Or(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[c,h]=s[l.id];i.push(c.shape),o.push(c),a.push(h)}return[o,a,i]}buildNodeConversionMap(e){const t={};let s;for(const r of this.layers){s=r instanceof pr?1:0;for(let o=0;o<r.inboundNodes.length;o++){const a=pr.nodeKey(r,o);this.containerNodes.has(a)&&(t[a]=s,s+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new Q("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new Q(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new Q(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return re(()=>{const e=[];for(const t of this.layers)for(let s=0;s<t.inboundNodes.length;++s){const r=pr.nodeKey(t,s);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),s=[];for(const a of this.layers){const i=a.getClassName(),l=a.getConfig(),c=[];for(let p=0;p<a.inboundNodes.length;p++){const f=a.inboundNodes[p],g=pr.nodeKey(a,p);let y={};if(this.containerNodes.has(g)){if(f.callArgs)try{JSON.stringify(f.callArgs),y=f.callArgs}catch{console.warn(`Layer ${a.name} was passed non-serializable keyword arguments: ${f.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),y={}}if(f.inboundLayers.length>0){const w=[];for(let x=0;x<f.inboundLayers.length;x++){const v=f.inboundLayers[x],k=f.nodeIndices[x],I=f.tensorIndices[x],N=pr.nodeKey(v,k);let T=t[N];T==null&&(T=0),w.push([v.name,T,I,y])}c.push(w)}}}const h={};h.name=a.name,h.className=i,h.config=l,h.inboundNodes=c,s.push(h)}e.layers=s;const r=[];for(let a=0;a<this.inputLayers.length;a++){const i=this.inputLayers[a],l=this.inputLayersNodeIndices[a],c=pr.nodeKey(i,l);if(!this.containerNodes.has(c))continue;let h=t[c];h==null&&(h=0);const p=this.inputLayersTensorIndices[a];r.push([i.name,h,p])}e.inputLayers=r;const o=[];for(let a=0;a<this.outputLayers.length;a++){const i=this.outputLayers[a],l=this.outputLayersNodeIndices[a],c=pr.nodeKey(i,l);if(!this.containerNodes.has(c))continue;let h=t[c];h==null&&(h=0);const p=this.outputLayersTensorIndices[a];o.push([i.name,h,p])}return e.outputLayers=o,e}static fromConfig(e,t,s={},r=!1){const o={},a={};function i(x,v){x.name in a?a[x.name].push(v):a[x.name]=[v]}function l(x,v){const k=[];let I;for(const N of v){const T=N[0],D=N[1],P=N[2];if(I=N[3]==null?{}:N[3],!(T in o)){i(x,v);return}const z=o[T];if(z.inboundNodes.length<=D){i(x,v);return}const F=z.inboundNodes[D];k.push(F.outputTensors[P])}k.length>0&&x.apply(Yn(k),I)}function c(x){const v=x.name,k=po(x,t.customObjects!=null?t.customObjects:{});k.setFastWeightInitDuringBuild(r),o[v]=k,x.inboundNodes.forEach(N=>{if(!(N instanceof Array))throw new Q(`Corrupted configuration, expected array for nodeData: ${N}`);i(k,N)})}const h=t.name,p=t.layers;for(const x of p)c(x);for(;!o5(a);)for(const x of p){const v=o[x.name];if(v.name in a){const k=a[v.name];delete a[v.name];for(const I of k)l(v,I)}}const f=[],g=[],y=t.inputLayers;for(const x of y){const v=x[0],k=x[1],I=x[2];Or(v in o);const T=o[v].inboundNodes[k].outputTensors;f.push(T[I])}const w=t.outputLayers;for(const x of w){const v=x[0],k=x[1],I=x[2];Or(v in o);const T=o[v].inboundNodes[k].outputTensors;g.push(T[I])}return new e({inputs:f,outputs:g,name:h})}get stateful(){if(this._stateful)throw new Q("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){re(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function kH(n,e,t){const s=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return e.forEach(o=>{o in n?r.push(n[o]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${t} must be either an array with ${s} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function AE(n,e){return kH(n,e,"classWeight")}async function DE(n,e,t,s){if(t!=null){const r=re(()=>{if(n.shape.length===1)return Mr(n);if(n.shape.length===2){if(n.shape[1]>1)return di(n,1);if(n.shape[1]===1)return q(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),o=Array.from(await r.data());Ye(r);const a=[];return o.forEach(i=>{if(t[i]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${i} exists in the data but not in classWeight`);a.push(t[i])}),Dn(a,"float32")}else return null}function SH(n,e){return G(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const NH=32;function _E(n,e){let t,s;const r=e;t=r.xs,s=r.ys,A(t!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const o=sI("input",n.inputNames,t),a=sI("output",n.outputNames,s),i=o[0].shape[0];A(o.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),A(a.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${a.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<o.length;l++)A(o[l].shape[0]===i,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${o[l].shape[0]}; expected  ${i} based on input ${n.inputNames[0]}.`);for(let l=0;l<a.length;l++)A(a[l].shape[0]===i,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${a[l].shape[0]}; expected  ${i} based on input ${n.inputNames[0]}.`);return{xs:o,ys:a}}function sI(n,e,t){if(t instanceof dt)return[t];if(Array.isArray(t))return A(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const s=[];for(const r of e){if(t[r]==null)throw new Q(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(t[r])}return s}}function CH(n){if(n.length===3)throw new Ke("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function IH(n,e,t){const s=t.batchesPerEpoch!=null;if(A(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),A(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),A(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),A(!s||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),A(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=t.validationData!=null;let o,a;if(r)if(rI(t.validationData))A(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const x=CH(t.validationData);o=x.xs,a=x.ys}const i=n.makeTrainFunction(),l=n.getDedupedMetricsNames();let c;r?c=l.slice().concat(l.map(x=>"val_"+x)):c=l.slice();const h=kE(t.callbacks,t.yieldEvery),p=t.verbose==null?1:t.verbose,{callbackList:f,history:g}=SE(h,p,t.epochs,null,null,$H(e,t),null,r,c);f.setModel(n),n.history=g,await f.onTrainBegin(),n.stopTraining_=!1;let y=t.initialEpoch==null?0:t.initialEpoch,w=await e.iterator();for(;y<t.epochs;){const x={};await f.onEpochBegin(y);let v=0,k=0;for(s||(w=await e.iterator());!s||v<t.batchesPerEpoch;){const I=await w.next();if(s&&I.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${v} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(I.value!=null){const{xs:N,ys:T}=_E(n,I.value),D={};D.batch=k,D.size=N[0].shape[0],await f.onBatchBegin(k,D);const P=[];if(t.classWeight!=null){const L=AE(t.classWeight,n.outputNames);for(let E=0;E<L.length;++E)P.push(await DE(T[E],null,L[E]))}const z=N.concat(T).concat(P),F=i(z);Ye(z);for(let L=0;L<l.length;++L){const E=l[L],j=F[L];D[E]=j,Jt(j)}await f.onBatchEnd(k,D),vE(D),k++,v++}if(s?v>=t.batchesPerEpoch:I.done){if(r){let N;rI(t.validationData)?N=pt(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):N=pt(n.evaluate(o,a,{batchSize:t.validationBatchSize==null?NH:t.validationBatchSize,verbose:0}));for(let T=0;T<n.metricsNames.length;++T)x[`val_${n.metricsNames[T]}`]=N[T]}break}if(n.stopTraining_)break}if(await f.onEpochEnd(y,x),y++,n.stopTraining_)break}return await f.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function $H(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function rI(n){return typeof n.iterator=="function"}function TH(n){return typeof n.next=="function"}async function EH(n,e,t){t=t||{};const s=t.batches!=null,r=n.testFunction;let o=[];if(t.verbose>0)throw new Ke("Verbose mode is not implemented yet.");A(!s||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const a=TH(e)?e:await e.iterator();let i=0,l=0;for(;!s||l<t.batches;){const c=await a.next();if(o=re(()=>{if(c.value){const{xs:h,ys:p}=_E(n,c.value),f=h.concat(p),g=re(()=>r(f));if(Ye(f),l===0)for(let w=0;w<g.length;++w)o.push(Me(0));const y=f[0].shape[0];for(let w=0;w<g.length;++w){const x=g[w],v=o[w];o[w]=re(()=>fe(o[w],G(y,x))),l>0&&Ye(v)}Ye(g),i+=y,++l}return o}),c.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<o.length;++c){const h=o[c];o[c]=Fe(o[c],i),Ye(h)}return Yn(o)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jx(n){A(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function _c(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(s=>ai(s,e,t-e)):ai(n,e,t-e)}function Yb(n,e){return re(()=>n==null?null:Array.isArray(n)?n.map(t=>Yb(t,e)):iE(n,e.dtype==="int32"?e:ke(e,"int32")))}function Gx(n,e){const t=[];let s=0,r=null;for(;s<n;)r=s+e,r>=n&&(r=n),t.push([s,r]),s=r;return t}function OE(n){const e=[];n instanceof dt&&(n=[n]);for(let t=0;t<n.length;++t){const s=n[t];if(s.rank===1)e.push(Vh(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function hr(n,e){if(n==null)return;const t=[];if(e instanceof dt)t.push(e.id);else if(Array.isArray(e))e.forEach(r=>t.push(r.id));else if(e!=null)for(const r in e){const o=e[r];t.push(o.id)}const s=[];if(n instanceof dt)t.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{t.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const o=n[r];t.indexOf(o.id)===-1&&s.push(o)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function RH(n){return n instanceof dt}function Qb(n){return Array.isArray(n)}function oI(n){return!RH(n)&&!Qb(n)}function aI(n,e,t,s=!0,r=""){if(e==null||e.length===0){if(n!=null){let a=!1;if(Qb(n)&&n.length>0)a=!0;else if(oI(n)){for(const i in n)if(n.hasOwnProperty(i)){a=!0;break}}else a=!0;if(a)throw new Q(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(a=>null);let o;if(oI(n)){n=n,o=[];for(const a of e){if(n[a]==null)throw new Q(`No data provided for "${a}". Need data for each key in: ${e}`);o.push(n[a])}}else if(Qb(n)){if(n=n,n.length!==e.length)throw new Q(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);o=n}else{if(n=n,e.length>1)throw new Q(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);o=[n]}if(o=OE(o),t!=null)for(let a=0;a<e.length;++a){if(t[a]==null)continue;const i=o[a];if(i.shape.length!==t[a].length)throw new Q(`Error when checking ${r}: expected ${e[a]} to have ${t[a].length} dimension(s). but got array with shape ${i.shape}`);for(let l=0;l<t[a].length;++l){if(l===0&&!s)continue;const c=i.shape[l],h=t[a][l];if(h!=null&&h>=0&&c!==h)throw new Q(`${r} expected a batch of elements where each example has shape [${t[a].slice(1,t[a].length)}] (i.e.,tensor shape [*,${t[a].slice(1,t[a].length)}]) but the ${r} received an input with ${i.shape[0]} examples, each with shape [${i.shape.slice(1,i.shape.length)}] (tensor shape [${i.shape}])`)}}return o}function AH(n,e,t){const s=ra(n.map(o=>o.shape[0]));s.sort();const r=ra(e.map(o=>o.shape[0]));if(r.sort(),s.length>1)throw new Q(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(o=>o.shape))}`);if(r.length>1)throw new Q(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(o=>o.shape))}`);if(s.length>0&&r.length>0&&!Je(s,r))throw new Q(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function DH(n,e,t){const s=[by,wy,od];for(let r=0;r<n.length;++r){const o=n[r],a=e[r],i=t[r];if(a!=null){if(a===od&&o.shape[o.shape.length-1]===1)throw new Q(`You are passing a target array of shape ${o.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(a)!==-1){const l=o.shape.slice(1),c=i.slice(1);for(let h=0;h<l.length;++h){const p=l[h],f=c[h];if(f!=null&&p!==f)throw new Q(`A target Tensor with shape ${o.shape} was passed for an output of shape ${i}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function iI(n,e,t,s=!0,r=""){let o;if(Array.isArray(n)){if(n.length!==e.length)throw new Q(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);o=n}else{if(e.length>1)throw new Q(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);o=[n]}if(t!=null)for(let a=0;a<e.length;++a){if(t[a]==null)continue;const i=o[a];if(i.shape.length!==t[a].length)throw new Q(`Error when checking ${r}: expected ${e[a]} to have ${t[a].length} dimension(s), but got array with shape ${JSON.stringify(i.shape)}`);for(let l=0;l<t[a].length;++l){if(l===0&&!s)continue;const c=i.shape[l],h=t[a][l];if(h!=null&&h!==c)throw new Q(`Error when checking ${r}: expected ${e[a]} to have shape ${JSON.stringify(t[a])} but got array with shape ${JSON.stringify(i.shape)}.`)}}}function _H(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(s=>t);{const s=[];for(const r of e){let o=t.hasOwnProperty(r)?t[r]:[];Array.isArray(o)||(o=[o]),s.push(o)}return s}}const OH="layers-model";class xl extends pr{constructor(e){super(e),this.isTraining=!1}summary(e,t,s=console.log){if(!this.built)throw new Q("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");gH(this,e,t,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=mH(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof $o))throw new Q("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const a in e.loss)if(this.outputNames.indexOf(a)===-1)throw new Q(`Unknown entry in loss dictionary: "${a}". Only expected the following keys: ${this.outputNames}`);for(const a of this.outputNames)e.loss[a]==null&&console.warn(`Output "${a}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${a} during training`),t.push(Ux(e.loss[a]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new Q(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(i=>Ux(i))}else{const a=Ux(e.loss);this.outputs.forEach(i=>{t.push(a)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let a=0;a<this.outputs.length;++a){const i=this.internalOutputShapes[a],l=this.outputNames[a];this.feedOutputNames.push(l),this.feedOutputShapes.push(i),this.feedLossFns.push(this.lossFunctions[a])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],oi("loss",()=>{for(let a=0;a<this.outputs.length;++a){if(s.indexOf(a)!==-1)continue;const i=this.lossFunctions[a];this.outputs.length>1&&(this.metricsTensors.push([i,a]),this.metricsNames.push(this.outputNames[a]+"_loss"))}});const r=_H(e.metrics,this.outputNames),o=(a,i,l)=>{this.outputNames.length>1&&(i=this.outputNames[a]+"_"+i),this.metricsNames.push(i),this.metricsTensors.push([l,a])};oi("metric",()=>{for(let a=0;a<this.outputs.length;++a){if(s.indexOf(a)!==-1)continue;const i=r[a];(c=>{const h="";let p,f,g;for(const y of c){if(typeof y=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(y)!==-1){const x=this.internalOutputShapes[a];x[x.length-1]===1||this.lossFunctions[a]===wy?["accuracy","acc"].indexOf(y)!==-1?f=CE:["crossentropy","ce"].indexOf(y)!==-1&&(f=oH):this.lossFunctions[a]===sm?["accuracy","acc"].indexOf(y)!==-1?f=aH:["crossentropy","ce"].indexOf(y)!==-1&&(f=TE):["accuracy","acc"].indexOf(y)!==-1?f=IE:["crossentropy","ce"].indexOf(y)!==-1&&(f=$E);let v;["accuracy","acc"].indexOf(y)!==-1?v="acc":["crossentropy","ce"].indexOf(y)!==-1&&(v="ce"),g=f,p=h+v}else g=fH(y),p=h+gf(y);let w;oi(p,()=>{w=g}),o(a,p,w)}})(i)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,s={}){const r=s.batchSize==null?32:s.batchSize;jx(r);const a=this.standardizeUserDataXY(e,t,!0,r);try{const i=a[0].concat(a[1]);this.makeTestFunction();const l=this.testFunction,c=this.testLoop(l,i,r,s.verbose,s.steps);return Yn(c)}finally{hr(a[0],e),hr(a[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),EH(this,e,t)}checkNumSamples(e,t,s,r="steps"){let o;if(s!=null){if(o=null,t!=null)throw new Q(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?o=e[0].shape[0]:o=e.shape[0];else throw new Q(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return o}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new Q("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(t),r=s?t:[t],o=this.retrieveSymbolicTensors(r),a=new ea;if(e instanceof dt&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new Q(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)a.add(this.inputs[l],e[l])}else for(const l of this.inputs){const c=e[l.name];if(c==null)throw new Q(`No value is provided for the model's input ${l.name}`);a.add(l,c)}const i=Pc(o,a);return s?i:i[0]}retrieveSymbolicTensors(e){const t=xi(null,e.length);let s=e.length;for(const r of this.layers){const o=Array.isArray(r.output)?r.output:[r.output],a=o.map(i=>i.name);for(let i=0;i<e.length;++i){const l=a.indexOf(e[i]);if(l!==-1&&(t[i]=o[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw t.forEach((o,a)=>{o==null&&r.push(e[a])}),new Q(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,s=!1){return re(()=>{const r=this.checkNumSamples(e);if(s)throw new Ke("Verbose predictLoop() is not implemented yet.");const o=Gx(r,t),a=this.outputs.map(i=>[]);for(let i=0;i<o.length;++i)re(()=>{const c=o[i][0],h=o[i][1],p=_c(e,c,h),f=[];if(Array.isArray(p))for(let y=0;y<p.length;++y)f.push({key:this.inputs[y],value:p[y]});else f.push({key:this.inputs[0],value:p});const g=new ea(f);return Pc(this.outputs,g)}).forEach((c,h)=>a[h].push(c));return Yn(a.map(i=>Wt(i,0)))})}predict(e,t={}){const s=OE(e);iI(s,this.inputNames,this.feedInputShapes,!1);try{const r=t.batchSize==null?32:t.batchSize;return jx(r),this.predictLoop(s,r)}finally{hr(s,e)}}predictOnBatch(e){iI(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,s=!0,r){if(this.optimizer_==null)throw new Ys("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const o=[];for(let a=0;a<this.feedOutputShapes.length;++a){const i=this.feedOutputShapes[a];this.feedLossFns[a]===sm?o.push(i.slice(0,i.length-1).concat([1])):o.push(i)}if(e=aI(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=aI(t,this.feedOutputNames,o,!1,"target"),AH(e,t),DH(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new Q(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,s,r,o=!0,a){const[i,l]=this.standardizeUserDataXY(e,t,o,a);if(s!=null)throw new Error("sample weight is not supported yet.");let c=null;if(r!=null){const h=AE(r,this.outputNames);c=[];for(let p=0;p<h.length;++p)c.push(await DE(l[p],null,h[p]))}return[i,l,c]}testLoop(e,t,s,r=0,o){return re(()=>{const a=this.checkNumSamples(t,s,o,"steps"),i=[];if(r>0)throw new Ke("Verbose mode is not implemented yet.");if(o!=null)throw new Ke("steps mode in testLoop() is not implemented yet");{const l=Gx(a,s),c=Dn(vr(0,a));for(let h=0;h<l.length;++h){const p=l[h][0],f=l[h][1],g=ai(c,p,f-p),y=Yb(t,g),w=e(y);if(h===0)for(let x=0;x<w.length;++x)i.push(Me(0));for(let x=0;x<w.length;++x){const v=w[x];i[x]=fe(i[x],G(f-p,v))}}for(let h=0;h<i.length;++h)i[h]=Fe(i[h],a)}return i})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let s=0;s<e.length;++s){const r=e[s];let o=r;if(GC(e,r)>1){const a=GC(e.slice(0,s),r);o+=`_${a}`}t.push(o)}return t}makeTrainFunction(){return e=>{const t=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),a=[],i=()=>{const p=[];for(let w=0;w<this.inputs.length;++w)p.push({key:this.inputs[w],value:s[w]});const f=new ea(p),g=Pc(this.outputs,f,{training:!0});let y;for(let w=0;w<this.lossFunctions.length;++w){const x=this.lossFunctions[w];let v=x(r[w],g[w]);o[w]!=null&&(v=SH(v,o[w]));const k=_t(v);t.push(k),w===0?y=v:y=fe(y,v)}for(let w=0;w<this.metricsTensors.length;++w){let x;if(this.outputs.length>1&&w<this.outputs.length)x=t[w];else{const v=this.metricsTensors[w][0],k=this.metricsTensors[w][1];x=_t(v(r[k],g[k]))}Jt(x),a.push(x)}return y=_t(y),this.calculateLosses().forEach(w=>{y=fe(y,w)}),y},l=this.collectedTrainableWeights.map(p=>p.read());return[this.optimizer_.minimize(i,!0,l)].concat(a)}}makeTestFunction(){this.testFunction=e=>re(()=>{const t=[];let s;const r=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=[];for(let c=0;c<this.inputs.length;++c)a.push({key:this.inputs[c],value:r[c]});const i=new ea(a),l=Pc(this.outputs,i);for(let c=0;c<this.lossFunctions.length;++c){const h=this.lossFunctions[c],p=_t(h(o[c],l[c]));c===0?s=p:s=fe(s,p),t.push(s)}for(let c=0;c<this.metricsTensors.length;++c){const h=this.metricsTensors[c][0],p=this.metricsTensors[c][1],f=_t(h(o[p],l[p]));t.push(f)}return t})}async fit(e,t,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,o,a,i,l,c,h,p,f;try{const g=s.batchSize==null?32:s.batchSize;jx(g);const w=await this.standardizeUserData(e,t,s.sampleWeight,s.classWeight,!1,g);r=w[0],o=w[1],f=w[2];let x=!1,v;if(s.validationData!=null&&s.validationData.length>0){if(x=!0,s.validationData.length===2)l=s.validationData[0],c=s.validationData[1];else throw s.validationData.length===3?new Ke("validationData including sample weights is not supported yet."):new Q(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const L=await this.standardizeUserData(l,c,null,null,!0,g);h=L[0],p=L[1],v=h.concat(p)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){x=!0;const F=Math.floor(r[0].shape[0]*(1-s.validationSplit)),L=r[0].shape[0];h=_c(r,F,L),a=r,r=_c(r,0,F),p=_c(o,F,L),i=o,o=_c(o,0,F),v=h.concat(p)}else s.validationSteps!=null&&(x=!0);const k=r.concat(o).concat(f);this.checkTrainableWeightsConsistency();const I=this.makeTrainFunction(),N=this.getDedupedMetricsNames();let T,D;x?(this.makeTestFunction(),T=this.testFunction,D=N.slice().concat(N.map(F=>"val_"+F))):(T=null,v=[],D=N.slice());const P=kE(s.callbacks,s.yieldEvery);return await this.fitLoop(I,k,N,g,s.epochs,s.verbose,P,T,v,s.shuffle,D,s.initialEpoch,null,null)}finally{this.isTraining=!1,hr(r,e),hr(o,t),hr(a,e),hr(i,t),hr(h,l),hr(p,c),f!=null&&Ye(f)}}async fitLoop(e,t,s,r,o,a,i,l,c,h,p,f,g,y){r==null&&(r=32),o==null&&(o=1),h==null&&(h=!0),f==null&&(f=0);let w=!1;if(l!=null&&c!=null&&(w=!0),y!=null&&(w=!0,g==null))throw new Q("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const x=this.checkNumSamples(t,r,g,"steps_per_epoch");let v;x!=null&&(v=vr(0,x)),a==null&&(a=1);const{callbackList:k,history:I}=SE(i,a,o,f,x,g,r,w,p);k.setModel(this),this.history=I,await k.onTrainBegin(),this.stopTraining_=!1;for(let N=f;N<o;++N){await k.onEpochBegin(N);const T={};if(g!=null)throw new Ke("stepsPerEpoch mode is not implemented yet.");{if(h==="batch")throw new Ke("batch shuffling is not implemneted yet");h&&cw(v);const D=Dn(v),P=Gx(x,r);for(let z=0;z<P.length;++z){const F={};if(await k.onBatchBegin(z,F),re(()=>{const L=P[z][0],E=P[z][1],j=ai(D,L,E-L);F.batch=z,F.size=E-L;const Z=Yb(t,j),ne=e(Z);for(let te=0;te<s.length;++te){const se=s[te],K=ne[te];F[se]=K,Jt(K)}if(z===P.length-1&&w){const te=this.testLoop(l,c,r);for(let se=0;se<s.length;++se){const K=s[se],B=te[se];Jt(B),T["val_"+K]=B}}}),await k.onBatchEnd(z,F),vE(F),this.stopTraining_)break}D.dispose()}if(await k.onEpochEnd(N,T),this.stopTraining_)break}return await k.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return IH(this,e,t)}async trainOnBatch(e,t){const s=await this.standardizeUserData(e,t),r=s[0],o=s[1],i=this.makeTrainFunction()(r.concat(o)),l=[];for(const c of i){const h=await c.data();l.push(h[0])}return Ye(i),hr(s[0],e),hr(s[1],t),Yn(l)}getNamedWeights(e){const t=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,o=this.getWeights(s);for(let a=0;a<r.length;++a)s&&!r[a].trainable||t.push({name:r[a].originalName,tensor:o[a]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=xb().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-xb().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=uo(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>uo(t))}else{const t=Object.keys(this.loss);e={};const s=this.loss;for(const r of t)if(typeof s[r]=="string")e[r]=uo(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[uo(gf(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>uo(gf(e)));{const e={};for(const t in this.metrics)e[t]=uo(gf(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=Kb(e.optimizer_config),s=po(t);let r;if(typeof e.loss=="string")r=Qa(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(a=>Qa(a));else if(e.loss!=null){r={};for(const a in e.loss)r[a]=Qa(e.loss[a])}let o;if(Array.isArray(e.metrics))o=e.metrics.map(a=>Qa(a));else if(e.metrics!=null){o={};for(const a in e.metrics)o[a]=Qa(e.metrics[a])}this.compile({loss:r,metrics:o,optimizer:s})}async save(e,t){if(typeof e=="string"){const c=H2(e);if(c.length===0)throw new Q(`Cannot find any save handlers for URL '${e}'`);if(c.length>1)throw new Q(`Found more than one (${c.length}) save handlers for URL '${e}'`);e=c[0]}if(e.save==null)throw new Q("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await bb(this.getNamedWeights(t)),i={modelTopology:this.toJSON(null,!1),format:OH,generatedBy:`TensorFlow.js tfjs-layers v${RE}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){i.trainingConfig=this.getTrainingConfig();const c="optimizer",{data:h,specs:p}=await bb(await this.optimizer.getWeights(),c);s.specs.push(...p),s.data=U2([s.data,h])}return this.userDefinedMetadata!=null&&(nI(this.userDefinedMetadata,this.name,!0),i.userDefinedMetadata=this.userDefinedMetadata),i.weightData=s.data,i.weightSpecs=s.specs,e.save(i)}setUserDefinedMetadata(e){nI(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}xl.className="Model";me(xl);class FE extends xl{}FE.className="Functional";me(FE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ad extends xl{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:gy("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new Q(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof ad||e instanceof xl;let s;if(t){if(s=e,s.outputs.length!==1)throw new Q("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new Q("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new Q("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=L5({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(t)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new Q(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new Q("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=gE(this.outputs[0])}this.inboundNodes=[],new xy({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:xi(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(ot(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new xl({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,s=console.log){this.built||this.build(),super.summary(e,t,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,s={}){if(!this.built)throw new Ys("The model needs to be compiled before being used.");return this.model.evaluate(e,t,s)}async evaluateDataset(e,t){if(!this.built)throw new Ys("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,s={}){if(!this.built)throw new Ys("The model needs to be compiled before being used.");return this.model.fit(e,t,s)}async fitDataset(e,t){if(!this.built)throw new Ys("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,s={},r=!1){let o,a={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new Q("Legacy serialization format not supported yet.");o=t}else A(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),o=t.layers,delete t.layers,a=t;const i=new e(a);if(!(i instanceof ad))throw new Ke(`Sequential.fromConfig called on non-Sequential input: ${i}`);for(const l of o){const h=po(l,void 0,r);r&&h.setFastWeightInitDuringBuild(!0),i.add(h)}return i}set stopTraining(e){if(this.model==null)throw new Q("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new Q("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const s={};s.className=t.getClassName(),s.config=t.getConfig(),e.push(s)}return{name:this.name,layers:e}}}ad.className="Sequential";me(ad);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let _n=class extends Ai{getConfig(){return{}}};class LE extends _n{apply(e,t=1){return w5(e,t)}}LE.className="elu";me(LE);class PE extends _n{apply(e){return Gg(e)}}PE.className="selu";me(PE);class zE extends _n{apply(e){return Cr(e)}}zE.className="relu";me(zE);class ME extends _n{apply(e){return re(()=>ha(6,Cr(e)))}}ME.className="relu6";me(ME);class BE extends _n{apply(e){return e}}BE.className="linear";me(BE);class VE extends _n{apply(e){return xr(e)}}VE.className="sigmoid";me(VE);class WE extends _n{apply(e){return k5(e)}}WE.className="hardSigmoid";me(WE);class UE extends _n{apply(e){return Ei(e)}}UE.className="softplus";me(UE);class jE extends _n{apply(e){return v5(e)}}jE.className="softsign";me(jE);class GE extends _n{apply(e){return da(e)}}GE.className="tanh";me(GE);let Iv=class extends _n{apply(e,t=-1){return Pu(e,t)}};Iv.className="softmax";me(Iv);class HE extends _n{apply(e,t=-1){return Pg(e,t)}}HE.className="logSoftmax";me(HE);class qE extends _n{apply(e){return re(()=>re(()=>{const t=Math.sqrt(2),s=G(.5,fe(1,Og(Fe(e,t))));return G(e,s)}))}}qE.className="gelu";me(qE);class KE extends _n{apply(e){return re(()=>G(.5,G(e,fe(1,da(G(pn(Fe(2,Math.PI)),fe(e,G(.044715,Gr(e,3)))))))))}}KE.className="gelu_new";me(KE);class XE extends _n{apply(e){return re(()=>G(e,da(Ei(e))))}}XE.className="mish";me(XE);class YE extends _n{apply(e,t=1){return re(()=>G(xr(G(e,t)),e))}}YE.className="swish";me(YE);function fa(n){return n.getClassName()}function Hx(n,e={}){return Bh(n,Es.getMap().classNameMap,e,"activation")}function ma(n){if(n==null){const e={};return e.className="linear",e.config={},Hx(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},Hx(e)}else return n instanceof _n?n:Hx(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function FH(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class QE extends Ai{}class ZE extends QE{constructor(e){super(),FH(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return re(()=>{let t=Vt([1]);return this.hasL1&&(t=fe(t,Ae(G(this.l1,Xt(e))))),this.hasL2&&(t=fe(t,Ae(G(this.l2,Wh(e))))),q(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}ZE.className="L1L2";me(ZE);const lI={l1l2:"L1L2"};function wt(n){return hv(n)}function uI(n,e={}){return Bh(n,Es.getMap().classNameMap,e,"regularizer")}function Et(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in lI?lI[n]:n,config:{}};return uI(t)}else return n instanceof QE?n:uI(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class JE extends Ze{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=Ue(e);let s=Cr(e);return this.maxValue!=null&&(s=ts(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}JE.className="ReLU";me(JE);class eR extends Ze{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=Ue(e);return Ch(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}eR.className="LeakyReLU";me(eR);class tR extends Ze{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Tt(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Et(e.alphaRegularizer),this.alphaConstraint=rn(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new Q(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=ot(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new tn({ndim:e.length,axes:s})],this.built=!0}call(e,t){return e=Ue(e),Dh(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Ot(this.alphaInitializer),alphaRegularizer:wt(this.alphaRegularizer),alphaConstraint:sn(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}tR.className="PReLU";me(tR);let nR=class extends Ze{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Ke(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=Ue(e);return _u(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};nR.className="ELU";me(nR);class sR extends Ze{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const s=Ue(e);return G(s,ke(os(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}sR.className="ThresholdedReLU";me(sR);class rR extends Ze{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new Iv().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return re(()=>{let s=Ue(e);const r=t.mask;if(r!=null){const o=G(Te(Qn(s.shape),ke(r,s.dtype)),Me(-1e9));s=fe(s,o)}return this.axis instanceof Array?this.axis.length>1?ns(Te(s,$h(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}rR.className="Softmax";me(rR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function bl(n,e,t){if(typeof n=="number")return xi(n,e);if(n.length!==e)throw new Q(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let s=0;s<e;++s){const r=n[s];if(!g5(r))throw new Q(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function br(n,e,t,s,r=1){if(n==null)return n;const o=e+(e-1)*(r-1);let a;return t==="same"?a=n:a=n-o+1,Math.floor((a+s-1)/s)}function Fr(n,e,t,s){if(n==null)return null;if(s==="valid")n=n*e+pa([t-e,0]);else if(s==="same")n=n*e;else throw new Q(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function $v(n,e){return re(()=>(Gt(e),e==="channelsFirst"?nt(n,[0,2,3,1]):n))}function oR(n,e){return re(()=>(Gt(e),e==="channelsFirst"?nt(n,[0,2,3,4,1]):n))}function LH(n,e,t,s=1,r="valid",o,a=1){return re(()=>{if(o==null&&(o=kr()),Gt(o),n.shape.length!==3)throw new Q(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new Q(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new Q(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(o==="channelsFirst"&&(n=nt(n,[0,2,1])),r==="causal")throw new Ke("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let i=Rg(n,e,s,r==="same"?"same":"valid","NWC",a);return t!=null&&(i=Ir(i,t)),i})}function cI(n,e,t,s=[1,1],r="valid",o,a,i=null){return re(()=>{if(o==null&&(o=kr()),Gt(o),n.rank!==3&&n.rank!==4)throw new Q(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new Q(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=$v(n,o);if(r==="causal")throw new Ke("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=H$({x:l,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:a,dataFormat:"NHWC",bias:t,activation:i}),o==="channelsFirst"&&(l=nt(l,[0,3,1,2])),l})}function PH(n,e,t,s=[1,1,1],r="valid",o,a){return re(()=>{if(o==null&&(o=kr()),Gt(o),n.rank!==4&&n.rank!==5)throw new Q(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new Q(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let i=oR(n,o);if(r==="causal")throw new Ke("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return i=Hw(i,e,s,r==="same"?"same":"valid","NDHWC",a),t!=null&&(i=Ir(i,t)),o==="channelsFirst"&&(i=nt(i,[0,4,1,2,3])),i})}class vy extends Ze{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",vy.verifyArgs(t),this.rank=e,dn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Ke(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=bl(t.kernelSize,e,"kernelSize"),this.strides=bl(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,Ls(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Gt(this.dataFormat),this.activation=ma(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=Tt(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=rn(t.biasConstraint),this.biasRegularizer=Et(t.biasRegularizer),this.activityRegularizer=Et(t.activityRegularizer),this.dilationRate=bl(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new Q(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new Q(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new Q(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(Or("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!pv(e.kernelSize,"number",1,3))throw new Q(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:fa(this.activation),useBias:this.useBias,biasInitializer:Ot(this.biasInitializer),biasRegularizer:wt(this.biasRegularizer),activityRegularizer:wt(this.activityRegularizer),biasConstraint:sn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class Mu extends vy{constructor(e,t){super(e,t),this.kernel=null,Mu.verifyArgs(t),this.filters=t.filters,dn(this.filters,"filters"),this.kernelInitializer=Tt(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=rn(t.kernelConstraint),this.kernelRegularizer=Et(t.kernelRegularizer)}build(e){e=ot(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new Q(`The channel dimension of the input should be defined. Found ${e[t]}`);const s=e[t],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:s}}],this.built=!0}call(e,t){return re(()=>{e=Ue(e);let s;const r=this.bias==null?null:this.bias.read(),o=tE(this.activation.getClassName());if(o!=null&&this.rank===2)s=cI(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,o);else{if(this.rank===1)s=LH(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=cI(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=PH(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Ke("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=ot(e);const t=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let o=0;o<s.length;++o){const a=br(s[o],this.kernelSize[o],this.padding,this.strides[o],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[o]);t.push(a)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:Ot(this.kernelInitializer),kernelRegularizer:wt(this.kernelRegularizer),kernelConstraint:sn(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new Q(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Hh extends Mu{constructor(e){super(2,e),Hh.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!pv(e.kernelSize,"number",1,2))throw new Q(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Hh.className="Conv2D";me(Hh);class qh extends Mu{constructor(e){super(3,e),qh.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new Q(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}qh.className="Conv3D";me(qh);class aR extends Hh{constructor(e){if(super(e),this.inputSpec=[new tn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new Q(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=ot(e),e.length!==4)throw new Q("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new Q("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new tn({ndim:4,axes:{[t]:s}})],this.built=!0}call(e,t){return re(()=>{let s=Ue(e);if(s.shape.length!==4)throw new Q(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let a,i;this.dataFormat==="channelsFirst"?(a=2,i=3):(a=1,i=2);const l=r[a],c=r[i],h=this.kernelSize[0],p=this.kernelSize[1],f=this.strides[0],g=this.strides[1],y=Fr(l,f,h,this.padding),w=Fr(c,g,p,this.padding),x=[o,y,w,this.filters];this.dataFormat!=="channelsLast"&&(s=nt(s,[0,2,3,1]));let v=Ag(s,this.kernel.read(),x,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(v=nt(v,[0,3,1,2])),this.bias!=null&&(v=Ir(v,this.bias.read(),this.dataFormat)),this.activation!=null&&(v=this.activation.apply(v)),v})}computeOutputShape(e){e=ot(e);const t=e.slice();let s,r,o;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3):(s=3,r=1,o=2);const a=this.kernelSize[0],i=this.kernelSize[1],l=this.strides[0],c=this.strides[1];return t[s]=this.filters,t[r]=Fr(t[r],l,a,this.padding),t[o]=Fr(t[o],c,i,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}aR.className="Conv2DTranspose";me(aR);class iR extends qh{constructor(e){if(super(e),this.inputSpec=[new tn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new Q(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=ot(e),e.length!==5)throw new Q("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new Q("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new tn({ndim:5,axes:{[t]:s}})],this.built=!0}call(e,t){return re(()=>{let s=Ue(e);if(s.shape.length!==5)throw new Q(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let a,i,l;this.dataFormat==="channelsFirst"?(l=2,a=3,i=4):(l=1,a=2,i=3);const c=r[l],h=r[a],p=r[i],f=this.kernelSize[0],g=this.kernelSize[1],y=this.kernelSize[2],w=this.strides[0],x=this.strides[1],v=this.strides[2],k=Fr(c,w,f,this.padding),I=Fr(h,x,g,this.padding),N=Fr(p,v,y,this.padding),T=[o,k,I,N,this.filters];this.dataFormat!=="channelsLast"&&(s=nt(s,[0,2,3,4,1]));let D=qw(s,this.kernel.read(),T,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(D=nt(D,[0,4,1,2,3])),this.bias!==null&&(D=Ir(D,this.bias.read(),this.dataFormat)),this.activation!==null&&(D=this.activation.apply(D)),D})}computeOutputShape(e){e=ot(e);const t=e.slice();let s,r,o,a;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3,a=4):(s=4,r=1,o=2,a=3);const i=this.kernelSize[0],l=this.kernelSize[1],c=this.kernelSize[2],h=this.strides[0],p=this.strides[1],f=this.strides[2];return t[s]=this.filters,t[r]=Fr(t[r],h,i,this.padding),t[o]=Fr(t[o],p,l,this.padding),t[a]=Fr(t[a],f,c,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}iR.className="Conv3DTranspose";me(iR);class lR extends Mu{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new Q("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new Q("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new Q(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=Tt(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Et(t.depthwiseRegularizer),this.depthwiseConstraint=rn(t.depthwiseConstraint),this.pointwiseInitializer=Tt(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Et(t.pointwiseRegularizer),this.pointwiseConstraint=rn(t.pointwiseConstraint)}build(e){if(e=ot(e),e.length<this.rank+2)throw new Q(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new Q(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const s=e[t],r=this.kernelSize.concat([s,this.depthMultiplier]),o=[];for(let i=0;i<this.rank;++i)o.push(1);o.push(s*this.depthMultiplier,this.filters);const a=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,a,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,a,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,a,this.biasConstraint):this.bias=null,this.inputSpec=[new tn({ndim:this.rank+2,axes:{[t]:s}})],this.built=!0}call(e,t){return re(()=>{e=Ue(e);let s;if(this.rank===1)throw new Ke("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=nt(e,[0,2,3,1])),s=Hg(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=Ir(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=nt(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Ot(this.depthwiseInitializer),e.pointwiseInitializer=Ot(this.pointwiseInitializer),e.depthwiseRegularizer=wt(this.depthwiseRegularizer),e.pointwiseRegularizer=wt(this.pointwiseRegularizer),e.depthwiseConstraint=sn(this.depthwiseConstraint),e.pointwiseConstraint=sn(this.pointwiseConstraint),e}}lR.className="SeparableConv";class uR extends lR{constructor(e){super(2,e)}}uR.className="SeparableConv2D";me(uR);class ky extends Mu{constructor(e){super(1,e),ky.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!pv(e.kernelSize,"number",1,1))throw new Q(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}ky.className="Conv1D";me(ky);class cR extends Ze{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return re(()=>{if(e=Ue(e),this.dataFormat==="channelsLast"){const s=mf(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return mf(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=mf(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return mf(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}cR.className="Cropping2D";me(cR);class dR extends Ze{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Gt(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,p5(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,s]}else{const t=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],t,s,e[3]]}}call(e,t){return re(()=>{let s=Ue(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=nt(s,[0,2,3,1]);const o=this.size[0]*r[2],a=this.size[1]*r[3],i=this.interpolation==="nearest"?Xs.resizeNearestNeighbor(s,[o,a]):Xs.resizeBilinear(s,[o,a]);return nt(i,[0,3,1,2])}else{const o=this.size[0]*r[1],a=this.size[1]*r[2];return this.interpolation==="nearest"?Xs.resizeNearestNeighbor(s,[o,a]):Xs.resizeBilinear(s,[o,a])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}dR.className="UpSampling2D";me(dR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function zH(n,e,t=[1,1],s="valid",r,o){return re(()=>{r==null&&(r=kr()),Gt(r);let a=$v(n,r);if(n.rank!==4)throw new Q(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new Q(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return a=Du(a,e,t,s==="same"?"same":"valid","NHWC",o),r==="channelsFirst"&&(a=nt(a,[0,3,1,2])),a})}class hR extends vy{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Tt(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=rn(e.depthwiseConstraint),this.depthwiseRegularizer=Et(e.depthwiseRegularizer)}build(e){if(e=ot(e),e.length<4)throw new Q(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new Q(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const s=e[t],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return re(()=>{e=Ue(e);let s=zH(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=Ir(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=ot(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,o=br(t,this.kernelSize[0],this.padding,this.strides[0]),a=br(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,o,a]:[e[0],o,a,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Ot(this.depthwiseInitializer),e.depthwiseRegularizer=wt(this.depthwiseRegularizer),e.depthwiseConstraint=sn(this.depthwiseRegularizer),e}}hR.className="DepthwiseConv2D";me(hR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function pR(n,e,t,s){if(Array.isArray(n)){if(e!=null||t!=null)throw new Q("When inputs is an array, neither initialState or constants should be provided");s!=null&&(t=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function r(o){return o==null||Array.isArray(o)?o:[o]}return e=r(e),t=r(t),{inputs:n,initialState:e,constants:t}}function fR(n,e,t,s=!1,r,o,a=!1,i=!1){return re(()=>{const l=e.shape.length;if(l<3)throw new Q(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(vr(2,l));e=nt(e,c),a&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=ke(ke(r,"bool"),"float32"),r.rank===l-1&&(r=An(r,-1)),r=nt(r,c)),s&&(e=Os(e,0),r!=null&&(r=Os(r,0)));const h=[];let p,f=t;const g=e.shape[0],y=Fs(e);let w;r!=null&&(w=Fs(r));for(let v=0;v<g;++v){const k=y[v],I=re(()=>n(k,f));if(r==null)p=I[0],f=I[1];else{const N=re(()=>{const T=w[v],D=Te(xs(T),T),P=fe(G(I[0],T),G(f[0],D)),z=f.map((F,L)=>fe(G(I[1][L],T),G(F,D)));return{output:P,newStates:z}});p=N.output,f=N.newStates}i&&h.push(p)}let x;return i&&(x=ss(h,1)),[p,x,f]})}class Ca extends Ze{constructor(e){super(e);let t;if(e.cell==null)throw new Q("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new Rv({cells:e.cell}):t=e.cell,t.stateSize==null)throw new Q("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new tn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return vr(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){Gb(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const s=t[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const o=[];for(const a of t)o.push([e[0],a]);return[r].concat(o)}else return r}computeMask(e,t){return re(()=>{Array.isArray(t)&&(t=t[0]);const s=this.returnSequences?t:null;if(this.returnState){const r=this.states.map(o=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let s=0;s<e;++s)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Ke("Constants support is not implemented in RNN yet.");Gb(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new tn({shape:[t,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!Je(this.stateSpec.map(a=>a.shape[a.shape.length-1]),o))throw new Q(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=o.map(a=>new tn({shape:[null,a]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){re(()=>{if(!this.stateful)throw new _r("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new Q("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Vt([s,r])):this.states_=[Vt([s,this.cell.stateSize])];else if(e==null)Ye(this.states_),this.keptStates!=null&&(Ye(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Vt([s,r])):this.states_[0]=Vt([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new Q(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):Ye(this.states_);for(let r=0;r<this.states_.length;++r){const o=e[r],a=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,i=[s,a];if(!Je(o.shape,i))throw new Q(`State ${r} is incompatible with layer ${this.name}: expected shape=${i}, received shape=${o.shape}`);this.states_[r]=o}}this.states_=this.states_.map(r=>Jt(r.clone()))})}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const o=pR(e,s,r,this.numConstants);e=o.inputs,s=o.initialState,r=o.constants;let a=[],i=[];if(s!=null){t.initialState=s,a=a.concat(s),this.stateSpec=[];for(const c of s)this.stateSpec.push(new tn({shape:c.shape}));i=i.concat(this.stateSpec)}if(r!=null&&(t.constants=r,a=a.concat(r),this.numConstants=r.length),a[0]instanceof qr){const c=[e].concat(a),h=this.inputSpec.concat(i),p=this.inputSpec;this.inputSpec=h;const f=super.apply(c,t);return this.inputSpec=p,f}else return super.apply(e,t)}call(e,t){return re(()=>{const s=t==null?null:t.mask,r=t==null?null:t.training;let o=t==null?null:t.initialState;e=Ue(e),o==null&&(this.stateful?o=this.states_:o=this.getInitialState(e));const a=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==a)throw new Q(`RNN Layer has ${a} state(s) but was passed ${o.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const i={training:r},c=fR((y,w)=>{const x=this.cell.call([y].concat(w),i);return[x[0],x.slice(1)]},e,o,this.goBackwards,s,null,this.unroll,this.returnSequences),h=c[0],p=c[1],f=c[2];this.stateful&&this.resetStates(f,r);const g=this.returnSequences?p:h;return this.returnState?[g].concat(f):g})}getInitialState(e){return re(()=>{let t=Vt(e.shape);return t=Ae(t,[1,2]),t=Vh(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?Ub(t,[1,s]):t):this.cell.stateSize>1?[Ub(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===Ca.className&&(t.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),t)}static fromConfig(e,t,s={}){const r=t.cell,o=po(r,s);return new e(Object.assign(t,{cell:o}))}}Ca.className="RNN";me(Ca);class Sy extends Ze{}class Tv extends Sy{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,dn(this.units,"units"),this.activation=ma(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Tt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Tt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Tt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Et(e.kernelRegularizer),this.recurrentRegularizer=Et(e.recurrentRegularizer),this.biasRegularizer=Et(e.biasRegularizer),this.kernelConstraint=rn(e.kernelConstraint),this.recurrentConstraint=rn(e.recurrentConstraint),this.biasConstraint=rn(e.biasConstraint),this.dropout=Tl([1,pa([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Tl([1,pa([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=ot(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return re(()=>{if(e=e,e.length!==2)throw new Q(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ga({ones:()=>xs(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ga({ones:()=>xs(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let o;const a=this.dropoutMask,i=this.recurrentDropoutMask;a!=null?o=Wr(G(e,a),this.kernel.read()):o=Wr(e,this.kernel.read()),this.bias!=null&&(o=Ir(o,this.bias.read())),i!=null&&(s=G(s,i));let l=fe(o,Wr(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:fa(this.activation),useBias:this.useBias,kernelInitializer:Ot(this.kernelInitializer),recurrentInitializer:Ot(this.recurrentInitializer),biasInitializer:Ot(this.biasInitializer),kernelRegularizer:wt(this.kernelRegularizer),recurrentRegularizer:wt(this.recurrentRegularizer),biasRegularizer:wt(this.biasRegularizer),activityRegularizer:wt(this.activityRegularizer),kernelConstraint:sn(this.kernelConstraint),recurrentConstraint:sn(this.recurrentConstraint),biasConstraint:sn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}Tv.className="SimpleRNNCell";me(Tv);class mR extends Ca{constructor(e){e.cell=new Tv(e),super(e)}call(e,t){return re(()=>{this.cell.dropoutMask!=null&&(Ye(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ye(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return new e(t)}}mR.className="SimpleRNN";me(mR);class Ev extends Sy{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new Q("GRUCell does not support reset_after parameter set to true.");this.units=e.units,dn(this.units,"units"),this.activation=ma(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ma(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Tt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Tt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Tt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Et(e.kernelRegularizer),this.recurrentRegularizer=Et(e.recurrentRegularizer),this.biasRegularizer=Et(e.biasRegularizer),this.kernelConstraint=rn(e.kernelConstraint),this.recurrentConstraint=rn(e.recurrentConstraint),this.biasConstraint=rn(e.biasConstraint),this.dropout=Tl([1,pa([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Tl([1,pa([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=ot(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return re(()=>{if(e=e,e.length!==2)throw new Q(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training==null?!1:t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ga({ones:()=>xs(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ga({ones:()=>xs(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let i,l,c;0<this.dropout&&this.dropout<1&&(e=G(e,o[0]));let h=Wr(e,this.kernel.read());this.useBias&&(h=Ir(h,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=G(r,a[0]));const p=this.recurrentKernel.read(),[f,g]=Zn(p,[2*this.units,this.units],p.rank-1),y=Wr(r,f),[w,x,v]=Zn(h,3,h.rank-1),[k,I]=Zn(y,2,y.rank-1);i=this.recurrentActivation.apply(fe(w,k)),l=this.recurrentActivation.apply(fe(x,I));const N=Wr(G(l,r),g);c=this.activation.apply(fe(v,N));const T=fe(G(i,r),G(fe(1,St(i)),c));return[T,T]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:fa(this.activation),recurrentActivation:fa(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Ot(this.kernelInitializer),recurrentInitializer:Ot(this.recurrentInitializer),biasInitializer:Ot(this.biasInitializer),kernelRegularizer:wt(this.kernelRegularizer),recurrentRegularizer:wt(this.recurrentRegularizer),biasRegularizer:wt(this.biasRegularizer),activityRegularizer:wt(this.activityRegularizer),kernelConstraint:sn(this.kernelConstraint),recurrentConstraint:sn(this.recurrentConstraint),biasConstraint:sn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}Ev.className="GRUCell";me(Ev);class gR extends Ca{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Ev(e),super(e)}call(e,t){return re(()=>{this.cell.dropoutMask!=null&&(Ye(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ye(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}gR.className="GRU";me(gR);class Ny extends Sy{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,dn(this.units,"units"),this.activation=ma(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ma(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Tt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Tt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Tt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Et(e.kernelRegularizer),this.recurrentRegularizer=Et(e.recurrentRegularizer),this.biasRegularizer=Et(e.biasRegularizer),this.kernelConstraint=rn(e.kernelConstraint),this.recurrentConstraint=rn(e.recurrentConstraint),this.biasConstraint=rn(e.biasConstraint),this.dropout=Tl([1,pa([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Tl([1,pa([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=ot(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const o=this.biasInitializer,a=this.units;r=new(t=class extends tr{apply(l,c){const h=o.apply([a]),p=new mv().apply([a]),f=o.apply([a*2]);return qC(qC(h,p),f)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return re(()=>{const s=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new Q(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const o=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ga({ones:()=>xs(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ga({ones:()=>xs(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const a=this.dropoutMask,i=this.recurrentDropoutMask;let l,c,h,p;0<this.dropout&&this.dropout<1&&(e=G(e,a[0]));let f=Wr(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=G(r,i[0])),f=fe(f,Wr(r,this.recurrentKernel.read())),this.useBias&&(f=Ir(f,this.bias.read()));const[g,y,w,x]=Zn(f,4,f.rank-1);l=this.recurrentActivation.apply(g),c=this.recurrentActivation.apply(y),h=fe(G(c,o),G(l,this.activation.apply(w))),p=this.recurrentActivation.apply(x);const v=G(p,this.activation.apply(h));return[v,v,h]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:fa(this.activation),recurrentActivation:fa(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Ot(this.kernelInitializer),recurrentInitializer:Ot(this.recurrentInitializer),biasInitializer:Ot(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:wt(this.kernelRegularizer),recurrentRegularizer:wt(this.recurrentRegularizer),biasRegularizer:wt(this.biasRegularizer),activityRegularizer:wt(this.activityRegularizer),kernelConstraint:sn(this.kernelConstraint),recurrentConstraint:sn(this.recurrentConstraint),biasConstraint:sn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}Ny.className="LSTMCell";me(Ny);class yR extends Ca{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Ny(e),super(e)}call(e,t){return re(()=>{this.cell.dropoutMask!=null&&(Ye(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ye(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}yR.className="LSTM";me(yR);class Rv extends Sy{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return re(()=>{e=e;let s=e.slice(1);const r=[];for(const i of this.cells.slice().reverse())Array.isArray(i.stateSize)?r.push(s.splice(0,i.stateSize.length)):r.push(s.splice(0,1));r.reverse();const o=[];let a;for(let i=0;i<this.cells.length;++i){const l=this.cells[i];s=r[i],i===0?a=[e[0]].concat(s):a=[a[0]].concat(s),a=l.call(a,t),o.push(a.slice(1))}s=[];for(const i of o.slice().reverse())s.push(...i);return[a[0]].concat(s)})}build(e){Gb(e)&&(e=e[0]),e=e;let t;this.cells.forEach((s,r)=>{oi(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?t=s.stateSize[0]:t=s.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=o=>({className:o.getClassName(),config:o.getConfig()}),r={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,t,s={}){const r=[];for(const o of t.cells)r.push(po(o,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.cells)t.push(...s.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return Hb(e)}setWeights(e){const t=[];for(const s of this.cells){const r=s.weights.length,o=e.splice(r);for(let a=0;a<s.weights.length;++a)t.push([s.weights[a],o[a]])}kv(t)}}Rv.className="StackedRNNCells";me(Rv);function ga(n){const{ones:e,rate:t,training:s=!1,count:r=1,dropoutFunc:o}=n,a=()=>o!=null?o(e(),t):lE(e(),t),i=()=>Uh(a,e,s);return!r||r<=1?Jt(i().clone()):Array(r).fill(void 0).map(i).map(c=>Jt(c.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var MH=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class xR extends Ca{constructor(e){if(e.unroll)throw new Ke("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Ke("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new tn({ndim:5})]}call(e,t){return re(()=>{if(this.cell.dropoutMask!=null&&(Ye(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ye(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new Q("ConvRNN2D cell does not support constants");const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return re(()=>{const{stateSize:t}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)],a=Vt(o);return Array.isArray(t)?Array(t.length).fill(a):[a]})}resetStates(e,t=!1){re(()=>{if(!this.stateful)throw new _r("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)];if(s[0]==null)throw new Q("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Vt(o)):this.states_=[Vt(o)];else if(e==null)Ye(this.states_),this.keptStates!=null&&(Ye(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Vt(o)):this.states_[0]=Vt(o);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new Q(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):Ye(this.states_);for(let i=0;i<this.states_.length;++i){const l=e[i],c=o;if(!Je(l.shape,c))throw new Q(`State ${i} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${l.shape}`);this.states_[i]=l}}this.states_=this.states_.map(i=>Jt(i.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:s,kernelSize:r,padding:o,strides:a,dilationRate:i}=this.cell,l=t==="channelsFirst",c=e[l?3:2],h=e[l?4:3],p=br(c,r[0],o,a[0],i[0]),f=br(h,r[1],o,a[1],i[1]);return[...e.slice(0,2),...l?[s,p,f]:[p,f,s]]}}xR.className="ConvRNN2D";class Av extends Ny{constructor(e){const{filters:t,kernelSize:s,strides:r,padding:o,dataFormat:a,dilationRate:i}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,dn(this.filters,"filters"),this.kernelSize=bl(s,2,"kernelSize"),this.kernelSize.forEach(l=>dn(l,"kernelSize")),this.strides=bl(r||1,2,"strides"),this.strides.forEach(l=>dn(l,"strides")),this.padding=o||"valid",Ls(this.padding),this.dataFormat=a||"channelsLast",Gt(this.dataFormat),this.dilationRate=bl(i||1,2,"dilationRate"),this.dilationRate.forEach(l=>dn(l,"dilationRate"))}build(e){var t;e=ot(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new Q(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],o=4,a=this.kernelSize.concat([r,this.filters*o]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const i=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const c=this.biasInitializer,h=this.filters;l=new(t=class extends tr{apply(f,g){const y=c.apply([h]),w=Qn([h]),x=c.apply([h*2]);return fv([y,w,x])}},t.className="CustomInit",t)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return re(()=>{if(e.length!==3)throw new Q(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training||!1,r=e[0],o=e[1],a=e[2],i=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ga({ones:()=>xs(r),rate:this.dropout,training:s,count:i,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,c=(X,M,H)=>!M||!M[H]?X:G(M[H],X);let h=c(r,l,0),p=c(r,l,1),f=c(r,l,2),g=c(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ga({ones:()=>xs(o),rate:this.recurrentDropout,training:s,count:i,dropoutFunc:this.dropoutFunc}));const y=this.recurrentDropoutMask;let w=c(o,y,0),x=c(o,y,1),v=c(o,y,2),k=c(o,y,3);const I=3,[N,T,D,P]=Zn(this.kernel.read(),i,I),[z,F,L,E]=this.useBias?Zn(this.bias.read(),i):[null,null,null,null];h=this.inputConv(h,N,z,this.padding),p=this.inputConv(p,T,F,this.padding),f=this.inputConv(f,D,L,this.padding),g=this.inputConv(g,P,E,this.padding);const[j,Z,ne,te]=Zn(this.recurrentKernel.read(),i,I);w=this.recurrentConv(w,j),x=this.recurrentConv(x,Z),v=this.recurrentConv(v,ne),k=this.recurrentConv(k,te);const se=this.recurrentActivation.apply(fe(h,w)),K=this.recurrentActivation.apply(fe(p,x)),B=fe(G(K,a),G(se,this.activation.apply(fe(f,v)))),J=G(this.recurrentActivation.apply(fe(g,k)),this.activation.apply(B));return[J,J,B]})}getConfig(){const e=super.getConfig(),{units:t}=e,s=MH(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),r)}inputConv(e,t,s,r){const o=go(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?Ir(o,s,this.dataFormat):o}recurrentConv(e,t){return go(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Av.className="ConvLSTM2DCell";me(Av);class bR extends xR{constructor(e){const t=new Av(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}bR.className="ConvLSTM2D";me(bR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Dv extends Ze{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return s}call(e,t){return re(()=>{this.invokeCallHook(e,t);const s=Ue(e);if(0<this.rate&&this.rate<1){const r=t.training==null?!1:t.training,o=this.getNoiseShape(s);return Uh(()=>lE(s,this.rate,o,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}Dv.className="Dropout";me(Dv);class wR extends Dv{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}wR.className="SpatialDropout1D";me(wR);class vR extends Ze{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,dn(this.units,"units"),this.activation=ma(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Tt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Tt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=rn(e.kernelConstraint),this.biasConstraint=rn(e.biasConstraint),this.kernelRegularizer=Et(e.kernelRegularizer),this.biasRegularizer=Et(e.biasRegularizer),this.activityRegularizer=Et(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=ot(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=ot(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return re(()=>{this.invokeCallHook(e,t);const s=Ue(e),r=tE(this.activation.getClassName());let o;return r!=null?o=Wr(s,this.kernel.read(),r,this.bias?this.bias.read():null):(o=Wr(s,this.kernel.read()),this.bias!=null&&(o=Ir(o,this.bias.read())),this.activation!=null&&(o=this.activation.apply(o))),o})}getConfig(){const e={units:this.units,activation:fa(this.activation),useBias:this.useBias,kernelInitializer:Ot(this.kernelInitializer),biasInitializer:Ot(this.biasInitializer),kernelRegularizer:wt(this.kernelRegularizer),biasRegularizer:wt(this.biasRegularizer),activityRegularizer:wt(this.activityRegularizer),kernelConstraint:sn(this.kernelConstraint),biasConstraint:sn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}vR.className="Dense";me(vR);class kR extends Ze{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=ot(e);for(const t of e.slice(1))if(t==null)throw new Q(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],oa(e,1)]}call(e,t){return re(()=>{this.invokeCallHook(e,t);let s=Ue(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let o=2;o<s.rank;++o)r.push(o);r.push(1),s=nt(s,r)}return b5(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}kR.className="Flatten";me(kR);class SR extends Ze{constructor(e){super(e),this.supportsMasking=!0,this.activation=ma(e.activation)}call(e,t){return re(()=>{this.invokeCallHook(e,t);const s=Ue(e);return this.activation.apply(s)})}getConfig(){const e={activation:fa(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}SR.className="Activation";me(SR);class NR extends Ze{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return re(()=>(e=Ue(e),y5(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}NR.className="RepeatVector";me(NR);class CR extends Ze{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const s="Total size of new array must be unchanged.",r=t.slice();let o=1,a=null;for(let l=0;l<r.length;++l){const c=r[l];if(this.isUnknown(c))if(a===null)a=l;else throw new Q("Can only specifiy one unknown dimension.");else o*=c}const i=oa(e);if(a!==null){if(o===0||i%o!==0)throw new Q(s);r[a]=i/o}else if(i!==o)throw new Q(s);return r}computeOutputShape(e){let t=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return re(()=>{this.invokeCallHook(e,t);const s=Ue(e),r=s.shape,o=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return q(s,o)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}CR.className="Reshape";me(CR);class IR extends Ze{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=vr(1,e.dims.length+1);if(!Je(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new tn({ndim:this.dims.length+1})]}computeOutputShape(e){e=ot(e);const t=e.slice();return this.dims.forEach((s,r)=>{t[r+1]=e[s]}),t}call(e,t){return nt(Ue(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}IR.className="Permute";me(IR);class $R extends Ze{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const s=Ue(e);return ed(fi(s,this.maskValue),-1)}call(e,t){return re(()=>{this.invokeCallHook(e,t);const s=Ue(e),a=ed(fi(s,this.maskValue),-1,!0);return G(s,ke(a,s.dtype))})}}$R.className="Masking";me($R);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class TR extends Ze{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(pt(e.inputLength))}this.inputDim=e.inputDim,dn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,dn(this.outputDim,"outputDim"),this.embeddingsInitializer=Tt(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Et(e.embeddingsRegularizer),this.activityRegularizer=Et(e.activityRegularizer),this.embeddingsConstraint=rn(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return re(()=>this.maskZero?(e=Ue(e),fi(e,st(e))):null)}computeOutputShape(e){if(e=ot(e),this.inputLength==null)return[...e,this.outputDim];const t=pt(this.inputLength);if(t.length!==e.length-1)throw new Q(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<t.length;++r){const o=t[r],a=e[r+1];if(o!=null&&a!=null&&o!==a)throw new Q(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);o==null&&(t[s]=a),s++}}return[e[0],...t,this.outputDim]}call(e,t){return re(()=>{this.invokeCallHook(e,t);let s=Ue(e);s.dtype!=="int32"&&(s=Vr(s,"int32"));const r=iE(this.embeddings.read(),q(s,[s.size]));return q(r,ot(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Ot(this.embeddingsInitializer),embeddingsRegularizer:wt(this.embeddingsRegularizer),activityRegularizer:wt(this.activityRegularizer),embeddingsConstraint:sn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}TR.className="Embedding";me(TR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class _i extends Ze{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Ke}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const s=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const o=e[e.length-t.length+r],a=t[r];if(o==null||a==null||o<0||a<0)s.push(null);else if(o===1)s.push(a);else if(a===1)s.push(o);else{if(o!==a)throw new Q("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));s.push(o)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[ot(e)]),e=e,e.length<2)throw new Q(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const o of e)o!=null&&o[0]!==null&&t.push(o[0]);if(t=ra(t),t.length>1)throw new Q(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let o=1;o<e.length;++o){const a=e[o]==null?null:e[o].slice(1);s=this.computeElementwiseOpOutputShape(s,a)}const r=e.map(o=>o.length);e.indexOf(null)===-1&&ra(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return re(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(o=>o.rank);if(r.indexOf(null)===-1){const o=pa(r);for(let a of e){const i=a.rank;for(let l=0;l<o-i;++l)a=Vh(a,1);s.push(a)}return this.mergeFunction(s)}else{let o=!1;for(const l of e){const c=l.rank;if(c==null){const h=l.shape,p=h[0],f=h.slice(1).concat([p]);let g=q(l,[p].concat(oa(h.slice(1))));g=nt(g,[1,0]),g=q(g,f),s.push(g),o=!0}else if(c>1){const h=vr(1,c).concat([0]);s.push(nt(l,h)),o=!0}else s.push(l)}let a=this.mergeFunction(s);const i=a.rank;if(o){if(i==null){const l=a.shape,c=l.length,h=l[c-1],p=[h].concat(l.slice(0,l.length-1));a=q(nt(q(a,[-1,h]),[1,0]),p)}else if(i>1){const l=[i-1].concat(vr(0,i-1));a=nt(a,l)}}return a}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){const o=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,o)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=ra(s),s.length===1?t=s.concat(t):t=[null].concat(t),t}computeMask(e,t){return re(()=>{if(t==null)return null;if(!Array.isArray(t))throw new Q("`mask` should be an Array");if(!Array.isArray(e))throw new Q("`inputs` should be an Array");if(t.length!==e.length)throw new Q(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:An(r,0));let s=t[0];for(let r=1;r<t.length-1;++r)s=wr(s,t[r]);return s})}}class ER extends _i{constructor(e){super(e)}mergeFunction(e){return re(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=fe(t,e[s]);return t})}}ER.className="Add";me(ER);class RR extends _i{constructor(e){super(e)}mergeFunction(e){return re(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=G(t,e[s]);return t})}}RR.className="Multiply";me(RR);class AR extends _i{constructor(e){super(e)}mergeFunction(e){return re(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=fe(t,e[s]);return G(1/e.length,t)})}}AR.className="Average";me(AR);class DR extends _i{constructor(e){super(e)}mergeFunction(e){return re(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=Xr(t,e[s]);return t})}}DR.className="Maximum";me(DR);class _R extends _i{constructor(e){super(e)}mergeFunction(e){return re(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=ha(t,e[s]);return t})}}_R.className="Minimum";me(_R);class OR extends _i{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new Q("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(r!=null){t=!1;break}if(t)return;const s=[];for(let r=0;r<e.length;++r){const o=e[r].slice();o.splice(this.axis,1);let a=!1;for(const i of s)if(Je(i,o)){a=!0;break}a||s.push(o)}if(s.length>1)throw new Q("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return re(()=>fv(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new Q("A `Concatenate` layer should be called on a list of inputs.");const t=e,s=t[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const o of t.slice(1)){if(s[r]==null||o[r]==null){s[r]=null;break}s[r]+=o[r]}return s}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new Q("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new Q("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new Q(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return re(()=>{let s=!0;if(t.forEach(a=>{if(a!=null){s=!1;return}}),s)return null;const r=[];for(let a=0;a<e.length;++a)t[a]==null?r.push(ke(xs(e[a]),"bool")):t[a].rank<e[a].rank?r.push(An(t[a],-1)):r.push(t[a]);const o=Wt(r,this.axis);return Eg(o,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}OR.className="Concatenate";me(OR);function Oc(n,e){for(;n<0;)n+=e;return n}function BH(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new Ke("batchDot is not implemented for tensors of 4D or higher rank yet");if(A(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),A(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new Ke("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=e.shape.length;t==null&&(t=[s-1,r-2]);const o=t;return re(()=>{let a;if(s>r){a=s-r;const l=[];for(let c=0;c<a;++c)l.push(1);e=q(e,e.shape.concat(l))}else if(r>s){a=r-s;const l=[];for(let c=0;c<a;++c)l.push(1);n=q(n,n.shape.concat(l))}else a=0;let i;if(n.shape.length===2&&e.shape.length===2)o[0]===o[1]?i=Ae(G(n,e),o[0]):i=Ae(G(nt(n,[1,0]),e),o[1]);else{const l=o[0]!==n.shape.length-1,c=o[1]===e.shape.length-1;i=Xe(n,e,l,c)}if(a>0){let l;s>r?l=s+r-3:l=s-1;const c=[];for(let h=l;h<l+a;++h)c.push(h);i=Co(i,c)}return i.shape.length===1&&(i=An(i,1)),i})}class FR extends _i{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){A(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],s=e[1];if(t.length>3||s.length>3)throw new Ke("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);if(t[r[0]]!==s[r[1]])throw new Q(`Dimension incompatibility: ${t[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new Q(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((o,a)=>Oc(o,e[a].shape.length)):r=[Oc(this.axes,t.shape.length),Oc(this.axes,s.shape.length)],this.normalize&&(t=nm(t,r[0]),s=nm(s,r[1])),BH(t,s,r)}interpretAxes(e,t){let s;return Array.isArray(this.axes)?s=this.axes:s=[Oc(this.axes,e.length),Oc(this.axes,t.length)],s}computeOutputShape(e){A(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),s=e[1].slice();if(t.length>3||s.length>3)throw new Ke("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);t.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const o=t.concat(s);return o.length===1&&o.push(1),o}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}FR.className="Dot";me(FR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class LR extends Ze{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return re(()=>{this.invokeCallHook(e,t);const s=Ue(e);return Uh(()=>fe(yy(s.shape,0,this.stddev),s),()=>s,t.training||!1)})}}LR.className="GaussianNoise";me(LR);class PR extends Ze{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return re(()=>{this.invokeCallHook(e,t);const s=Ue(e);return this.rate>0&&this.rate<1?Uh(()=>{const o=Math.sqrt(this.rate/(1-this.rate));return G(s,yy(s.shape,1,o))},()=>s,t.training||!1):s})}}PR.className="GaussianDropout";me(PR);class zR extends Ze{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Ue(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return re(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return Uh(()=>{const o=Ue(e),i=-1.6732632423543772*1.0507009873554805;let l=So(Sa(s),this.rate);l=Vr(l,"float32");const c=((1-this.rate)*(1+this.rate*i**2))**-.5,h=-c*i*this.rate,p=fe(G(o,l),G(fe(l,-1),i));return fe(G(p,c),h)},()=>Ue(e),t.training||!1)}return e})}}zR.className="AlphaDropout";me(zR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function id(n,e,t,s,r,o=.001){let a;if(n.rank===2)a=Lw(n,e,t,s,r,o);else if(n.rank===3)a=Pw(n,e,t,s,r,o);else if(n.rank===4)a=zw(n,e,t,s,r,o);else throw new Ke(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return a}function VH(n,e,t,s,r=.001){return re(()=>{const o=Rh(n,s),a=o.mean,i=o.variance;return[id(n,a,i,t,e,r),a,i]})}function WH(n,e,t,s,r=.001){return re(()=>{const o=Rh(n,s),a=o.mean,i=o.variance,l=[];for(const y of vr(0,n.rank))s.indexOf(y)!==-1?l.push(1):l.push(n.shape[y]);const c=q(a,l),h=q(i,l),p=e==null?null:q(e,l),f=t==null?null:q(t,l);return[id(n,c,h,f,p,r),a,i]})}function UH(n,e,t,s,r=.001){return Je(s.slice().sort(),vr(0,n.rank-1))?VH(n,e,t,s,r):WH(n,e,t,s,r)}class MR extends Ze{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Tt(e.betaInitializer||"zeros"),this.gammaInitializer=Tt(e.gammaInitializer||"ones"),this.movingMeanInitializer=Tt(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Tt(e.movingVarianceInitializer||"ones"),this.betaConstraint=rn(e.betaConstraint),this.gammaConstraint=rn(e.gammaConstraint),this.betaRegularizer=Et(e.betaRegularizer),this.gammaRegularizer=Et(e.gammaRegularizer)}build(e){e=ot(e);const t=this.axis>=0?this.axis:this.axis+e.length,s=e[t];if(s==null)throw new Q(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new tn({ndim:e.length,axes:{[t]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return re(()=>{const s=t.training==null?!1:t.training,r=Ue(e),o=r.shape,a=o.length,i=vr(0,a),l=this.axis>=0?this.axis:this.axis+a;i.splice(l,1);const c=xi(1,a);c[l]=o[l];const h=i.slice();h.sort();const p=!Je(h,vr(0,a).slice(0,a-1)),f=()=>{if(p){const k=q(this.movingMean.read(),c),I=q(this.movingVariance.read(),c),N=this.center?q(this.beta.read(),c):null,T=this.scale?q(this.gamma.read(),c):null;return id(r,k,I,N,T,this.epsilon)}else return id(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return f();const[g,y,w]=UH(r,this.gamma.read(),this.beta.read(),i,this.epsilon),x=(k,I,N)=>{re(()=>{const T=1-N,D=k.read(),P=G(Te(D,I),T);k.write(Te(D,P))})};return(()=>{x(this.movingMean,y,this.momentum),x(this.movingVariance,w,this.momentum)})(),g})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Ot(this.betaInitializer),gammaInitializer:Ot(this.gammaInitializer),movingMeanInitializer:Ot(this.movingMeanInitializer),movingVarianceInitializer:Ot(this.movingVarianceInitializer),betaRegularizer:wt(this.betaRegularizer),gammaRegularizer:wt(this.gammaRegularizer),betaConstraint:sn(this.betaConstraint),gammaConstraint:sn(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}MR.className="BatchNormalization";me(MR);class BR extends Ze{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Tt(e.betaInitializer||"zeros"),this.gammaInitializer=Tt(e.gammaInitializer||"ones"),this.betaRegularizer=Et(e.betaRegularizer),this.gammaRegularizer=Et(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=ot(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=t);for(const o of this.axis)if(o<0||o>=t)throw new Error(`Invalid axis: ${o}`);if(this.axis.length!==ra(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(o=>e[o]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const s=Ue(e),r=s.shape,o=r.length;return re(()=>{let{mean:i,variance:l}=Rh(s,this.axis,!0);const c=xi(1,o);for(const w of this.axis)c[w]=r[w];const h=w=>w!=null&&w.shape.length!==o?q(w,c):w;let p=this.scale?h(this.gamma.read()):null,f=this.center?h(this.beta.read()):null;const g=[],y=[];for(let w=0;w<o;++w)this.axis.indexOf(w)!==-1?(g.push(r[w]),y.push(1)):(g.push(1),y.push(r[w]));return i=Rs(i,g),l=Rs(l,g),p!=null&&(p=Rs(p,y)),f!=null&&(f=Rs(f,y)),id(s,i,l,f,p,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Ot(this.betaInitializer),gammaInitializer:Ot(this.gammaInitializer),betaRegularizer:wt(this.betaRegularizer),gammaRegularizer:wt(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}BR.className="LayerNormalization";me(BR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jH(n,e,t){return re(()=>{if(n.rank!==4)throw new Q(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new Q("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=kr()),t!=="channelsLast"&&t!=="channelsFirst")throw new Q(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return t==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],No(n,s)})}class VR extends Ze{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?kr():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new Q(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,s;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new Q(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new Q(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[t,s]}this.inputSpec=[new tn({ndim:4})]}computeOutputShape(e){e=ot(e);let t,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],t,s]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],t,s,e[3]])}call(e,t){return re(()=>jH(Ue(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}VR.className="ZeroPadding2D";me(VR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Cy(n,e,t,s,r,o){return re(()=>{Gt(r),sE(o),Ls(s),t==null&&(t=[1,1]),s==null&&(s="valid"),r==null&&(r=kr()),o==null&&(o="max"),n=$v(n,r);let a;const i=s==="same"?"same":"valid";return o==="max"?a=Eh(n,e,t,i):a=vh(n,e,t,i),r==="channelsFirst"&&(a=nt(a,[0,3,1,2])),a})}function WR(n,e,t,s,r,o){return re(()=>{Gt(r),sE(o),Ls(s),t==null&&(t=[1,1,1]),s==null&&(s="valid"),r==null&&(r=kr()),o==null&&(o="max"),n=oR(n,r);let a;const i=s==="same"?"same":"valid";return o==="max"?a=i1(n,e,t,i):a=Fw(n,e,t,i),r==="channelsFirst"&&(a=nt(a,[0,4,1,2,3])),a})}class UR extends Ze{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new Q(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(dn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new Q(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);dn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Ls(this.padding),this.inputSpec=[new tn({ndim:3})]}computeOutputShape(e){e=ot(e);const t=br(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return re(()=>{this.invokeCallHook(e,t),e=Vh(Ue(e),2);const s=this.poolingFunction(Ue(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Co(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class jR extends UR{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return Gt(o),Ls(r),Cy(e,t,s,r,o,"max")}}jR.className="MaxPooling1D";me(jR);class GR extends UR{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return Gt(o),Ls(r),Cy(e,t,s,r,o,"avg")}}GR.className="AveragePooling1D";me(GR);class HR extends Ze{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new Q(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];dn(this.poolSize,"poolSize"),dn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Gt(this.dataFormat),Ls(this.padding),this.inputSpec=[new tn({ndim:4})]}computeOutputShape(e){e=ot(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=br(t,this.poolSize[0],this.padding,this.strides[0]),s=br(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s]:[e[0],t,s,e[3]]}call(e,t){return re(()=>(this.invokeCallHook(e,t),this.poolingFunction(Ue(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class qR extends HR{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return Gt(o),Ls(r),Cy(e,t,s,r,o,"max")}}qR.className="MaxPooling2D";me(qR);class KR extends HR{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return Gt(o),Ls(r),Cy(e,t,s,r,o,"avg")}}KR.className="AveragePooling2D";me(KR);class XR extends Ze{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new Q(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];dn(this.poolSize,"poolSize"),dn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Gt(this.dataFormat),Ls(this.padding),this.inputSpec=[new tn({ndim:5})]}computeOutputShape(e){e=ot(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=br(t,this.poolSize[0],this.padding,this.strides[0]),s=br(s,this.poolSize[1],this.padding,this.strides[1]),r=br(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s,r]:[e[0],t,s,r,e[4]]}call(e,t){return re(()=>(this.invokeCallHook(e,t),this.poolingFunction(Ue(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class YR extends XR{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return Gt(o),Ls(r),WR(e,t,s,r,o,"max")}}YR.className="MaxPooling3D";me(YR);class QR extends XR{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return Gt(o),Ls(r),WR(e,t,s,r,o,"avg")}}QR.className="AveragePooling3D";me(QR);class ZR extends Ze{constructor(e){super(e),this.inputSpec=[new tn({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new Ke}}class JR extends ZR{constructor(e){super(e||{})}call(e,t){return re(()=>{const s=Ue(e);return _t(s,1)})}}JR.className="GlobalAveragePooling1D";me(JR);class eA extends ZR{constructor(e){super(e||{})}call(e,t){return re(()=>{const s=Ue(e);return _s(s,1)})}}eA.className="GlobalMaxPooling1D";me(eA);class tA extends Ze{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Gt(this.dataFormat),this.inputSpec=[new tn({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new Ke}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class nA extends tA{call(e,t){return re(()=>{const s=Ue(e);return this.dataFormat==="channelsLast"?_t(s,[1,2]):_t(s,[2,3])})}}nA.className="GlobalAveragePooling2D";me(nA);class sA extends tA{call(e,t){return re(()=>{const s=Ue(e);return this.dataFormat==="channelsLast"?_s(s,[1,2]):_s(s,[2,3])})}}sA.className="GlobalMaxPooling2D";me(sA);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class rA extends Ze{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,s={}){const r=t.layer,o=po(r,s);delete t.layer;const a={layer:o};return Object.assign(a,t),new e(a)}}class oA extends rA{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=ot(e),e.length<3)throw new Q(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=ot(e);const t=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(t),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,t){return re(()=>(e=Ue(e),fR((a,i)=>[Ue(this.layer.call(a,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}oA.className="TimeDistributed";me(oA);function GH(n){Di(h5,"BidirectionalMergeMode",n)}const HH="concat";class aA extends rA{constructor(e){super(e);const t=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=t,this.forwardLayer=po(s),t.goBackwards=t.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=po(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?HH:e.mergeMode,GH(this.mergeMode),e.weights)throw new Ke("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,s=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let s,r,o;return this.returnState&&(o=t.slice(1)),s=t[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(o).concat(o.slice()):[s].concat(o).concat(o.slice()):Yn(r)}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const o=pR(e,s,r,this.numConstants);if(e=o.inputs,s=o.initialState,r=o.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,t);const a=[],i=[];if(s!=null){const c=s.length;if(c%2>0)throw new Q("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=s,a.push(...s);const h=s.map(p=>new tn({shape:p.shape}));this.forwardLayer.stateSpec=h.slice(0,c/2),this.backwardLayer.stateSpec=h.slice(c/2),i.push(...h)}if(r!=null)throw new Ke("Support for constants in Bidirectional layers is not implemented yet.");const l=a[0]instanceof qr;for(const c of a)if(c instanceof qr!==l)throw new Q("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const c=[e].concat(a),h=this.inputSpec.concat(i),p=this.inputSpec;this.inputSpec=h;const f=super.apply(c,t);return this.inputSpec=p,f}else return super.apply(e,t)}call(e,t){return re(()=>{const s=t.initialState;let r,o;if(s==null)r=this.forwardLayer.call(e,t),o=this.backwardLayer.call(e,t);else{const l=s.slice(0,s.length/2),c=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:l})),o=this.backwardLayer.call(e,Object.assign(t,{initialState:c}))}let a;this.returnState&&(Array.isArray(r)&&(a=r.slice(1).concat(o.slice(1))),r=r[0],o=o[0]),this.returnSequences&&(o=Os(o,1));let i;return this.mergeMode==="concat"?i=fv([r,o]):this.mergeMode==="sum"?i=fe(r,o):this.mergeMode==="ave"?i=G(.5,fe(r,o)):this.mergeMode==="mul"?i=G(r,o):this.mergeMode==null&&(i=[r,o]),this.returnState?this.mergeMode==null?i.concat(a):[i].concat(a):i})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){oi(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),oi(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[t,t]:s=t:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const o=this.forwardLayer.states.map(a=>null);return Array.isArray(s)?s.concat(o).concat(o):[s].concat(o).concat(o)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const s=po(t.layer);if(delete t.layer,t.numConstants!=null)throw new Ke("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=s,new e(r)}}aA.className="Bidirectional";me(aA);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class iA extends Ze{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return re(()=>(e=Ue(e),e.dtype!=="float32"&&(e=Vr(e,"float32")),fe(G(e,this.scale),this.offset)))}}iA.className="Rescaling";me(iA);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:qH,cropAndResize:KH}=Xs;class lA extends Ze{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,s,r,o,a,i,l){return re(()=>{let c,h=!1;const p=t/a,f=s/i,g=(r+t)/a,y=(o+s)/i,w=[p,f,g,y],x=[];e.rank===3?(h=!0,c=ss([e])):c=e;for(let T=0;T<c.shape[0];T++)x.push(w);const v=Zs(x,[x.length,4]),k=mi(0,x.length,1,"int32"),N=KH(c,v,k,[r,o],"nearest");return Vr(h?Ue(Fs(N)):N,l)})}upsize(e,t,s,r){return re(()=>{const o=qH(e,[t,s]);return Vr(o,r)})}call(e,t){return re(()=>{const s=Ue(e),r=s.dtype,o=s.shape,a=o[o.length-3],i=o[o.length-2];let l=0;a!==this.height&&(l=Math.floor((a-this.height)/2));let c=0;return i!==this.width&&(c=Math.floor((i-this.width)/2),c===0&&(c=1)),l>=0&&c>=0?this.centerCrop(s,l,c,this.height,this.width,a,i,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=ot(e);const t=e.length-3,s=e.length-2;return e[t]=this.height,e[s]=this.width,e}}lA.className="CenterCrop";me(lA);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function XH(n,e,t,s){let r=Ue(n);if(r.dtype!=="int32"&&(r=Vr(r,"int32")),e==="int")return r;const o=r.shape;if(r.rank===0&&(r=An(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=An(r,-1)),r.rank>2)throw new Q(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${o} which would result in output rank ${r.rank}.`);const a=["multiHot","oneHot"].includes(e),i=r;let l;if(typeof s<"u"&&e==="count"?l=qf(i,s,t,a):l=qf(i,[],t,a),e!=="tfIdf")return l;if(s)return G(l,s);throw new Q("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class uA extends Ze{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=ot(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return re(()=>{e=Ue(e),e.dtype!=="int32"&&(e=Vr(e,"int32"));let s;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new Q(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);s=Ue(t.countWeights)}const r=_s(e),o=kl(e),a=os(this.numTokens,r).bufferSync().get(0),i=So(o,0).bufferSync().get(0);if(!(a&&i))throw new Q(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return XH(e,this.outputMode,this.numTokens,s)})}}uA.className="CategoryEncoding";me(uA);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const YH=["bilinear","nearest"],dI=new Set(YH);class cA extends Ze{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(dI.has(e.interpolation))this.interpolation=e.interpolation;else throw new Q(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=ot(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return re(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Xs.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Xs.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...dI]} are supported`)})}}cA.className="Resizing";me(cA);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class dA{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}dA.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class hA extends Ze{constructor(e){super(e),this.randomGenerator=new dA(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}hA.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const QH=["bilinear","nearest"],hI=new Set(QH);class pA extends hA{constructor(e){super(e);const{factor:t,interpolation:s="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new Q(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new Q(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new Q(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(hI.has(s))this.interpolation=s;else throw new Q(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=ot(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return re(()=>{const s=Ue(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=Sa([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let o=this.widthFactor.dataSync()[0]*r;o=Math.round(o);const a=[this.imgHeight,o];switch(this.interpolation){case"bilinear":return Xs.resizeBilinear(e,a);case"nearest":return Xs.resizeNearestNeighbor(e,a);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...hI]} are supported`)}})}}pA.className="RandomWidth";me(pA);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var pI;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(pI||(pI={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function De(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&A(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZH=ty;class Iy extends xm{nextDataId(){return Iy.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new uw(this,fr())}write(e,t,s){this.firstUse&&(this.firstUse=!1,oe().get("IS_NODE")&&Ts(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&Lr(s[0])){const o=s.map(a=>zr(a));r=this.write(o,e,t)}else r=this.write(s,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,s,r,o){this.data.set(e,{values:t,dtype:r,refCount:o})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:s}=this.data.get(e);if(t==="complex64"){const r=this.readSync(s.real.dataId),o=this.readSync(s.imag.dataId);return yo(r,o)}return w2(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>fo(r));return qe(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return qe(e.shape,e.dtype,t)}makeOutput(e,t,s){return fr().makeTensorFromTensorInfo(this.makeTensorInfo(t,s,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=Mn();return e(),{kernelMs:Mn()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){De([e],"where");const t=this.readSync(e.dataId);return ZH(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}Iy.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fA(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const JH=n=>{const{x:e}=n.inputs,t=n.backend;De(e,"abs");let s=new Float32Array(ce(e.shape));const r=t.data.get(e.dataId).values;return s=fA(r),t.makeOutput(s,e.shape,e.dtype)},e8={kernelName:md,backendName:"cpu",kernelFunc:JH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ht(n){return(e,t,s,r,o)=>{const a=He(e,t),i=a.length,l=ze(a),c=ce(a),h=hn(o,c),p=e.length,f=t.length,g=ze(e),y=ze(t),w=pi(e,a),x=pi(t,a);if(w.length+x.length===0)for(let v=0;v<h.length;++v)h[v]=n(s[v%s.length],r[v%r.length]);else for(let v=0;v<h.length;++v){const k=Ii(v,i,l),I=k.slice(-p);w.forEach(P=>I[P]=0);const N=yr(I,p,g),T=k.slice(-f);x.forEach(P=>T[P]=0);const D=yr(T,f,y);h[v]=n(s[N],r[D])}return[h,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gs(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,i=t.makeTensorInfo(s.shape,"complex64"),l=t.data.get(i.dataId);return l.complexTensorInfos={real:t.makeTensorInfo(s.shape,"float32",o),imag:t.makeTensorInfo(r.shape,"float32",a)},i}const t8={kernelName:$m,backendName:"cpu",kernelFunc:gs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function im(n,e,t="float32"){if(t==="complex64"){const r=im(n,e,"float32"),o=im(n,e,"float32");return gs({inputs:{real:r,imag:o},backend:n})}const s=kn(ce(e),t);return n.makeTensorInfo(e,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kr(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const n8={kernelName:nu,backendName:"cpu",kernelFunc:Kr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bi(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.real,o=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,o)}const s8={kernelName:ag,backendName:"cpu",kernelFunc:bi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mA(n,e,t,s){if(s==="int32"){const r=Int32Array.from(n);return[e,"int32",r]}if(s==="bool"){const r=xa([0],t),[o,a]=Ht((i,l)=>i!==l?1:0)(e,[],n,r,"bool");return[a,"bool",o]}throw new Error(`Error in Cast: failed to cast ${t} to ${s}`)}function ya(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return Kr({inputs:{x:r},backend:t});const h=im(t,r.shape,r.dtype),p=ya({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),f=gs({inputs:{real:p,imag:h},backend:t});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),f}if(r.dtype==="complex64"){const h=bi({inputs:{input:r},backend:t}),p=ya({inputs:{x:h},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(h),p}if(!hw(r.dtype,o)){const h=Kr({inputs:{x:r},backend:t});return{dataId:h.dataId,shape:h.shape,dtype:o}}const a=t.data.get(r.dataId).values,[i,l,c]=mA(a,r.shape,r.dtype,o);return t.makeTensorInfo(i,l,c)}const r8={kernelName:Ul,backendName:"cpu",kernelFunc:ya};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function on(n,e,t,s){return t==null?({inputs:r,backend:o})=>{const{a,b:i}=r,l=o;De([a,i],n);const c=l.data.get(a.dataId).values,h=l.data.get(i.dataId).values,p=a.dtype==="string"?xo(c):c,f=a.dtype==="string"?xo(h):h,g=s||a.dtype,[y,w]=e(a.shape,i.shape,p,f,g);return l.makeTensorInfo(w,g,y)}:({inputs:r,backend:o})=>{const{a,b:i}=r,l=o;if(a.dtype==="complex64"||i.dtype==="complex64"){const c=ya({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),h=l.data.get(c.dataId),p=h.complexTensorInfos.real,f=h.complexTensorInfos.imag,g=l.data.get(p.dataId).values,y=l.data.get(f.dataId).values,w=ya({inputs:{x:i},backend:l,attrs:{dtype:"complex64"}}),x=l.data.get(w.dataId),v=x.complexTensorInfos.real,k=x.complexTensorInfos.imag,I=l.data.get(v.dataId).values,N=l.data.get(k.dataId).values,[T,D,P]=t(a.shape,i.shape,g,y,I,N),z=l.makeTensorInfo(P,"float32",T),F=l.makeTensorInfo(P,"float32",D),L=gs({inputs:{real:z,imag:F},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(w),l.disposeIntermediateTensorInfo(z),l.disposeIntermediateTensorInfo(F),L}else{const c=l.data.get(a.dataId).values,h=l.data.get(i.dataId).values,p=s||a.dtype,[f,g]=e(a.shape,i.shape,c,h,p);return l.makeTensorInfo(g,p,f)}}}function _v(n){return(e,t,s,r,o,a)=>{const i=He(e,t),l=ce(i),c=i.length,h=ze(i),p=hn("float32",l),f=hn("float32",l),g=pi(e,i),y=pi(t,i),w=yo(s,r),x=yo(o,a),v=e.length,k=ze(e),I=t.length,N=ze(t);if(g.length+y.length===0)for(let T=0;T<p.length;T++){const D=T%w.length,P=T%x.length,z=n(w[D*2],w[D*2+1],x[P*2],x[P*2+1]);p[T]=z.real,f[T]=z.imag}else for(let T=0;T<p.length;T++){const D=Ii(T,c,h),P=D.slice(-v);g.forEach(j=>P[j]=0);const z=yr(P,v,k),F=D.slice(-I);y.forEach(j=>F[j]=0);const L=yr(F,I,N),E=n(w[z*2],w[z*2+1],x[L*2],x[L*2+1]);p[T]=E.real,f[T]=E.imag}return[p,f,i]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gA=Ht((n,e)=>n+e),o8=_v((n,e,t,s)=>({real:n+t,imag:e+s})),El=on($i,gA,o8),a8={kernelName:$i,backendName:"cpu",kernelFunc:El};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ov(n,e,t,s,r){const o=ce(s),a=kn(r,t);for(let i=0;i<n.length;i++){const l=n[i];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(o>0?a[l]+=e[i]:a[l]+=1)}return a}function yA(n,e,t,s=!1){const r=n.shape[0],o=n.shape[1],a=qe([r,t],e.dtype);for(let i=0;i<r;i++)for(let l=0;l<o;l++){const c=n.get(i,l);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(s?a.set(1,i,c):e.size>0?a.set(a.get(i,c)+e.get(i,l),i,c):a.set(a.get(i,c)+1,i,c))}return a}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xA=Ht((n,e)=>n&e),i8=on(Sd,xA),l8={kernelName:Sd,backendName:"cpu",kernelFunc:i8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yr(n){return(e,t,s)=>{const r=Mt(t,e.length);for(let o=0;o<e.length;++o)r[o]=n(e[o],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ft(n,e,t){const s=Yr(e);return Ia(n,s,t)}function Ia(n,e,t){return({inputs:s,attrs:r,backend:o})=>{const{x:a}=s;De(a,n);const i=o,l=i.data.get(a.dataId).values;let c;if(a.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");c=xo(l)}else c=l;const h=t||a.dtype,p=e(c,h,r);return i.makeTensorInfo(a.shape,h,p)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bA=Yr(n=>Math.ceil(n)),u8=Ia(jl,bA),c8={kernelName:jl,backendName:"cpu",kernelFunc:u8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wA(n,e,t,s){const r=Mt(t,ce(e));if(s&&t!=="string"){let o=0;n.forEach(a=>{const i=ce(a.shape);r.set(a.vals,o),o+=i})}else{let o=0;n.forEach(a=>{const i=t==="string"?xo(a.vals):a.vals;let l=0;for(let c=0;c<a.shape[0];++c){const h=c*e[1]+o;for(let p=0;p<a.shape[1];++p)r[h+p]=i[l++]}o+=a.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vA=Ht((n,e)=>n===e?1:0),kA=on(Dd,vA,null,"bool"),d8={kernelName:Dd,backendName:"cpu",kernelFunc:kA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SA=Yr(n=>Math.exp(n)),NA=Ia(Ql,SA,"float32"),h8={kernelName:Ql,backendName:"cpu",kernelFunc:NA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CA=Yr(n=>Math.expm1(n)),p8=Ia(Zl,CA),f8={kernelName:Zl,backendName:"cpu",kernelFunc:p8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IA=Yr(n=>Math.floor(n)),m8=Ia(Jl,IA),g8={kernelName:Jl,backendName:"cpu",kernelFunc:m8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $A=Ht((n,e)=>Math.floor(n/e)),y8=on(eu,$A,null,"int32"),x8={kernelName:eu,backendName:"cpu",kernelFunc:y8};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TA(n,e,t,s,r,o,a,i,l){const c=qe([s,o],t);for(let h=0;h<s;h++){const p=[];let f=0;for(let g=0;g<r;g++){const y=n[h*r+g];f+=y*a[g],p.push(y)}if(f<0||f>=l/o)throw new Error(`Invalid indices: ${p} does not index into ${i}`);for(let g=0;g<o;g++)c.values[h*o+g]=e.get(...e.indexToLoc(f*o+g))}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EA(n,e,t){const s=qe(t,n.dtype);for(let r=0;r<s.size;++r){const a=s.indexToLoc(r).slice(),i=a[0],l=a[2],c=e.locToIndex([i,l]);a[2]=e.values[c];const h=n.locToIndex(a);0<=h&&h<n.values.length&&(s.values[r]=n.values[h])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RA=Ht((n,e)=>n>e?1:0),b8=on(Ld,RA,null,"bool"),w8={kernelName:Ld,backendName:"cpu",kernelFunc:b8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AA=Ht((n,e)=>n>=e?1:0),v8=on(tu,AA,null,"bool"),k8={kernelName:tu,backendName:"cpu",kernelFunc:v8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DA=Ht((n,e)=>n<e?1:0),S8=on(zd,DA,null,"bool"),N8={kernelName:zd,backendName:"cpu",kernelFunc:S8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _A=Ht((n,e)=>n<=e?1:0),C8=on(Md,_A,null,"bool"),I8={kernelName:Md,backendName:"cpu",kernelFunc:C8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OA(n,e,t){const s=(e-n)/(t-1),r=kn(t,"float32");r[0]=n;for(let o=1;o<r.length;o++)r[o]=r[o-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FA=Yr(n=>Math.log(n)),$8=Ia(au,FA),T8={kernelName:au,backendName:"cpu",kernelFunc:$8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LA(n,e,t,s){const r=hn(s,ce(t));for(let o=0;o<r.length;++o){const a=o*e;let i=n[a];for(let l=0;l<e;++l){const c=n[a+l];(Number.isNaN(c)||c>i)&&(i=c)}r[o]=i}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PA=Ht((n,e)=>Math.max(n,e)),E8=on(lu,PA),R8={kernelName:lu,backendName:"cpu",kernelFunc:E8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zA=Ht((n,e)=>Math.min(n,e)),A8=on(uu,zA),D8={kernelName:uu,backendName:"cpu",kernelFunc:A8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fv=Ht((n,e)=>n*e),_8=_v((n,e,t,s)=>({real:n*t-e*s,imag:n*s+e*t})),$y=on(du,Fv,_8),O8={kernelName:du,backendName:"cpu",kernelFunc:$y};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MA(n,e,t){const s=wo(-1,t);return Fv([],e,s,n,t)}function F8(n){const{inputs:e,backend:t}=n,{x:s}=e;De(s,"neg");const r=t.data.get(s.dataId).values,[o,a]=MA(r,s.shape,s.dtype);return t.makeTensorInfo(a,s.dtype,o)}const L8={kernelName:Yd,backendName:"cpu",kernelFunc:F8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BA=Ht((n,e)=>n!==e?1:0),P8=on(Qd,BA,null,"bool"),z8={kernelName:Qd,backendName:"cpu",kernelFunc:P8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lv(n,e,t,s,r){const o=e.length,a=ce(e),i=ze(e),l=ze(r),c=hn(t,ce(r));for(let h=0;h<a;++h){const p=Ii(h,o,i),f=new Array(p.length);for(let y=0;y<f.length;y++)f[y]=p[s[y]];const g=yr(f,o,l);c[g]=n[h]}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rs(n){const{inputs:e,attrs:t,backend:s}=n,{x:r}=e,{perm:o}=t;De(r,"transpose");const a=r.shape.length,i=new Array(a);for(let p=0;p<i.length;p++)i[p]=r.shape[o[p]];const l=s.data.get(r.dataId).values,c=Lv(l,r.shape,r.dtype,o,i);return{dataId:s.write(c,i,r.dtype),shape:i,dtype:r.dtype}}const M8={kernelName:si,backendName:"cpu",kernelFunc:rs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VA(n,e,t,s){const[r,o]=mn(n,s),a=Jn(e,"int32"),i=kn(ce(r),a),l=ce(o);for(let c=0;c<i.length;++c){const h=c*l;let p=1;for(let f=0;f<l;++f)p*=t[h+f];i[c]=p}return{outVals:i,outShape:r,outDtype:a}}function B8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:a}=s;De(r,"prod");const i=r.shape.length,l=Qe(o,r.shape),c=Lt(l,i);let h=l,p=r;const f=[];c!=null&&(p=rs({inputs:{x:r},backend:t,attrs:{perm:c}}),f.push(p),h=jt(h.length,i));const g=t.data.get(p.dataId).values,{outVals:y,outShape:w,outDtype:x}=VA(p.shape,p.dtype,g,h);let v=w;return a&&(v=Ut(w,l)),f.forEach(k=>t.disposeIntermediateTensorInfo(k)),t.makeTensorInfo(v,x,y)}const V8={kernelName:sh,backendName:"cpu",kernelFunc:B8};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W8(n,e,t){n.forEach((s,r)=>{if(s<0||s>=t){const o=Ii(r,e.length,ze(e)).join(",");throw new Error(`indices[${o}] = ${s} is not in [0, ${t})`)}})}function U8(n,e){for(let t=0;t<n.length;++t){const s=n[t],r=t===n.length-1?e:n[t+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let o=1;o<s.length;++o)if(s[o-1]>s[o])throw new Error("Ragged splits must be sorted in ascending order")}}function j8(n,e,t,s){const r=[];let o=0;const a=e.length-1+t.length,i=new Array(a).fill(null).map(()=>[0]);U8(t,s);let l=1;for(let c=0;c<e.length-1;++c){l*=e[c];const h=e[c+1];for(let p=1;p<l+1;++p)i[c].push(p*h)}for(let c=0;c<n.length;++c){let h=n[c],p=n[c]+1;for(let f=0;f<t.length;++f){const g=t[f],y=f+e.length-1;if(y>=0){const w=i[y],x=w[w.length-1]-g[h];for(let v=h;v<p;++v)i[y].push(g[v+1]+x)}h=g[h],p=g[p]}p!==h&&(r.push([h,p]),o+=p-h)}return{outSplits:i,valueSlices:r,numValues:o}}function G8(n){const e=[];for(let t=0;t<n.length;++t){const s=n[t].length,r=Mt("int32",s);e.push(r),n[t].forEach((o,a)=>r[a]=o)}return e}function fI(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let s=e;s<n.length;s++)t[e-1]*=n[s];return t}function H8(n,e,t,s,r,o){const a=fI(e,2)[1],i=fI(o,2)[1];let l=0;for(const c of t)for(let h=c[0];h<c[1];++h){for(let p=0;p<s;++p)r[l*i+p]=n[h*a+p];++l}}function q8(n,e,t,s,r){const o=e.slice();o[0]=r;const a=Mt(t,ce(o)),i=n.length,l=i===0?0:i/e[0];return H8(n,e,s,l,a,o),[a,o]}function WA(n,e,t,s,r,o,a,i){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(W8(o,a,l),s.length===0)throw new Error("params.rank must be nonzero");const c=s[0],{outSplits:h,valueSlices:p,numValues:f}=j8(o,a,n,c),g=G8(h),y=q8(t,s,r,p,f);return[g,y[0],y[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mI=2147483647;function UA(n,e,t,s,r,o,a){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(a.length>1)throw new Error("deltas must be a scalar or vector");const i=e.length===0,l=r.length===0,c=a.length===0,h=[];i||h.push(e[0]),l||h.push(r[0]),c||h.push(a[0]);for(let x=1;x<h.length;++x)if(h[x]!==h[x-1])throw new Error("starts, limits, and deltas must have the same shape");const p=h.length===0?1:h[0],f=Mt("int32",p+1);f[0]=0;for(let x=0;x<p;++x){const v=i?n[0]:n[x],k=l?s[0]:s[x],I=c?o[0]:o[x];if(I===0)throw new Error("Requires delta != 0");let N;if(I>0&&k<v||I<0&&k>v)N=0;else if(N=Math.ceil(Math.abs((k-v)/I)),N>mI)throw new Error(`Requires ((limit - start) / delta) <= ${mI}`);f[x+1]=f[x]+N}const g=f[p],y=Mt(t,g);let w=0;for(let x=0;x<p;++x){const v=f[x+1]-f[x];let k=i?n[0]:n[x];const I=c?o[0]:o[x];for(let N=0;N<v;++N)y[w++]=k,k+=I}return[f,y]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Hs=gr;class lm{constructor(e,t,s,r,o,a,i,l,c,h){this.shape=e,this.shapeShape=t,this.values=s,this.valuesShape=r,this.valuesDType=o,this.defaultValue=a,this.defaultValueShape=i,this.rowPartitionValues=l,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=NT(h),this.raggedRank=CT(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Hs.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Hs.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Hs.VALUE_ROWIDS:return lm.getMaxWidthValueRowID(t);case Hs.ROW_SPLITS:return lm.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${Hs[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let s=0;for(let r=0;r<t-1;++r){const o=e[r+1]-e[r];o>s&&(s=o)}return s}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let s=0,r=e[0],o=0;for(let a=1;a<t;++a){const i=e[a];i!==r&&(r=i,o=Math.max(a-s,o),s=a)}return Math.max(t-s,o)}tensorShapeFromTensor(e,t,s=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return yI(e,s)}calculateOutputSize(e){const t=this.valuesShape,s=this.defaultValueShape;IT(s,t);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),a=ST(this.raggedRank,r,t);a[0]<0&&(a[0]=e);for(let i=1;i<=this.raggedRank;++i)a[i]<0&&(a[i]=this.getMaxWidth(i));return a}calculateFirstParentOutputIndex(e,t,s){const r=Math.min(e,s),o=[];let a=0;for(let i=0;i<r;++i,a+=t)o.push(a);for(let i=r;i<e;++i)o.push(-1);return A(o.length===e,()=>"Final length of result must be equal to firstDimension."),o}calculateOutputIndexRowSplit(e,t,s,r){const o=e.length,a=[];for(let i=0;i<o-1;++i){const l=e[i+1]-e[i];let c=Math.min(r,l),h=t[i];h===-1&&(c=0);for(let p=0;p<c;++p)a.push(h),h+=s;for(let p=0;p<l-c;++p)a.push(-1)}if(o>0&&a.length!==e[o-1])throw new Error("Invalid row split size.");return a}calculateOutputIndexValueRowID(e,t,s,r){const o=e.length,a=[];if(o===0)return[];let i=0,l=e[0];if(l>=t.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${t.length}`);let c=t[l];a.push(c);for(let h=1;h<o;++h){const p=e[h];if(p===l)c>=0&&(++i,i<r?c+=s:c=-1);else{if(i=0,l=p,p>=t.length)throw new Error(`Got nextValueRowId=${p} which is not less than ${t.length}`);c=t[p]}a.push(c)}if(a.length!==e.length)throw new Error("Invalid row ids.");return a}calculateOutputIndex(e,t,s,r){const o=this.getRowPartitionTensor(e),a=this.getRowPartitionTypeByDimension(e);switch(a){case Hs.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,t,s,r);case Hs.ROW_SPLITS:if(o.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${o.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(o,t,s,r);default:throw new Error(`Unsupported partition type: ${Hs[a]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case Hs.FIRST_DIM_SIZE:return e[0];case Hs.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Hs.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Hs[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),s=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const o=yI(s,!1),a=Mt(this.valuesDType,ce(o));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(t,r[0],s[0]);for(let c=1;c<=this.raggedRank;++c)l=this.calculateOutputIndex(c-1,l,r[c],s[c]);this.setOutput(this.raggedRank,l,a,o)}return[o,a]}setOutput(e,t,s,r){if(s.length===0)return;const o=this.values,a=s;let i=r.slice();i=i.slice(e+1);const l=ce(i),c=t.length;let h=this.defaultValue;if(h.length!==l&&h.length!==1){const y=this.defaultValueShape;re(()=>{const w=q(h,y);h=ri(w,i).dataSync()})}let p=0,f=0,g=0;for(let y=0;y<=c;++y){let w=y<c?t[y]:-1;if(w===g){++g;continue}if(f<g){const x=o.subarray(p*l),v=a.subarray(f*l),k=(g-f)*l;gI(v,x,k)}if(y>=c){const x=s.length;w=Math.floor(x/l)}if(w>g)if(this.defaultValue.length===1)a.subarray(g*l,w*l).fill(this.defaultValue[0]),g=w;else for(;w>g;){const x=a.slice(g*l);gI(x,h,l),++g}w<0?(p=y+1,f=g):(p=y,f=g,g=f+1)}}}function gI(n,e,t){for(let s=0;s<t;s++)n[s]=e[s]}function yI(n,e){const t=[];for(let s of n){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}t.push(s)}return t}function jA(n,e,t,s,r,o,a,i,l,c){return new lm(n,e,t,s,r,o,a,i,l,c).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GA(n,e,t,s){const r=n===e,o=n<e&&t<0,a=e<n&&t>1;if(r||o||a)return kn(0,s);const i=Math.abs(Math.ceil((e-n)/t)),l=kn(i,s);e<n&&t===1&&(t=-1),l[0]=n;for(let c=1;c<l.length;c++)l[c]=l[c-1]+t;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HA=Yr(n=>1/Math.sqrt(n)),K8=Ia(yu,HA),X8={kernelName:yu,backendName:"cpu",kernelFunc:K8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ei(n,e,t,s,r,o,a,i,l,c){const h=[s/r,r],p=n.values,f=e.values;if(s===0)return qe(t,e.dtype);const g=l instanceof Yt?l:qe(h,e.dtype);typeof l=="string"||typeof l=="number"?g.values.fill(l):typeof l=="boolean"&&g.values.fill(+l);for(let y=0;y<o;y++){const w=[];let x=0;for(let v=0;v<a;v++){const k=p[y*a+v];w.push(k),x+=k*i[v]}if(x<0||x>=s/r)throw new Error(`Invalid indices: ${w} does not index into ${t}`);for(let v=0;v<r;v++)c?g.values[x*r+v]+=f[y*r+v]:g.values[x*r+v]=e.rank===0?f[0]:f[y*r+v]}return g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y8=Yr(n=>1/(1+Math.exp(-n))),qA=ft(ku,n=>1/(1+Math.exp(-n))),Q8={kernelName:ku,backendName:"cpu",kernelFunc:qA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KA(n,e,t,s,r){const o=V1(s,e,t),a=ce(t),i=ze(s);if(o){const p=W1(e,i);return r==="string"?n.slice(p,p+a):n.subarray(p,p+a)}const l=r==="string"?xo(n):n,c=qe(s,r,l),h=qe(t,r);for(let p=0;p<h.size;++p){const f=h.indexToLoc(p),g=f.map((y,w)=>y+e[w]);h.set(c.get(...g),...f)}return r==="string"?HT(h.values):h.values}function wi(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,size:a}=s;De(r,"slice");const[i,l]=hy(r,o,a);M1(r,i,l);const c=t.data.get(r.dataId).values,h=KA(c,i,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,h)}const Z8={kernelName:uh,backendName:"cpu",kernelFunc:wi};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XA(n,e,t,s,r,o,a){const i=e[0],l=o[0],c=new Array(l),h=new Array(i),p=e[1];if(l===0){if(i!==0)throw new Error(_T(i));const x=Mt(t,0),v=Mt(r,0);return[x,[0,p],v,c,h]}let f=!0,g=0;const y=new Array(l).fill(0);for(let x=0;x<i;++x){const v=n[x*p];if(v<0)throw new Error(OT(x,v));if(v>=l)throw new Error(FT(x,v,l));++y[v],f=f&&v>=g,g=v}let w=!0;for(let x=0;x<l;++x){const v=y[x]===0;c[x]=v,w=w&&!v,y[x]=Math.max(y[x],1),x>0&&(y[x]+=y[x-1])}if(w&&f){const x=n,v=s;for(let k=0;k<i;++k)h[k]=k;return[x,[i,p],v,c,h]}else{const x=y[l-1],v=Mt(t,x*p),k=Mt(r,x),I=new Array(l).fill(0);for(let N=0;N<i;++N){const T=n[N*p],D=I[T],P=(T===0?0:y[T-1])+D;I[T]++;for(let z=0;z<p;++z)v[P*p+z]=n[N*p+z];k[P]=s[N],h[N]=P}for(let N=0;N<l;++N)if(I[N]===0){const D=N===0?0:y[N-1];v[D*p+0]=N;for(let P=1;P<p;++P)v[D*p+P]=0;k[D]=a}return[v,[x,p],k,c,h]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YA(n,e,t,s,r){const o=ce(s),a=e[0],i=r.length,l=[];let c=1,h=-1;for(let x=0;x<i;++x){const v=r[x];if(v===-1){if(h!==-1)throw new Error(LT(h,x));h=x,l.push(1)}else{if(v<0)throw new Error(PT(x,v));c*=v,l.push(v)}}if(h!==-1){if(c<=0)throw new Error(zT());const x=Math.trunc(o/c);if(c*x!==o)throw new Error(MT(s,l));l[h]=x}if(ce(l)!==o)throw new Error(BT(s,l));const f=s.length,g=[];if(f>0){g[f-1]=1;for(let x=f-2;x>=0;--x)g[x]=g[x+1]*s[x+1]}const y=[];if(i>0){y[i-1]=1;for(let x=i-2;x>=0;--x)y[x]=y[x+1]*l[x+1]}const w=Mt(t,a*i);for(let x=0;x<a;++x){let v=0;for(let k=0;k<f;++k)v+=n[x*f+k]*g[k];for(let k=0;k<i;++k)w[x*i+k]=Math.trunc(v/y[k]),v%=y[k]}return[w,[a,i],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pv(n,e,t,s,r,o=!1,a=0){const i=s.length,l=[e[0],n.length/e[0]],c=l[1],p=i>0?r[i-1]+1:0;if(p<0)throw new Error(Rb());const f=e.slice();f[0]=p;const g=f.reduce((I,N)=>I*N,1),y=Mt(t,g);if(i===0)return p>0&&y.fill(a),[y,f];if(p<=0)throw new Error(Rb());let w=0,x=1,v=0,k=r[w];for(;;){let I=0;if(x<i){if(I=r[x],k===I){++x;continue}if(k>=I)throw new Error(VT())}if(k<0||k>=p)throw new Error(WT(k,p));k>v&&y.fill(a,v*c,k*c);for(let N=w;N<x;++N){const T=s[N];if(T<0||T>=l[0])throw new Error(UT(N,s[N],l[0]));for(let D=0;D<c;D++)y[k*c+D]+=n[T*c+D]}if(o)for(let N=0;N<c;N++)y[k*c+N]/=x-w;if(w=x,++x,v=k+1,k=I,x>i)break}return v<p&&y.fill(a,v*c,p*c),[y,f]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J8=Yr(n=>Math.sqrt(n)),e7=ft(Nu,n=>Math.sqrt(n)),t7={kernelName:Nu,backendName:"cpu",kernelFunc:e7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QA=Ht((n,e)=>{const t=n-e;return t*t}),n7=on(Cu,QA),s7={kernelName:Cu,backendName:"cpu",kernelFunc:n7};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZA=Yr((n,e)=>{const{pattern:t,replaceGlobal:s,rewrite:r}=e;return n.replace(new RegExp(t,s?"g":""),r)}),r7=Ia(fh,ZA),o7={kernelName:fh,backendName:"cpu",kernelFunc:r7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JA(n,e,t,s){const r=qe(n,e.dtype);for(let o=0;o<r.size;o++){const a=r.indexToLoc(o),i=new Array(a.length);for(let l=0;l<i.length;l++)i[l]=a[l]*t[l]+s[l];r.set(e.get(...i),...a)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a7{constructor(e,t,s,r,o,a){this.separator=zr(e),this.nGramWidths=t,this.leftPad=zr(s),this.rightPad=zr(r),this.padWidth=o,this.preserveShort=a}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const s=this.getPadWidth(t);return Math.max(0,e+2*s-t+1)}createNGrams(e,t,s,r,o,a){for(let i=0;i<o;++i){const l=this.getPadWidth(a),c=Math.max(0,l-i),h=Math.max(0,l-(o-(i+1))),p=a-(c+h),f=t+(c>0?0:i-l);let g=0;g+=c*this.leftPad.length;for(let k=0;k<p;++k)g+=e[f+k].length;g+=h*this.rightPad.length;const y=c+h+p-1;g+=y*this.separator.length,s[r+i]=new Uint8Array(g);const w=s[r+i];let x=0;const v=k=>k.forEach(I=>w[x++]=I);for(let k=0;k<c;++k)v(this.leftPad),v(this.separator);for(let k=0;k<p-1;++k)v(e[f+k]),v(this.separator);if(p>0){v(e[f+p-1]);for(let k=0;k<h;++k)v(this.separator),v(this.rightPad)}else{for(let k=0;k<h-1;++k)v(this.rightPad),v(this.separator);v(this.rightPad)}}}compute(e,t){const s=e.length,r=t.length;if(r>0){let l=t[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let c=1;c<r;++c){let h=t[c]>=l;if(h=h&&t[c]<=s,!h)throw new Error(`Invalid split value ${t[c]}, must be in [${l}, ${s}]`);l=t[c]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const o=r-1,a=Mt("int32",r);if(s===0||r===0){const l=new Array(s);for(let c=0;c<=o;++c)a[c]=0;return[l,a]}a[0]=0;for(let l=1;l<=o;++l){const c=t[l]-t[l-1];let h=0;this.nGramWidths.forEach(p=>{h+=this.getNumNGrams(c,p)}),this.preserveShort&&c>0&&h===0&&(h=1),a[l]=a[l-1]+h}const i=new Array(a[o]);for(let l=0;l<o;++l){const c=t[l];let h=a[l];if(this.nGramWidths.forEach(p=>{const f=t[l+1]-t[l],g=this.getNumNGrams(f,p);this.createNGrams(e,c,i,h,g,p),h+=g}),this.preserveShort&&h===a[l]){const p=t[l+1]-t[l];if(p===0)continue;const f=p+2*this.padWidth;this.createNGrams(e,c,i,h,1,f)}}return[i,a]}}function eD(n,e,t,s,r,o,a,i){return new a7(t,s,r,o,a,i).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i7(n,e,t,s){if(!n.length)return;if(e.length===0){for(let o=0;o<n.length;++o)s.push(n.subarray(o,o+1));return}if(e.length===1){const o=e[0];let a=n.indexOf(o);for(;a!==-1;){const i=n.subarray(0,a);(!t||i.length!==0)&&s.push(i),n=n.subarray(a+1),a=n.indexOf(o)}(!t||n.length!==0)&&s.push(n);return}let r=0;for(let o=0;o<n.length+1;o++)if(o===n.length||e.indexOf(n[o])!==-1){const a=n.subarray(r,o);(!t||a.length!==0)&&s.push(a),r=o+1}}function tD(n,e,t){const s=n.length,r=[];let o=0,a=0;const i=new Array(s);for(let f=0;f<s;++f){const g=r.length;i7(n[f],e,t,r);const y=r.length-g;i[f]=y,o+=y,a=Math.max(a,y)}const l=Mt("int32",o*2),c=new Array(o),h=[s,a];let p=0;for(let f=0;f<s;++f)for(let g=0;g<i[f];++g)l[p*2]=f,l[p*2+1]=g,c[p]=r[p],++p;return[l,c,h]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nD(n,e){const t=Mt("int32",n.length);for(let s=0;s<n.length;++s)t[s]=A2(n[s]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sD=Ht((n,e)=>n-e),l7=_v((n,e,t,s)=>({real:n-t,imag:e-s})),zv=on(Iu,sD,l7),u7={kernelName:Iu,backendName:"cpu",kernelFunc:zv};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rD(n,e){const t=new Array(n.rank);for(let r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];const s=qe(t,n.dtype);for(let r=0;r<s.values.length;++r){const o=s.indexToLoc(r),a=new Array(n.rank);for(let l=0;l<a.length;l++)a[l]=o[l]%n.shape[l];const i=n.locToIndex(a);s.values[r]=n.values[i]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zc=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function oD(n,e,t=0,s=n.length-1){for(;s>t;){if(s-t>600){const i=s-t+1,l=e-t+1,c=Math.log(i),h=.5*Math.exp(2*c/3),p=.5*Math.sqrt(c*h*(i-h)/i)*Math.sign(l-i/2),f=Math.max(t,Math.floor(e-l*h/i+p)),g=Math.min(s,Math.floor(e+(i-l)*h/i+p));oD(n,e,f,g)}const r=n[e];let o=t,a=s;for(co(n,t,e),zc(n[s],r)>0&&co(n,t,s);o<a;){for(co(n,o,a),o++,a--;zc(n[o],r)<0;)o=o+1;for(;zc(n[a],r)>0;)a=a-1}zc(n[t],r)===0?co(n,t,a):(a=a+1,co(n,a,s)),a<=e&&(t=a+1),e<=a&&(s=a-1)}}function aD(n,e,t,s,r){const o=e[e.length-1],[a,i]=[n.length/o,o],l=hn(t,a*s),c=hn("int32",a*s);for(let p=0;p<a;p++){const f=p*i,g=n.subarray(f,f+i);let y=new Array(g.length);g.forEach((k,I)=>y[I]={value:k,index:I}),s<y.length&&(oD(y,s),y=y.slice(0,s)),r&&y.sort(zc);const w=p*s,x=l.subarray(w,w+s),v=c.subarray(w,w+s);for(let k=0;k<s;k++)x[k]=y[k].value,v[k]=y[k].index}const h=e.slice();return h[h.length-1]=s,[qe(h,t,l),qe(h,"int32",c)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iD(n,e,t,s){const r=Qe(e,t)[0],o=[1,t[0],1];for(let y=0;y<r;y++)o[0]*=t[y];o[1]=t[r];for(let y=r+1;y<t.length;y++)o[2]*=t[y];const a=new Map,i=new Int32Array(t[r]),l=new Yt(o,s,n),c=[],h=o[0]===1&&o[2]===1;for(let y=0;y<t[r];y++){let w;if(h)w=n[y].toString();else{const v=[];for(let k=0;k<o[0];k++)for(let I=0;I<o[2];I++)v.push(l.get(k,y,I));w=v.join(",")}const x=a.get(w);if(x!=null)i[y]=x;else{const v=a.size;a.set(w,v),i[y]=v,c.push(y)}}const p=o.slice();p[1]=a.size;const f=new Yt(p,s);c.forEach((y,w)=>{for(let x=0;x<o[0];x++)for(let v=0;v<o[2];v++)f.set(l.get(x,y,v),x,w,v)});const g=t.slice();return g[r]=p[1],{outputValues:f.values,outputShape:g,indices:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c7=Object.freeze(Object.defineProperty({__proto__:null,addImpl:gA,bincountImpl:Ov,bincountReduceImpl:yA,bitwiseAndImpl:xA,castImpl:mA,ceilImpl:bA,concatImpl:wA,equalImpl:vA,expImpl:SA,expm1Impl:CA,floorDivImpl:$A,floorImpl:IA,gatherNdImpl:TA,gatherV2Impl:EA,greaterEqualImpl:AA,greaterImpl:RA,lessEqualImpl:_A,lessImpl:DA,linSpaceImpl:OA,logImpl:FA,maxImpl:LA,maximumImpl:PA,minimumImpl:zA,multiplyImpl:Fv,negImpl:MA,notEqualImpl:BA,prodImpl:VA,raggedGatherImpl:WA,raggedRangeImpl:UA,raggedTensorToTensorImpl:jA,rangeImpl:GA,rsqrtImpl:HA,scatterImpl:ei,sigmoidImpl:Y8,simpleAbsImpl:fA,sliceImpl:KA,sparseFillEmptyRowsImpl:XA,sparseReshapeImpl:YA,sparseSegmentReductionImpl:Pv,sqrtImpl:J8,squaredDifferenceImpl:QA,staticRegexReplaceImpl:ZA,stridedSliceImpl:JA,stringNGramsImpl:eD,stringSplitImpl:tD,stringToHashBucketFastImpl:nD,subImpl:sD,tileImpl:rD,topKImpl:aD,transposeImpl:Lv,uniqueImpl:iD},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */vw("cpu",()=>new Iy,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lD=ft(Xl,n=>n>=0?n:Math.exp(n)-1),d7={kernelName:Xl,backendName:"cpu",kernelFunc:lD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uD(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:o}=s;De([r],"leakyRelu");const a=ce(r.shape),i=t.data.get(r.dataId).values,l=hn("float32",a);for(let c=0;c<i.length;c++)l[c]=i[c]<0?o*i[c]:i[c];return t.makeTensorInfo(r.shape,"float32",l)}const h7={kernelName:Pd,backendName:"cpu",kernelFunc:uD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p7=Ht((n,e)=>n<0?e*n:n);function cD(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e;De([s,r],"prelu");const o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,[i,l]=p7(s.shape,r.shape,o,a,"float32");return t.makeTensorInfo(l,"float32",i)}const f7={kernelName:nh,backendName:"cpu",kernelFunc:cD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dD=ft(fu,n=>Math.max(0,n)),m7={kernelName:fu,backendName:"cpu",kernelFunc:dD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hD=ft(mu,n=>Math.min(Math.max(0,n),6)),g7={kernelName:mu,backendName:"cpu",kernelFunc:hD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function um(n,e,t,s,r){if(t==="linear")return Kr({inputs:{x:e},backend:n});if(t==="relu")return dD({inputs:{x:e},backend:n});if(t==="elu")return lD({inputs:{x:e},backend:n});if(t==="relu6")return hD({inputs:{x:e},backend:n});if(t==="prelu")return cD({inputs:{x:e,alpha:s},backend:n});if(t==="leakyrelu")return uD({inputs:{x:e},backend:n,attrs:{alpha:r}});if(t==="sigmoid")return qA({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nt(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:o}=s,a=ce(r.shape),i=dw(o,a),l=ce(i);A(a===l,()=>`The new shape (${i}) has ${l} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`),t.incRef(r.dataId);const c=t.data.get(r.dataId);if(c.complexTensorInfos!=null){const h=c.complexTensorInfos.real,p=c.complexTensorInfos.imag;h.shape=i,p.shape=i}return{dataId:r.dataId,shape:i,dtype:r.dtype}}const y7={kernelName:rh,backendName:"cpu",kernelFunc:Nt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pD(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o}=e,{transposeA:a,transposeB:i}=s;De([r,o],"matMul");const l=r.shape.length,c=o.shape.length,h=a?r.shape[l-2]:r.shape[l-1],p=i?o.shape[c-1]:o.shape[c-2],f=a?r.shape[l-1]:r.shape[l-2],g=i?o.shape[c-2]:o.shape[c-1],y=r.shape.slice(0,-2),w=o.shape.slice(0,-2),x=ce(y),v=ce(w),I=He(r.shape.slice(0,-2),o.shape.slice(0,-2)).concat([f,g]);A(h===p,()=>`Error in matMul: inner shapes (${h}) and (${p}) of Tensors with shapes ${r.shape} and ${o.shape} and transposeA=${a} and transposeB=${i} must match.`);const N=a?[x,h,f]:[x,f,h],T=i?[v,g,p]:[v,p,g],D=Nt({inputs:{x:r},backend:t,attrs:{shape:N}}),P=Nt({inputs:{x:o},backend:t,attrs:{shape:T}}),z=a?D.shape[1]:D.shape[2],F=a?D.shape[2]:D.shape[1],L=i?P.shape[1]:P.shape[2],E=Math.max(x,v),j=t.data.get(D.dataId).values,Z=t.data.get(P.dataId).values,ne=ze(D.shape),te=ze(P.shape),[se,K,B]=a?[ne[0],1,ne[1]]:[ne[0],ne[1],1],[J,X,M]=i?[1,te[1],te[0]]:[te[1],1,te[0]],H=F*L,le=qe([E,F,L],D.dtype),he=le.values,pe=t.blockSize;for(let ge=0;ge<E;ge++){const Se=ge%x,Ne=ge%v;for(let Ie=0;Ie<F;Ie+=pe){const Be=Math.min(Ie+pe,F);for(let Ge=0;Ge<L;Ge+=pe){const at=Math.min(Ge+pe,L);for(let lt=0;lt<z;lt+=pe){const vt=Math.min(lt+pe,z);for(let ht=Ie;ht<Be;ht++)for(let ut=Ge;ut<at;ut++){let xt=0;for(let bt=lt;bt<vt;bt++){const ks=j[Se*se+ht*K+bt*B],Rt=Z[bt*J+ut*X+Ne*M];xt+=ks*Rt}he[ge*H+(ht*L+ut)]+=xt}}}}}return t.disposeIntermediateTensorInfo(D),t.disposeIntermediateTensorInfo(P),t.makeTensorInfo(I,le.dtype,le.values)}const x7={kernelName:vd,backendName:"cpu",kernelFunc:pD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b7(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o,bias:a,preluActivationWeights:i}=e,{transposeA:l,transposeB:c,activation:h,leakyreluAlpha:p}=s;let f,g,y;const w=[];f=pD({inputs:{a:r,b:o},attrs:{transposeA:l,transposeB:c},backend:t}),a&&(g=El({inputs:{a:f,b:a},backend:t}),w.push(f),f=g),h&&(y=um(t,f,h,i,p),w.push(f),f=y);for(const v of w)t.disposeIntermediateTensorInfo(v);return f}const w7={kernelName:qc,backendName:"cpu",kernelFunc:b7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v7=ft(Ll,n=>Math.acos(n)),k7={kernelName:Ll,backendName:"cpu",kernelFunc:v7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S7=ft(Pl,n=>Math.acosh(n)),N7={kernelName:Pl,backendName:"cpu",kernelFunc:S7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C7(n){const{inputs:e,backend:t}=n,s=e;De(e,"addN");const r=s.map(i=>t.data.get(i.dataId).values),o=qe(s[0].shape,s[0].dtype),a=o.values;for(let i=0;i<s.length;i++){const l=r[i];for(let c=0;c<a.length;c++)a[c]+=l[c]}return t.makeTensorInfo(o.shape,o.dtype,o.values)}const I7={kernelName:gd,backendName:"cpu",kernelFunc:C7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:a}=s;De(r,"all");const i=Qe(o,r.shape);let l=i;const c=Lt(l,r.shape.length);let h=r;c!=null&&(h=rs({inputs:{x:r},backend:t,attrs:{perm:c}}),l=jt(l.length,r.shape.length)),Cn("all",l,h.shape.length);const[p,f]=mn(h.shape,l),g=ce(f),y=kn(ce(p),h.dtype),w=t.data.get(h.dataId).values;for(let v=0;v<y.length;++v){const k=v*g;let I=w[k];for(let N=0;N<g;++N){const T=w[k+N];I=I&&T}y[v]=I}c!=null&&t.disposeIntermediateTensorInfo(h);const x=t.makeTensorInfo(p,h.dtype,y);if(a){const v=Ut(p,i),k=Nt({inputs:{x},backend:t,attrs:{shape:v}});return t.disposeIntermediateTensorInfo(x),k}return x}const T7={kernelName:vm,backendName:"cpu",kernelFunc:$7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:a}=s;De(r,"any");const i=Qe(o,r.shape);let l=i;const c=Lt(l,r.shape.length);let h=r;c!=null&&(h=rs({inputs:{x:r},backend:t,attrs:{perm:c}}),l=jt(l.length,r.shape.length)),Cn("any",l,h.shape.length);const[p,f]=mn(h.shape,l),g=ce(f),y=kn(ce(p),h.dtype),w=t.data.get(h.dataId).values;for(let v=0;v<y.length;++v){const k=v*g;let I=w[k];for(let N=0;N<g;++N){const T=w[k+N];I=I||T}y[v]=I}c!=null&&t.disposeIntermediateTensorInfo(h);const x=t.makeTensorInfo(p,h.dtype,y);if(a){const v=Ut(p,i),k=Nt({inputs:{x},backend:t,attrs:{shape:v}});return t.disposeIntermediateTensorInfo(x),k}return x}const R7={kernelName:km,backendName:"cpu",kernelFunc:E7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;De(r,"argMax");let a=Qe(o,r.shape);const i=Lt(a,r.shape.length);let l=r;const c=[];i!=null&&(l=rs({inputs:{x:r},backend:t,attrs:{perm:i}}),c.push(l),a=jt(a.length,l.shape.length)),a=[a[0]],Cn("argMax",a,l.shape.length);const[h,p]=mn(l.shape,a),f=ce(h),g=kn(f,"int32"),y=ce(p),w=t.data.get(l.dataId).values;for(let x=0;x<g.length;++x){const v=x*y;let k=w[v],I=0;for(let N=0;N<y;++N){const T=w[v+N];T>k&&(k=T,I=N)}g[x]=I}return c.forEach(x=>t.disposeIntermediateTensorInfo(x)),t.makeTensorInfo(h,"int32",g)}const D7={kernelName:yd,backendName:"cpu",kernelFunc:A7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;De(r,"argMin");let a=Qe(o,r.shape);const i=Lt(a,r.shape.length);let l=r;const c=[];i!=null&&(l=rs({inputs:{x:r},backend:t,attrs:{perm:i}}),c.push(l),a=jt(a.length,l.shape.length)),a=[a[0]],Cn("argMin",a,l.shape.length);const[h,p]=mn(l.shape,a),f=ce(h),g=kn(f,"int32"),y=ce(p),w=t.data.get(l.dataId).values;for(let x=0;x<g.length;++x){const v=x*y;let k=w[v],I=0;for(let N=0;N<y;++N){const T=w[v+N];T<k&&(k=T,I=N)}g[x]=I}return c.forEach(x=>t.disposeIntermediateTensorInfo(x)),t.makeTensorInfo(h,"int32",g)}const O7={kernelName:xd,backendName:"cpu",kernelFunc:_7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F7=ft(zl,n=>Math.asin(n)),L7={kernelName:zl,backendName:"cpu",kernelFunc:F7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P7=ft(Ml,n=>Math.asinh(n)),z7={kernelName:Ml,backendName:"cpu",kernelFunc:P7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M7=ft(Bl,n=>Math.atan(n)),B7={kernelName:Bl,backendName:"cpu",kernelFunc:M7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V7=Ht((n,e)=>Math.atan2(n,e)),W7=on(Wl,V7),U7={kernelName:Wl,backendName:"cpu",kernelFunc:W7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j7=ft(Vl,n=>Math.atanh(n)),G7={kernelName:Vl,backendName:"cpu",kernelFunc:j7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mv(n,e,t,s,r,o){const a=r.strideHeight,i=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterHeight,p=r.effectiveFilterWidth,f=r.padInfo.top,g=r.padInfo.left,y=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=qe(r.outShape,t),x=w.values,v=r.outShape[1]*r.outShape[2]*r.outShape[3],k=r.outShape[2]*r.outShape[3],I=r.outShape[3];for(let N=0;N<r.batchSize;++N){const T=N*v,D=N*s[0];for(let P=0;P<r.inChannels;++P)for(let z=0;z<r.outHeight;++z){const F=z*a-f,L=Math.max(0,F),E=Math.min(r.inHeight,h+F),j=T+z*k;for(let Z=0;Z<r.outWidth;++Z){const ne=Z*i-g,te=Math.max(0,ne),se=Math.min(r.inWidth,p+ne);let K=y,B=0,J=0;for(let M=L;M<E;M+=l){const H=D+M*s[1];for(let le=te;le<se;le+=c){const he=H+le*s[2],pe=n[he+P];o==="max"&&pe>K?K=pe:o==="avg"&&(B+=pe,J++)}if(isNaN(K))break}const X=j+Z*I+P;x[X]=o==="avg"?B/J:K}}}return w}function fD(n,e,t,s,r=!1,o=!1){const a=qe(s.outShape,"int32"),i=s.strideHeight,l=s.strideWidth,c=s.dilationHeight,h=s.dilationWidth,p=s.effectiveFilterHeight,f=s.effectiveFilterWidth,g=s.padInfo.top,y=s.padInfo.left,w=qe(e,t,n);for(let x=0;x<s.batchSize;++x)for(let v=0;v<s.inChannels;++v)for(let k=0;k<s.outHeight;++k){const I=k*i-g;let N=I;for(;N<0;)N+=c;const T=Math.min(s.inHeight,p+I);for(let D=0;D<s.outWidth;++D){const P=D*l-y;let z=P;for(;z<0;)z+=h;const F=Math.min(s.inWidth,f+P);let L=Number.NEGATIVE_INFINITY,E=-1;for(let j=N;j<T;j+=c){const Z=j-I;for(let ne=z;ne<F;ne+=h){const te=ne-P,se=w.get(x,j,ne,v);se>L&&(L=se,r?E=o?((x*s.inHeight+j)*s.inWidth+ne)*s.inChannels+v:(j*s.inWidth+ne)*s.inChannels+v:E=Z*f+te)}}a.set(E,x,k,D,v)}}return a}function mD(n,e,t,s,r,o){const a=r.strideDepth,i=r.strideHeight,l=r.strideWidth,c=r.dilationDepth,h=r.dilationHeight,p=r.dilationWidth,f=r.effectiveFilterDepth,g=r.effectiveFilterHeight,y=r.effectiveFilterWidth,w=r.padInfo.front,x=r.padInfo.top,v=r.padInfo.left,k=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,I=qe(r.outShape,t),N=I.values,T=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],D=r.outShape[2]*r.outShape[3]*r.outShape[4],P=r.outShape[3]*r.outShape[4],z=r.outShape[4];for(let F=0;F<r.batchSize;++F){const L=F*T,E=F*s[0];for(let j=0;j<r.inChannels;++j)for(let Z=0;Z<r.outDepth;++Z){const ne=Z*a-w;let te=ne;for(;te<0;)te+=c;const se=Math.min(r.inDepth,f+ne),K=L+Z*D;for(let B=0;B<r.outHeight;++B){const J=B*i-x;let X=J;for(;X<0;)X+=h;const M=Math.min(r.inHeight,g+J),H=K+B*P;for(let le=0;le<r.outWidth;++le){const he=le*l-v;let pe=he;for(;pe<0;)pe+=p;const ge=Math.min(r.inWidth,y+he),Se=H+le*z;let Ne=k,Ie=0,Be=0;for(let at=te;at<se;at+=c){const lt=E+at*s[1];for(let vt=X;vt<M;vt+=h){const ht=lt+vt*s[2];for(let ut=pe;ut<ge;ut+=p){const xt=ht+ut*s[3],bt=n[xt+j];if(o==="max"&&bt>Ne?Ne=bt:o==="avg"&&(Ie+=bt,Be++),isNaN(Ne))break}if(isNaN(Ne))break}if(isNaN(Ne))break}const Ge=Se+j;N[Ge]=o==="avg"?Ie/Math.max(Be,1):Ne}}}}return I}function H7(n,e){const t=qe(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,o=e.strideWidth,a=e.dilationDepth,i=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,f=e.padInfo.front,g=e.padInfo.top,y=e.padInfo.left;for(let w=0;w<e.batchSize;++w)for(let x=0;x<e.inChannels;++x)for(let v=0;v<e.outDepth;++v){const k=v*s-f;let I=k;for(;I<0;)I+=a;const N=Math.min(e.inDepth,c+k);for(let T=0;T<e.outHeight;++T){const D=T*r-g;let P=D;for(;P<0;)P+=i;const z=Math.min(e.inHeight,h+D);for(let F=0;F<e.outWidth;++F){const L=F*o-y;let E=L;for(;E<0;)E+=l;const j=Math.min(e.inWidth,p+L);let Z=Number.NEGATIVE_INFINITY,ne=-1;for(let te=I;te<N;te+=a){const se=te-k;for(let K=P;K<z;K+=i){const B=K-D;for(let J=E;J<j;J+=l){const X=J-L,M=n.get(w,te,K,J,x);M>=Z&&(Z=M,ne=se*h*p+B*h+X)}}}t.set(ne,w,v,T,F,x)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;De(r,"avgPool");const{filterSize:o,strides:a,pad:i,dimRoundingMode:l}=s,c=1;A(Nn(a,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${a} and dilations '${c}'`);const h=er(r.shape,o,a,c,i,l);let p;if(h.filterWidth===1&&h.filterHeight===1&&Je(h.inShape,h.outShape))p=Kr({inputs:{x:r},backend:t});else{const f=t.data.get(r.dataId).values,g=ze(r.shape),y=Mv(f,r.shape,r.dtype,g,h,"avg");p=t.makeTensorInfo(h.outShape,r.dtype,y.values)}return p}const K7={kernelName:bd,backendName:"cpu",kernelFunc:q7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:a,pad:i,dimRoundingMode:l,dataFormat:c}=s;De(r,"avgPool3d");const h=vo(r.shape,o,a,1,i,l,c),p=t.data.get(r.dataId).values,f=mD(p,r.shape,r.dtype,ze(r.shape),h,"avg");return t.makeTensorInfo(f.shape,"float32",f.values)}const Y7={kernelName:wd,backendName:"cpu",kernelFunc:X7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q7(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,{filterSize:a,strides:i,pad:l,dimRoundingMode:c}=s;De([r,o],"avgPool3DGrad");const h=vo(o.shape,a,i,1,l,c),p=h.strideDepth,f=h.strideHeight,g=h.strideWidth,y=h.filterDepth,w=h.filterHeight,x=h.filterWidth,v=h.dilationDepth,k=h.dilationHeight,I=h.dilationWidth,N=h.effectiveFilterDepth,T=h.effectiveFilterHeight,D=h.effectiveFilterWidth,P=N-1-h.padInfo.front,z=D-1-h.padInfo.left,F=T-1-h.padInfo.top,L=qe(o.shape,"float32"),E=1/(y*w*x),j=t.bufferSync(r);for(let Z=0;Z<h.batchSize;++Z)for(let ne=0;ne<h.inChannels;++ne)for(let te=0;te<h.inDepth;++te)for(let se=0;se<h.inHeight;++se)for(let K=0;K<h.inWidth;++K){const B=te-P,J=se-F,X=K-z;let M=0;for(let H=0;H<N;H+=v){const le=(B+H)/p;if(!(le<0||le>=h.outDepth||Math.floor(le)!==le))for(let he=0;he<T;he+=k){const pe=(J+he)/f;if(!(pe<0||pe>=h.outHeight||Math.floor(pe)!==pe))for(let ge=0;ge<D;ge+=I){const Se=(X+ge)/g;if(Se<0||Se>=h.outWidth||Math.floor(Se)!==Se)continue;const Ne=j.get(Z,le,pe,Se,ne);M+=Ne}}}L.set(M*E,Z,te,se,K,ne)}return t.makeTensorInfo(L.shape,L.dtype,L.values)}const Z7={kernelName:Nm,backendName:"cpu",kernelFunc:Q7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J7(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,a=o;De([r,o],"avgPoolGrad");const{filterSize:i,strides:l,pad:c}=s,h=er(a.shape,i,l,1,c),p=h.strideHeight,f=h.strideWidth,g=h.filterHeight,y=h.filterWidth,w=h.dilationHeight,x=h.dilationWidth,v=h.effectiveFilterHeight,k=h.effectiveFilterWidth,I=k-1-h.padInfo.left,N=v-1-h.padInfo.top,T=qe(a.shape,"float32"),D=1/(g*y),P=t.data.get(r.dataId).values,z=qe(r.shape,"float32",P);for(let F=0;F<h.batchSize;++F)for(let L=0;L<h.inChannels;++L)for(let E=0;E<h.inHeight;++E)for(let j=0;j<h.inWidth;++j){const Z=E-N,ne=j-I;let te=0;for(let se=0;se<v;se+=w){const K=(Z+se)/p;if(!(K<0||K>=h.outHeight||Math.floor(K)!==K))for(let B=0;B<k;B+=x){const J=(ne+B)/f;if(J<0||J>=h.outWidth||Math.floor(J)!==J)continue;const X=z.get(F,K,J,L);te+=X}}T.set(te*D,F,E,j,L)}return t.makeTensorInfo(T.shape,T.dtype,T.values)}const eq={kernelName:Sm,backendName:"cpu",kernelFunc:J7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,scale:o,offset:a,mean:i,variance:l}=e;A(i.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),A(a==null||i.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),A(o==null||i.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),De([r,i,l,o,a],"batchNorm");let{varianceEpsilon:c}=s;c==null&&(c=.001);const h=t.data.get(r.dataId).values,p=t.data.get(i.dataId).values,f=t.data.get(l.dataId).values,g=o?t.data.get(o.dataId).values:new Float32Array([1]),y=a?t.data.get(a.dataId).values:new Float32Array([0]),w=new Float32Array(h.length),x=y.length,v=g.length,k=f.length,I=p.length;let N=0,T=0,D=0,P=0;for(let z=0;z<h.length;++z)w[z]=y[N++]+(h[z]-p[T++])*g[D++]/Math.sqrt(f[P++]+c),N>=x&&(N=0),T>=I&&(T=0),D>=v&&(D=0),P>=k&&(P=0);return t.makeTensorInfo(r.shape,r.dtype,w)}const nq={kernelName:Od,backendName:"cpu",kernelFunc:tq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,crops:a}=s;De([r],"batchToSpaceND");const i=o.reduce((v,k)=>v*k),l=Ph(r.shape,o,i),c=zh(l.length,o.length),h=Mh(r.shape,o,i),p=K1(a,o.length),f=X1(h,a,o.length),g=Nt({inputs:{x:r},backend:t,attrs:{shape:l}}),y=rs({inputs:{x:g},backend:t,attrs:{perm:c}}),w=Nt({inputs:{x:y},backend:t,attrs:{shape:h}}),x=wi({inputs:{x:w},backend:t,attrs:{begin:p,size:f}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),x}const rq={kernelName:kd,backendName:"cpu",kernelFunc:sq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:a}=s,i=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,c=Ov(i,l,o.dtype,o.shape,a);return t.makeTensorInfo([a],o.dtype,c)}const aq={kernelName:Cm,backendName:"cpu",kernelFunc:oq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iq(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,o=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,i=He(Array.from(o),Array.from(a));return t.makeTensorInfo([i.length],"int32",Int32Array.from(i))}const lq={kernelName:Im,backendName:"cpu",kernelFunc:iq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uq=ft(Gl,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),cq={kernelName:Gl,backendName:"cpu",kernelFunc:uq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dq=n=>{const{x:e}=n.inputs,t=n.backend,s=new Float32Array(ce(e.shape)),r=t.data.get(e.dataId),o=r.complexTensorInfos.real,a=r.complexTensorInfos.imag,i=t.data.get(o.dataId).values,l=t.data.get(a.dataId).values;for(let c=0;c<i.length;c++){const h=i[c],p=l[c];s[c]=Math.hypot(h,p)}return t.makeOutput(s,e.shape,"float32")},hq={kernelName:Nd,backendName:"cpu",kernelFunc:dq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rl(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.imag,o=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,o)}const pq={kernelName:Hm,backendName:"cpu",kernelFunc:Rl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Al(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,o=Qe(r,e[0].shape)[0],a=e.map(w=>w.shape);G1(a,o);let i=Br(e.map(w=>w.shape),o);if(ce(i)===0)return t.makeTensorInfo(i,e[0].dtype,[]);const l=e.filter(w=>ce(w.shape)>0);if(l.length===1)return Kr({inputs:{x:l[0]},backend:t});if(l[0].dtype==="complex64"){const w=l.map(N=>bi({inputs:{input:N},backend:t})),x=l.map(N=>Rl({inputs:{input:N},backend:t})),v=Al({inputs:w,backend:t,attrs:{axis:o}}),k=Al({inputs:x,backend:t,attrs:{axis:o}}),I=gs({inputs:{real:v,imag:k},backend:t});return w.forEach(N=>t.disposeIntermediateTensorInfo(N)),x.forEach(N=>t.disposeIntermediateTensorInfo(N)),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(k),I}const c=l.map(w=>{const v=[-1,ce(w.shape.slice(o))];return Nt({inputs:{x:w},backend:t,attrs:{shape:v}})}),h=c.map(w=>({vals:t.data.get(w.dataId).values,shape:w.shape}));i=Br(c.map(w=>w.shape),1);const p=c[0].shape[0]===1,f=wA(h,i,e[0].dtype,p),g=Br(l.map(w=>w.shape),o),y=t.makeTensorInfo(g,e[0].dtype,f);return c.forEach(w=>t.disposeIntermediateTensorInfo(w)),y}const fq={kernelName:Cd,backendName:"cpu",kernelFunc:Al};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gD(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:a,pad:i,dataFormat:l,dilations:c,dimRoundingMode:h}=s;De([r,o],"conv2d");const p=ko(l),f=fn(r.shape,o.shape,a,c,i,h,!1,p),g=f.filterHeight,y=f.filterWidth,w=f.dilationHeight,x=f.dilationWidth,v=f.padInfo.left,k=f.padInfo.top,I=f.dataFormat==="channelsLast",N=new Yt(f.outShape,r.dtype),T=ze(r.shape),D=ze(o.shape),P=T[0],z=I?T[1]:T[2],F=I?T[2]:1,L=I?1:T[1],E=N.strides[0],j=I?N.strides[1]:N.strides[2],Z=I?N.strides[2]:1,ne=I?1:N.strides[1],te=t.data.get(r.dataId).values,se=t.data.get(o.dataId).values,K=N.values;for(let B=0;B<f.batchSize;++B){const J=B*P,X=B*E;for(let M=0;M<f.outHeight;++M){const H=X+M*j,le=M*f.strideHeight-k;for(let he=0;he<g;++he){const pe=le+he*w;if(pe<0||pe>=f.inHeight)continue;const ge=he*D[0],Se=J+pe*z;for(let Ne=0;Ne<f.outWidth;++Ne){const Ie=H+Ne*Z,Be=Ne*f.strideWidth-v;for(let Ge=0;Ge<y;++Ge){const at=Be+Ge*x;if(at<0||at>=f.inWidth)continue;const lt=ge+Ge*D[1],vt=Se+at*F;let ht=lt;for(let ut=0;ut<f.inChannels;++ut){const xt=te[vt+ut*L];for(let bt=0;bt<f.outChannels;++bt)K[Ie+bt*ne]+=xt*se[ht+bt];ht+=f.outChannels}}}}}}return t.makeTensorInfo(N.shape,N.dtype,K)}const mq={kernelName:Id,backendName:"cpu",kernelFunc:gD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:a,pad:i,dataFormat:l,dimRoundingMode:c,filterShape:h}=s;De([r,o],"conv2dBackpropFilter");const p=ko(l),f=fn(r.shape,h,a,1,i,c,!1,p),{strideHeight:g,strideWidth:y,filterHeight:w,filterWidth:x}=f,v=f.dataFormat==="channelsLast",k=new Yt(f.filterShape,"float32"),I=f.padInfo.left,N=f.padInfo.top,T=t.data.get(r.dataId).values,D=t.data.get(o.dataId).values,P=new Yt(r.shape,r.dtype,T),z=new Yt(o.shape,o.dtype,D);for(let F=0;F<w;++F){const L=Math.max(0,Math.ceil((N-F)/g)),E=Math.min(f.outHeight,(f.inHeight+N-F)/g);for(let j=0;j<x;++j){const Z=Math.max(0,Math.ceil((I-j)/y)),ne=Math.min(f.outWidth,(f.inWidth+I-j)/y);for(let te=0;te<f.inChannels;++te)for(let se=0;se<f.outChannels;++se){let K=0;for(let B=0;B<f.batchSize;++B)for(let J=L;J<E;++J){const X=F+J*g-N;for(let M=Z;M<ne;++M){const H=j+M*y-I;v?K+=P.get(B,X,H,te)*z.get(B,J,M,se):K+=P.get(B,te,X,H)*z.get(B,se,J,M)}}k.set(K,F,j,te,se)}}}return t.makeTensorInfo(k.shape,k.dtype,k.values)}const yq={kernelName:Tm,backendName:"cpu",kernelFunc:gq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{inputShape:a,strides:i,pad:l,dataFormat:c,dimRoundingMode:h}=s;De([r,o],"conv2dBackpropInput");const p=ze(o.shape),f=ze(r.shape);let g=ko(c);const y=fn(a,o.shape,i,1,l,h,!1,g),w=new Yt(y.inShape,"float32"),x=w.values,v=t.data.get(r.dataId).values,k=t.data.get(o.dataId).values,[I,N,T]=p,{batchSize:D,filterHeight:P,filterWidth:z,inChannels:F,inHeight:L,inWidth:E,outChannels:j,outHeight:Z,outWidth:ne,strideHeight:te,strideWidth:se}=y;g=y.dataFormat;const K=P-1-y.padInfo.top,B=z-1-y.padInfo.left,J=g==="channelsLast",X=w.strides[0],M=J?w.strides[1]:w.strides[2],H=J?w.strides[2]:1,le=J?1:w.strides[1],he=f[0],pe=J?f[1]:f[2],ge=J?f[2]:1,Se=J?1:f[1];for(let Ne=0;Ne<D;++Ne)for(let Ie=0;Ie<F;++Ie)for(let Be=0;Be<L;++Be){const Ge=Be-K,at=Math.max(0,Math.ceil(Ge/te)),lt=Math.min(Z,(P+Ge)/te);for(let vt=0;vt<E;++vt){const ht=vt-B,ut=Math.max(0,Math.ceil(ht/se)),xt=Math.min(ne,(z+ht)/se);let bt=0;for(let Rt=at;Rt<lt;++Rt){const qn=Rt*te-Ge;for(let Tn=ut;Tn<xt;++Tn){const $r=Tn*se-ht,as=he*Ne+pe*Rt+ge*Tn,Ps=I*(P-1-qn)+N*(z-1-$r)+T*Ie;for(let sr=0;sr<j;++sr){const zs=v[as+Se*sr],Ss=k[Ps+sr];bt+=zs*Ss}}}const ks=X*Ne+M*Be+H*vt+le*Ie;x[ks]=bt}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const bq={kernelName:$d,backendName:"cpu",kernelFunc:xq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:a,pad:i,dilations:l}=s;De([r,o],"conv3d");const c=wa(r.shape,o.shape,a,l,i),{filterDepth:h,filterHeight:p,filterWidth:f,dilationDepth:g,dilationHeight:y,dilationWidth:w,padInfo:x}=c,v=x.front,k=x.left,I=x.top,N=new Yt(c.outShape,r.dtype),T=t.data.get(r.dataId).values,D=t.data.get(o.dataId).values,P=N.values,z=ze(r.shape),F=ze(o.shape);for(let L=0;L<c.batchSize;++L){const E=L*z[0],j=L*N.strides[0];for(let Z=0;Z<c.outDepth;++Z){const ne=j+Z*N.strides[1],te=Z*c.strideDepth-v;for(let se=0;se<h;++se){const K=te+se*g;if(K<0||K>=c.inDepth)continue;const B=se*F[0],J=E+K*z[1];for(let X=0;X<c.outHeight;++X){const M=ne+X*N.strides[2],H=X*c.strideHeight-I;for(let le=0;le<p;++le){const he=H+le*y;if(he<0||he>=c.inHeight)continue;const pe=B+le*F[1],ge=J+he*z[2];for(let Se=0;Se<c.outWidth;++Se){const Ne=M+Se*c.outChannels,Ie=Se*c.strideWidth-k;for(let Be=0;Be<f;++Be){const Ge=Ie+Be*w;if(Ge<0||Ge>=c.inWidth)continue;const at=pe+Be*F[2],lt=ge+Ge*c.inChannels;let vt=at;for(let ht=0;ht<c.inChannels;++ht){const ut=T[lt+ht];for(let xt=0;xt<c.outChannels;++xt)P[Ne+xt]+=ut*D[vt+xt];vt+=c.outChannels}}}}}}}}return t.makeTensorInfo(N.shape,N.dtype,N.values)}const vq={kernelName:Td,backendName:"cpu",kernelFunc:wq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:a,pad:i,filterShape:l}=s;De([r,o],"conv3dBackpropFilterV2");const c=ze(r.shape),h=ze(o.shape),p=wa(r.shape,l,a,1,i),f=p.strideDepth,g=p.strideHeight,y=p.strideWidth,w=p.filterDepth,x=p.filterHeight,v=p.filterWidth,k=new Yt(p.filterShape,"float32"),I=k.values,[N,T,D,P]=k.strides,z=t.data.get(o.dataId).values,[F,L,E,j]=h,Z=t.data.get(r.dataId).values,[ne,te,se,K]=c,B=p.padInfo.front,J=p.padInfo.left,X=p.padInfo.top;for(let M=0;M<w;++M){const H=Math.max(0,Math.ceil((B-M)/f)),le=Math.min(p.outDepth,(p.inDepth+B-M)/f),he=M*N;for(let pe=0;pe<x;++pe){const ge=Math.max(0,Math.ceil((X-pe)/g)),Se=Math.min(p.outHeight,(p.inHeight+X-pe)/g),Ne=pe*T+he;for(let Ie=0;Ie<v;++Ie){const Be=Math.max(0,Math.ceil((J-Ie)/y)),Ge=Math.min(p.outWidth,(p.inWidth+J-Ie)/y),at=Ie*D+Ne;for(let lt=0;lt<p.inChannels;++lt){const vt=lt*P+at;for(let ht=0;ht<p.outChannels;++ht){let ut=0;for(let xt=0;xt<p.batchSize;++xt){const bt=xt*ne,ks=xt*F;for(let Rt=H;Rt<le;++Rt){const Tn=(M+Rt*f-B)*te+bt,$r=Rt*L+ks;for(let as=ge;as<Se;++as){const sr=(pe+as*g-X)*se+Tn,zs=as*E+$r;for(let Ss=Be;Ss<Ge;++Ss){const Qr=(Ie+Ss*y-J)*K+sr,Zr=Ss*j+zs;ut+=Z[Qr+lt]*z[Zr+ht]}}}}I[vt+ht]=ut}}}}}return t.makeTensorInfo(k.shape,k.dtype,k.values)}const Sq={kernelName:Em,backendName:"cpu",kernelFunc:kq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{pad:a,strides:i,inputShape:l}=s;De([r],"conv3dBackpropInputV2");const c=ze(r.shape),h=ze(o.shape),p=wa(l,o.shape,i,1,a),f=new Yt(p.inShape,"float32"),g=f.values,[y,w,x,v]=f.strides,k=t.data.get(r.dataId).values,[I,N,T,D]=c,P=t.data.get(o.dataId).values,[z,F,L,E]=h,{batchSize:j,filterDepth:Z,filterHeight:ne,filterWidth:te,inChannels:se,inDepth:K,inHeight:B,inWidth:J,outChannels:X,outDepth:M,outHeight:H,outWidth:le,strideDepth:he,strideHeight:pe,strideWidth:ge}=p,Se=Z-1-p.padInfo.front,Ne=ne-1-p.padInfo.top,Ie=te-1-p.padInfo.left;for(let Be=0;Be<j;++Be)for(let Ge=0;Ge<se;++Ge)for(let at=0;at<K;++at){const lt=at-Se,vt=Math.max(0,Math.ceil(lt/he)),ht=Math.min(M,(Z+lt)/he);for(let ut=0;ut<B;++ut){const xt=ut-Ne,bt=Math.max(0,Math.ceil(xt/pe)),ks=Math.min(H,(ne+xt)/pe);for(let Rt=0;Rt<J;++Rt){const qn=Rt-Ie,Tn=Math.max(0,Math.ceil(qn/ge)),$r=Math.min(le,(te+qn)/ge);let as=0;for(let Ps=vt;Ps<ht;++Ps){const sr=Ps*he-lt;for(let zs=bt;zs<ks;++zs){const Ss=zs*pe-xt;for(let Eo=Tn;Eo<$r;++Eo){const Qr=Eo*ge-qn,Zr=I*Be+N*Ps+T*zs+D*Eo,_y=z*(Z-1-sr)+F*(ne-1-Ss)+L*(te-1-Qr)+E*Ge;for(let Ta=0;Ta<X;++Ta){const ep=k[Zr+Ta],Oy=P[_y+Ta];as+=ep*Oy}}}}g[y*Be+w*at+x*ut+v*Rt+Ge]=as}}}return t.makeTensorInfo(f.shape,f.dtype,f.values)}const Cq={kernelName:Rm,backendName:"cpu",kernelFunc:Nq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iq=ft(Hl,n=>Math.cos(n)),$q={kernelName:Hl,backendName:"cpu",kernelFunc:Iq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tq=ft(ql,n=>Math.cosh(n)),Eq={kernelName:ql,backendName:"cpu",kernelFunc:Tq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rq(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:o,boxInd:a}=e,{cropSize:i,method:l,extrapolationValue:c}=s,[h,p,f,g]=r.shape,y=o.shape[0],[w,x]=i,v=qe([y,w,x,g],"float32"),k=t.data.get(o.dataId).values,I=t.data.get(a.dataId).values,N=t.data.get(r.dataId).values,T=ze(r.shape),D=ze(v.shape);for(let P=0;P<y;P++){const z=P*4,F=k[z],L=k[z+1],E=k[z+2],j=k[z+3],Z=I[P];if(Z>=h)continue;const ne=w>1?(E-F)*(p-1)/(w-1):0,te=x>1?(j-L)*(f-1)/(x-1):0;for(let se=0;se<w;se++){const K=w>1?F*(p-1)+se*ne:.5*(F+E)*(p-1);if(K<0||K>p-1){for(let B=0;B<x;B++)for(let J=0;J<g;J++){const X=J+B*D[2]+se*D[1]+P*D[0];v.values[X]=c}continue}if(l==="bilinear"){const B=Math.floor(K),J=Math.ceil(K),X=K-B;for(let M=0;M<x;M++){const H=x>1?L*(f-1)+M*te:.5*(L+j)*(f-1);if(H<0||H>f-1){for(let ge=0;ge<g;ge++){const Se=ge+M*D[2]+se*D[1]+P*D[0];v.values[Se]=c}continue}const le=Math.floor(H),he=Math.ceil(H),pe=H-le;for(let ge=0;ge<g;ge++){let Se=ge+le*T[2]+B*T[1]+Z*T[0];const Ne=N[Se];Se=ge+he*T[2]+B*T[1]+Z*T[0];const Ie=N[Se];Se=ge+le*T[2]+J*T[1]+Z*T[0];const Be=N[Se];Se=ge+he*T[2]+J*T[1]+Z*T[0];const Ge=N[Se],at=Ne+(Ie-Ne)*pe,lt=Be+(Ge-Be)*pe;Se=ge+M*D[2]+se*D[1]+P*D[0],v.values[Se]=at+(lt-at)*X}}}else for(let B=0;B<x;++B){const J=x>1?L*(f-1)+B*te:.5*(L+j)*(f-1);if(J<0||J>f-1){for(let H=0;H<g;H++){const le=H+B*D[2]+se*D[1]+P*D[0];v.values[le]=c}continue}const X=Math.round(J),M=Math.round(K);for(let H=0;H<g;H++){const le=H+X*T[2]+M*T[1]+Z*T[0],he=H+B*D[2]+se*D[1]+P*D[0];v.values[he]=N[le]}}}}return t.makeTensorInfo(v.shape,v.dtype,v.values)}const Aq={kernelName:Dm,backendName:"cpu",kernelFunc:Rq};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:a,reverse:i}=s;De(r,"cumprod");const l=Lt([o],r.shape.length);let c=r;l!=null&&(c=rs({inputs:{x:r},backend:t,attrs:{perm:l}}));const h=jt(1,r.shape.length)[0];if(h!==c.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${h}`);const p=Jn(c.dtype,"int32"),f=wm(ce(c.shape),p),g=t.data.get(c.dataId).values,y=c.shape[c.shape.length-1],w=i?(v,k)=>v+y-k-1:(v,k)=>v+k;for(let v=0;v<g.length;v+=y)for(let k=0;k<y;k++){const I=w(v,k);if(k===0)f[I]=a?1:g[I];else{const N=w(v,k-1);f[I]=a?g[N]*f[N]:g[I]*f[N]}}const x=t.makeTensorInfo(c.shape,p,f);if(l!=null){const v=va(l),k=rs({inputs:{x},backend:t,attrs:{perm:v}});return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(c),k}return x}const _q={kernelName:Am,backendName:"cpu",kernelFunc:Dq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:a,reverse:i}=s;De(r,"cumsum");const l=Lt([o],r.shape.length);let c=r;l!=null&&(c=rs({inputs:{x:r},backend:t,attrs:{perm:l}}));const h=jt(1,r.shape.length)[0];if(h!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${h}`);const p=Jn(c.dtype,"int32"),f=kn(ce(c.shape),p),g=t.data.get(c.dataId).values,y=c.shape[c.shape.length-1],w=i?(v,k)=>v+y-k-1:(v,k)=>v+k;for(let v=0;v<g.length;v+=y)for(let k=0;k<y;k++){const I=w(v,k);if(k===0)f[I]=a?0:g[I];else{const N=w(v,k-1);f[I]=a?g[N]+f[N]:g[I]+f[N]}}const x=t.makeTensorInfo(c.shape,p,f);if(l!=null){const v=va(l),k=rs({inputs:{x},backend:t,attrs:{perm:v}});return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(c),k}return x}const Fq={kernelName:Ed,backendName:"cpu",kernelFunc:Oq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:a,binaryOutput:i}=s;if(r.shape.length===1){const l=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,h=Ov(l,c,o.dtype,o.shape,a);return t.makeTensorInfo([a],o.dtype,h)}else if(r.shape.length===2){const l=t.bufferSync(r),c=t.bufferSync(o),h=yA(l,c,a,i);return t.makeTensorInfo(h.shape,o.dtype,h.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const Pq={kernelName:_m,backendName:"cpu",kernelFunc:Lq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:o,dataFormat:a}=s;A(a==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${a}`);const i=r.shape[0],l=r.shape[1],c=r.shape[2],h=r.shape[3],p=l*o,f=c*o,g=h/(o*o),y=t.data.get(r.dataId).values,w=new Float32Array(i*p*f*g);let x=0;for(let v=0;v<i;++v)for(let k=0;k<p;++k){const I=Math.floor(k/o),N=k%o;for(let T=0;T<f;++T){const D=Math.floor(T/o),P=T%o,z=(N*o+P)*g;for(let F=0;F<g;++F){const E=F+z+h*(D+c*(I+l*v));w[x++]=y[E]}}}return t.makeTensorInfo([i,p,f,g],r.dtype,w)}const Mq={kernelName:Om,backendName:"cpu",kernelFunc:zq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yD(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:a,pad:i,dilations:l,dimRoundingMode:c}=s;De([r,o],"depthwiseConv2DNative");const h=ze(r.shape),p=ze(o.shape);let f=l;f==null&&(f=[1,1]),A(Nn(a,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${a} and dilations '${f}'`);const g=fn(r.shape,o.shape,a,f,i,c,!0),{filterHeight:y,filterWidth:w,dilationHeight:x,dilationWidth:v,padInfo:k}=g,I=k.left,N=k.top,T=g.outChannels/g.inChannels,D=new Yt(g.outShape,r.dtype),P=t.data.get(r.dataId).values,z=t.data.get(o.dataId).values,F=D.values;for(let L=0;L<g.batchSize;++L){const E=L*h[0],j=L*D.strides[0];for(let Z=0;Z<g.outHeight;++Z){const ne=j+Z*D.strides[1],te=Z*g.strideHeight-N;for(let se=0;se<y;++se){const K=te+se*x;if(K<0||K>=g.inHeight)continue;const B=se*p[0],J=E+K*h[1];for(let X=0;X<g.outWidth;++X){const M=ne+X*D.strides[2],H=X*g.strideWidth-I;for(let le=0;le<w;++le){const he=H+le*v;if(he<0||he>=g.inWidth)continue;const pe=B+le*p[1],ge=J+he*g.inChannels;let Se=M,Ne=pe;for(let Ie=0;Ie<g.inChannels;++Ie){const Be=P[ge+Ie];for(let Ge=0;Ge<T;++Ge)F[Se+Ge]+=Be*z[Ne+Ge];Se+=T,Ne+=T}}}}}}return t.makeTensorInfo(D.shape,D.dtype,D.values)}const Bq={kernelName:Rd,backendName:"cpu",kernelFunc:yD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:a,dilations:i,pad:l,dimRoundingMode:c,filterShape:h}=s;De([r,o],"depthwiseConv2dNativeBackpropFilter");const p=fn(r.shape,h,a,i,l,c,!0),{strideHeight:f,strideWidth:g,filterHeight:y,filterWidth:w}=p,x=new Yt(p.filterShape,"float32"),v=p.padInfo.left,k=p.padInfo.top,I=p.outChannels/p.inChannels,N=t.data.get(r.dataId).values,T=new Yt(r.shape,r.dtype,N),D=t.data.get(o.dataId).values,P=new Yt(o.shape,o.dtype,D);for(let z=0;z<y;++z){const F=Math.max(0,Math.ceil((k-z)/f)),L=Math.min(p.outHeight,(p.inHeight+k-z)/f);for(let E=0;E<w;++E){const j=Math.max(0,Math.ceil((v-E)/g)),Z=Math.min(p.outWidth,(p.inWidth+v-E)/g);for(let ne=0;ne<p.outChannels;++ne){const te=Math.trunc(ne/I),se=ne%I;let K=0;for(let B=0;B<p.batchSize;++B)for(let J=F;J<L;++J){const X=z+J*f-k;for(let M=j;M<Z;++M){const H=E+M*g-v;K+=T.get(B,X,H,te)*P.get(B,J,M,ne)}}x.set(K,z,E,te,se)}}}return t.makeTensorInfo(x.shape,x.dtype,x.values)}const Wq={kernelName:Fm,backendName:"cpu",kernelFunc:Vq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uq(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{strides:a,dilations:i,pad:l,dimRoundingMode:c,inputShape:h}=s;De([r,o],"depthwiseConv2DNativeBackpropInput");const p=ze(r.shape),f=ze(o.shape),g=fn(h,o.shape,a,i,l,c,!0),y=new Yt(g.inShape,"float32"),w=y.values,[x,v,k]=y.strides,I=t.data.get(r.dataId).values,[N,T,D]=p,P=t.data.get(o.dataId).values,[z,F,L]=f,{batchSize:E,filterHeight:j,filterWidth:Z,inChannels:ne,inHeight:te,inWidth:se,outChannels:K,outHeight:B,outWidth:J,strideHeight:X,strideWidth:M}=g,H=j-1-g.padInfo.top,le=Z-1-g.padInfo.left,he=K/ne;for(let pe=0;pe<E;++pe)for(let ge=0;ge<ne;++ge)for(let Se=0;Se<te;++Se){const Ne=Se-H,Ie=Math.max(0,Math.ceil(Ne/X)),Be=Math.min(B,(j+Ne)/X);for(let Ge=0;Ge<se;++Ge){const at=Ge-le,lt=Math.max(0,Math.ceil(at/M)),vt=Math.min(J,(Z+at)/M);let ht=0;for(let ut=Ie;ut<Be;++ut){const xt=ut*X-Ne;for(let bt=lt;bt<vt;++bt){const ks=bt*M-at,Rt=N*pe+T*ut+D*bt,qn=z*(j-1-xt)+F*(Z-1-ks)+L*ge;for(let Tn=0;Tn<he;++Tn){const $r=ge*he+Tn,as=I[Rt+$r],Ps=P[qn+Tn];ht+=as*Ps}}}w[x*pe+v*Se+k*Ge+ge]=ht}}return t.makeTensorInfo(y.shape,y.dtype,y.values)}const jq={kernelName:Lm,backendName:"cpu",kernelFunc:Uq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gq(n){const{inputs:e,backend:t}=n,{x:s}=e,r=ce(s.shape),o=t.data.get(s.dataId).values,a=qe([r,r],s.dtype),i=a.values;for(let c=0;c<o.length;c++)i[c*r+c]=o[c];const l=[...s.shape,...s.shape];return t.makeTensorInfo(l,a.dtype,a.values)}const Hq={kernelName:Pm,backendName:"cpu",kernelFunc:Gq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qq={kernelName:Ad,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r}=n,{strides:o,pad:a,dilations:i}=t,l=e,c=l.data.get(s.dataId).values,h=s.shape.length,p=l.data.get(r.dataId).values,f=r.shape.length,{batchSize:g,inHeight:y,inWidth:w,inChannels:x,outHeight:v,outWidth:k,padInfo:I,strideHeight:N,strideWidth:T,filterHeight:D,filterWidth:P,dilationHeight:z,dilationWidth:F,outShape:L}=wh(s.shape,r.shape,o,a,"NHWC",i),E=ce(L),j=L.length,Z=Mt(s.dtype,E);for(let te=0;te<g;++te)for(let se=0;se<v;++se){const K=se*N-I.top;for(let B=0;B<k;++B){const J=B*T-I.left;for(let X=0;X<x;++X){let M=Number.MIN_SAFE_INTEGER;for(let le=0;le<D;++le){const he=K+le*z;if(he>=0&&he<y)for(let pe=0;pe<P;++pe){const ge=J+pe*F;if(ge>=0&&ge<w){const Se=yr([te,he,ge,X],h,ze(s.shape)),Ne=yr([le,pe,X],f,ze(r.shape)),Ie=c[Se]+p[Ne];Ie>M&&(M=Ie)}}}const H=yr([te,se,B,X],j,ze(L));Z[H]=M}}}return{dataId:l.write(xa(Z,s.dtype),L,s.dtype),shape:L,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kq={kernelName:jf,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:o}=n,{strides:a,pad:i,dilations:l}=t,c=e,h=Ds(s.shape,c.data.get(s.dataId).values),p=Ds(r.shape,c.data.get(r.dataId).values),{batchSize:f,inHeight:g,inWidth:y,inChannels:w,outHeight:x,outWidth:v,padInfo:k,strideHeight:I,strideWidth:N,filterHeight:T,filterWidth:D,dilationHeight:P,dilationWidth:z,outShape:F}=wh(s.shape,r.shape,a,i,"NHWC",l);A(o.rank===F.length,()=>`Error in ${jf}, dy must have the same rank as output ${F.length}, but got ${o.rank}`);const L=Ds(F,c.data.get(o.dataId).values),E=pw(r.shape,r.dtype);for(let Z=0;Z<f;++Z)for(let ne=0;ne<x;++ne){const te=ne*I-k.top;for(let se=0;se<v;++se){const K=se*N-k.left;for(let B=0;B<w;++B){let J=Number.MIN_SAFE_INTEGER,X=0,M=0;for(let H=0;H<T;++H){const le=te+H*P;if(le>=0&&le<g)for(let he=0;he<D;++he){const pe=K+he*z;if(pe>=0&&pe<y){const ge=h[Z][le][pe][B]+p[H][he][B];ge>J&&(J=ge,X=H,M=he)}}}E[X][M][B]+=L[Z][ne][se][B]}}}return{dataId:c.write(xa(E,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xq={kernelName:Uf,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:o}=n,{strides:a,pad:i,dilations:l}=t,c=e,h=Ds(s.shape,c.data.get(s.dataId).values),p=Ds(r.shape,c.data.get(r.dataId).values),{batchSize:f,inHeight:g,inWidth:y,inChannels:w,outHeight:x,outWidth:v,padInfo:k,strideHeight:I,strideWidth:N,filterHeight:T,filterWidth:D,dilationHeight:P,dilationWidth:z,outShape:F}=wh(s.shape,r.shape,a,i,"NHWC",l);A(o.rank===F.length,()=>`Error in ${Uf}, dy must have the same rank as output ${F.length}, but got ${o.rank}`);const L=Ds(F,c.data.get(o.dataId).values),E=pw(s.shape,s.dtype);for(let Z=0;Z<f;++Z)for(let ne=0;ne<x;++ne){const te=ne*I-k.top;for(let se=0;se<v;++se){const K=se*N-k.left;for(let B=0;B<w;++B){let J=Number.MIN_SAFE_INTEGER,X=te<0?0:te,M=K<0?0:K;for(let H=0;H<T;++H){const le=te+H*P;if(le>=0&&le<g)for(let he=0;he<D;++he){const pe=K+he*z;if(pe>=0&&pe<y){const ge=h[Z][le][pe][B]+p[H][he][B];ge>J&&(J=ge,X=le,M=pe)}}}E[Z][X][M][B]+=L[Z][ne][se][B]}}}return{dataId:c.write(xa(E,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yq(n){const{inputs:e,backend:t,attrs:s}=n,{image:r}=e,{canvas:o,options:a}=s,{contextOptions:i,imageOptions:l}=a||{},c=(l==null?void 0:l.alpha)||1,h=(i==null?void 0:i.contextType)||"2d";if(h!=="2d")throw new Error(`Context type ${i.contextType} is not supported by the CPU backend.`);const p=o.getContext(h,(i==null?void 0:i.contextAttributes)||{});if(p==null)throw new Error(`Could not get the context with ${h} type.`);const[f,g]=r.shape.slice(0,2),y=r.shape.length===2?1:r.shape[2],w=t.data.get(r.dataId).values,x=r.dtype==="float32"?255:1,v=new Uint8ClampedArray(g*f*4);for(let I=0;I<f*g;++I){const N=[0,0,0,255*c];for(let D=0;D<y;D++){const P=w[I*y+D];if(r.dtype==="float32"){if(P<0||P>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${P}.`)}else if(r.dtype==="int32"&&(P<0||P>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${P}.`);y===1?(N[0]=P*x,N[1]=P*x,N[2]=P*x):N[D]=P*x}const T=I*4;v[T+0]=Math.round(N[0]),v[T+1]=Math.round(N[1]),v[T+2]=Math.round(N[2]),v[T+3]=Math.round(N[3])}o.width=g,o.height=f;const k=new ImageData(v,g,f);return p.putImageData(k,0,0),r}const Qq={kernelName:zm,backendName:"cpu",kernelFunc:Yq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kh(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:a}=s;De(r,"sum");let i;r.dtype==="bool"?i=ya({inputs:{x:r},backend:t,attrs:{dtype:"int32"}}):i=Kr({inputs:{x:r},backend:t});const l=i.shape.length,c=Qe(o,i.shape),h=Lt(c,l);let p=c,f=i;h!=null&&(f=rs({inputs:{x:i},backend:t,attrs:{perm:h}}),p=jt(p.length,l)),Cn("sum",p,f.shape.length);const[g,y]=mn(f.shape,p),w=Jn(f.dtype,"int32");let x=im(t,g,w);const v=ce(y),k=t.data.get(x.dataId).values,I=t.data.get(f.dataId).values;for(let N=0;N<k.length;++N){const T=N*v;let D=0;for(let P=0;P<v;++P)D+=I[T+P];k[N]=D}if(a){const N=Ut(x.shape,c),T=x;x=Nt({inputs:{x},backend:t,attrs:{shape:N}}),t.disposeIntermediateTensorInfo(T)}return t.disposeIntermediateTensorInfo(i),h!=null&&t.disposeIntermediateTensorInfo(f),x}const Zq={kernelName:ch,backendName:"cpu",kernelFunc:Kh};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jq(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,o=e,{allDims:a,summedDims:i,idDims:l}=sv(r,o.length);ov(a.length,l,o);const{path:c,steps:h}=av(i,l),p=h.length;let f=null,g=a.length;const y=[];for(let w=0;w<p;++w){for(const x of h[w]){const{permutationIndices:v,expandDims:k}=rv(g,l[x]);let I;iv(v)?I=o[x]:(I=rs({inputs:{x:o[x]},backend:t,attrs:{perm:v}}),y.push(I));const N=I.shape.slice();for(let T=0;T<k.length;++T)N.splice(k[T],0,1);Je(I.shape,N)||(I=Nt({inputs:{x:I},backend:t,attrs:{shape:N}}),y.push(I)),f===null?f=I:(f=$y({inputs:{a:I,b:f},backend:t}),y.push(f))}w<p-1&&(c[w]>=0&&(f=Kh({inputs:{x:f},backend:t,attrs:{axis:c[w]-(a.length-g),keepDims:!1}}),y.push(f)),g--)}for(const w of y)w!==f&&t.disposeIntermediateTensorInfo(w);return f}const e9={kernelName:Mm,backendName:"cpu",kernelFunc:Jq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t9(n){const{inputs:e,backend:t}=n,{dy:s,y:r}=e;De([s,r],"eluGrad");const o=new Float32Array(ce(r.shape)),a=t.data.get(r.dataId).values,i=t.data.get(s.dataId).values;for(let l=0;l<a.length;++l){const c=a[l];c>=0?o[l]=i[l]:o[l]=i[l]*(c+1)}return t.makeTensorInfo(r.shape,"float32",o)}const n9={kernelName:Bm,backendName:"cpu",kernelFunc:t9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s9=Y1,r9=Q1,o9=Z1,a9=J1,i9=ev,l9=tv,u9=ft(Yl,n=>{const e=Math.sign(n),t=Math.abs(n),s=1/(1+s9*t);return e*(1-((((l9*s+i9)*s+a9)*s+o9)*s+r9)*s*Math.exp(-t*t))}),c9={kernelName:Yl,backendName:"cpu",kernelFunc:u9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cm(n){const{inputs:e,backend:t,attrs:s}=n,{input:r}=e,{dim:o}=s,a=r.shape.length,i=r.shape.slice();let l=o;return o<0&&(A(-(a+1)<=o,()=>`Axis must be in the interval [${-(a+1)}, ${a}]`),l=a+o+1),i.splice(l,0,1),Nt({inputs:{x:r},backend:t,attrs:{shape:i}})}const d9={kernelName:_d,backendName:"cpu",kernelFunc:cm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h9=Ht((n,e)=>n/e),Bv=on(Kl,h9),Zb={kernelName:Kl,backendName:"cpu",kernelFunc:Bv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xD(n,e,t){const s=n.shape,r=s[0],o=s[1],a=t.data.get(n.dataId),i=a.complexTensorInfos.real,l=a.complexTensorInfos.imag,c=[r,o],h=ce(c),p=hn("float32",h),f=hn("float32",h);for(let x=0;x<r;x++){const v=wi({inputs:{x:i},backend:t,attrs:{begin:[x,0],size:[1,o]}}),k=wi({inputs:{x:l},backend:t,attrs:{begin:[x,0],size:[1,o]}}),I=gs({inputs:{real:v,imag:k},backend:t}),{real:N,imag:T}=p9(I,e,t),D=yo(N,T);for(let P=0;P<o;P++){const z=nv(D,P);p[x*o+P]=z.real,f[x*o+P]=z.imag}t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(I)}const g=t.makeTensorInfo(c,"float32",p),y=t.makeTensorInfo(c,"float32",f),w=gs({inputs:{real:g,imag:y},backend:t});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),w}function p9(n,e,t){const s=ce(n.shape),r=t.data.get(n.dataId),o=t.data.get(r.complexTensorInfos.real.dataId).values,a=t.data.get(r.complexTensorInfos.imag.dataId).values;if(f9(s)){const i=Jb(o,a,s,e,t),l=[n.shape[0],n.shape[1]];if(e){const c=t.makeTensorInfo(l,"float32",i.real),h=t.makeTensorInfo(l,"float32",i.imag),p=t.makeTensorInfo([],"float32",wo(s,"float32")),f=Kr({inputs:{x:p},backend:t}),g=Zb.kernelFunc({inputs:{a:c,b:p},backend:t}),y=Zb.kernelFunc({inputs:{a:h,b:f},backend:t}),w=t.data.get(g.dataId).values,x=t.data.get(y.dataId).values;return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),{real:w,imag:x}}return i}else{const i=yo(o,a),l=m9(i,s,e);return $T(l)}}function f9(n){return(n&n-1)===0}function Jb(n,e,t,s,r){if(t===1)return{real:n,imag:e};const o=yo(n,e),a=t/2,i=TT(o),l=i.real,c=i.imag,h=[l.length],p=r.makeTensorInfo(h,"float32",l),f=r.makeTensorInfo(h,"float32",c),g=gs({inputs:{real:p,imag:f},backend:r}),y=ET(o),w=y.real,x=y.imag,v=[w.length],k=r.makeTensorInfo(v,"float32",w),I=r.makeTensorInfo(v,"float32",x),N=gs({inputs:{real:k,imag:I},backend:r}),T=Jb(l,c,a,s,r),D=T.real,P=T.imag,z=[D.length],F=r.makeTensorInfo(z,"float32",D),L=r.makeTensorInfo(z,"float32",P),E=gs({inputs:{real:F,imag:L},backend:r}),j=Jb(w,x,a,s,r),Z=j.real,ne=j.imag,te=[Z.length],se=r.makeTensorInfo(te,"float32",Z),K=r.makeTensorInfo(te,"float32",ne),B=gs({inputs:{real:se,imag:K},backend:r}),J=AT(t,s),X=[J.real.length],M=r.makeTensorInfo(X,"float32",J.real),H=r.makeTensorInfo(X,"float32",J.imag),le=gs({inputs:{real:M,imag:H},backend:r}),he=$y({inputs:{a:le,b:B},backend:r}),pe=El({inputs:{a:E,b:he},backend:r}),ge=zv({inputs:{a:E,b:he},backend:r}),Se=bi({inputs:{input:pe},backend:r}),Ne=bi({inputs:{input:ge},backend:r}),Ie=Rl({inputs:{input:pe},backend:r}),Be=Rl({inputs:{input:ge},backend:r}),Ge=Al({inputs:[Se,Ne],backend:r,attrs:{axis:0}}),at=Al({inputs:[Ie,Be],backend:r,attrs:{axis:0}}),lt=r.data.get(Ge.dataId).values,vt=r.data.get(at.dataId).values;return r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(k),r.disposeIntermediateTensorInfo(I),r.disposeIntermediateTensorInfo(N),r.disposeIntermediateTensorInfo(F),r.disposeIntermediateTensorInfo(L),r.disposeIntermediateTensorInfo(E),r.disposeIntermediateTensorInfo(se),r.disposeIntermediateTensorInfo(K),r.disposeIntermediateTensorInfo(B),r.disposeIntermediateTensorInfo(M),r.disposeIntermediateTensorInfo(H),r.disposeIntermediateTensorInfo(le),r.disposeIntermediateTensorInfo(he),r.disposeIntermediateTensorInfo(pe),r.disposeIntermediateTensorInfo(ge),r.disposeIntermediateTensorInfo(Se),r.disposeIntermediateTensorInfo(Ie),r.disposeIntermediateTensorInfo(Ne),r.disposeIntermediateTensorInfo(Be),r.disposeIntermediateTensorInfo(Ge),r.disposeIntermediateTensorInfo(at),{real:lt,imag:vt}}function m9(n,e,t){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let o=0,a=0;for(let i=0;i<e;i++){const l=DT(r*i,e,t),c=nv(n,i);o+=c.real*l.real-c.imag*l.imag,a+=c.real*l.imag+c.imag*l.real}t&&(o/=e,a/=e),RT(s,o,a,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g9(n){const{inputs:e,backend:t}=n,{input:s}=e,r=ce(s.shape),o=s.shape[s.shape.length-1],a=r/o,i=Nt({inputs:{x:s},backend:t,attrs:{shape:[a,o]}}),l=xD(i,!1,t),c=Nt({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(l),c}const y9={kernelName:Vm,backendName:"cpu",kernelFunc:g9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vv(n){const{backend:e,attrs:t}=n,{shape:s,value:r,dtype:o}=t,a=o||Ci(r),i=Mt(a,ce(s));return b9(i,r,a),e.makeTensorInfo(s,a,i)}const x9={kernelName:Wm,backendName:"cpu",kernelFunc:Vv};function b9(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w9={kernelName:Um,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,r=t,o=hn(s.dtype,ce(s.shape)),[a,i,l,c]=s.shape,h=r.data.get(s.dataId).values;for(let f=0;f<a;f++){const g=f*l*i*c;for(let y=0;y<i;y++){const w=y*(l*c);for(let x=0;x<l;x++){const v=x*c;for(let k=0;k<c;k++){const I=Math.round(l-x-1),N=g+w+v+k;let T=h[N];if(I>=0&&I<l){const D=I*c,P=g+w+D+k;T=h[P]}o[N]=T}}}}return{dataId:r.write(o,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v9(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:a,preluActivationWeights:i}=e,{strides:l,pad:c,dataFormat:h,dilations:p,dimRoundingMode:f,activation:g,leakyreluAlpha:y}=s;let w=gD({inputs:{x:r,filter:o},backend:t,attrs:{strides:l,pad:c,dataFormat:h,dilations:p,dimRoundingMode:f}});if(a){const x=w;if(h==="NCHW"&&a.shape.length===1&&a.shape[0]!==1){const v=Nt({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});w=El({inputs:{a:w,b:v},backend:t}),t.disposeIntermediateTensorInfo(v)}else w=El({inputs:{a:w,b:a},backend:t});t.disposeIntermediateTensorInfo(x)}if(g){const x=w;if(h==="NCHW"&&g==="prelu"&&i.shape.length===1&&i.shape[0]!==1){const v=Nt({inputs:{x:i},backend:t,attrs:{shape:[i.shape[0],1,1]}});w=um(t,w,g,v,y),t.disposeIntermediateTensorInfo(v)}else w=um(t,w,g,i,y);t.disposeIntermediateTensorInfo(x)}return w}const k9={kernelName:Kc,backendName:"cpu",kernelFunc:v9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S9(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:a,preluActivationWeights:i}=e,{strides:l,pad:c,dataFormat:h,dilations:p,dimRoundingMode:f,activation:g,leakyreluAlpha:y}=s;let w=yD({inputs:{x:r,filter:o},backend:t,attrs:{strides:l,pad:c,dataFormat:h,dilations:p,dimRoundingMode:f}});if(a){const x=w;w=El({inputs:{a:w,b:a},backend:t}),t.disposeIntermediateTensorInfo(x)}if(g){const x=w;w=um(t,w,g,i,y),t.disposeIntermediateTensorInfo(x)}return w}const N9={kernelName:Xc,backendName:"cpu",kernelFunc:S9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C9(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,o=ce(s.shape),a=r.shape,i=a[a.length-1],[l,c,h,p]=dy(s,r);if(c===0)return t.makeTensorInfo(l,s.dtype,[]);const f=t.data.get(r.dataId).values,g=t.bufferSync(s),y=TA(f,g,s.dtype,c,i,h,p,s.shape,o);return t.makeTensorInfo(l,s.dtype,y.values)}const I9={kernelName:jm,backendName:"cpu",kernelFunc:C9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $9(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:o}=e,{axis:a,batchDims:i}=s;De([r,o],"gatherV2");const l=Qe(a,r.shape)[0],c=t.data.get(o.dataId).values,h=r.shape[l];for(let N=0;N<c.length;++N){const T=c[N];A(T<=h-1&&T>=0,()=>`GatherV2: the index value ${T} is not in [0, ${h-1}]`)}let p=i;i==null&&(p=0);const f=ce(o.shape),g=uv(r,o,l,p),y=Nt({inputs:{x:r},backend:t,attrs:{shape:[g.batchSize,g.outerSize,g.dimSize,g.sliceSize]}}),w=Nt({inputs:{x:o},backend:t,attrs:{shape:[g.batchSize,f/g.batchSize]}}),x=[g.batchSize,g.outerSize,f/g.batchSize,g.sliceSize],v=t.bufferSync(w),k=t.bufferSync(y),I=EA(k,v,x);return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),t.makeTensorInfo(g.outputShape,I.dtype,I.values)}const T9={kernelName:Fd,backendName:"cpu",kernelFunc:$9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E9(n){const{inputs:e,backend:t}=n,{input:s}=e,r=ce(s.shape),o=s.shape[s.shape.length-1],a=r/o,i=Nt({inputs:{x:s},backend:t,attrs:{shape:[a,o]}}),l=xD(i,!0,t),c=Nt({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(l),c}const R9={kernelName:Gm,backendName:"cpu",kernelFunc:E9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A9=ft(su,n=>Number.isFinite(n)?1:0,"bool"),D9={kernelName:su,backendName:"cpu",kernelFunc:A9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _9=ft(ru,n=>Math.abs(n)===1/0?1:0,"bool"),O9={kernelName:ru,backendName:"cpu",kernelFunc:_9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F9=ft(ou,n=>Number.isNaN(n)?1:0,"bool"),L9={kernelName:ou,backendName:"cpu",kernelFunc:F9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P9(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:o}=t,a=OA(s,r,o);return e.makeTensorInfo([a.length],"float32",a)}const z9={kernelName:qm,backendName:"cpu",kernelFunc:P9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M9=ft(iu,n=>Math.log1p(n)),B9={kernelName:iu,backendName:"cpu",kernelFunc:M9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V9=Ht((n,e)=>n&&e),W9=on(Bd,V9,null,"bool"),U9={kernelName:Bd,backendName:"cpu",kernelFunc:W9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j9=ft(Vd,n=>n?0:1,"bool"),G9={kernelName:Vd,backendName:"cpu",kernelFunc:j9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H9=Ht((n,e)=>n||e),q9=on(Wd,H9,null,"bool"),K9={kernelName:Wd,backendName:"cpu",kernelFunc:q9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X9(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:o,bias:a,alpha:i,beta:l}=s;De(r,"LRN");const c=r.shape[3],h=c-1,p=t.data.get(r.dataId).values,f=ce(r.shape),g=new Float32Array(f);function y(w){const x=w%c;let v=w-x+Math.max(0,x-o);const k=w-x+Math.min(x+o,h);let I=0;for(;v<=k;v++){const N=p[v];I+=N*N}return I}for(let w=0;w<f;w++){const x=y(w),v=p[w]*Math.pow(a+i*x,-l);g[w]=v}return t.makeTensorInfo(r.shape,r.dtype,g)}const Y9={kernelName:Ud,backendName:"cpu",kernelFunc:X9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q9(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,y:o,dy:a}=e,{depthRadius:i,bias:l,alpha:c,beta:h}=s;De(a,"LRNGrad");const p=ce(a.shape),f=a.shape[3],g=t.data.get(a.dataId).values,y=t.data.get(r.dataId).values,w=t.data.get(o.dataId).values,x=new Float32Array(p),v=p;for(let k=0;k<v;k++){const I=k%f,N=k-I+Math.max(0,I-i),T=k-I+Math.min(f,I+i+1);let D=0;for(let P=N;P<T;P++)D+=Math.pow(y[P],2);D=c*D+l;for(let P=N;P<T;P++){let z=-2*c*h*y[P]*w[k]/D;k===P&&(z+=Math.pow(D,-h)),z*=g[k],x[P]+=z}}return t.makeTensorInfo(a.shape,r.dtype,x)}const Z9={kernelName:Km,backendName:"cpu",kernelFunc:Q9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bD(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:o,keepDims:a}=s,i=t;let l=r.shape;const c=l.length,h=Qe(o,l);let p=h;const f=Lt(p,c);let g=i.data.get(r.dataId).values;if(f!=null){const N=new Array(c);for(let T=0;T<N.length;T++)N[T]=l[f[T]];g=Lv(g,l,r.dtype,f,N),p=jt(p.length,c),l=N}De(r,"max"),Cn("max",p,c);const[y,w]=mn(l,p),x=ce(w),v=LA(g,x,y,r.dtype),k=i.write(v,y,r.dtype);let I=y;return a&&(I=Ut(y,h)),{dataId:k,shape:I,dtype:r.dtype}}const J9={kernelName:jd,backendName:"cpu",kernelFunc:bD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;De(r,"maxPool");const{filterSize:o,strides:a,pad:i,dimRoundingMode:l}=s,c=1;A(Nn(a,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${a} and dilations '${c}'`);const h=er(r.shape,o,a,c,i,l);let p;if(h.filterWidth===1&&h.filterHeight===1&&Je(h.inShape,h.outShape))p=Kr({inputs:{x:r},backend:t});else{const f=t.data.get(r.dataId).values,g=ze(r.shape),y=Mv(f,r.shape,r.dtype,g,h,"max");p=t.makeTensorInfo(h.outShape,r.dtype,y.values)}return p}const tK={kernelName:Gd,backendName:"cpu",kernelFunc:eK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:a,pad:i,dimRoundingMode:l,dataFormat:c}=s;De(r,"maxPool3d");const h=vo(r.shape,o,a,1,i,l,c),p=t.data.get(r.dataId).values,f=mD(p,r.shape,r.dtype,ze(r.shape),h,"max");return t.makeTensorInfo(f.shape,"float32",f.values)}const sK={kernelName:Hd,backendName:"cpu",kernelFunc:nK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rK(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,{filterSize:a,strides:i,pad:l,dimRoundingMode:c}=s;De([r,o],"maxPool3DGrad");const h=vo(o.shape,a,i,1,l,c),p=t.bufferSync(o),f=H7(p,h),g=h.strideDepth,y=h.strideHeight,w=h.strideWidth,x=h.dilationDepth,v=h.dilationHeight,k=h.dilationWidth,I=h.effectiveFilterDepth,N=h.effectiveFilterHeight,T=h.effectiveFilterWidth,D=I-1-h.padInfo.front,P=T-1-h.padInfo.left,z=N-1-h.padInfo.top,F=qe(o.shape,"float32"),L=t.bufferSync(r);for(let E=0;E<h.batchSize;++E)for(let j=0;j<h.inChannels;++j)for(let Z=0;Z<h.inDepth;++Z)for(let ne=0;ne<h.inHeight;++ne)for(let te=0;te<h.inWidth;++te){const se=Z-D,K=ne-z,B=te-P;let J=0;for(let X=0;X<I;X+=x){const M=(se+X)/g;if(!(M<0||M>=h.outDepth||Math.floor(M)!==M))for(let H=0;H<N;H+=v){const le=(K+H)/y;if(!(le<0||le>=h.outHeight||Math.floor(le)!==le))for(let he=0;he<T;he+=k){const pe=(B+he)/w;if(pe<0||pe>=h.outWidth||Math.floor(pe)!==pe)continue;const ge=I*N*T-1-f.get(E,M,le,pe,j),Se=X*N*T+H*T+he,Ne=ge===Se?1:0;if(Ne===0)continue;const Ie=L.get(E,M,le,pe,j);J+=Ie*Ne}}}F.set(J,E,Z,ne,te,j)}return t.makeTensorInfo(F.shape,F.dtype,F.values)}const oK={kernelName:Ym,backendName:"cpu",kernelFunc:rK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aK(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o,output:a}=e,i=o;De([o,a],"maxPoolGrad");const{filterSize:l,strides:c,pad:h,dimRoundingMode:p}=s,f=er(i.shape,l,c,1,h,p),g=t.data.get(i.dataId).values,y=qe(f.outShape,i.dtype,fD(g,i.shape,i.dtype,f).values),w=f.strideHeight,x=f.strideWidth,v=f.dilationHeight,k=f.dilationWidth,I=f.effectiveFilterHeight,N=f.effectiveFilterWidth,T=N-1-f.padInfo.left,D=I-1-f.padInfo.top,P=qe(i.shape,"float32"),z=t.data.get(r.dataId).values,F=qe(r.shape,"float32",z);for(let L=0;L<f.batchSize;++L)for(let E=0;E<f.inChannels;++E)for(let j=0;j<f.inHeight;++j)for(let Z=0;Z<f.inWidth;++Z){const ne=j-D,te=Z-T;let se=0;for(let K=0;K<I;K+=v){const B=(ne+K)/w;if(!(B<0||B>=f.outHeight||Math.floor(B)!==B))for(let J=0;J<N;J+=k){const X=(te+J)/x;if(X<0||X>=f.outWidth||Math.floor(X)!==X)continue;const M=I*N-1-y.get(L,B,X,E),H=K*N+J,le=M===H?1:0;if(le===0)continue;const he=F.get(L,B,X,E);se+=he*le}}P.set(se,L,j,Z,E)}return t.makeTensorInfo(P.shape,P.dtype,P.values)}const iK={kernelName:Xm,backendName:"cpu",kernelFunc:aK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lK(n,e,t,s,r){const o=ze(e),a=Mv(n,e,t,o,r,"max"),i=fD(n,e,t,r,!0,s);return[a.values,i.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uK={kernelName:Qm,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:o,pad:a,includeBatchInIndex:i}=e,l=t;De(s,"MaxPoolWithArgmax");const c=l.data.get(s.dataId).values,h=er(s.shape,r,o,[1,1],a),[p,f]=lK(c,s.shape,s.dtype,i,h),g=l.write(p,h.outShape,s.dtype),y=l.write(f,h.outShape,s.dtype);return[{dataId:g,shape:h.outShape,dtype:s.dtype},{dataId:y,shape:h.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:a}=s,i=Qe(o,r.shape),c=mn(r.shape,i)[1],h=ce(c),p=[],f=t.makeTensorInfo([],"float32",new Float32Array([h]));p.push(f);const g=ya({inputs:{x:r},backend:t,attrs:{dtype:"float32"}});p.push(g);const y=Bv({inputs:{a:g,b:f},backend:t});p.push(y);const w=Kh({inputs:{x:y},backend:t,attrs:{axis:o,keepDims:a}});return p.forEach(x=>t.disposeIntermediateTensorInfo(x)),w}const dK={kernelName:qd,backendName:"cpu",kernelFunc:cK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:a}=s;De(r,"min");const i=Qe(o,r.shape);let l=i;const c=Lt(l,r.shape.length);let h=r;c!=null&&(h=rs({inputs:{x:r},backend:t,attrs:{perm:c}}),l=jt(l.length,r.shape.length)),Cn("min",l,h.shape.length);const[p,f]=mn(h.shape,l),g=ce(f),y=kn(ce(p),h.dtype),w=t.data.get(h.dataId).values;for(let v=0;v<y.length;++v){const k=v*g;let I=w[k];for(let N=0;N<g;++N){const T=w[k+N];(Number.isNaN(T)||T<I)&&(I=T)}y[v]=I}c!=null&&t.disposeIntermediateTensorInfo(h);const x=t.makeTensorInfo(p,h.dtype,y);if(a){const v=Ut(p,i),k=Nt({inputs:{x},backend:t,attrs:{shape:v}});return t.disposeIntermediateTensorInfo(x),k}return x}const pK={kernelName:Kd,backendName:"cpu",kernelFunc:hK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,mode:a}=s;De(r,"mirrorPad");const i=o.map((I,N)=>I[0]+r.shape[N]+I[1]),l=o.map(I=>I[0]),c=o.map((I,N)=>I[0]+r.shape[N]),h=a==="reflect"?0:1,p=t.data.get(r.dataId).values,f=r.shape.length,g=ze(r.shape),y=ce(i),w=i.length,x=ze(i),v=hn(r.dtype,y);for(let I=0;I<y;I++){let N=Ii(I,w,x);for(let D=0;D<w;D++)N[D]<l[D]?N[D]=l[D]*2-N[D]-h:N[D]>=c[D]&&(N[D]=(c[D]-1)*2-N[D]+h);N=N.map((D,P)=>D-l[P]);const T=yr(N,f,g);v[I]=p[T]}return{dataId:t.write(v,i,r.dtype),shape:i,dtype:r.dtype}}const mK={kernelName:Xd,backendName:"cpu",kernelFunc:fK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gK=Ht((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e}),yK=on(cu,gK),xK={kernelName:cu,backendName:"cpu",kernelFunc:yK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wD(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:o}=s,a=r.shape.length;let i=o;if(i===-1&&(i=a-1),i!==a-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${a} and dim was ${i}`);const l=Qe([i],r.shape),c=bD({inputs:{x:r},backend:t,attrs:{reductionIndices:l,keepDims:!1}}),h=Ut(c.shape,l),p=Nt({inputs:{x:c},backend:t,attrs:{shape:h}}),f=zv({inputs:{a:r,b:p},backend:t}),g=NA({inputs:{x:f},backend:t}),y=Kh({inputs:{x:g},backend:t,attrs:{axis:l,keepDims:!1}}),w=Nt({inputs:{x:y},backend:t,attrs:{shape:h}}),x=Bv({inputs:{a:g,b:w},backend:t});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),x}const bK={kernelName:ph,backendName:"cpu",kernelFunc:wD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wK(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:o,seed:a,normalized:i}=s;De(r,"multinomial");const l=i?r:wD({inputs:{logits:r},backend:t,attrs:{dim:-1}}),c=l.shape[0],h=l.shape[1],p=t.data.get(l.dataId).values,f=[c,o],g=kn(ce(f),"int32");for(let y=0;y<c;++y){const w=y*h,x=new Float32Array(h-1);x[0]=p[w];for(let I=1;I<x.length;++I)x[I]=x[I-1]+p[w+I];const v=Bg.alea(a.toString()),k=y*o;for(let I=0;I<o;++I){const N=v();g[k+I]=x.length;for(let T=0;T<x.length;T++)if(N<x[T]){g[k+I]=T;break}}}return i||t.disposeIntermediateTensorInfo(l),t.makeTensorInfo(f,"int32",g)}const vK={kernelName:Zm,backendName:"cpu",kernelFunc:wK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kK=iy;function SK(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:a,iouThreshold:i,scoreThreshold:l}=s;De(r,"NonMaxSuppression");const c=t.data.get(r.dataId).values,h=t.data.get(o.dataId).values,{selectedIndices:p}=kK(c,h,a,i,l);return t.makeTensorInfo([p.length],"int32",new Int32Array(p))}const NK={kernelName:Jm,backendName:"cpu",kernelFunc:SK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CK=ly;function IK(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:a,iouThreshold:i,scoreThreshold:l,padToMaxOutputSize:c}=s;De(r,"NonMaxSuppressionPadded");const h=t.data.get(r.dataId).values,p=t.data.get(o.dataId).values,{selectedIndices:f,validOutputs:g}=CK(h,p,a,i,l,c);return[t.makeTensorInfo([f.length],"int32",new Int32Array(f)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const $K={kernelName:eg,backendName:"cpu",kernelFunc:IK};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TK=uy;function EK(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:a,iouThreshold:i,scoreThreshold:l,softNmsSigma:c}=s;De(r,"NonMaxSuppressionWithScore");const h=t.data.get(r.dataId).values,p=t.data.get(o.dataId).values,f=a,g=i,y=l,w=c,{selectedIndices:x,selectedScores:v}=TK(h,p,f,g,y,w);return[t.makeTensorInfo([x.length],"int32",new Int32Array(x)),t.makeTensorInfo([v.length],"float32",new Float32Array(v))]}const RK={kernelName:tg,backendName:"cpu",kernelFunc:EK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AK(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:o,depth:a,onValue:i,offValue:l}=s;De(r,"oneHot");const c=ce(r.shape),h=new Float32Array(c*a);h.fill(l);const p=t.data.get(r.dataId).values;for(let f=0;f<c;++f)p[f]>=0&&p[f]<a&&(h[f*a+p[f]]=i);return t.makeTensorInfo([...r.shape,a],o,h)}const DK={kernelName:Jd,backendName:"cpu",kernelFunc:AK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dm(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=bi({inputs:{input:s},backend:t}),o=dm({inputs:{x:r},backend:t}),a=Rl({inputs:{input:s},backend:t}),i=dm({inputs:{x:a},backend:t}),l=gs({inputs:{real:o,imag:i},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),l}else return Vv({backend:t,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const _K={kernelName:yh,backendName:"cpu",kernelFunc:dm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vD(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=bi({inputs:{input:s},backend:t}),o=vD({inputs:{x:r},backend:t}),a=Rl({inputs:{input:s},backend:t}),i=dm({inputs:{x:a},backend:t}),l=gs({inputs:{real:o,imag:i},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),l}else return Vv({backend:t,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const OK={kernelName:Zd,backendName:"cpu",kernelFunc:vD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kD(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return cm({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const o=e[0].shape,a=e[0].dtype;e.forEach(h=>{Sn(o,h.shape,"All tensors passed to stack must have matching shapes"),A(a===h.dtype,()=>"All tensors passed to stack must have matching dtypes")});const i=[],l=e.map(h=>{const p=cm({inputs:{input:h},backend:t,attrs:{dim:r}});return i.push(p),p}),c=Al({inputs:l,backend:t,attrs:{axis:r}});return i.forEach(h=>t.disposeIntermediateTensorInfo(h)),c}const FK={kernelName:eh,backendName:"cpu",kernelFunc:kD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,constantValue:a}=s;De(r,"pad");const i=o.map((k,I)=>k[0]+r.shape[I]+k[1]),l=o.map(k=>k[0]),c=t.data.get(r.dataId).values,h=ce(r.shape),p=r.shape.length,f=ze(r.shape),g=ce(i),y=i.length,w=ze(i),x=hn(r.dtype,g);a!==0&&x.fill(a);for(let k=0;k<h;k++){const N=Ii(k,p,f).map((D,P)=>D+l[P]),T=yr(N,y,w);x[T]=c[k]}return{dataId:t.write(x,i,r.dtype),shape:i,dtype:r.dtype}}const SD={kernelName:th,backendName:"cpu",kernelFunc:LK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PK=Ht((n,e)=>Math.pow(n,e)),zK=on(hu,PK),MK={kernelName:hu,backendName:"cpu",kernelFunc:zK};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BK(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:o,indices:a}=e,{outputRaggedRank:i}=s,l=r.map(v=>t.data.get(v.dataId).values),c=r.map(v=>v.shape),h=t.data.get(o.dataId).values,p=t.data.get(a.dataId).values,[f,g,y]=WA(l,c,h,o.shape,o.dtype,p,a.shape),w=f.map(v=>t.makeTensorInfo([v.length],"int32",v)),x=t.makeTensorInfo(y,o.dtype,g);return w.concat([x])}const VK={kernelName:ng,backendName:"cpu",kernelFunc:BK};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WK(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:o}=e,a=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,[c,h]=UA(a,s.shape,s.dtype,i,r.shape,l,o.shape),p=t.makeTensorInfo([c.length],"int32",c),f=t.makeTensorInfo([h.length],s.dtype,h);return[p,f]}const UK={kernelName:sg,backendName:"cpu",kernelFunc:WK};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jK(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:o,defaultValue:a,rowPartitionTensors:i}=e,{rowPartitionTypes:l}=s,c=t.data.get(r.dataId).values,h=t.data.get(o.dataId).values,p=t.data.get(a.dataId).values,f=i.map(x=>t.data.get(x.dataId).values),g=i.map(x=>x.shape),[y,w]=jA(c,r.shape,h,o.shape,o.dtype,p,a.shape,f,g,l);return t.makeTensorInfo(y,o.dtype,w)}const GK={kernelName:rg,backendName:"cpu",kernelFunc:jK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HK(n){const{backend:e,attrs:t}=n,{start:s,stop:r,dtype:o,step:a}=t,i=GA(s,r,a,o);return e.makeTensorInfo([i.length],o,i)}const qK={kernelName:og,backendName:"cpu",kernelFunc:HK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KK=ft(pu,n=>1/n),XK={kernelName:pu,backendName:"cpu",kernelFunc:KK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YK(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:a,size:i}=s;De(r,"resizeBilinear");const l=ze(r.shape),[c,h]=i,[p,f,g,y]=r.shape,w=t.data.get(r.dataId).values,x=new Float32Array(ce([p,c,h,y])),v=[o&&c>1?f-1:f,o&&h>1?g-1:g],k=[o&&c>1?c-1:c,o&&h>1?h-1:h];let I=0;const N=v[0]/k[0],T=v[1]/k[1];for(let D=0;D<p;D++)for(let P=0;P<c;P++){let z;a?z=N*(P+.5)-.5:z=N*P;const F=Math.max(0,Math.floor(z)),L=z-F,E=Math.min(f-1,Math.ceil(z)),j=D*l[0]+F*l[1],Z=D*l[0]+E*l[1];for(let ne=0;ne<h;ne++){let te;a?te=T*(ne+.5)-.5:te=T*ne;const se=Math.max(0,Math.floor(te)),K=te-se,B=Math.min(g-1,Math.ceil(te)),J=j+se*l[2],X=Z+se*l[2],M=j+B*l[2],H=Z+B*l[2];for(let le=0;le<y;le++){const he=w[J+le],pe=w[X+le],ge=w[M+le],Se=w[H+le],Ne=he+(ge-he)*K,Ie=pe+(Se-pe)*K,Be=Ne+(Ie-Ne)*L;x[I++]=Be}}}return t.makeTensorInfo([p,c,h,y],"float32",x)}const QK={kernelName:ah,backendName:"cpu",kernelFunc:YK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZK(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:a}=s;De([o,r],"resizeBilinearGrad");const i=ze(r.shape),[l,c,h,p]=r.shape,[,f,g]=o.shape,y=new Float32Array(l*c*h*p),w=[a&&f>1?c-1:c,a&&g>1?h-1:h],x=[a&&f>1?f-1:f,a&&g>1?g-1:g],v=w[0]/x[0],k=w[1]/x[1],I=t.data.get(o.dataId).values;let N=0;for(let T=0;T<l;T++){const D=T*i[0];for(let P=0;P<f;P++){const z=P*v,F=Math.floor(z),L=Math.min(Math.ceil(z),c-1),E=D+F*i[1],j=D+L*i[1],Z=z-F,ne=1-Z;for(let te=0;te<g;te++){const se=te*k,K=Math.floor(se),B=Math.min(Math.ceil(se),h-1),J=se-K,X=1-J,M=E+K*i[2],H=E+B*i[2],le=j+K*i[2],he=j+B*i[2],pe=ne*X,ge=ne*J,Se=Z*X,Ne=Z*J;for(let Ie=0;Ie<p;Ie++){const Be=I[N++];y[M+Ie]+=Be*pe,y[H+Ie]+=Be*ge,y[le+Ie]+=Be*Se,y[he+Ie]+=Be*Ne}}}}return t.makeTensorInfo([l,h,c,p],"float32",y)}const JK={kernelName:lg,backendName:"cpu",kernelFunc:ZK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eX(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:a,size:i}=s;De(r,"resizeNearestNeighbor");const l=ze(r.shape),[c,h]=i,[p,f,g,y]=r.shape,w=t.data.get(r.dataId).values,x=new Float32Array(p*c*h*y),v=[o&&c>1?f-1:f,o&&h>1?g-1:g],k=[o&&c>1?c-1:c,o&&h>1?h-1:h],I=v[0]/k[0],N=v[1]/k[1];let T=0;for(let D=0;D<p;D++){const P=D*l[0];for(let z=0;z<c;z++){const F=a?I*(z+.5):I*z;let L=Math.min(f-1,o?Math.round(F):Math.floor(F));a&&(L=Math.max(0,L));const E=P+L*l[1];for(let j=0;j<h;j++){const Z=a?N*(j+.5):N*j;let ne=Math.min(g-1,o?Math.round(Z):Math.floor(Z));a&&(ne=Math.max(0,ne));const te=E+ne*l[2];for(let se=0;se<y;se++){const K=w[te+se];x[T++]=K}}}}return t.makeTensorInfo([p,c,h,y],r.dtype,x)}const tX={kernelName:oh,backendName:"cpu",kernelFunc:eX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nX(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:a}=s;De([o,r],"resizeNearestNeighborGrad");const i=ze(r.shape),l=ze(o.shape),[c,h,p,f]=r.shape,[,g,y]=o.shape,w=new Float32Array(c*h*p*f),x=t.data.get(o.dataId).values,v=[a&&g>1?h-1:h,a&&y>1?p-1:p],k=[a&&g>1?g-1:g,a&&y>1?y-1:y],I=v[0]/k[0],N=v[1]/k[1],T=1/I,D=1/N,P=Math.ceil(T)*2+2,z=Math.ceil(D)*2+2;for(let F=0;F<c;F++){const L=F*i[0];for(let E=0;E<h;E++){const j=L+E*i[1],Z=Math.floor(E*T),ne=Math.floor(Z-P/2);for(let te=0;te<p;te++){const se=j+te*i[2],K=Math.floor(te*D),B=Math.floor(K-z/2);for(let J=0;J<f;J++){let X=0;for(let M=0;M<P;M++){const H=M+ne;if(H<0||H>=g)continue;const le=L+H*l[1],he=H*I,pe=Math.min(h-1,a?Math.round(he):Math.floor(he));if(E===pe)for(let ge=0;ge<z;ge++){const Se=ge+B;if(Se<0||Se>=y)continue;const Ne=le+Se*l[2],Ie=Se*N,Be=Math.min(p-1,a?Math.round(Ie):Math.floor(Ie));te===Be&&(X+=x[Ne+J])}}w[se+J]=X}}}}return t.makeTensorInfo(r.shape,r.dtype,w)}const sX={kernelName:ig,backendName:"cpu",kernelFunc:nX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:o}=s;De(r,"reverse");const a=r.shape.length,i=Qe(o,r.shape);if(a===0)return Kr({inputs:{x:r},backend:t});const l=new Yt(r.shape,r.dtype),c=t.bufferSync(r);for(let h=0;h<l.size;h++){const p=l.indexToLoc(h),f=p.slice();i.forEach(g=>f[g]=r.shape[g]-1-f[g]),l.set(c.get(...f),...p)}return t.makeTensorInfo(l.shape,l.dtype,l.values)}const oX={kernelName:ih,backendName:"cpu",kernelFunc:rX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aX={kernelName:Cg,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:o,center:a}=e,i=t,l=hn(s.dtype,ce(s.shape)),[c,h,p,f]=s.shape,[g,y]=q1(a,h,p),w=255,x=Math.sin(r),v=Math.cos(r),k=i.data.get(s.dataId).values;for(let N=0;N<c;N++){const T=N*p*h*f;for(let D=0;D<h;D++){const P=D*(p*f);for(let z=0;z<p;z++){const F=z*f;for(let L=0;L<f;L++){const E=[c,D,z,L],j=E[2],Z=E[1];let ne=(j-g)*v-(Z-y)*x,te=(j-g)*x+(Z-y)*v;ne=Math.round(ne+g),te=Math.round(te+y);let se=o;if(typeof o!="number"&&(L===3?se=w:se=o[L]),ne>=0&&ne<p&&te>=0&&te<h){const B=te*(p*f),J=ne*f,X=T+B+J+L;se=k[X]}const K=T+P+F+L;l[K]=se}}}}return{dataId:i.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iX=ft(gu,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),lX={kernelName:gu,backendName:"cpu",kernelFunc:iX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uX(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:o}=e,{shape:a}=s,{sliceRank:i,numUpdates:l,sliceSize:c,strides:h,outputSize:p}=Na(o,r,a),f=!0,g=t.bufferSync(r),y=t.bufferSync(o),w=ei(g,y,a,p,c,l,i,h,0,f);return t.makeTensorInfo(a,w.dtype,w.values)}const cX={kernelName:ug,backendName:"cpu",kernelFunc:uX};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dX(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<e?t=r+1:s=r;return s}function hX(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<=e?t=r+1:s=r;return s}function pX(n,e,t,s,r,o){const a=Mt("int32",t*r);for(let i=0;i<t;++i){const l=n.slice(i*s,(i+1)*s),c=i*r;for(let h=0;h<r;++h)a[c+h]=o==="left"?dX(l,e[h+c]):hX(l,e[h+c])}return a}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fX(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:o}=e,{side:a}=s,i=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,c=pX(i,l,r.shape[0],r.shape[1],o.shape[1],a);return t.makeTensorInfo(o.shape,"int32",c)}const mX={kernelName:dg,backendName:"cpu",kernelFunc:fX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gX(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:o}=e;De([s,r,o],"select");const a=s.shape.length,i=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,h=Jn(r.dtype,o.dtype),p=kn(ce(r.shape),h);let f=0;const g=a===0||a>1||r.shape.length===1?1:ce(r.shape.slice(1));for(let y=0;y<i.length;y++)for(let w=0;w<g;w++)i[y]===1?p[f++]=l[y]:p[f++]=c[y];return t.makeTensorInfo(r.shape,h,p)}const yX={kernelName:lh,backendName:"cpu",kernelFunc:gX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xX=fy,bX=my,wX=ft(xu,n=>n>=0?bX*n:xX*(Math.exp(n)-1)),vX={kernelName:xu,backendName:"cpu",kernelFunc:wX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kX=ft(vu,n=>n<0?-1:n>0?1:0),SX={kernelName:vu,backendName:"cpu",kernelFunc:kX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NX=ft(bu,n=>Math.sin(n)),CX={kernelName:bu,backendName:"cpu",kernelFunc:NX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IX=ft(wu,n=>Math.sinh(n)),$X={kernelName:wu,backendName:"cpu",kernelFunc:IX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TX=11920928955078125e-23,xI=Math.log(TX)+2,EX=ft(Su,n=>{const e=n>-xI,t=n<xI,s=Math.exp(n);let r;return t?r=s:e?r=n:r=Math.log(1+s),r}),RX={kernelName:Su,backendName:"cpu",kernelFunc:EX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,paddings:a}=s;De([r],"spaceToBatchND");const i=ce(o),l=[[0,0]];l.push(...a);for(let D=1+o.length;D<r.shape.length;++D)l.push([0,0]);const c=SD.kernelFunc({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),h=Ph(c.shape,o,i,!1),p=zh(h.length,o.length,!1),f=Mh(c.shape,o,i,!1),w=Nt({inputs:{x:c},backend:t,attrs:{shape:h}}),k=rs({inputs:{x:w},backend:t,attrs:{perm:p}}),T=Nt({inputs:{x:k},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(k),T}const DX={kernelName:dh,backendName:"cpu",kernelFunc:AX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _X(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:o,defaultValue:a}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(a.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${a.shape}`);const i=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,c=t.data.get(o.dataId).values,h=t.data.get(a.dataId).values[0],[p,f,g,y,w]=XA(i,s.shape,s.dtype,l,r.dtype,c,h);return[t.makeTensorInfo(f,s.dtype,p),t.makeTensorInfo([f[0]],r.dtype,g),t.makeTensorInfo([y.length],"bool",new Uint8Array(y.map(x=>Number(x)))),t.makeTensorInfo([w.length],s.dtype,new Int32Array(w))]}const OX={kernelName:hg,backendName:"cpu",kernelFunc:_X};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FX(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const a=Array.from(t.data.get(r.dataId).values),i=t.data.get(s.dataId).values,l=Array.from(t.data.get(o.dataId).values),[c,h,p]=YA(i,s.shape,s.dtype,a,l);return[t.makeTensorInfo(h,s.dtype,c),t.makeTensorInfo([p.length],o.dtype,new Int32Array(p))]}const LX={kernelName:pg,backendName:"cpu",kernelFunc:FX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PX(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const a=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,[c,h]=Pv(a,s.shape,s.dtype,i,l,!0);return t.makeTensorInfo(h,s.dtype,c)}const zX={kernelName:fg,backendName:"cpu",kernelFunc:PX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MX(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const a=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,[c,h]=Pv(a,s.shape,s.dtype,i,l);return t.makeTensorInfo(h,s.dtype,c)}const BX={kernelName:mg,backendName:"cpu",kernelFunc:MX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VX(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:o,defaultValue:a}=e,{outputShape:i}=s,{sliceRank:l,numUpdates:c,sliceSize:h,strides:p,outputSize:f}=Na(o,r,i),g=!1,y=t.bufferSync(r);let w;switch(o.dtype){case"bool":{const x=t.bufferSync(o),v=!!t.data.get(a.dataId).values[0];w=ei(y,x,i,f,h,c,l,p,v,g);break}case"float32":{const x=t.bufferSync(o),v=t.data.get(a.dataId).values[0];w=ei(y,x,i,f,h,c,l,p,v,g);break}case"int32":{const x=t.bufferSync(o),v=t.data.get(a.dataId).values[0];w=ei(y,x,i,f,h,c,l,p,v,g);break}case"string":{const x=t.bufferSync(o),v=fo(t.data.get(a.dataId).values[0]);w=ei(y,x,i,f,h,c,l,p,v,g);break}default:throw new Error(`Unsupported type ${o.dtype}`)}return t.makeTensorInfo(i,w.dtype,w.values)}const WX={kernelName:gg,backendName:"cpu",kernelFunc:VX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:o,axis:a}=s,i=Qe(a,r.shape)[0],l=lv(r,o,i),c=new Array(r.shape.length).fill(0),h=r.shape.slice();return l.map(p=>{const f=[...h];f[i]=p;const g=wi({inputs:{x:r},backend:t,attrs:{begin:c,size:f}});return c[i]+=p,g})}const jX={kernelName:hh,backendName:"cpu",kernelFunc:UX};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GX={kernelName:yg,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,s=e;De(t,"square");const r=s.data.get(t.dataId).values,o=new Float32Array(r.length);for(let i=0;i<r.length;++i){const l=r[i];o[i]=l*l}return{dataId:s.write(o,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HX=ft(Ru,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),qX={kernelName:Ru,backendName:"cpu",kernelFunc:HX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,end:a,strides:i,beginMask:l,endMask:c,ellipsisMask:h,newAxisMask:p,shrinkAxisMask:f}=s;De(r,"stridedSlice");const{finalShapeSparse:g,finalShape:y,isIdentity:w,sliceDim0:x,isSimpleSlice:v,begin:k,end:I,strides:N}=U1(r.shape,o,a,i,l,c,h,p,f);let T;if(w)T=Nt({inputs:{x:r},backend:t,attrs:{shape:y}});else if(x||v){A(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const D=B1(k,I,N),P=wi({inputs:{x:r},backend:t,attrs:{begin:k,size:D}});T=Nt({inputs:{x:P},backend:t,attrs:{shape:y}}),t.disposeIntermediateTensorInfo(P)}else{const D=t.bufferSync(r),P=JA(g,D,N,k);T=t.makeTensorInfo(y,P.dtype,P.values)}return T}const XX={kernelName:xg,backendName:"cpu",kernelFunc:KX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YX(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:o,leftPad:a,rightPad:i,padWidth:l,preserveShortSequences:c}=s,{data:h,dataSplits:p}=e,f=t.data.get(h.dataId).values,g=t.data.get(p.dataId).values,[y,w]=eD(f,g,r,o,a,i,l,c);return[t.makeTensorInfo([y.length],"string",y),t.makeTensorInfo(p.shape,"int32",w)]}const QX={kernelName:bg,backendName:"cpu",kernelFunc:YX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZX(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:o,delimiter:a}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(a.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${a.shape}`);const i=t.data.get(o.dataId).values,l=t.data.get(a.dataId).values[0],[c,h,p]=tD(i,l,r),f=h.length;return[t.makeTensorInfo([f,2],"int32",c),t.makeTensorInfo([f],"string",h),t.makeTensorInfo([2],"int32",new Int32Array(p))]}const JX={kernelName:wg,backendName:"cpu",kernelFunc:ZX};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eY(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const a=t.data.get(o.dataId).values,i=nD(a,r);return t.makeTensorInfo(o.shape,"int32",i)}const tY={kernelName:vg,backendName:"cpu",kernelFunc:eY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nY=ft($u,n=>Math.tan(n)),sY={kernelName:$u,backendName:"cpu",kernelFunc:nY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rY=ft(Tu,n=>Math.tanh(n)),oY={kernelName:Tu,backendName:"cpu",kernelFunc:rY};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aY(n){const{inputs:e,backend:t}=n,{tensor:s,indices:r,updates:o}=e,{sliceRank:a,numUpdates:i,sliceSize:l,strides:c,outputSize:h}=Na(o,r,s.shape),p=!1,f=t.bufferSync(r),g=t.bufferSync(o),y=t.bufferSync(s),w=ei(f,g,s.shape,h,l,i,a,c,y,p);return t.makeTensorInfo(s.shape,w.dtype,w.values)}const iY={kernelName:cg,backendName:"cpu",kernelFunc:aY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:o}=s;De(r,"tile");const a=rD(t.bufferSync(r),o);return t.makeTensorInfo(a.shape,a.dtype,a.values)}const uY={kernelName:Eu,backendName:"cpu",kernelFunc:lY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:o,sorted:a}=s;De(r,"topk");const i=t.data.get(r.dataId).values,[l,c]=aD(i,r.shape,r.dtype,o,a);return[t.makeTensorInfo(l.shape,l.dtype,l.values),t.makeTensorInfo(c.shape,c.dtype,c.values)]}const dY={kernelName:kg,backendName:"cpu",kernelFunc:cY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hY(n){const{inputs:e,attrs:t,backend:s}=n,{image:r,transforms:o}=e,{interpolation:a,fillMode:i,fillValue:l,outputShape:c}=t,[h,p,f,g]=r.shape,[y,w]=c??[p,f],x=[h,y,w,g],v=ze(r.shape),k=v[0],I=v[1],N=v[2],T=ze(x),D=T[0],P=T[1],z=T[2],F=hn(r.dtype,ce(x));F.fill(l);const L=s.data.get(r.dataId).values,E=s.data.get(o.dataId).values;for(let Z=0;Z<h;++Z){const ne=o.shape[0]===1?E:E.subarray(Z*8,Z*8+8);for(let te=0;te<y;++te)for(let se=0;se<w;++se)for(let K=0;K<g;++K){let B;const J=ne[6]*se+ne[7]*te+1;if(J===0)continue;const X=(ne[0]*se+ne[1]*te+ne[2])/J,M=(ne[3]*se+ne[4]*te+ne[5])/J,H=bI(X,f,i),le=bI(M,p,i);switch(a){case"nearest":B=xY(L,p,f,k,I,N,Z,le,H,K,l);break;case"bilinear":B=bY(L,p,f,k,I,N,Z,le,H,K,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${a}`)}const he=Z*D+te*P+se*z+K;F[he]=B}return s.makeTensorInfo(x,r.dtype,F)}return{dataId:s.write(F,x,r.dtype),shape:r.shape,dtype:r.dtype}}const pY={kernelName:Sg,backendName:"cpu",kernelFunc:hY};function bI(n,e,t){switch(t){case"reflect":return fY(n,e);case"wrap":return mY(n,e);case"nearest":return yY(n,e);case"constant":default:return gY(n)}}function fY(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=2*e;t<s&&(t=s*Math.trunc(-t/s)+t),t=t<-e?t+s:-t-1}else if(t>e-1)if(e<=1)t=0;else{const s=2*e;t-=s*Math.trunc(t/s),t>=e&&(t=s-t-1)}return aa(0,t,e-1)}function mY(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=e-1;t+=e*(Math.trunc(-t/s)+1)}else if(t>e-1)if(e<=1)t=0;else{const s=e-1;t-=e*Math.trunc(t/s)}return aa(0,t,e-1)}function gY(n,e){return n}function yY(n,e){return aa(0,n,e-1)}function Mc(n,e,t,s,r,o,a,i,l,c,h){const p=a*s+i*r+l*o+c;return 0<=i&&i<e&&0<=l&&l<t?n[p]:h}function xY(n,e,t,s,r,o,a,i,l,c,h){const p=Math.round(i),f=Math.round(l);return Mc(n,e,t,s,r,o,a,p,f,c,h)}function bY(n,e,t,s,r,o,a,i,l,c,h){const p=Math.floor(i),f=Math.floor(l),g=p+1,y=f+1,w=(y-l)*Mc(n,e,t,s,r,o,a,p,f,c,h)+(l-f)*Mc(n,e,t,s,r,o,a,p,y,c,h),x=(y-l)*Mc(n,e,t,s,r,o,a,g,f,c,h)+(l-f)*Mc(n,e,t,s,r,o,a,g,y,c,h);return(g-i)*w+(i-p)*x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wY(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:o}=e;De(o,"unique");const a=s.data.get(o.dataId).values,{outputValues:i,outputShape:l,indices:c}=iD(a,r,o.shape,o.dtype);return[s.makeTensorInfo(l,o.dtype,i),s.makeTensorInfo([c.length],"int32",c)]}const vY={kernelName:Ng,backendName:"cpu",kernelFunc:wY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kY(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const a=r.shape.length,i=r.shape[o],l=new Array(a-1);let c=0;for(let g=0;g<a;g++)g!==o&&(l[c++]=r.shape[g]);const h=new Array(a).fill(0),p=r.shape.slice();p[o]=1;const f=new Array(i);for(let g=0;g<f.length;g++){h[o]=g;const y=wi({inputs:{x:r},backend:t,attrs:{begin:h,size:p}});f[g]=Nt({inputs:{x:y},backend:t,attrs:{shape:l}}),t.disposeIntermediateTensorInfo(y)}return f}const SY={kernelName:mh,backendName:"cpu",kernelFunc:kY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NY(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:o}=e,{numSegments:a}=s;De(r,"unsortedSegmentSum");const i=r.shape.length,l=o.shape.length,c=[],h=[],p=i-l;let f=o;for(let y=0;y<p;++y){const w=cm({inputs:{input:f},backend:t,attrs:{dim:y+1}});f=w,h.push(w)}for(let y=0;y<a;++y){const w=wo(y,"int32"),x=t.makeTensorInfo([],"int32",w),v=kA({inputs:{a:x,b:f},backend:t}),k=ya({inputs:{x:v},backend:t,attrs:{dtype:"float32"}}),I=$y({inputs:{a:k,b:r},backend:t}),N=Kh({inputs:{x:I},backend:t,attrs:{axis:0,keepDims:!1}});c.push(N),h.push(x),h.push(v),h.push(k),h.push(I),h.push(N)}const g=kD({inputs:c,backend:t,attrs:{axis:0}});return h.forEach(y=>t.disposeIntermediateTensorInfo(y)),g}const CY={kernelName:gh,backendName:"cpu",kernelFunc:NY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IY=[w7,e8,k7,N7,a8,I7,T7,R7,D7,O7,L7,z7,B7,U7,G7,K7,Y7,Z7,eq,x7,nq,rq,aq,l8,lq,r8,c8,cq,t8,hq,fq,mq,yq,bq,vq,Sq,Cq,$q,Eq,Aq,_q,Fq,Pq,Mq,Bq,Wq,jq,Hq,qq,Kq,Xq,Qq,e9,d7,n9,d8,c9,h8,d9,f8,y9,x9,w9,g8,x8,k9,N9,I9,T9,w8,k8,n8,R9,pq,D9,O9,L9,h7,N8,I8,z9,T8,B9,U9,G9,K9,Y9,Z9,J9,R8,tK,sK,oK,iK,uK,dK,pK,D8,mK,xK,vK,O8,L8,NK,$K,RK,z8,DK,OK,FK,SD,MK,f7,V8,VK,UK,GK,qK,s8,Zb,XK,m7,g7,y7,QK,JK,tX,sX,oX,aX,lX,X8,cX,mX,yX,vX,Q8,SX,CX,$X,Z8,bK,RX,DX,OX,LX,zX,BX,WX,jX,t7,GX,s7,o7,qX,XX,QX,JX,tY,u7,Zq,sY,oY,iY,uY,dY,pY,M8,vY,SY,CY,_K];for(const n of IY)Ig(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Za={},yf={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function $Y(n,e){Za[n]=e}function Sr(n,e){if(!(n in Za)||e!=null){const s=EY(n,e);if(s!==null)Za[n]=s;else return console.log("Could not get context for WebGL version",n),null}const t=Za[n];return t==null||t.isContextLost()?(delete Za[n],Sr(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Za[n])}function TY(n){if(!oe().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function EY(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??TY(n);return t.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete Za[n]},!1),oe().getBool("SOFTWARE_WEBGL_ENABLED")&&(yf.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",yf)||t.getContext("experimental-webgl",yf):t.getContext("webgl2",yf)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ld;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(ld||(ld={}));var As;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(As||(As={}));var wn;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(wn||(wn={}));function Xh(n,e){return[e,n]}function RY(n,e){return n*e}function xf(n){const e=ce(n),t=Math.ceil(e/4);return Bf(t)}function Bu(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function AY(n,e){const[t,s]=Bu(n,e);return t*s*4}function Wv(n,e){const t=n;let s,r,o,a,i,l,c,h,p,f;return oe().getNumber("WEBGL_VERSION")===2?(s=t.R32F,r=t.R16F,o=t.RGBA16F,a=t.RGBA32F,i=t.RED,c=4,h=1,p=t.HALF_FLOAT,f=t.FLOAT,l=t.RGBA8):(s=n.RGBA,r=n.RGBA,o=n.RGBA,a=t.RGBA,i=n.RGBA,c=4,h=4,p=e!=null?e.HALF_FLOAT_OES:null,f=n.FLOAT,l=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:a,textureFormatFloat:i,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:h,textureTypeHalfFloat:p,textureTypeFloat:f}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $e(n,e){const t=e();return oe().getBool("DEBUG")&&DY(n),t}function DY(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+LY(n,e))}const _Y=596e-10,OY=65504;function FY(n){return!!(oe().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||_Y<Math.abs(n)&&Math.abs(n)<OY)}function LY(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function bf(n,e){return To(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function PY(n,e){const t=To(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if($e(n,()=>n.shaderSource(t,e)),$e(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function zY(n,e){const t=To(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if($e(n,()=>n.shaderSource(t,e)),$e(n,()=>n.compileShader(t)),oe().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw ND(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const MY=/ERROR: [0-9]+:([0-9]+):/g;function ND(n,e){const t=MY.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const s=+t[1],r=n.split(`
`),o=r.length.toString().length+2,a=r.map((p,f)=>ni((f+1).toString(),o)+p);let i=0;for(let p=0;p<a.length;p++)i=Math.max(a[p].length,i);const l=a.slice(0,s-1),c=a.slice(s-1,s),h=a.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${ni(c[0],i)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join(`
`))}function BY(n){return To(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function VY(n,e){if($e(n,()=>n.linkProgram(e)),!oe().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function qx(n,e){if($e(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function WY(n,e){const t=To(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return $e(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),$e(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function UY(n,e){const t=To(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return $e(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),$e(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function jY(n){return To(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function GY(n,e){const t=oe().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const s=`[${n}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>t||e>t){const s=`[${n}x${e}]`,r=`[${t}x${t}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function HY(n){return To(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function wI(n,e,t,s,r,o,a){const i=n.getAttribLocation(e,t);return i===-1?!1:($e(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),$e(n,()=>n.vertexAttribPointer(i,r,n.FLOAT,!1,o,a)),$e(n,()=>n.enableVertexAttribArray(i)),!0)}function qY(n,e,t){ZY(n,t),$e(n,()=>n.activeTexture(n.TEXTURE0+t)),$e(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function KY(n,e,t){return To(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function XY(n,e,t){return n.getUniformLocation(e,t)}function YY(n,e,t,s){$e(n,()=>qY(n,e,s)),$e(n,()=>n.uniform1i(t,s))}function Kx(n,e,t){$e(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),$e(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function vI(n,e){$e(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),$e(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function wf(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+QY(n,e))}function QY(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function To(n,e,t){const s=$e(n,()=>e());if(s==null)throw new Error(t);return s}function ZY(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+n.TEXTURE0;if(s<n.TEXTURE0||s>t){const r=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${r}.`)}}function Dl(n,e=2){return ce(n.slice(0,n.length-e))}function _l(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function vf(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[Dl(n),..._l(n)]),e}function JY(n,e=!1){let t=oe().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=oe().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&oe().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=t/2),e&&(t=t*2,s=s*2,n=n.map((i,l)=>l>=n.length-2?bm(n[l]):n[l]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=bo(n).newShape);let r=ce(n),o=null;n.length<=1&&r<=t?o=[1,r]:n.length===2&&n[0]<=t&&n[1]<=t?o=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?o=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?o=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?o=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(o=[n[0],n[1]*n[2]*n[3]]);const a=o!=null&&Math.max(...o)>s&&Math.min(...o)<=(e?2:1)&&Math.min(...o)>0;if(o==null||a)if(e){const i=Dl(n);let l=2,c=2;n.length&&([l,c]=_l(n)),r=i*(l/2)*(c/2),o=Bf(r).map(h=>h*2)}else o=Bf(r);return o}function kf(n){return n%2===0}function hm(n,e){if(n=n.slice(-2),e=e.slice(-2),Je(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],s=e[e.length-1];if(t===s||kf(t)&&kf(s)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&kf(n[0])&&kf(e[0])}let Xx,Yx;function eQ(n){if(Xx==null){const e=Sr(n);Xx=e.getParameter(e.MAX_TEXTURE_SIZE)}return Xx}function tQ(n){if(Yx==null){const e=Sr(n);Yx=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Yx)}function nQ(n){if(n===0)return 0;let e;const t=Sr(n);return Qs(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:Qs(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function Qs(n,e){return n.getExtension(e)!=null}function kI(n){try{if(Sr(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function sQ(n){if(n===0)return!1;const e=Sr(n);if(n===1){if(!Qs(e,"OES_texture_float"))return!1}else if(!Qs(e,"EXT_color_buffer_float"))return!1;return ew(e)}function rQ(n){if(n===0)return!1;const e=Sr(n);if(n===1){if(!Qs(e,"OES_texture_float")||!Qs(e,"WEBGL_color_buffer_float"))return!1}else{if(Qs(e,"EXT_color_buffer_float"))return ew(e);const s="EXT_color_buffer_half_float";if(Qs(e,s)){const r=e.getExtension(s);return oQ(e,r)}return!1}return ew(e)}function ew(n){const e=Wv(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(o),a}function oQ(n,e){const t=Wv(n,e),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const a=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,a),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(a),i}function aQ(n){return n!==2?!1:Sr(n).fenceSync!=null}function Yh(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&A(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oe=oe();Oe.registerFlag("HAS_WEBGL",()=>Oe.getNumber("WEBGL_VERSION")>0);Oe.registerFlag("WEBGL_VERSION",()=>kI(2)?2:kI(1)?1:0);Oe.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Oe.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Oe.get("WEBGL_VERSION")===2);Oe.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Oe.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Oe.registerFlag("WEBGL_PACK",()=>Oe.getBool("HAS_WEBGL"));Oe.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_PACK_CLIP",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_PACK_REDUCE",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_LAZILY_UNPACK",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_CONV_IM2COL",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Oe.getBool("WEBGL_PACK"));Oe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>eQ(Oe.getNumber("WEBGL_VERSION")));Oe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>tQ(Oe.getNumber("WEBGL_VERSION")));Oe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=Oe.getNumber("WEBGL_VERSION");return n===0?0:nQ(n)});Oe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Oe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!xw());Oe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>sQ(Oe.getNumber("WEBGL_VERSION")));Oe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Oe.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Oe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Oe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>rQ(Oe.getNumber("WEBGL_VERSION")));Oe.registerFlag("WEBGL_FENCE_API_ENABLED",()=>aQ(Oe.getNumber("WEBGL_VERSION")));Oe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Oe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Oe.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});Oe.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>xw()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});Oe.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Oe.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Oe.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Oe.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Oe.registerFlag("WEBGL_EXP_CONV",()=>!1);Oe.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Oe.getBool("IS_TEST"));Oe.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Oe.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Oe.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Oe.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hn(){let n,e,t,s,r,o,a,i,l,c;return oe().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",s="in",r="texture",o="outputColor",a="out vec4 outputColor;",i=oe().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",s="varying",r="texture2D",o="gl_FragColor",a="",i=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:s,texture2D:r,output:o,defineOutput:a,defineSpecialNaN:i,defineSpecialInf:l,defineRound:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oi(n,e,t="index"){const s=ze(e);return s.map((r,o)=>{const a=`int ${n[o]} = ${t} / ${r}`,i=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${r}`:`index -= ${n[o]} * ${r}`;return`${a}; ${i};`}).join("")}function Ty(n,e,t="index"){const s=ze(e);return s.map((r,o)=>{const a=`int ${n[o]} = ${t} / outShapeStrides[${o}]`,i=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * outShapeStrides[${o}]`:`index -= ${n[o]} * outShapeStrides[${o}]`;return`${a}; ${i};`}).join("")}function iQ(n,e){const t=n.length,s=n.map(o=>`${e}[${o}]`),r=new Array(t-1);r[t-2]=s[t-1];for(let o=t-3;o>=0;--o)r[o]=`(${r[o+1]} * ${s[o+1]})`;return r}function lQ(n,e,t="index"){const s=n.map((o,a)=>a),r=iQ(s,e);return r.map((o,a)=>{const i=`int ${n[a]} = ${t} / ${r[a]}`,l=a===r.length-1?`int ${n[a+1]} = ${t} - ${n[a]} * ${r[a]}`:`index -= ${n[a]} * ${r[a]}`;return`${i}; ${l};`}).join("")}function Uv(n){const e=ze(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function jv(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const CD=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:ID}=qT;function uQ(n,e,t){const s=[];if(n.forEach(g=>{const y=ce(g.shapeInfo.logicalShape);if(g.shapeInfo.isUniform?s.push(`uniform float ${g.name}${y>1?`[${y}]`:""};`):(s.push(`uniform sampler2D ${g.name};`),s.push(`uniform int offset${g.name};`)),t.enableShapeUniforms){const{uniformShape:w}=Gv(t.packedInputs,g.shapeInfo.logicalShape,g.shapeInfo.texShape);switch(w.length){case 1:s.push(`uniform int ${g.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${g.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${g.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${g.name}Shape;`);break}s.push(`uniform ivec2 ${g.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(g=>{s.push(`uniform ${g.type} ${g.name}${g.arrayIndex?`[${g.arrayIndex}]`:""};`)});const r=s.join(`
`),o=n.map(g=>cQ(g,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),a=e.texShape,i=Hn(),l=pQ(i);let c,h,p=gQ(i);return e.isPacked?(c=dQ(e.logicalShape,a,t.enableShapeUniforms),h=mQ(i)):(c=hQ(e.logicalShape,a,t.enableShapeUniforms),h=fQ(i)),t.packedInputs&&(p+=wQ),[p,l,h,r,c,o,t.userCode].join(`
`)}function Vu(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return DQ(n,e);case 1:return OQ(n,e);case 2:return LQ(n,e);case 3:return zQ(n,e);case 4:return BQ(n,e);case 5:return VQ(n);case 6:return WQ(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function $D(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return AQ(n);case 1:return _Q(n,e);case 2:return FQ(n,e);case 3:return PQ(n,e);default:return MQ(n,e)}}function cQ(n,e,t=!1,s){let r="";t?r+=$D(n,s):r+=Vu(n,s);const o=n.shapeInfo.logicalShape,a=e.logicalShape;return o.length<=a.length&&(t?r+=UQ(n,e):r+=jQ(n,e)),r}function dQ(n,e,t){switch(n.length){case 0:return TD();case 1:return vQ(n,e,t);case 2:return EQ(n,e,t);case 3:return SQ(n,e,t);default:return CQ(n,e,t)}}function hQ(n,e,t){switch(n.length){case 0:return TD();case 1:return kQ(n,e,t);case 2:return RQ(n,e,t);case 3:return NQ(n,e,t);case 4:return IQ(n,e,t);case 5:return $Q(n,e);case 6:return TQ(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function pQ(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function fQ(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function mQ(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function gQ(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${yQ}
    ${xQ}
    ${bQ}
  `}const yQ=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,xQ=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,bQ=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,wQ=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function TD(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function vQ(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function kQ(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function SQ(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),o=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function NQ(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Ty(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=Oi(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function CQ(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),o=r*Math.ceil(n[n.length-2]/2);let a=o,i="",l="b, r, c";for(let c=2;c<n.length-1;c++)a*=n[n.length-c-1],i=`
      int b${c} = index / ${a};
      index -= b${c} * ${a};
    `+i,l=`b${c}, `+l;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${i}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${l});
    }
  `}function IQ(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Ty(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=Oi(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function $Q(n,e){const t=Oi(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function TQ(n,e){const t=Oi(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function EQ(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Je(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function RQ(n,e,t){return Je(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function Fi(n){return`offset${n}`}function AQ(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),s=Hn();return`
    vec4 ${t}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function DQ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${t};}`;const[r,o]=n.shapeInfo.texShape;if(r===1&&o===1)return`
      float ${s}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=Fi(t);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${a});
      return sampleTexture(${t}, uv);
    }
  `;const[i,l]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${i}, ${l}, ${a});
      return sampleTexture(${t}, uv);
    }
  `}function _Q(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,o=Hn();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${o.texture2D}(${t}, uv);
    }
  `;const a=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${a[0]}, ${a[1]}, index);
      return ${o.texture2D}(${t}, uv);
    }
  `}function OQ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Wu(n)}
      }
    `;const r=n.shapeInfo.texShape,o=r[0],a=r[1];if(a===1&&o===1)return`
      float ${s}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const i=Fi(t);return a===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${i}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${i}) + 0.5) / ${o}.0);
        return sampleTexture(${t}, uv);
      }
    `:o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${i}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${i}) + 0.5) / ${a}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${i});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${o}, ${a}, index + ${i});
      return sampleTexture(${t}, uv);
    }
  `}function FQ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape,a=o[0],i=o[1],l=Hn();if(o!=null&&Je(t,o))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${i}.0, ${a}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const c=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],h=Math.ceil(t[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${h}, ${c[0]}, ${c[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function LQ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape;if(o!=null&&Je(t,o)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const f=o[0],g=o[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${g}.0, ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:a,keptDims:i}=bo(t),l=a;if(l.length<t.length){const f=Uu(n,l),g=["row","col"];return`
      ${Vu(f,e)}
      float ${r}(int row, int col) {
        return ${r}(${ju(g,i)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${Wu(n)}
      }
    `;const c=o[0],h=o[1],p=Fi(s);return h===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${p}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${p}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);
      return sampleTexture(${s}, uv);
    }
  `:c===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${p}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${p}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${h}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${p};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${p};
    vec2 uv = uvFromFlat(${c}, ${h}, index);
    return sampleTexture(${s}, uv);
  }
`}function PQ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(t[0]===1){const f=t.slice(1),g=[1,2],y=Uu(n,f),w=["b","row","col"];return`
        ${$D(y,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${ju(w,g)});
        }
      `}const i=Hn();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${i.texture2D}(${s}, uv);
    }
  `;const l=a[0],c=a[1],h=Math.ceil(t[2]/2),p=h*Math.ceil(t[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${c}, ${p}, ${h}, b, row, col);
      return ${i.texture2D}(${s}, uv);
    }
  `}function zQ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t[1]*t[2],a=t[2],{newShape:i,keptDims:l}=bo(t),c=i;if(c.length<t.length){const w=Uu(n,c),x=["row","col","depth"];return`
        ${Vu(w,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${ju(x,l)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${a}, 1)));
        ${Wu(n)}
      }
    `;const h=n.shapeInfo.texShape,p=h[0],f=h[1],g=n.shapeInfo.flatOffset;if(f===o&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${a}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${f}.0, ${p}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(f===a&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${p}.0);
      return sampleTexture(${s}, uv);
    }
  `;const y=Fi(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${y};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${a} + depth + ${y};
        vec2 uv = uvFromFlat(${p}, ${f}, index);
        return sampleTexture(${s}, uv);
      }
  `}function MQ(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=Hn();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${t}, uv);
    }
  `;const o=n.shapeInfo.logicalShape,a=o.length,i=n.shapeInfo.texShape,l=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],c=l[0],h=l[1],p=Math.ceil(o[a-1]/2);let f=p*Math.ceil(o[a-2]/2),g="int b, int row, int col",y=`b * ${f} + (row / 2) * ${p} + (col / 2)`;for(let w=2;w<a-1;w++)g=`int b${w}, `+g,f*=o[a-w-1],y=`b${w} * ${f} + `+y;return`
    vec4 ${s}(${g}) {
      int index = ${y};
      int texR = index / ${h};
      int texC = index - texR * ${h};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}, ${c});
      return ${r.texture2D}(${t}, uv);
    }
  `}function BQ(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t[3],a=t[2]*o,i=t[1]*a,{newShape:l,keptDims:c}=bo(t);if(l.length<t.length){const k=Uu(n,l),I=["row","col","depth","depth2"];return`
      ${Vu(k,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${ju(I,c)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${i}, ${a}, ${o}, 1)));
        ${Wu(n)}
      }
    `;const h=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,f=p[0],g=p[1],y=`int stride2 = ${s}Shape[3];`,w=`int stride1 = ${s}Shape[2] * stride2;`,x=`int stride0 = ${s}Shape[1] * stride1;`;if(g===i&&h==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${y}
        ${w}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${a}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(g===o&&h==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;const v=Fi(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${y}
      ${w}
      ${x}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${v});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${i} + col * ${a} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${f}, ${g}, index + ${v});
      return sampleTexture(${s}, uv);
    }
  `}function VQ(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],o=e[3]*r,a=e[2]*o,i=e[1]*a,{newShape:l,keptDims:c}=bo(e);if(l.length<e.length){const w=Uu(n,l),x=["row","col","depth","depth2","depth3"];return`
      ${Vu(w)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${ju(x,c)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${i}, ${a}, ${o}, ${r})) +
          depth3;
        ${Wu(n)}
      }
    `;const h=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,f=p[0],g=p[1];if(g===i&&h==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${a}, ${o}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${f}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(g===r&&h==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${f}.0);
        return sampleTexture(${t}, uv);
      }
    `;const y=Fi(t);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${i} + col * ${a} + depth * ${o} +
          depth2 * ${r} + depth3 + ${y};
      vec2 uv = uvFromFlat(${f}, ${g}, index);
      return sampleTexture(${t}, uv);
    }
  `}function WQ(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:r,keptDims:o}=bo(e);if(r.length<e.length){const x=Uu(n,r),v=["row","col","depth","depth2","depth3","depth4"];return`
      ${Vu(x)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${ju(v,o)});
      }
    `}const a=e[5],i=e[4]*a,l=e[3]*i,c=e[2]*l,h=e[1]*c;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${h}, ${c}, ${l}, ${i})) +
          dot(
            vec2(depth3, depth4),
            vec2(${a}, 1)));
        ${Wu(n)}
      }
    `;const p=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,g=f[0],y=f[1];if(y===h&&p==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${i}, ${a})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${y}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(y===a&&p==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${y}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;const w=Fi(t);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${h} + col * ${c} + depth * ${l} +
          depth2 * ${i} + depth3 * ${a} + depth4 + ${w};
      vec2 uv = uvFromFlat(${g}, ${y}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Wu(n){const e=n.name,t=ce(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function UQ(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",o=n.shapeInfo.logicalShape.length,a=e.logicalShape.length,i=ID(n.shapeInfo.logicalShape,e.logicalShape),l=yt(a),c=a-o;let h;const p=["x","y","z","w","u","v"];o===0?h="":a<2&&i.length>=1?h="coords = 0;":h=i.map(k=>`coords.${p[k+c]} = 0;`).join(`
`);let f="";a<2&&o>0?f="coords":f=n.shapeInfo.logicalShape.map((k,I)=>`coords.${p[I+c]}`).join(", ");let g="return outputValue;";const w=ce(n.shapeInfo.logicalShape)===1,v=ce(e.logicalShape)===1;if(o===1&&!w&&!v)g=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(w&&!v)a===1?g=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:g=`
        return vec4(outputValue.x);
      `;else if(i.length){const k=o-2,I=o-1;i.indexOf(k)>-1&&i.indexOf(I)>-1?g="return vec4(outputValue.x);":i.indexOf(k)>-1?g="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":i.indexOf(I)>-1&&(g="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${h}
      vec4 outputValue = get${s}(${f});
      ${g}
    }
  `}function jQ(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",o=e.texShape,a=n.shapeInfo.texShape,i=n.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!n.shapeInfo.isUniform&&i===l&&n.shapeInfo.flatOffset==null&&Je(a,o))return`
      float ${r}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const c=yt(l),h=ID(n.shapeInfo.logicalShape,e.logicalShape),p=l-i;let f;const g=["x","y","z","w","u","v"];i===0?f="":l<2&&h.length>=1?f="coords = 0;":f=h.map(w=>`coords.${g[w+p]} = 0;`).join(`
`);let y="";return l<2&&i>0?y="coords":y=n.shapeInfo.logicalShape.map((w,x)=>`coords.${g[x+p]}`).join(", "),`
    float ${r}() {
      ${c} coords = getOutputCoords();
      ${f}
      return get${s}(${y});
    }
  `}function yt(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function Gv(n,e,t){const{newShape:s,keptDims:r}=bo(e),o=e.length,a=n&&o===3&&e[0]===1,i=a?e.slice(1):s,l=!n&&o>1&&!Je(e,t)&&s.length<o||a;return{useSqueezeShape:l,uniformShape:l?i:e,keptDims:r}}function Uu(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function ju(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GQ(n,e,t,s){const r=t.map((h,p)=>{const f={logicalShape:h.shape,texShape:h.isUniform?null:h.texData.texShape,isUniform:h.isUniform,isPacked:h.isUniform?!1:h.texData.isPacked,flatOffset:null};return h.texData!=null&&h.texData.slice!=null&&h.texData.slice.flatOffset>0&&(f.flatOffset=h.texData.slice.flatOffset),{name:e.variableNames[p],shapeInfo:f}}),o=r.map(h=>h.shapeInfo),a={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},i=uQ(r,a,e),l=zY(n.gl,i),c=n.createProgram(l);return oe().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:i,webGLProgram:c,inShapeInfos:o,outShapeInfo:a,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(c),Object.assign({program:e,fragmentShader:l,source:i,webGLProgram:c,inShapeInfos:o,outShapeInfo:a},ED(n,e,c)))}function ED(n,e,t){const s=[],r=[];let o,a,i,l=null,c=null;c=n.getUniformLocation(t,"NAN",!1),oe().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));const h=!1;for(const p of e.variableNames){const f={name:p,uniform:n.getUniformLocation(t,p,h),offset:n.getUniformLocation(t,`offset${p}`,h)};e.enableShapeUniforms&&(f.shape=n.getUniformLocation(t,`${p}Shape`,h),f.texShape=n.getUniformLocation(t,`${p}TexShape`,h)),s.push(f)}if(e.enableShapeUniforms&&(o=n.getUniformLocation(t,"outShape",h),i=n.getUniformLocation(t,"outShapeStrides",h),a=n.getUniformLocation(t,"outTexShape",h)),e.customUniforms)for(const p of e.customUniforms)r.push(n.getUniformLocation(t,p.name,h));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:c,outShapeLocation:o,outShapeStridesLocation:i,outTexShapeLocation:a}}function SI(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,s)=>{const r=t.logicalShape,o=e[s],a=o.shape;if(!Je(r,a))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${a} must match`);if(t.isUniform&&o.isUniform)return;const i=t.texShape,l=o.isUniform?null:o.texData.texShape;if(!Je(i,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${i} and ${l} must match`)})}function HQ(n,e,t,s,r){e.program.enableShapeUniforms||(SI(e.inShapeInfos,t),SI([e.outShapeInfo],[s]));const o=s.texData.texture,a=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(o.texture,a[0],a[1]):n.setOutputMatrixTexture(o.texture,a[0],a[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),oe().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<t.length;++l){const c=t[l],{uniform:h,offset:p,shape:f,texShape:g}=e.variablesLocations[l];if(f){const{uniformShape:y}=Gv(e.program.packedInputs,c.shape,c.texData.texShape);switch(y.length){case 1:n.gl.uniform1iv(f,new Int32Array(y));break;case 2:n.gl.uniform2iv(f,new Int32Array(y));break;case 3:n.gl.uniform3iv(f,new Int32Array(y));break;case 4:n.gl.uniform4iv(f,new Int32Array(y));break}}if(g&&n.gl.uniform2i(g,c.texData.texShape[0],c.texData.texShape[1]),h!=null){if(c.isUniform){if(ce(c.shape)<2)n.gl.uniform1f(h,c.uniformValues[0]);else{let y=c.uniformValues;y instanceof Float32Array||(y=new Float32Array(y)),n.gl.uniform1fv(h,y)}continue}c.texData.slice!=null&&p!=null&&n.gl.uniform1i(p,c.texData.slice.flatOffset),n.setInputMatrixTexture(c.texData.texture.texture,h,l)}}const i=e.outShapeLocation;if(i)switch(s.shape.length){case 1:n.gl.uniform1iv(i,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(i,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(i,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(i,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=ze(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const c=e.program.customUniforms[l],h=e.customUniformLocations[l],p=r[l];if(c.type==="float")n.gl.uniform1fv(h,p);else if(c.type==="vec2")n.gl.uniform2fv(h,p);else if(c.type==="vec3")n.gl.uniform3fv(h,p);else if(c.type==="vec4")n.gl.uniform4fv(h,p);else if(c.type==="int")n.gl.uniform1iv(h,p);else if(c.type==="ivec2")n.gl.uniform2iv(h,p);else if(c.type==="ivec3")n.gl.uniform3iv(h,p);else if(c.type==="ivec4")n.gl.uniform4iv(h,p);else throw Error(`uniform type ${c.type} is not supported yet.`)}n.executeProgram()}function qQ(n,e,t){let s="";e.concat(t).forEach(a=>{const i=a.texData!=null&&a.texData.slice!=null&&a.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!a.isUniform){const l=a.texData.texShape,{useSqueezeShape:c,uniformShape:h,keptDims:p}=Gv(n.packedInputs,a.shape,l);let f="",g="",y="";if(h.length===1&&n.packedInputs){const T=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];f=`${T[0]>1}_${T[1]>1}`}else if(h.length===2&&!n.packedInputs)g=`${h[0]>1}_${h[1]>1}`;else if(h.length>2&&!n.packedInputs){const T=ze(h);y=`${T[0]===l[1]}_${T[T.length-1]===l[1]}`}const w=a.shape.length,x=h.length===2&&Je(a.shape,l),v=ce(a.shape)===1,k=pi(a.shape,t.shape),I=!n.packedInputs&&w===t.shape.length&&Je(l,t.texData.texShape),N=n.packedInputs||h.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${w}_${I}_${c?p:""}_${h.length}_${v}_${k}_${x}_${f}_${g}_${y}_${N}_${i}`}else{const l=a.isUniform?"uniform":a.texData.texShape;s+=`${a.shape}_${l}_${i}`}});const r=n.userCode;let o=n.constructor.name;return o+="_"+s+"_"+r+`${oe().getNumber("WEBGL_VERSION")}`,o}function On(n){return oe().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KQ{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=ld.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Hn();this.outputShape=e,this.enableShapeUniforms=On(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Ty(["r","c","d"],e):Oi(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XQ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=ld.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Hn();this.outputShape=e,this.enableShapeUniforms=On(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Ty(["r","c","d"],e):Oi(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YQ{constructor(e){this.variableNames=["A"],this.outTexUsage=As.DOWNLOAD;const t=Hn();this.outputShape=e,this.userCode=`
      ${CD}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QQ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=As.DOWNLOAD;const t=Hn();this.outputShape=e,this.userCode=`
      ${CD}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZQ={R:0,G:1,B:2,A:3};class NI{constructor(e,t=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=Hn();this.outputShape=e,this.enableShapeUniforms=On(this.outputShape.length);let o="result";t&&(o="floor(result * 255. + 0.5)");let a="";for(let i=0;i<s.length;i++){const l=s[i];a+=`
          if(offset == ${i}) {
            result = values[${ZQ[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?jv():Uv(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${a}
        }
        ${r.output} = vec4(${o}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JQ{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=Hn();this.outputShape=e,this.enableShapeUniforms=On(this.outputShape.length);let r="",o="result";t&&(o="floor(result * 255. + 0.5)");for(let a=0;a<=1;a++)for(let i=0;i<=1;i++){const l=a*2+i;r+=`
          localCoords = coords;
          if(localCoords[2] + ${i} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${i};
          if (localCoords[1] + ${a} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${a};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?jv():Uv(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${o};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eZ(n){const e=Hn(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return PY(n,t)}function tZ(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return WY(n,e)}function nZ(n){const e=new Uint16Array([0,1,2,2,1,3]);return UY(n,e)}function Qh(n,e,t,s,r,o){GY(e,t);const a=jY(n),i=n.TEXTURE_2D;return $e(n,()=>n.bindTexture(i,a)),$e(n,()=>n.texParameteri(i,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),$e(n,()=>n.texParameteri(i,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),$e(n,()=>n.texParameteri(i,n.TEXTURE_MIN_FILTER,n.NEAREST)),$e(n,()=>n.texParameteri(i,n.TEXTURE_MAG_FILTER,n.NEAREST)),oe().getNumber("WEBGL_VERSION")===1?$e(n,()=>n.texImage2D(i,0,s,e,t,0,r,o,null)):$e(n,()=>n.texStorage2D(i,1,s,e,t)),$e(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:a,texShape:[t,e]}}function RD(n){return n.internalFormatFloat}function sZ(n,e,t,s){const[r,o]=Xh(e,t);return Qh(n,r,o,RD(s),s.textureFormatFloat,n.FLOAT)}function AD(n){return n.internalFormatHalfFloat}function rZ(n,e,t,s){const[r,o]=Xh(e,t);return Qh(n,r,o,AD(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function DD(n){return n.downloadTextureFormat}function oZ(n,e,t,s){const[r,o]=Xh(e,t);return Qh(n,r,o,DD(s),n.RGBA,n.UNSIGNED_BYTE)}function _D(n){return n.internalFormatPackedFloat}function aZ(n,e,t,s){const[r,o]=Bu(e,t);return Qh(n,r,o,_D(s),n.RGBA,n.FLOAT)}function OD(n){return n.internalFormatPackedHalfFloat}function iZ(n,e,t,s){const[r,o]=Bu(e,t);return Qh(n,r,o,OD(s),n.RGBA,s.textureTypeHalfFloat)}function lZ(n,e,t){return $e(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),wI(n,e,"clipSpacePos",t,3,20,0)&&wI(n,e,"uv",t,2,20,12)}function uZ(n,e,t,s,r,o){$e(n,()=>n.bindTexture(n.TEXTURE_2D,e));let a,i,l;r instanceof Uint8Array?(a=new Uint8Array(t*s*4),i=n.UNSIGNED_BYTE,l=n.RGBA):(a=new Float32Array(t*s*4),i=n.FLOAT,l=o.internalFormatPackedFloat),a.set(r),oe().getNumber("WEBGL_VERSION")===2?$e(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,s,n.RGBA,i,a)):$e(n,()=>n.texImage2D(n.TEXTURE_2D,0,l,t,s,0,n.RGBA,i,a)),$e(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function cZ(n,e,t){$e(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?oe().getNumber("WEBGL_VERSION")===2?$e(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):$e(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):oe().getNumber("WEBGL_VERSION")===2?$e(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):$e(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),$e(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function dZ(n,e,t,s){const r=n.createBuffer();$e(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const i=4*4*e*t;return $e(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,i,n.STREAM_READ)),$e(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),$e(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function hZ(n,e,t){const s=n,r=new Float32Array(t);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function pZ(n,e,t,s){const[r,o]=Xh(e,t),a=4,i=new Uint8Array(RY(e*t,a));return $e(n,()=>n.readPixels(0,0,r,o,s.downloadTextureFormat,n.UNSIGNED_BYTE,i)),new Float32Array(i.buffer)}function fZ(n,e,t,s,r,o,a,i){const l=n,c=new Float32Array(AY(o,a));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function mZ(n,e,t){const s=new Float32Array(e*t*4);return $e(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qx{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=oe().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,$Y(t,e)):this.gl=Sr(t),e=this.gl,oe().getNumber("WEBGL_VERSION")===2){const o=e;this.createVertexArray=()=>$e(o,()=>o.createVertexArray()),this.bindVertexArray=a=>$e(o,()=>o.bindVertexArray(a)),this.deleteVertexArray=a=>$e(o,()=>o.deleteVertexArray(a)),this.getVertexArray=()=>$e(o,()=>o.getParameter(o.VERTEX_ARRAY_BINDING))}else if(e!=null){const o=e.getExtension("OES_vertex_array_object");if(o==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>$e(e,()=>o.createVertexArrayOES()),this.bindVertexArray=a=>$e(e,()=>o.bindVertexArrayOES(a)),this.deleteVertexArray=a=>$e(e,()=>o.deleteVertexArrayOES(a)),this.getVertexArray=()=>$e(e,()=>e.getParameter(o.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),oe().getNumber("WEBGL_VERSION")===1){const o="OES_texture_float",a="OES_texture_half_float";if(this.textureFloatExtension=bf(this.gl,o),Qs(this.gl,a))this.textureHalfFloatExtension=bf(this.gl,a);else if(oe().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Qs(this.gl,r))this.colorBufferHalfFloatExtension=bf(this.gl,r);else if(oe().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Qs(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Qs(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=tZ(this.gl),this.indexBuffer=nZ(this.gl),this.framebuffer=HY(this.gl),this.textureConfig=Wv(this.gl,this.textureHalfFloatExtension)}get debug(){return oe().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;$e(e,()=>e.finish()),$e(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),$e(e,()=>e.deleteFramebuffer(this.framebuffer)),$e(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),$e(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),$e(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),sZ(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),rZ(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),oZ(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),cZ(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,s,r){this.throwIfDisposed(),uZ(this.gl,e,t,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),iZ(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),aZ(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(vI(this.gl,this.framebuffer),this.outputTexture=null),$e(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,s){return this.downloadMatrixDriver(e,()=>pZ(this.gl,t,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,s,r,o,a){return fZ(this.gl,e,t,s,r,o,a,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return hZ(this.gl,e,t)}createBufferFromTexture(e,t,s){this.bindTextureToFrameBuffer(e);const r=dZ(this.gl,t,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,s;if(oe().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,o=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const a=r.clientWaitSync(o,0,0);return a===r.ALREADY_SIGNALED||a===r.CONDITION_SATISFIED},t=o}else oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(t,oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:t,isFencePassed:s}}downloadMatrixFromPackedTexture(e,t,s){return this.downloadMatrixDriver(e,()=>mZ(this.gl,t,s))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=eZ(t));const s=BY(t);$e(t,()=>t.attachShader(s,this.vertexShader)),$e(t,()=>t.attachShader(s,e)),VY(t,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&qx(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;$e(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),lZ(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&($e(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&qx(this.gl,this.program),$e(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,s=!0){return this.throwIfDisposed(),s?KY(this.gl,e,t):XY(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),$e(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,s){this.throwIfDisposed(),this.throwIfNoProgram(),YY(this.gl,e,t,s)}setOutputMatrixTexture(e,t,s){this.setOutputMatrixTextureDriver(e,s,t)}setOutputPackedMatrixTexture(e,t,s){this.throwIfDisposed();const[r,o]=Bu(t,s);this.setOutputMatrixTextureDriver(e,r,o)}setOutputMatrixWriteRegion(e,t,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&qx(this.gl,this.program),wf(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}$e(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),$e(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=bf(this.gl,oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,o),o}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,s=this.getQueryTimerExtensionWebGL2();t.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await ub(()=>this.disposed||this.isQueryAvailable(e,oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=gZ(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:s}=this.itemsToPoll[t];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in oe().platform&&(s=oe().platform.setTimeoutCustom.bind(oe().platform)),ub(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),Kx(this.gl,e,this.framebuffer),this.debug&&wf(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(Kx(this.gl,this.outputTexture,this.framebuffer),this.debug&&wf(this.gl)):vI(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const s=t();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,t,s){this.throwIfDisposed();const r=this.gl;Kx(r,e,this.framebuffer),this.debug&&wf(r),this.outputTexture=e,$e(r,()=>r.viewport(0,0,t,s)),$e(r,()=>r.scissor(0,0,t,s))}setOutputMatrixWriteRegionDriver(e,t,s,r){this.throwIfDisposed(),$e(this.gl,()=>this.gl.scissor(e,t,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function gZ(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:yZ,bincountImpl:FD,bincountReduceImpl:xZ,bitwiseAndImpl:bZ,castImpl:wZ,ceilImpl:vZ,concatImpl:kZ,equalImpl:SZ,expImpl:NZ,expm1Impl:CZ,floorImpl:IZ,gatherNdImpl:$Z,gatherV2Impl:TZ,greaterImpl:EZ,greaterEqualImpl:RZ,lessImpl:AZ,lessEqualImpl:DZ,linSpaceImpl:_Z,logImpl:OZ,maxImpl:FZ,maximumImpl:LZ,minimumImpl:PZ,multiplyImpl:zZ,negImpl:MZ,notEqualImpl:BZ,prodImpl:VZ,raggedGatherImpl:WZ,raggedRangeImpl:UZ,raggedTensorToTensorImpl:jZ,rangeImpl:GZ,rsqrtImpl:HZ,scatterImpl:qZ,sigmoidImpl:KZ,simpleAbsImpl:LD,sliceImpl:XZ,sparseFillEmptyRowsImpl:YZ,sparseReshapeImpl:QZ,sparseSegmentReductionImpl:PD,sqrtImpl:ZZ,staticRegexReplaceImpl:JZ,stridedSliceImpl:eJ,stringNGramsImpl:tJ,stringSplitImpl:nJ,stringToHashBucketFastImpl:sJ,subImpl:rJ,tileImpl:oJ,topKImpl:aJ,transposeImpl:Hv,uniqueImpl:iJ}=c7;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zD(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function Un(n,e){return e===1?[n]:zD(n,e)}function lJ(n,e){if(n===1)return"rc";let t="";for(let s=0;s<n;s++)t+=e[s],s<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uJ{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=On(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=Un("rc",this.rank),s=yt(this.rank),r=this.getOutOfBoundsCondition(t),o=this.getSetup(t),a=this.getOutput(t);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${o}

            setOutput(vec4(${a}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let o=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let a=2;a<this.rank;a++)o=`${e[e.length-1-a]},`+o;t.push(o)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let s=this.rank-2;s<this.rank;s++)t+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MD{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=On(this.outputShape.length);let s="";for(let r=0;r<4;r++){let o="thisRC = rc;";r%2===1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),s+=`
        ${o}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${cJ(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?jv():Uv(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function cJ(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?lQ(["r","c","d"],"inputShape"):Oi(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dJ{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,s){const r=II(t,s),o=$I(e,r,s);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const a=CI(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=a,this.log();const l=this.freeTextures[o].pop();return this.usedTextures[o].push(l),l}let i;return r===wn.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===wn.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===wn.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===wn.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===wn.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(i),this.numUsedTextures++,this._numBytesAllocated+=a,this.log(),i}releaseTexture(e,t,s,r){if(this.freeTextures==null)return;const o=II(s,r),a=$I(t,o,r);a in this.freeTextures||(this.freeTextures[a]=[]);const i=CI(t,o,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=oe().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=i):(this.freeTextures[a].push(e),this.numFreeTextures++,this._numBytesFree+=i),this.numUsedTextures--;const c=this.usedTextures[a],h=c&&c.indexOf(e);if(h==null||h<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[h]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function hJ(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function CI(n,e,t,s,r){const o=pJ(e,s);let a;if(r){const[l,c]=Bu(n[0],n[1]);a=l*c}else{const[l,c]=Xh(n[0],n[1]);a=l*c}const i=hJ(t,o);return a*i}function pJ(n,e){switch(n){case wn.PACKED_2X2_FLOAT32:return _D(e);case wn.PACKED_2X2_FLOAT16:return OD(e);case wn.UNPACKED_FLOAT32:return RD(e);case wn.UNPACKED_FLOAT16:return AD(e);case wn.PACKED_4X1_UNSIGNED_BYTE:return DD(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function fJ(n){return oe().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?wn.PACKED_2X2_FLOAT32:wn.UNPACKED_FLOAT32:n?wn.PACKED_2X2_FLOAT16:wn.UNPACKED_FLOAT16}function II(n,e){if(n===As.UPLOAD)return wn.PACKED_2X2_FLOAT32;if(n===As.RENDER||n==null)return fJ(e);if(n===As.DOWNLOAD||n===As.PIXELS)return wn.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function $I(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pr{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=On(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const nr="if (isnan(x)) return x;",mJ="return x;",TI="return abs(x);",gJ="return (x >= 0.0) ? x : (exp(x) - 1.0);",yJ=nr+`
  return (x < 0.0) ? 0.0 : x;
`,xJ=nr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Qo="return x;",bJ="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wJ="return x;",vJ=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,kJ=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,SJ=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,NJ="return 1.0 / (1.0 + exp(-1.0 * x));";class ta{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=On(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CJ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=On(this.outputShape.length);const t=e.length,s=Un("rc",t),r=yt(t),o=lJ(t,s),a=s.slice(-2),i=t<=1?"rc":`vec2(${a.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${o});

        setOutput(getChannel(packedInput, ${i}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IJ=ty,$J=1e-7,TJ=1e-4,Sf={};function EJ(n){return n in Sf||(Sf[n]={}),Sf[n]}const RJ=oe().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),AJ=600;function DJ(){return oe().global.screen==null?1024:oe().global.screen.height*oe().global.screen.width*window.devicePixelRatio*AJ/1024/1024}class Ey extends xm{nextDataId(){return Ey.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!oe().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof Qx)t=e;else{const s=Sr(oe().getNumber("WEBGL_VERSION"),e);t=new Qx(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=Sr(oe().getNumber("WEBGL_VERSION"));t=new Qx(s),this.binaryCache=EJ(oe().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new dJ(this.gpgpu),this.numMBBeforeWarning=DJ(),this.texData=new uw(this,fr())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,s,r,o,a){const i=this.makeTensorInfo(t,s),l=this.texData.get(i.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,o]},l.texShape=[r,o];const c=vf(t),h=new NI(c,!1,a),p=this.runWebGLProgram(h,[i],s,[[r,o]]);return p.shape=t,l.texture=null,this.disposeIntermediateTensorInfo(i),p.dataId}write(e,t,s){if((oe().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||oe().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:s,values:e,usage:As.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,s,r,o){if(oe().getBool("DEBUG")&&this.checkNumericalProblems(t),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:t,usage:As.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:o,slice:a,shape:i,isPacked:l}=t;if(a!=null){let f;l?f=new ta(i,Qo):f=new Pr(i,Qo);const g=this.runWebGLProgram(f,[{dataId:e,shape:i,dtype:r}],r),y=this.readSync(g.dataId);return this.disposeIntermediateTensorInfo(g),y}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const c=this.activeTimers!=null;let h;c&&(h=Mn());let p;if(r==="complex64"){const f=this.readSync(o.real.dataId),g=this.readSync(o.imag.dataId);p=yo(f,g)}else p=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=Mn()-h),this.convertAndCacheOnCPU(e,p)}async read(e){if(this.pendingRead.has(e)){const y=this.pendingRead.get(e);return new Promise(w=>y.push(w))}const t=this.texData.get(e),{values:s,shape:r,slice:o,dtype:a,complexTensorInfos:i,isPacked:l}=t;if(o!=null){let y;l?y=new ta(r,Qo):y=new Pr(r,Qo);const w=this.runWebGLProgram(y,[{dataId:e,shape:r,dtype:a}],a),x=this.read(w.dataId);return this.disposeIntermediateTensorInfo(w),x}if(s!=null)return this.convertAndCacheOnCPU(e);if(oe().getBool("DEBUG")&&!oe().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&oe().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c=null,h;if(a!=="complex64"&&oe().get("WEBGL_BUFFER_SUPPORTED")){h=this.decode(e);const y=this.texData.get(h.dataId);c=this.gpgpu.createBufferFromTexture(y.texture.texture,...xf(r))}this.pendingRead.set(e,[]),a!=="complex64"&&await this.gpgpu.createAndWaitForFence();let p;if(a==="complex64"){const y=await Promise.all([this.read(i.real.dataId),this.read(i.imag.dataId)]),w=y[0],x=y[1];p=yo(w,x)}else if(c==null)p=this.getValuesFromTexture(e);else{const y=ce(r);p=this.gpgpu.downloadFloat32MatrixFromBuffer(c,y)}if(h!=null&&this.disposeIntermediateTensorInfo(h),c!=null){const y=this.gpgpu.gl;$e(y,()=>y.deleteBuffer(c))}const f=this.convertAndCacheOnCPU(e,p),g=this.pendingRead.get(e);return this.pendingRead.delete(e),g.forEach(y=>y(f)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&fr().removeDataId(e,this),this.pendingDeletes--),f}readToGPU(e,t={}){const s=this.texData.get(e),{values:r,shape:o,slice:a,dtype:i,isPacked:l,texture:c}=s;if(i==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(a!=null){let g;l?g=new ta(o,Qo):g=new Pr(o,Qo);const y=this.runWebGLProgram(g,[{dataId:e,shape:o,dtype:i}],i),w=this.readToGPU(y,t);return this.disposeIntermediateTensorInfo(y),w}if(c==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const h=this.decode(e,t.customTexShape),p=fr().makeTensorFromTensorInfo(h),f=this.texData.get(h.dataId);return Object.assign({tensorRef:p},f.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>fo(r));return qe(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return qe(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const s=e[t];if(!FY(s))throw oe().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:s,isPacked:r}=this.texData.get(e),o=ce(t);if(oe().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const f=this.decode(e),g=this.texData.get(f.dataId),y=this.gpgpu.downloadMatrixFromPackedTexture(g.texture.texture,...xf(t)).subarray(0,o);return this.disposeIntermediateTensorInfo(f),y}const a=oe().getBool("WEBGL_PACK")&&r===!0,i=a?vf(t):t,l=a?new QQ(i):new YQ(i),c=this.runWebGLProgram(l,[{shape:i,dtype:s,dataId:e}],"float32"),h=this.texData.get(c.dataId),p=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(h.texture.texture,h.texShape[0],h.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(c),p}timerAvailable(){return oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const o=Ur(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),a=Ur(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=t,r&&(this.programTimersStack=null);const i={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(o);i.kernelMs=p2(l),i.getExtraProfileInfo=()=>l.map((c,h)=>({name:a[h],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", ")}else i.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,i})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Mn(),endMs:null}}endTimer(e){return oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Mn(),e)}async getQueryTime(e){if(oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,t),this.disposeData(s.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:s,texShape:r,usage:o,isPacked:a,slice:i}=this.texData.get(e),l=i&&i.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),t!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(t,r,o,a)));const h=this.texData.get(e);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=RJ){return oe().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&ce(s.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){Ts("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return IJ(e.shape,t)}packedUnaryOp(e,t,s){const r=new ta(e.shape,t),o=this.compileAndRun(r,[e],s);return fr().makeTensorFromTensorInfo(o)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=LD(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(oe().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,TI,e.dtype);const t=new Pr(e.shape,TI),s=this.compileAndRun(t,[e]);return fr().makeTensorFromTensorInfo(s)}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&Lr(s[0])){const o=s.map(a=>zr(a));r=this.write(o,e,t)}else r=this.write(s,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,s){return fr().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,s),this)}unpackTensor(e){const t=new CJ(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new uJ(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const s=[Dl(e.shape),..._l(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},o=[Dl(t),..._l(t)],a=new MD(o,s),i=!0,l=[s],c=this.runWebGLProgram(a,[r],e.dtype,l,i);return{dataId:c.dataId,shape:t,dtype:c.dtype}}decode(e,t){const s=this.texData.get(e),{isPacked:r,shape:o,dtype:a}=s;if(t!=null){const f=ce(o),g=t[0]*t[1]*4;A(f<=g,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const i=vf(o);let l;r?l=new XQ(i):l=new KQ(i);const c=!0,h=[t??xf(i)],p=this.runWebGLProgram(l,[{shape:i,dtype:a,dataId:e}],a,h,c,t);return{dtype:a,shape:o,dataId:p.dataId}}runWebGLProgram(e,t,s,r,o=!1,a){const i=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(i.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===ld.DENSE){const v=a??xf(e.outputShape);l.texShape=v.map(k=>k*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),ce(i.shape)===0)return l.values=hn(i.dtype,0),i;const c=[],h=t.map(v=>{if(v.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let k=this.texData.get(v.dataId);if(k.texture==null){if(!e.packedInputs&&ce(v.shape)<=oe().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:v.shape,texData:null,isUniform:!0,uniformValues:k.values};e.packedInputs&&(k.isPacked=!0,k.shape=v.shape)}if(this.uploadToGPU(v.dataId),!!k.isPacked!=!!e.packedInputs)v=k.isPacked?this.unpackTensor(v):this.packTensor(v),c.push(v),k=this.texData.get(v.dataId);else if(k.isPacked&&!hm(k.shape,v.shape)){const I=v,N=v.shape;v.shape=k.shape,v=this.packedReshape(v,N),c.push(v),k=this.texData.get(v.dataId),I.shape=N}return{shape:v.shape,texData:k,isUniform:!1}});this.uploadToGPU(i.dataId);const p={shape:i.shape,texData:l,isUniform:!1},f=qQ(e,h,p),g=this.getAndSaveBinary(f,()=>GQ(this.gpgpu,e,h,p)),y=this.activeTimers!=null;let w;y&&(w=this.startTimer()),oe().get("ENGINE_COMPILE_ONLY")||HQ(this.gpgpu,g,h,p,r),c.forEach(v=>this.disposeIntermediateTensorInfo(v)),y&&(w=this.endTimer(w),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(w)}));const x=oe().getNumber("WEBGL_FLUSH_THRESHOLD");if(x>0){const v=Mn();v-this.lastGlFlushTime>x&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=v)}if(!oe().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&o===!1){const v=this.unpackTensor(i);return this.disposeIntermediateTensorInfo(i),v}return i}compileAndRun(e,t,s,r,o=!1){return s=s||t[0].dtype,this.runWebGLProgram(e,t,s,r,o)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(oe().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=re(()=>{if(!oe().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=oe().getBool("DEBUG");oe().set("DEBUG",!1);const t=this.abs(Me(1e-8)).dataSync()[0];if(oe().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?$J:TJ}uploadToGPU(e){const t=this.texData.get(e),{shape:s,dtype:r,values:o,texture:a,usage:i,isPacked:l}=t;if(a!=null)return;const c=this.activeTimers!=null;let h;c&&(h=Mn());let p=t.texShape;if(p==null&&(p=JY(s,l),t.texShape=p),o!=null){const f=vf(s);let g,y=p[1],w=p[0];const x=o instanceof Uint8Array||o instanceof Uint8ClampedArray;(l||!x)&&([y,w]=Bu(p[0],p[1])),l?g=new JQ(f,x):g=new NI(f,x);const v=x?[w,y]:p,k=this.makeTensorInfo(v,r),I=this.texData.get(k.dataId);x?I.usage=As.PIXELS:I.usage=As.UPLOAD,I.texShape=v,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(k.dataId),y,w,o);const N=[[w,y]],D=this.runWebGLProgram(g,[k],r,N,!0),P=this.texData.get(D.dataId);t.texShape=P.texShape,t.isPacked=P.isPacked,t.usage=P.usage,oe().get("ENGINE_COMPILE_ONLY")?this.disposeData(D.dataId):(t.texture=P.texture,t.values=null,this.texData.delete(D.dataId)),this.disposeIntermediateTensorInfo(k),c&&(this.uploadWaitMs+=Mn()-h)}else{const f=this.acquireTexture(p,i,r,l);t.texture=f}}convertAndCacheOnCPU(e,t){const s=this.texData.get(e),{dtype:r}=s;return t!=null&&(s.values=_J(t,r)),s.values}acquireTexture(e,t,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${o} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*Hc(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(t),r(!0)}catch(o){throw o}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await j1(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(ND(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:s,infLoc:r,nanLoc:o,outShapeLocation:a,outShapeStridesLocation:i,outTexShapeLocation:l}=ED(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=o,e.outShapeLocation=a,e.outShapeStridesLocation=i,e.outTexShapeLocation=l}}createTensorFromGPUData(e,t,s){e.channels=e.channels||"RGBA";const{texture:r,height:o,width:a,channels:i}=e,l=fr().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const c=l.writeTexture(r,t,s,o,a,i);return fr().makeTensorFromDataId(c,t,s,l)}}Ey.nextDataId=0;function _J(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<t.length;++s)t[s]=Math.round(n[s]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */bw()&&vw("webgl",()=>new Ey,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qv=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class vi{constructor(e,t,s){this.variableNames=["A","B"],this.outputShape=He(t,s),this.enableShapeUniforms=On(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Li=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Gu{constructor(e,t,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=He(t,s);const o=this.outputShape.length;this.enableShapeUniforms=On(o);let a="";if(r)if(o===0||ce(this.outputShape)===1)a=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(a=`
          ${yt(o)} coords = getOutputCoords();
        `,o===1)this.enableShapeUniforms?a+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:a+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=Un("coords",o);this.enableShapeUniforms?a+=`
            bool nextRowOutOfBounds =
              (${l[o-2]} + 1) >= outShape[${o} - 2];
            bool nextColOutOfBounds =
              (${l[o-1]} + 1) >= outShape[${o} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:a+=`
            bool nextRowOutOfBounds =
              (${l[o-2]} + 1) >= ${this.outputShape[o-2]};
            bool nextColOutOfBounds =
              (${l[o-1]} + 1) >= ${this.outputShape[o-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${a}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ws(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const OJ={kernelName:nu,backendName:"webgl",kernelFunc:ws};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $a(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,o=t.makeTensorInfo(s.shape,"complex64"),a=t.texData.get(o.dataId),i=ws({inputs:{x:s},backend:t}),l=ws({inputs:{x:r},backend:t});return a.complexTensorInfos={real:i,imag:l},o}const FJ={kernelName:$m,backendName:"webgl",kernelFunc:$a};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BD="return (a < 0.) ? b * a : a;",VD=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function LJ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:o}=s,a=t.makeTensorInfo([],"float32",wo(o,"float32")),i=oe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Gu(VD,r.shape,a.shape):new vi(BD,r.shape,a.shape),l=t.runWebGLProgram(i,[r,a],"float32");return t.disposeIntermediateTensorInfo(a),l}const PJ={kernelName:Pd,backendName:"webgl",kernelFunc:LJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WD="return (a < 0.) ? b * a : a;",UD=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function zJ(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e,o=oe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Gu(UD,s.shape,r.shape):new vi(WD,s.shape,r.shape);return t.runWebGLProgram(o,[s,r],"float32")}const MJ={kernelName:nh,backendName:"webgl",kernelFunc:zJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hu="if (isnan(x)) return x;";function rt({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:s}){return({inputs:r,backend:o})=>{const{x:a}=r,i=o,l=s||a.dtype;if(i.shouldExecuteOnCPU([a])&&t!=null){const p=i.texData.get(a.dataId),f=t(p.values,l);return i.makeTensorInfo(a.shape,l,f)}const c=oe().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let h;return c?h=new ta(a.shape,e):h=new Pr(a.shape,n),i.runWebGLProgram(h,[a],l)}}function $n({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:o}){return({inputs:a,backend:i})=>{const{a:l,b:c}=a,h=i;if(s&&l.dtype==="complex64"){const y=h.texData.get(l.dataId),w=h.texData.get(c.dataId),[x,v]=[[y.complexTensorInfos.real,w.complexTensorInfos.real],[y.complexTensorInfos.imag,w.complexTensorInfos.imag]].map(I=>{const[N,T]=I,D={dataId:N.dataId,dtype:N.dtype,shape:l.shape},P={dataId:T.dataId,dtype:T.dtype,shape:c.shape},z=new vi(n,l.shape,c.shape);return h.runWebGLProgram(z,[D,P],Jn(N.dtype,T.dtype))}),k=$a({inputs:{real:x,imag:v},backend:h});return h.disposeIntermediateTensorInfo(x),h.disposeIntermediateTensorInfo(v),k}const p=o||Jn(l.dtype,c.dtype);if((l.dtype==="string"||c.dtype==="string"||h.shouldExecuteOnCPU([l,c]))&&r!=null){const y=h.texData.get(l.dataId).values,w=h.texData.get(c.dataId).values,x=l.dtype==="string"?xo(y):y,v=l.dtype==="string"?xo(w):w,[k,I]=r(l.shape,c.shape,x,v,p),N=h.makeTensorInfo(I,p),T=h.texData.get(N.dataId);return T.values=k,N}const f=oe().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let g;return f?g=new Gu(e,l.shape,c.shape,t):g=new vi(n,l.shape,c.shape),h.runWebGLProgram(g,[l,c],p)}}function ud(n,e=!1){if(n==="linear")return e?wJ:mJ;if(n==="relu")return e?kJ:yJ;if(n==="elu")return e?vJ:gJ;if(n==="relu6")return e?SJ:xJ;if(n==="prelu")return e?UD:WD;if(n==="leakyrelu")return e?VD:BD;if(n==="sigmoid")return e?NJ:bJ;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jD{constructor(e,t,s,r=!1,o=!1,a=!1,i=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=On(this.outputShape.length);const h=r?e[1]:e[2],p=Math.ceil(h/2),f=r?"i * 2, rc.y":"rc.y, i * 2",g=o?"rc.z, i * 2":"i * 2, rc.z",y=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],w=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let x="",v="";i&&(l?x=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${i}
        }`:c?x=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${i}
        }`:x=`vec4 activation(vec4 x) {
          ${i}
        }`,v="result = activation(result);");const k=a?"result += getBiasAtOutCoords();":"";a&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let I="rc.x",N="rc.x";e[0]<t[0]?I=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(N=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${x}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${p}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${I};
        int batchB = ${N};
        for (int i = 0; i < ${p}; i++) {
          vec4 a = getMatrixA(batchA, ${f});
          vec4 b = getMatrixB(batchB, ${g});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${y[0]} * ${w[0]});
          result += (${y[1]} * ${w[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${k}

        ${v}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EI={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class RI{constructor(e,t,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=He(t,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AI="return a * b;";function Kv(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,o=Jn(s.dtype,r.dtype);if(s.dtype==="complex64"){const i=t.texData.get(s.dataId),l=t.texData.get(r.dataId),c=new RI(EI.REAL,s.shape,r.shape),h=new RI(EI.IMAG,s.shape,r.shape),p=[{dataId:i.complexTensorInfos.real.dataId,dtype:i.complexTensorInfos.real.dtype,shape:s.shape},{dataId:i.complexTensorInfos.imag.dataId,dtype:i.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],f=t.runWebGLProgram(c,p,"float32"),g=t.runWebGLProgram(h,p,"float32"),y=$a({inputs:{real:f,imag:g},backend:t});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(g),y}if(t.shouldExecuteOnCPU([s,r])){const i=t.texData.get(s.dataId),l=t.texData.get(r.dataId),[c,h]=zZ(s.shape,r.shape,i.values,l.values,o),p=t.makeTensorInfo(h,o),f=t.texData.get(p.dataId);return f.values=c,p}let a;return oe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?a=new Gu(AI,s.shape,r.shape):a=new vi(AI,s.shape,r.shape),t.runWebGLProgram(a,[s,r],o)}const BJ={kernelName:du,backendName:"webgl",kernelFunc:Kv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VJ(n,e,t){const s=[Dl(n.shape),..._l(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},o=[Dl(e),..._l(e)],a=new MD(o,s),i=!0,l=[s],c=t.runWebGLProgram(a,[r],n.dtype,l,i);return{dataId:c.dataId,shape:e,dtype:c.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ce(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:o}=s,a=t,i=ce(r.shape),l=dw(o,i),c=ce(l);A(i===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${r.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`);const h=a.texData.get(r.dataId);return h.isPacked&&!hm(r.shape,l)&&!(h.texture!==null&&hm(h.shape,l))?VJ(r,l,a):(a.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const WJ={kernelName:rh,backendName:"webgl",kernelFunc:Ce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DI{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:a}=e;this.outputShape=[r,a];const i=Math.floor(s/4)*4,l=s%4;let c="sumValue += dot(values, ones);";if(t!=null){const p=1/t;c=`sumValue += dot(values * ${ii(p)?p.toPrecision(2):p}, ones);`}let h="";o%s>0&&(h=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${h}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${i}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${i};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UJ{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:a}=e;this.outputShape=[r,a];let i="0.0",l="";t==="prod"?i="1.0":t==="min"?(i="1.0 / 1e-20",l="min"):t==="max"&&(i="-1.0 / 1e-20",l="max");let c=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?c="sumValue":t==="prod"?c="prodValue":t==="all"?c="allValue":t==="any"&&(c="anyValue");const h=Math.floor(s/4)*4,p=s%4;let f=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,g="vec4";t==="all"?(i="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,g="bvec4"):t==="any"&&(i="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,g="bvec4");let y="";o%s>0&&(y=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${i};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${y}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${i});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${f}
        }

        int inIdx = inOffset + ${h};
        if (${p===1}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${p===2}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${p===3}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${f}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jJ(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],s=py(t);e.push({inSize:t,windowSize:s,outSize:Math.ceil(t/s)})}return e}function Pi(n,e,t,s){const r=jJ(n.shape);let o=n;for(let a=0;a<r.length;a++){const{inSize:i,windowSize:l,outSize:c}=r[a];let h,p;t==="mean"?h=a===0?new DI({windowSize:l,inSize:i,batchSize:n.shape[0],outSize:c},i):new DI({windowSize:l,inSize:i,batchSize:n.shape[0],outSize:c}):h=new UJ({windowSize:l,inSize:i,batchSize:n.shape[0],outSize:c},t),p=o,o=s.runWebGLProgram(h,[o],e),p.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(p)}return o}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GJ{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let a=0;a<s.length;a++)s[a]=e[t[a]];this.outputShape=s,this.rank=s.length;const r=yt(this.rank),o=HJ(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${o}));
    }
    `}}function HJ(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<n.length;r++)s[n[r]]=t[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qJ{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let h=0;h<s.length;h++)s[h]=e[t[h]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=yt(this.rank),o=zD("rc",this.rank),a=new Array(this.rank);for(let h=0;h<t.length;h++)a[t[h]]=o[h];const i=`vec2(${a.slice(-2).join()})`,l=`++${o[this.rank-1]} < ${s[this.rank-1]}`,c=`getChannel(getA(${a.join()}), ${i})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${o[this.rank-1]};
      if(++${o[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ry(n,e,t){const s=oe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new qJ(n.shape,e):new GJ(n.shape,e);return t.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KJ(n,e,t,s){const r=e,o=n.shape.length,a=Qe(r,n.shape);let i=a;const l=Lt(i,o),c=l!=null;let h=n;c&&(h=Ry(n,l,s),i=jt(i.length,o)),Cn("sum",i,o);const[p,f]=mn(h.shape,i);let g=p;t&&(g=Ut(p,a));const y=ce(f),x=ce(n.shape)/y,v=Ce({inputs:{x:h},attrs:{shape:[x,y]},backend:s}),k=$g(n.dtype),I=Pi(v,k,"sum",s),N=Ce({inputs:{x:I},attrs:{shape:g},backend:s});return s.disposeIntermediateTensorInfo(v),s.disposeIntermediateTensorInfo(I),c&&s.disposeIntermediateTensorInfo(h),N}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ay(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:a}=s;return KJ(r,o,a,t)}const XJ={kernelName:ch,backendName:"webgl",kernelFunc:Ay};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jn(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{perm:o}=s,a=t,i=r.shape.length,l=new Array(i);for(let h=0;h<l.length;h++)l[h]=r.shape[o[h]];let c;if(a.shouldExecuteOnCPU([r])){const p=a.texData.get(r.dataId).values,f=Hv(p,r.shape,r.dtype,o,l);c=a.makeTensorInfo(l,r.dtype);const g=a.texData.get(c.dataId);g.values=f}else c=Ry(r,o,a);return c}const YJ={kernelName:si,backendName:"webgl",kernelFunc:jn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GD=1e3;function pm({a:n,b:e,transposeA:t,transposeB:s,backend:r,bias:o=null,preluActivationWeights:a=null,leakyreluAlpha:i=0,activation:l=null}){const c=n.shape.length,h=e.shape.length,p=t?n.shape[c-2]:n.shape[c-1],f=s?e.shape[h-1]:e.shape[h-2],g=t?n.shape[c-1]:n.shape[c-2],y=s?e.shape[h-2]:e.shape[h-1],w=n.shape.slice(0,-2),x=e.shape.slice(0,-2),v=ce(w),k=ce(x),N=He(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([g,y]);A(p===f,()=>`Error in matMul: inner shapes (${p}) and (${f}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${s} must match.`);const T=t?[v,p,g]:[v,g,p],D=s?[k,y,f]:[k,f,y],P=Ce({inputs:{x:n},backend:r,attrs:{shape:T}}),z=Ce({inputs:{x:e},backend:r,attrs:{shape:D}}),F=[P,z],L=Math.max(v,k),E=t?P.shape[1]:P.shape[2],j=o!=null,Z=a!=null,ne=l==="leakyrelu",te=l!=null?ud(l,!0):null,se=j||Z||ne||te!=null;let K;if((g===1||y===1)&&E>GD&&se===!1){let J=P,X=z;t&&(J=jn({inputs:{x:P},backend:r,attrs:{perm:[0,2,1]}}),F.push(J)),s&&(X=jn({inputs:{x:z},backend:r,attrs:{perm:[0,2,1]}}),F.push(X));const M=y!==1,H=y===1;let le=J;M&&(le=Ce({inputs:{x:J},backend:r,attrs:{shape:[L,E,1]}}),F.push(le));const he=y===1?2:1;let pe=X;H&&(pe=Ce({inputs:{x:X},backend:r,attrs:{shape:[L,1,E]}}),F.push(pe));const ge=Kv({inputs:{a:le,b:pe},backend:r});K=Ay({inputs:{x:ge},backend:r,attrs:{axis:he,keepDims:!0}}),F.push(ge)}else{const J=Jn(n.dtype,e.dtype),X=new jD(T,D,[L,g,y],t,s,j,te,Z,ne),M=[P,z];if(o!=null&&M.push(o),Z&&M.push(a),ne){const H=r.makeTensorInfo([],"float32",wo(i,"float32"));M.push(H),F.push(H)}K=r.runWebGLProgram(X,M,J)}const B=Ce({inputs:{x:K},backend:r,attrs:{shape:N}});F.push(K);for(const J of F)r.disposeIntermediateTensorInfo(J);return B}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QJ(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o,bias:a,preluActivationWeights:i}=e,{transposeA:l,transposeB:c,activation:h,leakyreluAlpha:p}=s;return pm({a:r,b:o,transposeA:l,transposeB:c,backend:t,bias:a,preluActivationWeights:i,leakyreluAlpha:p,activation:h})}const ZJ={kernelName:qc,backendName:"webgl",kernelFunc:QJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _I="return abs(x);";function JJ(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const o=t.texData.get(s.dataId),a=LD(o.values);return t.makeTensorInfo(s.shape,s.dtype,a)}let r;return oe().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new ta(s.shape,_I):r=new Pr(s.shape,_I),t.runWebGLProgram(r,[s],s.dtype)}const eee={kernelName:md,backendName:"webgl",kernelFunc:JJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tee=nr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,nee=rt({opSnippet:tee}),see={kernelName:Ll,backendName:"webgl",kernelFunc:nee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ree=nr+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,oee=rt({opSnippet:ree}),aee={kernelName:Pl,backendName:"webgl",kernelFunc:oee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OI="return a + b;",iee=$n({opSnippet:OI,packedOpSnippet:OI,supportsComplex:!0,cpuKernelImpl:yZ}),lee={kernelName:$i,backendName:"webgl",kernelFunc:iee};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uee{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((o,a)=>`T${a}`);const s=[];this.variableNames.forEach(o=>{s.push(`float v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cee{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((o,a)=>`T${a}`);const s=[];this.variableNames.forEach(o=>{s.push(`vec4 v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pf(n){const{inputs:e,backend:t}=n,s=e;if(s.length===1)return ws({inputs:{x:s[0]},backend:t});if(s.length>oe().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),c=Pf({inputs:s.slice(0,l),backend:t}),h=Pf({inputs:s.slice(l),backend:t});return Pf({inputs:[c,h],backend:t})}const r=s.map(l=>l.dtype).reduce((l,c)=>Jn(l,c)),o=s.map(l=>l.shape),i=oe().getBool("WEBGL_PACK")?new cee(s[0].shape,o):new uee(s[0].shape,o);return t.runWebGLProgram(i,s,r)}const dee={kernelName:gd,backendName:"webgl",kernelFunc:Pf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:a}=s,i=r.shape.length,l=Qe(o,r.shape);let c=l;const h=Lt(c,i);let p=r;h!=null&&(p=jn({inputs:{x:r},backend:t,attrs:{perm:h}}),c=jt(c.length,i)),Cn("all",c,i);const[f,g]=mn(p.shape,c),y=ce(g),w=Ce({inputs:{x:p},backend:t,attrs:{shape:[-1,y]}}),x=Pi(w,w.dtype,"all",t);let v;if(a){const k=Ut(f,l);v=Ce({inputs:{x},backend:t,attrs:{shape:k}})}else v=Ce({inputs:{x},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(x),h!=null&&t.disposeIntermediateTensorInfo(p),v}const pee={kernelName:vm,backendName:"webgl",kernelFunc:hee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:a}=s,i=r.shape.length,l=Qe(o,r.shape);let c=l;const h=Lt(c,i);let p=r;h!=null&&(p=jn({inputs:{x:r},backend:t,attrs:{perm:h}}),c=jt(c.length,i)),Cn("any",c,i);const[f,g]=mn(p.shape,c),y=ce(g),w=Ce({inputs:{x:p},backend:t,attrs:{shape:[-1,y]}}),x=Pi(w,w.dtype,"any",t);let v;if(a){const k=Ut(f,l);v=Ce({inputs:{x},backend:t,attrs:{shape:k}})}else v=Ce({inputs:{x},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(x),h!=null&&t.disposeIntermediateTensorInfo(p),v}const mee={kernelName:km,backendName:"webgl",kernelFunc:fee};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gee{constructor(e,t,s){this.variableNames=["A"];const{windowSize:r,batchSize:o,outSize:a}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[o,a];const i=t==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${i} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yee{constructor(e,t,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,A(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const o=e[e.length-1],a=Math.ceil(o/t);this.outputShape=e.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");const i=this.outputShape,l=i.length,c=yt(l),h=Un("coords",l);let p,f;if(a===1){f=l+1;const z=yt(f);p=`
        ${z} sourceLocR = ${z}(${h.join()}, 0);
        ++${h[l-1]};
        ${z} sourceLocG = ${z}(${h.join()}, 0);
        ++${h[l-2]};
        ${z} sourceLocA = ${z}(${h.join()}, 0);
        --${h[l-1]};
        ${z} sourceLocB = ${z}(${h.join()}, 0);
        --${h[l-2]};`}else f=l,p=`
        ${c} sourceLocR = coords;
        ++${h[l-1]};
        ${c} sourceLocG = coords;
        ++${h[l-2]};
        ${c} sourceLocA = coords;
        --${h[l-1]};
        ${c} sourceLocB = coords;
        --${h[l-2]};`;const g=["x","y","z","w","u","v"].slice(0,f),y="."+g[f-1],w=g.map(z=>"int "+z),x=Un("sourceLocR",f-1).concat("inIdx.r"),v=Un("sourceLocG",f-1).concat("inIdx.g"),k=Un("sourceLocB",f-1).concat("inIdx.b"),I=Un("sourceLocA",f-1).concat("inIdx.a"),N=s==="max"?"greaterThan":"lessThan",T=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${k.join()}),
                             getBestIndicesAChannel(${I.join()})));`,D=`vec4(
            getAChannel(${x.join()}),
            hasNextCol ? getAChannel(${v.join()}) : 0.,
            hasNextRow ? getAChannel(${k.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${I.join()}) : 0.)`,P=r?"":`
      float getBestIndicesAChannel(${w.join()}) {
        return getChannel(getBestIndicesA(${g.join()}),
                                          vec2(${g.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${w.join()}) {
        return getChannel(getA(${g.join()}),
                               vec2(${g.slice(-2).join()}));
      }
      ${P}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${h[l-1]} < ${i[l-1]-1};
        bool hasNextRow = ${h[l-2]} < ${i[l-2]-1};
        ${p}
        ivec4 srcIdx = ivec4(sourceLocR${y}, sourceLocG${y},
          sourceLocB${y}, sourceLocA${y}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${D};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${T}
          vec4 candidate = ${D};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${N}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HD(n,e,t,s=null){let r=e.shape[0],o=e.shape[1];s!=null&&(r=s.shape[0],o=s.shape[1]);const a=py(o),i={windowSize:a,inSize:o,batchSize:r,outSize:Math.ceil(o/a)},l=new gee(i,t,s==null),c=[e];s!=null&&c.push(s);const h=n.runWebGLProgram(l,c,"int32");if(h.shape[1]===1)return h;const p=HD(n,e,t,h);return n.disposeIntermediateTensorInfo(h),p}function qD(n,e,t,s=null){const r=s!=null?s.shape:e.shape,o=r[r.length-1],a=py(o),i=new yee(r,a,t,s==null),l=s==null?[e]:[e,s],c=n.runWebGLProgram(i,l,"int32");if(c.shape.length===e.shape.length){const h=qD(n,e,t,c);return n.disposeIntermediateTensorInfo(c),h}return c}function KD(n,e,t,s){const r=[t];if(Cn("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!oe().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const o=[],a=n.texData.get(e.dataId),i=a!==null&&a.isPacked;let l=e;i&&(l=n.unpackTensor(e),o.push(l));const[c,h]=mn(l.shape,r),p=ce(h),f=Ce({inputs:{x:l},backend:n,attrs:{shape:[-1,p]}});o.push(f);const g=HD(n,f,s);o.push(g);const y=Ce({inputs:{x:g},backend:n,attrs:{shape:c}});return o.forEach(w=>n.disposeIntermediateTensorInfo(w)),y}return qD(n,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;let a=Qe(o,r.shape);const i=Lt(a,r.shape.length);let l=r;const c=[];i!=null&&(l=jn({inputs:{x:r},backend:t,attrs:{perm:i}}),c.push(l),a=jt(a.length,l.shape.length)),Cn("argMax",[a[0]],l.shape.length);const h=KD(t,l,a[0],"max");return c.forEach(p=>t.disposeIntermediateTensorInfo(p)),h}const bee={kernelName:yd,backendName:"webgl",kernelFunc:xee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;let a=Qe(o,r.shape);const i=Lt(a,r.shape.length);let l=r;const c=[];i!=null&&(l=jn({inputs:{x:r},backend:t,attrs:{perm:i}}),c.push(l),a=jt(a.length,l.shape.length)),Cn("argMin",[a[0]],l.shape.length);const h=KD(t,l,a[0],"min");return c.forEach(p=>t.disposeIntermediateTensorInfo(p)),h}const vee={kernelName:xd,backendName:"webgl",kernelFunc:wee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kee=nr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,See=rt({opSnippet:kee}),Nee={kernelName:zl,backendName:"webgl",kernelFunc:See};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cee=nr+"return log(x + sqrt(x * x + 1.0));",Iee=rt({opSnippet:Cee}),$ee={kernelName:Ml,backendName:"webgl",kernelFunc:Iee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tee=nr+`
  return atan(x);
`,Eee=rt({opSnippet:Tee}),Ree={kernelName:Bl,backendName:"webgl",kernelFunc:Eee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aee=qv+`
  return atan(a, b);
`,Dee=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Li+`
  return result;
`,_ee=$n({opSnippet:Aee,packedOpSnippet:Dee}),Oee={kernelName:Wl,backendName:"webgl",kernelFunc:_ee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fee=nr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Lee=rt({opSnippet:Fee}),Pee={kernelName:Vl,backendName:"webgl",kernelFunc:Lee};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cd{constructor(e,t,s,r=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const a=e.filterWidth,i=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,h=e.dilationWidth,p=e.effectiveFilterHeight,f=e.effectiveFilterWidth,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;const w=t==="avg",x=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,v=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let k="0.0";if(w||(k="-1.0 / 1e-20"),s){const z=">=";this.userCode=`
        const ivec2 strides = ivec2(${i}, ${l});
        const ivec2 pads = ivec2(${g}, ${y});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${p};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f};
                wC += ${h}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${z} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?o?x:v:`wR * ${f} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const I="max";let N=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(N="avgValue / max(count, 1.0)");const T=Math.floor(a/4)*4,D=a%4,P=`
      if (${w}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${I}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${l});
      const ivec2 pads = ivec2(${g}, ${y});
      const float initializationValue = ${k};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${k});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${p};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${T}; wC += 4) {
            int xC = xCCorner + wC * ${h};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              getValue(batch, xR, xC + 3 * ${h}, d)
            );

            ${P}
          }

          int xC = xCCorner + ${T};
          if (${D===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${P}
          } else if (${D===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              initializationValue,
              initializationValue
            );

            ${P}
          } else if (${D===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${h}, d),
              getValue(batch, xR, xC + 2 * ${h}, d),
              initializationValue
            );

            ${P}
          }
        }
        setOutput(${N});
      }
    `}}class Xv{constructor(e,t,s,r=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const a=e.filterWidth,i=e.strideDepth,l=e.strideHeight,c=e.strideWidth,h=e.dilationDepth,p=e.dilationHeight,f=e.dilationWidth,g=e.effectiveFilterDepth,y=e.effectiveFilterHeight,w=e.effectiveFilterWidth,x=e.padInfo.front,v=e.padInfo.top,k=e.padInfo.left;this.outputShape=e.outShape;const I=t==="avg";let N="0.0";if(I||(N="-1.0 / 1e-20"),s){const L=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${i}, ${l}, ${c});
        const ivec3 pads = ivec3(${x}, ${v}, ${k});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${g};
              wD += ${h}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${y};
                wR += ${p}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${w};
                  wC += ${f}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${L} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?o?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${y} * ${w} +
                      wR * ${w} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const T="max";let D=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(D="avgValue / max(count, 1.0)");const P=Math.floor(a/4)*4,z=a%4,F=`
      if (${I}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${T}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${i}, ${l}, ${c});
      const ivec3 pads = ivec3(${x}, ${v}, ${k});
      const float initializationValue = ${N};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${N});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${g};
            wD += ${h}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${y};
            wR += ${p}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${P}; wC += 4) {
              int xC = xCCorner + wC * ${f};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                getValue(batch, xD, xR, xC + 3 * ${f}, ch)
              );

              ${F}
            }

            int xC = xCCorner + ${P};
            if (${z===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${F}
            } else if (${z===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                initializationValue,
                initializationValue
              );

              ${F}
            } else if (${z===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                initializationValue
              );

              ${F}
            }
          }
        }
        setOutput(${D});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Yh(r,"avgPool");const{filterSize:o,strides:a,pad:i,dimRoundingMode:l}=s,c=1;A(Nn(a,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${a} and dilations '${c}'`);const h=er(r.shape,o,a,c,i,l);if(h.filterWidth===1&&h.filterHeight===1&&Je(h.inShape,h.outShape))return ws({inputs:{x:r},backend:t});const p=new cd(h,"avg",!1);return t.runWebGLProgram(p,[r],"float32")}const Mee={kernelName:bd,backendName:"webgl",kernelFunc:zee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:a,pad:i,dimRoundingMode:l,dataFormat:c}=s,h=[1,1,1],p=vo(r.shape,o,a,h,i,l,c),f=new Xv(p,"avg",!1);return t.runWebGLProgram(f,[r],"float32")}const Vee={kernelName:wd,backendName:"webgl",kernelFunc:Bee};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wee{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=e.dilationHeight,i=e.dilationWidth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,h=l-1-e.padInfo.top,p=c-1-e.padInfo.left,f=1/(t*s);this.userCode=`
      const ivec2 pads = ivec2(${h}, ${p});
      const float avgMultiplier = float(${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${a}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${i}) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class Uee{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,h=e.dilationWidth,p=e.effectiveFilterDepth,f=e.effectiveFilterHeight,g=e.effectiveFilterWidth,y=p-1-e.padInfo.front,w=f-1-e.padInfo.top,x=g-1-e.padInfo.left,v=1/(t*s*r);this.userCode=`
      const ivec3 pads = ivec3(${y}, ${w}, ${x});
      const float avgMultiplier = float(${v});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${o}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${f};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${a}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${g};
                wC += ${h}) {
              float dyC = float(dyCCorner + wC) / ${i}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jee(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,a=o,{filterSize:i,strides:l,pad:c,dimRoundingMode:h}=s,p=[1,1,1],f=vo(a.shape,i,l,p,c,h),g=new Uee(f);return t.runWebGLProgram(g,[r],a.dtype)}const Gee={kernelName:Nm,backendName:"webgl",kernelFunc:jee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hee(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,a=o;Yh([r,o],"avgPoolGrad");const{filterSize:i,strides:l,pad:c}=s,h=er(a.shape,i,l,1,c),p=new Wee(h);return t.runWebGLProgram(p,[r],a.dtype)}const qee={kernelName:Sm,backendName:"webgl",kernelFunc:Hee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kee(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o}=e,{transposeA:a,transposeB:i}=s;return pm({a:r,b:o,transposeA:a,transposeB:i,backend:t})}const Xee={kernelName:vd,backendName:"webgl",kernelFunc:Kee};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yee{constructor(e,t,s,r,o,a){this.outputShape=[],this.variableNames=["x","mean","variance"],He(e,t),He(e,s);let i="0.0";r!=null&&(He(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");let l="1.0";o!=null&&(He(e,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${i};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${a}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qee{constructor(e,t,s,r,o,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],He(e,t),He(e,s);let i="vec4(0.0)";r!=null&&(He(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");let l="vec4(1.0)";o!=null&&(He(e,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${i};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${a}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zee=({inputs:n,backend:e,attrs:t})=>{const{x:s,mean:r,variance:o,offset:a,scale:i}=n;A(r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),A(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),A(i==null||r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=t;l==null&&(l=.001);const c=[s,r,o];let h=null;a!=null&&(h=a.shape,c.push(a));let p=null;i!=null&&(p=i.shape,c.push(i));const f=oe().getBool("WEBGL_PACK_NORMALIZATION")?new Qee(s.shape,r.shape,o.shape,h,p,l):new Yee(s.shape,r.shape,o.shape,h,p,l);return e.runWebGLProgram(f,c,c[0].dtype)},Jee={kernelName:Od,backendName:"webgl",kernelFunc:Zee};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ete{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=yt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=tte(this.rank);let r;const o=e.map((a,i)=>`sourceLoc.${tw[i]} = start[${i}] + coords.${tw[i]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${o.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const tw=["x","y","z","w","u","v"];function tte(n){if(n===1)return"sourceLoc";if(n<=6)return tw.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nte{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=yt(this.rank),s=Un("coords",this.rank),r=Un("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,a=`getChannel(getSource(${r.join()}), ${o})`,i=`
      result.x = ${a};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${a};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${a};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${a};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((h,p)=>`start[${p}]`).join()});`:e.map((h,p)=>`${r[p]} = ${s[p]} + start[${p}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${i}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ste(n,e,t,s){const r=s.texData.get(n.dataId),o=s.makeTensorInfo(t,n.dtype),a=s.texData.get(o.dataId);Object.assign(a,r),a.refCount=1,a.shape=t,a.dtype=n.dtype;let i=W1(e,ze(n.shape));r.slice&&(i+=r.slice.flatOffset),a.slice={flatOffset:i,origDataId:r.slice&&r.slice.origDataId||n.dataId};const l=s.dataRefCount.get(a.slice.origDataId)||1;return s.dataRefCount.set(a.slice.origDataId,l+1),o}function qu(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,size:a}=s,[i,l]=hy(r,o,a);if(M1(r,i,l),ce(l)===0)return t.makeTensorInfo(l,r.dtype,[]);if(t.shouldExecuteOnCPU([r])||r.dtype==="string"){const p=t.texData.get(r.dataId),f=XZ(p.values,i,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,f)}const{isPacked:c}=t.texData.get(r.dataId),h=V1(r.shape,i,l);if(c||!h){const p=oe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new nte(l):new ete(l),f=[i];return t.runWebGLProgram(p,[r],r.dtype,f)}return t.uploadToGPU(r.dataId),ste(r,i,l,t)}const rte={kernelName:uh,backendName:"webgl",kernelFunc:qu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ote=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,crops:a}=s;A(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const i=o.reduce((k,I)=>k*I),l=Ph(r.shape,o,i),c=zh(l.length,o.length),h=Mh(r.shape,o,i),p=K1(a,o.length),f=X1(h,a,o.length),g=[],y=Ce({inputs:{x:r},backend:t,attrs:{shape:l}}),w=jn({inputs:{x:y},backend:t,attrs:{perm:c}}),x=Ce({inputs:{x:w},backend:t,attrs:{shape:h}}),v=qu({inputs:{x},backend:t,attrs:{begin:p,size:f}});return g.push(y),g.push(w),g.push(x),g.forEach(k=>t.disposeIntermediateTensorInfo(k)),v},ate={kernelName:kd,backendName:"webgl",kernelFunc:ote};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ite(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:a}=s,i=t.readSync(r.dataId),l=t.readSync(o.dataId),c=FD(i,l,o.dtype,o.shape,a);return t.makeTensorInfo([a],o.dtype,c)}const lte={kernelName:Cm,backendName:"webgl",kernelFunc:ite};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ute=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,cte=`
  return float(int(a.r) & int(b.r));
`;function dte(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,o=oe().getBool("WEBGL_PACK_BINARY_OPERATIONS"),a=oe().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([s,r])||a===1){const l=t.texData.get(s.dataId).values,c=t.texData.get(r.dataId).values,[h,p]=bZ(s.shape,r.shape,l,c,s.dtype),f=t.makeTensorInfo(p,s.dtype),g=t.texData.get(f.dataId);return g.values=h,f}let i;return o?i=new Gu(ute,s.shape,r.shape,!1):i=new vi(cte,s.shape,r.shape),t.runWebGLProgram(i,[s,r],s.dtype)}const hte={kernelName:Sd,backendName:"webgl",kernelFunc:dte};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pte(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,o=t.readSync(s.dataId),a=t.readSync(r.dataId),i=He(Array.from(o),Array.from(a));return t.makeTensorInfo([i.length],"int32",Int32Array.from(i))}const fte={kernelName:Im,backendName:"webgl",kernelFunc:pte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mte="return float(a != b);",XD=$n({opSnippet:mte,cpuKernelImpl:BZ,dtype:"bool"}),gte={kernelName:Qd,backendName:"webgl",kernelFunc:XD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zh(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return ws({inputs:{x:r.complexTensorInfos.real},backend:t})}const yte={kernelName:ag,backendName:"webgl",kernelFunc:Zh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xte="return float(int(x));";function bte(n,e){const t=new Pr(n.shape,xte),s=e.runWebGLProgram(t,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nw(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return ws({inputs:{x:r},backend:t});const a=Vt(r.shape),i=nw({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),l=$a({inputs:{real:i,imag:a},backend:t});return a.dispose(),t.disposeIntermediateTensorInfo(i),l}if(r.dtype==="complex64"){const a=Zh({inputs:{input:r},backend:t}),i=nw({inputs:{x:a},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(a),i}if(!hw(r.dtype,o)){const a=ws({inputs:{x:r},backend:t});return{dataId:a.dataId,shape:a.shape,dtype:o}}if(t.shouldExecuteOnCPU([r])){const a=t.texData.get(r.dataId).values,[i,l,c]=wZ(a,r.shape,r.dtype,o);return t.makeTensorInfo(i,l,c)}if(o==="int32")return bte(r,t);if(o==="bool"){const a=t.makeTensorInfo([],"bool",hn("bool",1)),l=XD({inputs:{a:r,b:a},backend:t});return t.disposeIntermediateTensorInfo(a),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${o}`)}const wte={kernelName:Ul,backendName:"webgl",kernelFunc:nw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FI="return ceil(x);",vte=rt({opSnippet:FI,packedOpSnippet:FI,cpuKernelImpl:vZ}),kte={kernelName:jl,backendName:"webgl",kernelFunc:vte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ste{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nte{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{clipValueMin:o,clipValueMax:a}=s;let i;oe().getBool("WEBGL_PACK_CLIP")?i=new Nte(r.shape):i=new Ste(r.shape);const l=[[o],[a]];return t.runWebGLProgram(i,[r],r.dtype,l)}const Ite={kernelName:Gl,backendName:"webgl",kernelFunc:Cte};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $te{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LI(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function Tte(n){const{inputs:e,backend:t}=n,{x:s}=e,r=t.texData.get(s.dataId),o=new $te(s.shape),a=[LI(s,r.complexTensorInfos.real),LI(s,r.complexTensorInfos.imag)];return t.runWebGLProgram(o,a,a[0].dtype)}const Ete={kernelName:Nd,backendName:"webgl",kernelFunc:Tte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rte{constructor(e){this.outputShape=[],this.outputShape=Br(e,1),this.variableNames=e.map((a,i)=>`T${i}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let a=1;a<t.length;a++)t[a]=t[a-1]+e[a][1];const s=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let a=1;a<t.length;a++){const i=t[a-1];s.push(`else if (yC < ${t[a]}) setOutput(getT${a}(yR, yC-${i}));`)}const r=t.length,o=t[t.length-1];s.push(`else setOutput(getT${r}(yR, yC-${o}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ate{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Br(e,t);const s=this.outputShape,r=s.length,o=yt(r),a=Un("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((w,x)=>`T${x}`);const l=new Array(e.length-1);l[0]=e[0][t];for(let w=1;w<l.length;w++)l[w]=l[w-1]+e[w][t];const c=i[t],h=i.slice(-2),p=i.join();let f=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${p}), vec2(${h.join()}));
        }`;for(let w=1;w<l.length;w++){const x=l[w-1];f+=`
        if (${c} < ${l[w]}  && ${c} >= ${l[w-1]}) {
          return getChannel(
            getT${w}(${Nf(i,c,x)}),
            vec2(${Nf(h,c,x)}));
        }`}const g=l.length,y=l[l.length-1];f+=`
        return getChannel(
          getT${g}(${Nf(i,c,y)}),
          vec2(${Nf(h,c,y)}));`,this.userCode=`
      float getValue(${i.map(w=>"int "+w)}) {
        ${f}
      }

      void main() {
        ${o} coords = getOutputCoords();
        vec4 result = vec4(getValue(${a}), 0., 0., 0.);

        ${a[r-1]} = ${a[r-1]} + 1;
        if (${a[r-1]} < ${s[r-1]}) {
          result.g = getValue(${a});
        }

        ${a[r-2]} = ${a[r-2]} + 1;
        if (${a[r-2]} < ${s[r-2]}) {
          result.a = getValue(${a});
        }

        ${a[r-1]} = ${a[r-1]} - 1;
        if (${a[r-2]} < ${s[r-2]} &&
            ${a[r-1]} < ${s[r-1]}) {
          result.b = getValue(${a});
        }
        setOutput(result);
      }
    `}}function Nf(n,e,t){const s=n.indexOf(e);return n.map((o,a)=>a===s?`${o} - ${t}`:o).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dy(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return ws({inputs:{x:r.complexTensorInfos.imag},backend:t})}const Dte={kernelName:Hm,backendName:"webgl",kernelFunc:Dy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bc(n,e,t){const s=n[0].dtype;if(s==="complex64"){const g=n.map(k=>Zh({inputs:{input:k},backend:t})),y=n.map(k=>Dy({inputs:{input:k},backend:t})),w=Bc(g,e,t),x=Bc(y,e,t),v=$a({inputs:{real:w,imag:x},backend:t});return g.forEach(k=>t.disposeIntermediateTensorInfo(k)),y.forEach(k=>t.disposeIntermediateTensorInfo(k)),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(x),v}let r=t.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const g=n.map(N=>{const D=[-1,ce(N.shape.slice(e))];return Ce({inputs:{x:N},backend:t,attrs:{shape:D}})}),y=g.map(N=>({vals:t.readSync(N.dataId),shape:N.shape})),w=Br(g.map(N=>N.shape),1),x=g[0].shape[0]===1,v=kZ(y,w,s,x),k=Br(n.map(N=>N.shape),e),I=t.makeTensorInfo(k,s,v);return g.forEach(N=>t.disposeIntermediateTensorInfo(N)),I}const o=n.filter(g=>ce(g.shape)>0),a=oe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&o[0].shape.length>1;if(o.length===1){const g=a?new Pr(n[0].shape,Qo):new ta(n[0].shape,Qo);return t.runWebGLProgram(g,n,s)}const i=oe().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(o.length>i){const g=[];for(let w=0;w<o.length;w+=i){const x=o.slice(w,w+i);g.push(Bc(x,e,t))}const y=Bc(g,e,t);for(const w of g)t.disposeIntermediateTensorInfo(w);return y}if(a){const g=new Ate(o.map(y=>y.shape),e);return t.runWebGLProgram(g,o,s)}const{tensors2D:l,outShape:c}=_te(o,e,t),h=new Rte(l.map(g=>g.shape)),p=t.runWebGLProgram(h,l,s);l.forEach(g=>t.disposeIntermediateTensorInfo(g));const f=Ce({inputs:{x:p},attrs:{shape:c},backend:t});return t.disposeIntermediateTensorInfo(p),f}function _te(n,e,t){const s=Br(n.map(o=>o.shape),e);return{tensors2D:n.map(o=>Ce({inputs:{x:o},attrs:{shape:[-1,ce(o.shape.slice(e))]},backend:t})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YD(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,o=Qe(r,e[0].shape)[0],a=e.map(c=>c.shape);G1(a,o);const i=Br(e.map(c=>c.shape),o);if(ce(i)===0)return t.makeTensorInfo(i,e[0].dtype,[]);const l=e.filter(c=>ce(c.shape)>0);return l.length===1?ws({inputs:{x:l[0]},backend:t}):Bc(l,o,t)}const Ote={kernelName:Cd,backendName:"webgl",kernelFunc:YD};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QD{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const a=e.padInfo.top,i=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,h=e.dilationHeight,p=e.dilationWidth,f=e.filterHeight,g=e.filterWidth,y=Math.floor(e.inChannels/4)*4,w=e.inChannels%4,x=e.dataFormat==="channelsLast",v=x?1:2,k=x?2:3,I=x?3:1;let N="",T="";s&&(r?N=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?N=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:N=`
          float activation(float x) {
            ${s}
          }
        `,T="result = activation(result);");const D=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${N}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${a}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${I}];

        ivec2 xRCCorner =
            ivec2(coords[${v}], coords[${k}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f}; wR++) {
          int xR = xRCorner + wR * ${h};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${g}; wC++) {
            int xC = xCCorner + wC * ${p};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${y}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${x}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${w===1}) {

              if (${x}) {
                dotProd +=
                    getX(batch, xR, xC, ${y}) *
                    getW(wR, wC, ${y}, d2);
              } else {
                dotProd +=
                    getX(batch, ${y}, xR, xC) *
                    getW(wR, wC, ${y}, d2);
              }

            } else if (${w===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${y}, d2),
                getW(wR, wC, ${y} + 1, d2)
              );

              if (${x}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${y}),
                  getX(batch, xR, xC, ${y} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${y}, xR, xC),
                  getX(batch, ${y} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${w===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${y}, d2),
                getW(wR, wC, ${y} + 1, d2),
                getW(wR, wC, ${y} + 2, d2)
              );

              if (${x}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${y}),
                  getX(batch, xR, xC, ${y} + 1),
                  getX(batch, xR, xC, ${y} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${y}, xR, xC),
                  getX(batch, ${y} + 1, xR, xC),
                  getX(batch, ${y} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${D}
        ${T}
        setOutput(result);
      }
    `}}class Fte{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,h=e.dilationWidth,p=e.filterDepth,f=e.filterHeight,g=e.filterWidth,y=Math.floor(e.inChannels/4)*4,w=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${o}, ${a}, ${i});
      const ivec3 pads = ivec3(${t}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${p}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${g}; wC++) {
              int xC = xCCorner + wC * ${h};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${y}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${w===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${y}) *
                  getW(wF, wR, wC, ${y}, d2);
              } else if (${w===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${y}),
                  getX(batch, xF, xR, xC, ${y} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${y}, d2),
                  getW(wF, wR, wC, ${y} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${w===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${y}),
                  getX(batch, xF, xR, xC, ${y} + 1),
                  getX(batch, xF, xR, xC, ${y} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${y}, d2),
                  getW(wF, wR, wC, ${y} + 1, d2),
                  getW(wF, wR, wC, ${y} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZD{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=On(this.outputShape.length);const a=e.padInfo.left,i=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,h=e.filterWidth,p=h;let f=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<h;x++)f+=`
           vec4 xTexelC${x*2};
           int xTexelC${x*2}Ready;
           vec4 xTexelC${x*2+1};
           int xTexelC${x*2+1}Ready;
           vec4 xC${x};`;f+=`
     for (int r = 0; r < ${c}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let x=0;x<h;x++)f+=`
           xTexelC${x*2} = vec4(0.0);
           xTexelC${x*2}Ready = 0;
           xTexelC${x*2+1} = vec4(0.0);
           xTexelC${x*2+1}Ready = 0;
           xC${x} = vec4(0.0);`;f+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let x=0;x<(p+1)/2;x++){const v=x*2;if(f+=`
           xC = xCCorner + ${v*l};
           `,i===1){if(v<h&&(a%2===1?(f+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }
               `,l===1&&v>0?f+=`
                 xC${v} = vec4(xTexelC${v-2}.zw, xTexelC${v}.xy);
                 `:f+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${v} = vec4(previous.zw, xTexelC${v}.xy);
                   } else {
                     xC${v} = vec4(0.0, 0.0, xTexelC${v}.xy);
                   }
                   `):f+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }

                 xC${v} = xTexelC${v};
                 `,v+1<h)){const k=a%2===0?bm(l):l;l%2===0&&a%2===1||l%2!==0&&a%2!==1?(f+=`
                   xCOffset = xC + imod(pads[1], 2) + ${k};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                     xTexelC${v+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${v+1}.zw = vec2(0.0);
                     }
                     xTexelC${v+1}Ready = 1;
                   }
                   `,l>1?f+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${v+1} = vec4(previous.zw, xTexelC${v+1}.xy);
                     } else {
                      xC${v+1} = vec4(0.0, 0.0, xTexelC${v+1}.xy);
                     }
                     `:f+=`
                     xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.xy);
                     `):k===1?f+=`
                     xC${v+1} = xTexelC${v};
                     `:f+=`
                     xCOffset = xC + ${k};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                       xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${v+1}.zw = vec2(0.0);
                       }
                       xTexelC${v+1}Ready = 1;
                     }

                     xC${v+1} = xTexelC${v+1};
                     `}}else v<h&&(a%2===1?(f+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${v+1}Ready == 0) {
                   xTexelC${v+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${v+1}.zw = vec2(0.0);
                   }
                   xTexelC${v+1}Ready = 1;
                 }

                 xC${v} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
               `,v+1<h&&(f+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${v+1} = vec4(xTexelC${v+1}.xy, final.xy);
                 `)):(f+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                   xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${v+1}.zw = vec2(0.);
                   }
                   xTexelC${v+1}Ready = 1;
                 }

                 xC${v} = vec4(
                   xTexelC${v}.xy, xTexelC${v+1}.xy);
               `,v+1<h&&(f+=`
                   xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
                 `)));v<h&&(f+=`
             wTexel = getW(r, ${v}, d1, d2);
             dotProd += xC${v}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${v}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,v+1<h&&(f+=`
               wTexel = getW(r, ${v+1}, d1, d2);
               dotProd += xC${v+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${v+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}f+=`
     }
   `,f+=`
     }
   `,f+=`
     }
   `;let g="",y="";s&&(r?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:o?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:g=`vec4 activation(vec4 x) {
           ${s}
         }`,y="result = activation(result);");const w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${g}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${f}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${w}
         ${y}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lte{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=On(this.outputShape.length);const{dataFormat:s}=t,r=Hn(),o=s==="channelsLast",a=o?1:2,i=o?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let c="";for(let h=0;h<=1;h++)for(let p=0;p<=1;p++)c+=`
          blockIndex = rc.z + ${p};
          pos = rc.y + ${h};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${a}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${i}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${o}) {
                  innerDims = vec2(d1, ch);
                  result[${h*2+p}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${h*2+p}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fm(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function JD({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:i=null}){const l=n.shape,c=s.texData.get(n.dataId),h=t.inChannels,p=l[0]*l[1]*l[2],f=t.outChannels,g=t.dataFormat==="channelsLast",y=!1,w=!1;let x;const v=[];if(o!=null){const N=fm(o.shape,g);N!=null&&(o=Ce({inputs:{x:o},backend:s,attrs:{shape:N}}),v.push(o))}if(r!=null){const N=fm(r.shape,g);N!=null&&(r=Ce({inputs:{x:r},backend:s,attrs:{shape:N}}),v.push(r))}if(!((p===1||f===1)&&h>GD)&&c.isPacked&&g&&c.texture!=null&&l[2]%2!==0&&Je(c.shape.slice(-3),l.slice(-3))){const N=l[0]*l[1]*(l[2]+1),T={dataId:n.dataId,shape:[1,N,t.inChannels],dtype:n.dtype},D=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,A(hm(c.shape,T.shape),()=>`packed reshape ${c.shape} to ${T.shape} isn't free`);const P=Ce({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}});v.push(P);const z=pm({a:T,b:P,backend:s,transposeA:y,transposeB:w,bias:r,activation:i,preluActivationWeights:o,leakyreluAlpha:a}),F=s.texData.get(z.dataId);A(F.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=D,F.shape=t.outShape,x=ws({inputs:{x:z},backend:s}),x.shape=t.outShape,v.push(z)}else{const N=t.outHeight*t.outWidth,T=Ce({inputs:{x:n},backend:s,attrs:{shape:g?[t.batchSize,N,t.inChannels]:[t.batchSize,t.inChannels,N]}}),D=Ce({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}}),P=pm({a:g?T:D,b:g?D:T,transposeA:!g,transposeB:w,backend:s,bias:r,activation:i,preluActivationWeights:o,leakyreluAlpha:a});x=Ce({inputs:{x:P},backend:s,attrs:{shape:t.outShape}}),v.push(T),v.push(D),v.push(P)}for(const N of v)s.disposeIntermediateTensorInfo(N);return x}function e_({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:i=null}){const{filterWidth:l,filterHeight:c,inChannels:h,outWidth:p,outHeight:f,dataFormat:g}=t,y=g==="channelsLast",w=l*c*h,x=f*p,v=[t.batchSize,w,x],k=!0,I=!1,N=[];if(o!=null){const B=fm(o.shape,y);B!=null&&(o=Ce({inputs:{x:o},backend:s,attrs:{shape:B}}),N.push(o))}if(r!=null){const B=fm(r.shape,y);B!=null&&(r=Ce({inputs:{x:r},backend:s,attrs:{shape:B}}),N.push(r))}const T=Ce({inputs:{x:e},backend:s,attrs:{shape:[1,w,ce(e.shape)/w]}});N.push(T);const D=new Lte(v,t),P=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],z=s.runWebGLProgram(D,[n],"float32",P),F=Ce({inputs:{x:z},backend:s,attrs:{shape:v}});N.push(z),N.push(F);const L=r!=null,E=o!=null,j=i==="leakyrelu",Z=i?ud(i,!0):null,ne=new jD(y?F.shape:T.shape,y?T.shape:F.shape,y?[t.batchSize,x,t.outChannels]:[t.batchSize,t.outChannels,x],k,I,L,Z,E,j),te=y?[F,T]:[T,F];if(r&&te.push(r),E&&te.push(o),j){const B=s.makeTensorInfo([],"float32",wo(a,"float32"));te.push(B),N.push(B)}const se=s.runWebGLProgram(ne,te,"float32"),K=Ce({inputs:{x:se},backend:s,attrs:{shape:t.outShape}});N.push(se);for(const B of N)s.disposeIntermediateTensorInfo(B);return K}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:a,pad:i,dataFormat:l,dilations:c,dimRoundingMode:h}=s,p=ko(l),f=fn(r.shape,o.shape,a,c,i,h,!1,p);let g;if(f.filterHeight===1&&f.filterWidth===1&&f.dilationHeight===1&&f.dilationWidth===1&&f.strideHeight===1&&f.strideWidth===1&&(f.padInfo.type==="SAME"||f.padInfo.type==="VALID"))g=JD({x:r,filter:o,convInfo:f,backend:t});else if(f.strideWidth<=2&&p==="channelsLast"&&oe().getBool("WEBGL_EXP_CONV")){const w=new ZD(f),x=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];g=t.runWebGLProgram(w,[r,o],"float32",x)}else if(oe().getBool("WEBGL_CONV_IM2COL"))g=e_({x:r,filter:o,convInfo:f,backend:t});else{const w=new QD(f);g=t.runWebGLProgram(w,[r,o],"float32")}const y=Ce({inputs:{x:g},backend:t,attrs:{shape:f.outShape}});return t.disposeIntermediateTensorInfo(g),y}const zte={kernelName:Id,backendName:"webgl",kernelFunc:Pte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mte{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,a=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${a?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Bte{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=e.dataFormat==="channelsLast",i=t-1-e.padInfo.top,l=s-1-e.padInfo.left,c=a?1:2,h=a?2:3,p=a?3:1;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${p}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${h}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${a}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Vte{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,a=e.padInfo.top,i=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${o};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${a};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${i};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Wte{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,a=e.strideHeight,i=e.strideWidth,l=t-1-e.padInfo.front,c=s-1-e.padInfo.top,h=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${h});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${o}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${a}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${i}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ute(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:a,pad:i,dataFormat:l,dimRoundingMode:c,filterShape:h}=s,p=ko(l),f=fn(r.shape,h,a,1,i,c,!1,p),g=new Mte(f);return t.runWebGLProgram(g,[r,o],"float32")}const jte={kernelName:Tm,backendName:"webgl",kernelFunc:Ute};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gte{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=On(this.outputShape.length);const t=e.filterHeight,s=e.filterWidth,r=t-1-e.padInfo.top,o=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hte(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{inputShape:a,strides:i,pad:l,dataFormat:c,dimRoundingMode:h}=s,p=ko(c),f=fn(a,o.shape,i,1,l,h,!1,p);if(oe().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&p==="channelsLast"){const g=[[f.strideHeight,f.strideWidth]],y=new Gte(f);return t.runWebGLProgram(y,[r,o],"float32",g)}else{const g=new Bte(f);return t.runWebGLProgram(g,[r,o],"float32")}}const qte={kernelName:$d,backendName:"webgl",kernelFunc:Hte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:a,pad:i,dilations:l}=s,c=wa(r.shape,o.shape,a,l,i),h=new Fte(c);return t.runWebGLProgram(h,[r,o],"float32")}const Xte={kernelName:Td,backendName:"webgl",kernelFunc:Kte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:a,pad:i,filterShape:l}=s,c=wa(r.shape,l,a,1,i),h=new Vte(c);return t.runWebGLProgram(h,[r,o],"float32")}const Qte={kernelName:Em,backendName:"webgl",kernelFunc:Yte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zte(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{pad:a,strides:i,inputShape:l}=s,c=wa(l,o.shape,i,1,a),h=new Wte(c);return t.runWebGLProgram(h,[r,o],"float32")}const Jte={kernelName:Rm,backendName:"webgl",kernelFunc:Zte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ene=Hu+`
  return cos(x);
`,tne=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Li}
  return result;
`,nne=rt({opSnippet:ene,packedOpSnippet:tne}),sne={kernelName:Hl,backendName:"webgl",kernelFunc:nne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rne=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,one=rt({opSnippet:rne}),ane={kernelName:ql,backendName:"webgl",kernelFunc:one};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ine{constructor(e,t,s,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[a,i,l,c]=e,[h]=t,[p,f]=s;this.outputShape=[h,p,f,c];const g=r==="bilinear"?1:0,[y,w]=[`${i-1}.0`,`${l-1}.0`],[x,v,k]=p>1?[`${(i-1)/(p-1)}`,"(y2-y1) * height_ratio",`y1*${y} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${y}`],[I,N,T]=f>1?[`${(l-1)/(f-1)}`,"(x2-x1) * width_ratio",`x1*${w} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${w}`];this.userCode=`
      const float height_ratio = float(${x});
      const float width_ratio = float(${I});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${a}) {
          return;
        }

        float height_scale = ${v};
        float width_scale = ${N};

        float in_y = ${k};
        if( in_y < 0.0 || in_y > ${y} ) {
          setOutput(float(${o}));
          return;
        }
        float in_x = ${T};
        if( in_x < 0.0 || in_x > ${w} ) {
          setOutput(float(${o}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${g} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lne=n=>{const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:o,boxInd:a}=e,{cropSize:i,method:l,extrapolationValue:c}=s,h=new ine(r.shape,o.shape,i,l,c);return t.runWebGLProgram(h,[r,o,a],"float32")},une={kernelName:Dm,backendName:"webgl",kernelFunc:lne};var dd;(function(n){n.Prod="*",n.Sum="+"})(dd||(dd={}));class PI{constructor(e,t,s,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const o=this.outputShape.length,a=this.op===dd.Prod?"1.0":"0.0",i=s?a:`getX(${zI(o,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let c="",h="";s?(c=r?`end != ${l-1}`:"end != 0",h=r?"end + 1":"end - 1"):(c=r?`end + pow2 < ${l}`:"end >= pow2",h=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${yt(o)} coords = getOutputCoords();
        int end = ${MI(o,"coords",this.op)};
        float val = ${i};
        int pow2 = int(pow(2.0, index));
        if (${c}) {
          int idx = ${h};
          ${MI(o,"coords",this.op)} = idx;
          val ${this.op}= getX(${zI(o,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function zI(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function MI(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t_(n,e,t,s,r,o){const a=e.shape.length,i=Lt([s],a);let l=e;i!=null&&(l=jn({inputs:{x:e},backend:t,attrs:{perm:i}}));const c=jt(1,a)[0];if(c!==a-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const h=l.shape[c];let p=ws({inputs:{x:l},backend:t});for(let f=0;f<=Math.ceil(Math.log2(h))-1;f++){const g=new PI(n,l.shape,!1,o),y=[[f]],w=p;p=t.runWebGLProgram(g,[p],p.dtype,y),t.disposeIntermediateTensorInfo(w)}if(r){const f=new PI(n,l.shape,r,o),g=p;p=t.runWebGLProgram(f,[p],p.dtype),t.disposeIntermediateTensorInfo(g)}if(i!=null){const f=va(i),g=jn({inputs:{x:p},backend:t,attrs:{perm:f}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(l),g}return p}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:a,reverse:i}=s;return t_(dd.Prod,r,t,o,a,i)}const dne={kernelName:Am,backendName:"webgl",kernelFunc:cne};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:a,reverse:i}=s;return t_(dd.Sum,r,t,o,a,i)}const pne={kernelName:Ed,backendName:"webgl",kernelFunc:hne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:a,binaryOutput:i}=s;if(r.shape.length===1){const l=t.readSync(r.dataId),c=t.readSync(o.dataId),h=FD(l,c,o.dtype,o.shape,a);return t.makeTensorInfo([a],o.dtype,h)}else if(r.shape.length===2){const l=t.bufferSync(r),c=t.bufferSync(o),h=xZ(l,c,a,i);return t.makeTensorInfo(h.shape,o.dtype,h.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const mne={kernelName:_m,backendName:"webgl",kernelFunc:fne};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gne{constructor(e,t,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:o,dataFormat:a}=s,i=r.shape[0],l=a==="NHWC"?r.shape[1]:r.shape[2],c=a==="NHWC"?r.shape[2]:r.shape[3],h=a==="NHWC"?r.shape[3]:r.shape[1],p=l*o,f=c*o,g=h/(o*o),y=a==="NHWC"?[i,p,f,g]:[i,g,p,f],w=new gne(y,o,a);return t.runWebGLProgram(w,[r],r.dtype)}const xne={kernelName:Om,backendName:"webgl",kernelFunc:yne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n_{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=On(this.outputShape.length);const a=e.filterHeight,i=e.filterWidth,l=e.outChannels/e.inChannels;let c="",h="";s&&(r?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:c=`
          float activation(float x) {
            ${s}
          }
        `,h="result = activation(result);");const p=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${a}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${i}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${p}
        ${h}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class s_{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=On(this.outputShape.length);const a=e.outChannels/e.inChannels,i=e.padInfo.left,l=e.strideWidth,c=e.dilationWidth,h=e.filterHeight,p=e.filterWidth,f=p;let g=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let v=0;v<p;v++)g+=`
          vec4 xTexelC${v*2};
          int xTexelC${v*2}Ready;
          vec4 xTexelC${v*2+1};
          int xTexelC${v*2+1}Ready;
          vec4 xC${v};`;g+=`
    for (int r = 0; r < ${h}; r++) {
      `;for(let v=0;v<p;v++)g+=`
          xTexelC${v*2} = vec4(0.0);
          xTexelC${v*2}Ready = 0;
          xTexelC${v*2+1} = vec4(0.0);
          xTexelC${v*2+1}Ready = 0;
          xC${v} = vec4(0.0);`;g+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let v=0;v<(f+1)/2;v++){const k=v*2;if(g+=`
          xC = xCCorner + ${k*c};
          `,l===1){if(k<p&&(i%2===1?(g+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k}Ready == 0) {
                  xTexelC${k} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${k}.zw = vec2(0.0);
                  }
                  xTexelC${k}Ready = 1;
                }
              `,c===1&&k>0?g+=`
                xC${k} = vec4(xTexelC${k-2}.zw, xTexelC${k}.xy);
                `:g+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${k} = vec4(previous.zw, xTexelC${k}.xy);
                  } else {
                    xC${k} = vec4(0.0, 0.0, xTexelC${k}.xy);
                  }
                  `):g+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${k}Ready == 0) {
                  xTexelC${k} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${k}.zw = vec2(0.0);
                  }
                  xTexelC${k}Ready = 1;
                }

                xC${k} = xTexelC${k};
                `,k+1<p)){const I=i%2===0?bm(c):c;c%2===0&&i%2===1||c%2!==0&&i%2!==1?(g+=`
                  xCOffset = xC + imod(pads[1], 2) + ${I};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k+1}Ready == 0) {
                    xTexelC${k+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${k+1}.zw = vec2(0.0);
                    }
                    xTexelC${k+1}Ready = 1;
                  }
                  `,c>1?g+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${k+1} = vec4(previous.zw, xTexelC${k+1}.xy);
                    } else {
                     xC${k+1} = vec4(0.0, 0.0, xTexelC${k+1}.xy);
                    }
                    `:g+=`
                    xC${k+1} = vec4(xTexelC${k}.zw, xTexelC${k+1}.xy);
                    `):I===1?g+=`
                    xC${k+1} = xTexelC${k};
                    `:g+=`
                    xCOffset = xC + ${I};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k+1}Ready == 0) {
                      xTexelC${k+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${k+1}.zw = vec2(0.0);
                      }
                      xTexelC${k+1}Ready = 1;
                    }

                    xC${k+1} = xTexelC${k+1};
                    `}}else k<p&&(i%2===1?(g+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k}Ready == 0) {
                  xTexelC${k} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${k}.zw = vec2(0.0);
                  }
                  xTexelC${k}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${k+1}Ready == 0) {
                  xTexelC${k+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${k+1}.zw = vec2(0.0);
                  }
                  xTexelC${k+1}Ready = 1;
                }

                xC${k} = vec4(xTexelC${k}.zw, xTexelC${k+1}.zw);
              `,k+1<p&&(g+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${k+1} = vec4(xTexelC${k+1}.xy, final.xy);
                `)):(g+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${k}Ready == 0) {
                  xTexelC${k} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${k}.zw = vec2(0.0);
                  }
                  xTexelC${k}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${k+1}Ready == 0) {
                  xTexelC${k+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${k+1}.zw = vec2(0.);
                  }
                  xTexelC${k+1}Ready = 1;
                }

                xC${k} = vec4(
                  xTexelC${k}.xy, xTexelC${k+1}.xy);
              `,k+1<p&&(g+=`
                  xC${k+1} = vec4(xTexelC${k}.zw, xTexelC${k+1}.zw);
                `)));k<p&&(g+=`
            wTexel = getW(r, ${k}, d1, q);
            dotProd += xC${k} * vec4(wTexel.xz, wTexel.xz);
          `,k+1<p&&(g+=`
              wTexel = getW(r, ${k+1}, d1, q);
              dotProd += xC${k+1} * vec4(wTexel.xz, wTexel.xz);
            `))}g+=`
    }
  `,g+=`
      }
    `;let y="",w="";s&&(r?y=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?y=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:y=`vec4 activation(vec4 x) {
          ${s}
        }`,w="result = activation(result);");const x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${y}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${a};
        int q = d2 - d1 * ${a};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${g}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${x}
        ${w}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:a,pad:i,dilations:l,dimRoundingMode:c}=s;let h=l;h==null&&(h=[1,1]),A(Nn(a,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${a} and dilations '${h}'`);const p=fn(r.shape,o.shape,a,h,i,c,!0);let f;oe().getBool("WEBGL_PACK_DEPTHWISECONV")&&p.strideWidth<=2&&p.outChannels/p.inChannels===1?f=new s_(p):f=new n_(p);const g=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];return t.runWebGLProgram(f,[r,o],"float32",g)}const wne={kernelName:Rd,backendName:"webgl",kernelFunc:bne};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vne{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,a=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${a} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class kne{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,a=t-1-e.padInfo.top,i=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:a,dilations:i,pad:l,dimRoundingMode:c,filterShape:h}=s,p=fn(r.shape,h,a,i,l,c,!0),f=new vne(p);return t.runWebGLProgram(f,[r,o],"float32")}const Nne={kernelName:Fm,backendName:"webgl",kernelFunc:Sne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cne(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{strides:a,dilations:i,pad:l,dimRoundingMode:c,inputShape:h}=s,p=fn(h,o.shape,a,i,l,c,!0),f=new kne(p);return t.runWebGLProgram(f,[r,o],"float32")}const Ine={kernelName:Lm,backendName:"webgl",kernelFunc:Cne};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $ne{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tne(n){const{inputs:e,backend:t}=n,{x:s}=e,r=[...s.shape,...s.shape],o=ce(s.shape),a=Ce({inputs:{x:s},backend:t,attrs:{shape:[o]}}),i=new $ne(o),l=t.runWebGLProgram(i,[a],a.dtype),c=Ce({inputs:{x:l},backend:t,attrs:{shape:r}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),c}const Ene={kernelName:Pm,backendName:"webgl",kernelFunc:Tne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rne{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:s,padInfo:r,strideHeight:o,strideWidth:a,filterHeight:i,filterWidth:l,dilationHeight:c,dilationWidth:h}=e,{top:p,left:f}=r;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${a});
      const ivec2 pads = ivec2(${p}, ${f});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${i}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${h};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ane(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:a,pad:i,dilations:l}=s,c=wh(r.shape,o.shape,a,i,"NHWC",l);let h;const p=new Rne(c);h=t.runWebGLProgram(p,[r,o],"float32");const f=Ce({inputs:{x:h},backend:t,attrs:{shape:c.outShape}});return t.disposeIntermediateTensorInfo(h),f}const Dne={kernelName:Ad,backendName:"webgl",kernelFunc:Ane};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ne(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,o=e,{allDims:a,summedDims:i,idDims:l}=sv(r,o.length);ov(a.length,l,o);const{path:c,steps:h}=av(i,l),p=h.length;let f=null,g=a.length;const y=[];for(let w=0;w<p;++w){for(const x of h[w]){const{permutationIndices:v,expandDims:k}=rv(g,l[x]);let I;iv(v)?I=o[x]:(I=jn({inputs:{x:o[x]},backend:t,attrs:{perm:v}}),y.push(I));const N=I.shape.slice();for(let T=0;T<k.length;++T)N.splice(k[T],0,1);Je(I.shape,N)||(I=Ce({inputs:{x:I},backend:t,attrs:{shape:N}}),y.push(I)),f===null?f=I:(f=Kv({inputs:{a:I,b:f},backend:t}),y.push(f))}w<p-1&&(c[w]>=0&&(f=Ay({inputs:{x:f},backend:t,attrs:{axis:c[w]-(a.length-g),keepDims:!1}}),y.push(f)),g--)}for(const w of y)w!==f&&t.disposeIntermediateTensorInfo(w);return f}const One={kernelName:Mm,backendName:"webgl",kernelFunc:_ne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fne="return (x >= 0.0) ? x : (exp(x) - 1.0);",Lne=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Pne=rt({opSnippet:Fne,packedOpSnippet:Lne}),zne={kernelName:Xl,backendName:"webgl",kernelFunc:Pne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mne="return (b >= 0.0) ? a : a * (b + 1.0);",Bne=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,Vne=n=>{const{inputs:e,backend:t}=n,{dy:s,y:r}=e,o=oe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Gu(Bne,s.shape,r.shape):new vi(Mne,s.shape,r.shape);return t.runWebGLProgram(o,[s,r],s.dtype)},Wne={kernelName:Bm,backendName:"webgl",kernelFunc:Vne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Une=`
  return vec4(equal(a, b));
`,jne="return float(a == b);",Gne=$n({opSnippet:jne,packedOpSnippet:Une,dtype:"bool",cpuKernelImpl:SZ}),Hne={kernelName:Dd,backendName:"webgl",kernelFunc:Gne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qne=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${Y1};
  float a1 = ${Q1};
  float a2 = ${Z1};
  float a3 = ${J1};
  float a4 = ${ev};
  float a5 = ${tv};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Kne=rt({opSnippet:qne}),Xne={kernelName:Yl,backendName:"webgl",kernelFunc:Kne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yne=Hu+`
  return exp(x);
`,Qne=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,r_=rt({opSnippet:Yne,packedOpSnippet:Qne,cpuKernelImpl:NZ,dtype:"float32"}),Zne={kernelName:Ql,backendName:"webgl",kernelFunc:r_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sw(n){const{inputs:e,attrs:t,backend:s}=n,{dim:r}=t,{input:o}=e,a=o.shape.length,i=o.shape.slice();let l=r;return r<0&&(A(-(a+1)<=r,()=>`Axis must be in the interval [${-(a+1)}, ${a}]`),l=a+r+1),i.splice(l,0,1),Ce({inputs:{x:o},backend:s,attrs:{shape:i}})}const Jne={kernelName:_d,backendName:"webgl",kernelFunc:sw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BI="return exp(x) - 1.0;",ese=rt({opSnippet:BI,packedOpSnippet:BI,cpuKernelImpl:CZ}),tse={kernelName:Zl,backendName:"webgl",kernelFunc:ese};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VI{constructor(e,t,s){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const o=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,a=s?`${r}.0`:"1.0";let i;if(e==="real")i="return real * expR - imag * expI;";else if(e==="imag")i="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${o};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${i}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${a};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o_(n,e,t){const s=t.texData.get(n.dataId),r=ce(n.shape),o=n.shape[n.shape.length-1],a=r/o,i=Ce({inputs:{x:n},backend:t,attrs:{shape:[a,o]}}),l=i.shape,c=new VI("real",l,e),h=new VI("imag",l,e),p=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],f=t.runWebGLProgram(c,p,"float32"),g=t.runWebGLProgram(h,p,"float32"),y=$a({inputs:{real:f,imag:g},backend:t});t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(g);const w=Ce({inputs:{x:y},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(y),w}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nse(n){const{inputs:e,backend:t}=n,{input:s}=e;return o_(s,!1,t)}const sse={kernelName:Vm,backendName:"webgl",kernelFunc:nse};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rse{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jh(n){const{backend:e,attrs:t}=n,{shape:s,value:r}=t;let{dtype:o}=t;if(o=o||Ci(r),o==="string"){const a=Mt(o,ce(s));return a.fill(r),e.makeTensorInfo(s,o,a)}else{const a=new rse(s,r),i=[[r]];return e.runWebGLProgram(a,[],o,i)}}const ose={kernelName:Wm,backendName:"webgl",kernelFunc:Jh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ase{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ise={kernelName:Um,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,s=e,r=new ase(t.shape);return s.runWebGLProgram(r,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WI="return floor(x);",lse=rt({opSnippet:WI,packedOpSnippet:WI,cpuKernelImpl:IZ}),use={kernelName:Jl,backendName:"webgl",kernelFunc:lse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cse=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,dse=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,hse=$n({opSnippet:cse,packedOpSnippet:dse,dtype:"int32"}),pse={kernelName:eu,backendName:"webgl",kernelFunc:hse};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fse{constructor(e){this.variableNames=["A"];const t=Hn(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mse{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=Hn(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gse={kernelName:Gf,backendName:"webgl",kernelFunc:yse};let cl,Zx=oe().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function yse(n){const{inputs:e,backend:t,attrs:s}=n;let{pixels:r}=e;const{numChannels:o}=s,a=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,i=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,c]=a?[r.videoWidth,r.videoHeight]:[r.width,r.height],h=[c,l],p=[c,l,o];if(i||a){const w=oe().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(cl==null||w!==Zx)&&(Zx=w,cl=document.createElement("canvas").getContext("2d",{willReadFrequently:Zx})),cl.canvas.width=l,cl.canvas.height=c,cl.drawImage(r,0,0,l,c),r=cl.canvas}const f=t.makeTensorInfo(h,"int32");t.texData.get(f.dataId).usage=As.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(f.dataId),r);const g=oe().getBool("WEBGL_PACK")?new mse(p):new fse(p),y=t.runWebGLProgram(g,[f],"int32");return t.disposeData(f.dataId),y}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:a,preluActivationWeights:i}=e,{strides:l,pad:c,dataFormat:h,dilations:p,dimRoundingMode:f,activation:g,leakyreluAlpha:y}=s,w=ko(h),x=fn(r.shape,o.shape,l,p,c,f,!1,w);let v;const k=[],I=a!=null,N=i!=null,T=g==="leakyrelu",D=()=>{const z=[r,o],F=(L,E)=>{if(E==="NCHW"&&L.shape.length===1&&L.shape[0]!==1){const j=Ce({inputs:{x:L},backend:t,attrs:{shape:[L.shape[0],1,1]}});return k.push(j),j}return L};if(I&&z.push(F(a,h)),N&&z.push(F(i,h)),T){const L=t.makeTensorInfo([],"float32",wo(y,"float32"));z.push(L),k.push(L)}return z};if(x.filterHeight===1&&x.filterWidth===1&&x.dilationHeight===1&&x.dilationWidth===1&&x.strideHeight===1&&x.strideWidth===1&&(x.padInfo.type==="SAME"||x.padInfo.type==="VALID"))v=JD({x:r,filter:o,convInfo:x,backend:t,bias:a,activation:g,preluActivationWeights:i,leakyreluAlpha:y});else if(x.strideWidth<=2&&w==="channelsLast"&&oe().getBool("WEBGL_EXP_CONV")){const z=g?ud(g,!0):null,F=new ZD(x,I,z,N,T),L=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],E=D();v=t.runWebGLProgram(F,E,"float32",L)}else if(oe().getBool("WEBGL_CONV_IM2COL"))v=e_({x:r,filter:o,convInfo:x,backend:t,bias:a,activation:g,preluActivationWeights:i,leakyreluAlpha:y});else{const z=g?ud(g,!1):null,F=new QD(x,I,z,N,T),L=D();v=t.runWebGLProgram(F,L,"float32")}const P=Ce({inputs:{x:v},backend:t,attrs:{shape:x.outShape}});return k.push(v),k.forEach(z=>t.disposeIntermediateTensorInfo(z)),P}const bse={kernelName:Kc,backendName:"webgl",kernelFunc:xse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wse(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:a,preluActivationWeights:i}=e,{strides:l,pad:c,dilations:h,dimRoundingMode:p,activation:f,leakyreluAlpha:g}=s,y=[];let w=h;w==null&&(w=[1,1]),A(Nn(l,w),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${w}'`);const x=fn(r.shape,o.shape,l,w,c,p,!0),v=oe().getBool("WEBGL_PACK_DEPTHWISECONV")&&x.strideWidth<=2&&x.outChannels/x.inChannels===1,k=f?ud(f,v):null,I=[r,o],N=a!=null,T=i!=null,D=f==="leakyrelu";if(N&&I.push(a),T&&I.push(i),D){const L=t.makeTensorInfo([],"float32",wo(g,"float32"));I.push(L),y.push(L)}let P;v?P=new s_(x,N,k,T,D):P=new n_(x,N,k,T,D);const z=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],F=t.runWebGLProgram(P,I,"float32",z);return y.forEach(L=>t.disposeIntermediateTensorInfo(L)),F}const vse={kernelName:Xc,backendName:"webgl",kernelFunc:wse};class kse{constructor(e,t,s,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const o=yt(s.length);let a=`
    int index;`;for(let i=0;i<this.sliceDim;i++)a+=`
          index = round(getIndices(coords[0], ${i}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[i]};
          flattenIndex += index * ${this.strides[i]};`;this.userCode=`
         void main() {
          ${o} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${a}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sse(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,o=r.shape,a=o[o.length-1],i=ce(s.shape),[l,c,h,p]=dy(s,r),f=Ce({inputs:{x:r},backend:t,attrs:{shape:[c,a]}}),g=Ce({inputs:{x:s},backend:t,attrs:{shape:[ce(s.shape)/h,h]}});if(t.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const v=t.readSync(r.dataId),k=t.bufferSync(s),I=$Z(v,k,s.dtype,c,a,h,p,s.shape,i);return t.makeTensorInfo(l,s.dtype,I.values)}const y=new kse(a,p,[c,h],s.shape),w=t.runWebGLProgram(y,[g,f],g.dtype),x=Ce({inputs:{x:w},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(w),x}const Nse={kernelName:jm,backendName:"webgl",kernelFunc:Sse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cse{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const s=yt(this.rank),r=Ise(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function Ise(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${t[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a_(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:o}=e,{axis:a,batchDims:i}=s,l=Qe(a,r.shape)[0];if(oe().get("DEBUG")){const k=t.readSync(o.dataId),I=r.shape[l];for(let N=0;N<k.length;++N){const T=k[N];A(T<=I-1&&T>=0,()=>`GatherV2: the index value ${T} is not in [0, ${I-1}]`)}}const c=uv(r,o,l,i),h=ce(o.shape),p=[],f=Ce({inputs:{x:r},backend:t,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),g=Ce({inputs:{x:o},backend:t,attrs:{shape:[c.batchSize,h/c.batchSize]}});p.push(f),p.push(g);const y=[c.batchSize,c.outerSize,h/c.batchSize,c.sliceSize];if(t.shouldExecuteOnCPU([r,o])||r.dtype==="string"){const k=t.bufferSync(g),I=t.bufferSync(f),N=TZ(I,k,y);return p.forEach(T=>t.disposeIntermediateTensorInfo(T)),t.makeTensorInfo(c.outputShape,N.dtype,N.values)}const w=new Cse(f.shape,y),x=t.runWebGLProgram(w,[f,g],f.dtype);p.push(x);const v=Ce({inputs:{x},backend:t,attrs:{shape:c.outputShape}});return p.forEach(k=>t.disposeIntermediateTensorInfo(k)),v}const $se={kernelName:Fd,backendName:"webgl",kernelFunc:a_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tse="return float(a > b);",Ese=`
  return vec4(greaterThan(a, b));
`,Rse=$n({opSnippet:Tse,packedOpSnippet:Ese,cpuKernelImpl:EZ,dtype:"bool"}),Ase={kernelName:Ld,backendName:"webgl",kernelFunc:Rse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dse="return float(a >= b);",_se=`
  return vec4(greaterThanEqual(a, b));
`,Ose=$n({opSnippet:Dse,packedOpSnippet:_se,dtype:"bool",cpuKernelImpl:RZ}),Fse={kernelName:tu,backendName:"webgl",kernelFunc:Ose};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lse(n){const{inputs:e,backend:t}=n,{input:s}=e;return o_(s,!0,t)}const Pse={kernelName:Gm,backendName:"webgl",kernelFunc:Lse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zse="return float(!isnan(x) && !isinf(x));",Mse=rt({opSnippet:zse,dtype:"bool"}),Bse={kernelName:su,backendName:"webgl",kernelFunc:Mse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vse="return float(isinf(x));",Wse=rt({opSnippet:Vse,dtype:"bool"}),Use={kernelName:ru,backendName:"webgl",kernelFunc:Wse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jse="return float(isnan(x));",Gse=rt({opSnippet:jse,dtype:"bool"}),Hse={kernelName:ou,backendName:"webgl",kernelFunc:Gse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qse="return float(a < b);",Kse=`
  return vec4(lessThan(a, b));
`,Xse=$n({opSnippet:qse,packedOpSnippet:Kse,cpuKernelImpl:AZ,dtype:"bool"}),Yse={kernelName:zd,backendName:"webgl",kernelFunc:Xse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qse="return float(a <= b);",Zse=`
  return vec4(lessThanEqual(a, b));
`,Jse=$n({opSnippet:Qse,packedOpSnippet:Zse,cpuKernelImpl:DZ,dtype:"bool"}),ere={kernelName:Md,backendName:"webgl",kernelFunc:Jse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tre(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:o}=t,a=_Z(s,r,o);return e.makeTensorInfo([a.length],"float32",a)}const nre={kernelName:qm,backendName:"webgl",kernelFunc:tre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sre=Hu+`
  return x < 0.0 ? 0./0. : log(x);
`,rre=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,ore=rt({opSnippet:sre,packedOpSnippet:rre,cpuKernelImpl:OZ}),are={kernelName:au,backendName:"webgl",kernelFunc:ore};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ire=Hu+`
  return log(1.0 + x);
`,lre=rt({opSnippet:ire}),ure={kernelName:iu,backendName:"webgl",kernelFunc:lre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cre="return float(a >= 1.0 && b >= 1.0);",dre=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,hre=$n({opSnippet:cre,packedOpSnippet:dre,dtype:"bool"}),pre={kernelName:Bd,backendName:"webgl",kernelFunc:hre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fre="return float(!(x >= 1.0));",mre=rt({opSnippet:fre}),gre={kernelName:Vd,backendName:"webgl",kernelFunc:mre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yre="return float(a >= 1.0 || b >= 1.0);",xre=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,bre=$n({opSnippet:yre,packedOpSnippet:xre,dtype:"bool"}),wre={kernelName:Wd,backendName:"webgl",kernelFunc:bre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vre{constructor(e,t,s,r,o){this.variableNames=["x"],this.outputShape=[];const a=t,i=e[3]-1;this.outputShape=e;let l;const c=`float(${s}) + float(${r}) * sum`;o===.5?l=`inversesqrt(${c})`:o===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${a}; j <= ${a}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${i}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kre{constructor(e,t,s,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const a=t,i=e[3]-1;this.outputShape=e;let l;const c=`float(${s}) + float(${r}) * sum`;o===.5?l=`inversesqrt(${c})`:o===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${a};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${a}; j <= ${a}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${i}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sre=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:o,bias:a,alpha:i,beta:l}=s,c=oe().getBool("WEBGL_PACK_NORMALIZATION")?new kre(r.shape,o,a,i,l):new vre(r.shape,o,a,i,l);return t.runWebGLProgram(c,[r],r.dtype)},Nre={kernelName:Ud,backendName:"webgl",kernelFunc:Sre};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cre{constructor(e,t,s,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=s,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${o})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${o});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ire=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r,y:o,dy:a}=e,{depthRadius:i,bias:l,alpha:c,beta:h}=s,p=new Cre(r.shape,i,l,c,h);return t.runWebGLProgram(p,[r,o,a],r.dtype)},$re={kernelName:Km,backendName:"webgl",kernelFunc:Ire};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tre(n,e,t,s){const r=ce(e),a=ce(n.shape)/r,i=Ce({inputs:{x:n},attrs:{shape:[a,r]},backend:s}),l=Pi(i,n.dtype,"max",s),c=Ce({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(i),s.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i_(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:o,keepDims:a}=s,i=r.shape.length,l=Qe(o,r.shape);let c=l;const h=Lt(c,i),p=h!=null,f=t.shouldExecuteOnCPU([r]);let g=r;if(p){if(f){const I=t.texData.get(g.dataId).values,N=new Array(i);for(let P=0;P<N.length;P++)N[P]=r.shape[h[P]];const T=Hv(I,r.shape,r.dtype,h,N);g=t.makeTensorInfo(N,r.dtype);const D=t.texData.get(g.dataId);D.values=T}else g=Ry(r,h,t);c=jt(c.length,i)}Cn("max",c,i);const[y,w]=mn(g.shape,c);let x=y;a&&(x=Ut(y,l));let v;if(f){const I=t.texData.get(g.dataId).values,N=FZ(I,ce(w),x,r.dtype);v=t.makeTensorInfo(x,r.dtype);const T=t.texData.get(v.dataId);T.values=N}else v=Tre(g,w,x,t);return p&&t.disposeIntermediateTensorInfo(g),v}const Ere={kernelName:jd,backendName:"webgl",kernelFunc:i_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rre=qv+`
  return max(a, b);
`,Are=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Li+`
  return result;
`,Dre=$n({opSnippet:Rre,packedOpSnippet:Are,cpuKernelImpl:LZ}),_re={kernelName:lu,backendName:"webgl",kernelFunc:Dre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ore(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Yh(r,"maxPool");const{filterSize:o,strides:a,pad:i,dimRoundingMode:l}=s,c=1;A(Nn(a,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${a} and dilations '${c}'`);const h=er(r.shape,o,a,c,i,l);if(h.filterWidth===1&&h.filterHeight===1&&Je(h.inShape,h.outShape))return ws({inputs:{x:r},backend:t});const p=new cd(h,"max",!1);return t.runWebGLProgram(p,[r],r.dtype)}const Fre={kernelName:Gd,backendName:"webgl",kernelFunc:Ore};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lre(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:a,pad:i,dataFormat:l,dimRoundingMode:c}=s,h=[1,1,1],p=vo(r.shape,o,a,h,i,c,l),f=new Xv(p,"max",!1);return t.runWebGLProgram(f,[r],r.dtype)}const Pre={kernelName:Hd,backendName:"webgl",kernelFunc:Lre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zre{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,a=e.effectiveFilterWidth,i=o-1-e.padInfo.top,l=a-1-e.padInfo.left,c=o*a-1;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${a}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${a} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Mre{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,i=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=l-1-e.padInfo.front,f=c-1-e.padInfo.top,g=h-1-e.padInfo.left,y=l*c*h-1;this.userCode=`
      const ivec3 pads = ivec3(${p}, ${f}, ${g});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${a}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${h};
                wC += ${i}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${y} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${h} +
                  wR * ${h} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bre(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,a=o,{filterSize:i,strides:l,pad:c,dimRoundingMode:h}=s,p=[1,1,1],f=vo(a.shape,i,l,p,c,h),g=new Xv(f,"max",!0),y=t.runWebGLProgram(g,[a],a.dtype),w=new Mre(f),x=t.runWebGLProgram(w,[r,y],a.dtype);return t.disposeIntermediateTensorInfo(y),x}const Vre={kernelName:Ym,backendName:"webgl",kernelFunc:Bre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wre(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o,output:a}=e,i=o;Yh([o,a],"maxPoolGrad");const{filterSize:l,strides:c,pad:h,dimRoundingMode:p}=s,f=er(i.shape,l,c,1,h,p),g=!0,y=new cd(f,"max",g),w=t.runWebGLProgram(y,[i],i.dtype),x=new zre(f),v=t.runWebGLProgram(x,[r,w],i.dtype);return t.disposeIntermediateTensorInfo(w),v}const Ure={kernelName:Xm,backendName:"webgl",kernelFunc:Wre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jre(n,e,t,s){let r=new cd(t,"max",!1);const o=s.runWebGLProgram(r,[n],"float32");r=new cd(t,"max",!0,!0,e);const a=s.runWebGLProgram(r,[n],"float32");return[o,a]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gre={kernelName:Qm,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:o,pad:a,includeBatchInIndex:i}=e,l=t;A(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const c=[1,1];A(Nn(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const h=er(s.shape,r,o,c,a),[p,f]=jre(s,i,h,l);return[p,f]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hre(n,e,t,s){const r=ce(e),a=ce(n.shape)/r,i=Ce({inputs:{x:n},attrs:{shape:[a,r]},backend:s}),l=Pi(i,"float32","mean",s),c=Ce({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(i),s.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qre={kernelName:qd,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{keepDims:r,axis:o}=e,a=t,i=s.shape.length,l=Qe(o,s.shape);let c=l;const h=Lt(c,i),p=h!=null,f=a.shouldExecuteOnCPU([s]),g=[];let y=s;if(p){if(f){const N=a.texData.get(y.dataId).values,T=new Array(i);for(let z=0;z<T.length;z++)T[z]=s.shape[h[z]];const D=Hv(N,s.shape,s.dtype,h,T);y=a.makeTensorInfo(T,s.dtype);const P=a.texData.get(y.dataId);P.values=D}else y=Ry(s,h,a);g.push(y),c=jt(c.length,i)}Cn("sum",c,i);const[w,x]=mn(y.shape,c);let v=w;r&&(v=Ut(w,l));const k=Hre(y,x,v,a);for(const I of g)a.disposeIntermediateTensorInfo(I);return k}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kre(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:a}=s,i=r.shape.length,l=Qe(o,r.shape);let c=l;const h=Lt(c,i);let p=r;h!=null&&(p=jn({inputs:{x:r},backend:t,attrs:{perm:h}}),c=jt(c.length,r.shape.length)),Cn("min",c,i);const[f,g]=mn(p.shape,c),y=ce(g),w=Ce({inputs:{x:p},backend:t,attrs:{shape:[-1,y]}}),x=Pi(w,w.dtype,"min",t);let v;if(a){const k=Ut(f,l);v=Ce({inputs:{x},backend:t,attrs:{shape:k}})}else v=Ce({inputs:{x},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(x),h!=null&&t.disposeIntermediateTensorInfo(p),v}const Xre={kernelName:Kd,backendName:"webgl",kernelFunc:Kre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yre=qv+`
  return min(a, b);
`,Qre=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Li+`
  return result;
`,Zre=$n({opSnippet:Yre,packedOpSnippet:Qre,cpuKernelImpl:PZ}),Jre={kernelName:uu,backendName:"webgl",kernelFunc:Zre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eoe{constructor(e,t,s){this.variableNames=["x"],this.outputShape=t.map((h,p)=>h[0]+e[p]+h[1]);const r=e.length,o=yt(r),a=t.map(h=>h[0]).join(","),i=t.map((h,p)=>h[0]+e[p]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),c=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${a};
        int end = ${i};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${a});
      ${o} end = ${o}(${i});

      void main() {
        ${o} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${o} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class toe{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((y,w)=>y[0]+e[w]+y[1]);const r=e.length,o=yt(r),a=t.map(y=>y[0]).join(","),i=t.map((y,w)=>y[0]+e[w]).join(","),l=Un("rc",r),c=Un("source",r),h=`${l[r-1]} < ${this.outputShape[r-1]}`,p=r===1?"source":`vec2(${c.slice(-2).join()})`,f=s==="reflect"?0:1;let g="";if(r===1){const y=`
        ${o} source = rc;
        if (source < start) {
          source = start * 2 - source - ${f};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${f};
        }
        source -= start;
      `;g=`
        ${o} rc = outputLoc;
        ${y}
        result[0] = getChannel(getX(${c.join()}), ${p});
        ${l[r-1]} += 1;
        if(${h}) {
          ${y}
          result[1] = getChannel(getX(${c.join()}), ${p});
        }
      `}else{const y=`
        ${o} source = rc;
        ${o} lt = ${o}(lessThan(source, start));
        ${o} gte = ${o}(greaterThanEqual(source, end));
        ${o} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${f}) +
                gte * ((end - 1) * 2 - source + ${f});
        source -= start;
      `;g=`
        ${o} rc = outputLoc;
        ${y}
        result[0] = getChannel(getX(${c.join()}), ${p});
        ${l[r-1]} += 1;
        if(${h}) {
          ${y}
          result[1] = getChannel(getX(${c.join()}), ${p});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${y}
          result[2] = getChannel(getX(${c.join()}), ${p});
          ${l[r-1]} += 1;
          if(${h}) {
            ${y}
            result[3] = getChannel(getX(${c.join()}), ${p});
          }
        }
      `}this.userCode=`
      const ${o} start = ${o}(${a});
      const ${o} end = ${o}(${i});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const noe=({inputs:n,backend:e,attrs:t})=>{const{x:s}=n,{paddings:r,mode:o}=t,a=oe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new toe(s.shape,r,o):new eoe(s.shape,r,o);return e.runWebGLProgram(a,[s],s.dtype)},soe={kernelName:Xd,backendName:"webgl",kernelFunc:noe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const roe=`if (b == 0.0) return NAN;
  return mod(a, b);`,ooe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Li+`
  return result;
`,aoe=$n({opSnippet:roe,packedOpSnippet:ooe}),ioe={kernelName:cu,backendName:"webgl",kernelFunc:aoe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class loe{constructor(e,t,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uoe=`
if (a == b) {
  return 1.0;
};
return a / b;`,coe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,l_=$n({opSnippet:uoe,packedOpSnippet:coe,checkOutOfBounds:!0}),doe={kernelName:Kl,backendName:"webgl",kernelFunc:l_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UI="return a - b;",u_=$n({opSnippet:UI,packedOpSnippet:UI,supportsComplex:!0,cpuKernelImpl:rJ}),hoe={kernelName:Iu,backendName:"webgl",kernelFunc:u_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c_(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:o}=s,a=Qe([o],r.shape),i=i_({inputs:{x:r},backend:t,attrs:{reductionIndices:a,keepDims:!1}}),l=Ut(i.shape,a),c=Ce({inputs:{x:i},backend:t,attrs:{shape:l}}),h=u_({inputs:{a:r,b:c},backend:t}),p=r_({inputs:{x:h},backend:t}),f=Ay({inputs:{x:p},backend:t,attrs:{axis:a,keepDims:!1}}),g=Ce({inputs:{x:f},backend:t,attrs:{shape:l}}),y=l_({inputs:{a:p,b:g},backend:t});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(g),y}const poe={kernelName:ph,backendName:"webgl",kernelFunc:c_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function foe(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:o,seed:a,normalized:i}=s,l=i?r:c_({inputs:{logits:r},backend:t,attrs:{dim:r.shape.length-1}}),c=l.shape[0],h=l.shape[1],p=new loe(c,h,o),f=[[a]],g=t.runWebGLProgram(p,[l],"int32",f);return i||t.disposeIntermediateTensorInfo(l),g}const moe={kernelName:Zm,backendName:"webgl",kernelFunc:foe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const goe=nr+`
  return -x;
`,yoe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function xoe(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])){const o=t.texData.get(s.dataId),[a,i]=MZ(o.values,s.shape,s.dtype);return t.makeTensorInfo(i,s.dtype,a)}let r;return oe().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new ta(s.shape,yoe):r=new Pr(s.shape,goe),t.runWebGLProgram(r,[s],s.dtype)}const boe={kernelName:Yd,backendName:"webgl",kernelFunc:xoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const woe=iy;function voe(n){Ts("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:a,iouThreshold:i,scoreThreshold:l}=s,c=t.readSync(r.dataId),h=t.readSync(o.dataId),{selectedIndices:p}=woe(c,h,a,i,l);return t.makeTensorInfo([p.length],"int32",new Int32Array(p))}const koe={kernelName:Jm,backendName:"webgl",kernelFunc:voe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Soe=ly;function Noe(n){Ts("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:a,iouThreshold:i,scoreThreshold:l,padToMaxOutputSize:c}=s,h=t.readSync(r.dataId),p=t.readSync(o.dataId),{selectedIndices:f,validOutputs:g}=Soe(h,p,a,i,l,c);return[t.makeTensorInfo([f.length],"int32",new Int32Array(f)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const Coe={kernelName:eg,backendName:"webgl",kernelFunc:Noe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ioe=uy;function $oe(n){Ts("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:a,iouThreshold:i,scoreThreshold:l,softNmsSigma:c}=s,h=t.readSync(r.dataId),p=t.readSync(o.dataId),f=a,g=i,y=l,w=c,{selectedIndices:x,selectedScores:v}=Ioe(h,p,f,g,y,w);return[t.makeTensorInfo([x.length],"int32",new Int32Array(x)),t.makeTensorInfo([v.length],"float32",new Float32Array(v))]}const Toe={kernelName:tg,backendName:"webgl",kernelFunc:$oe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Eoe{constructor(e,t,s,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Roe=n=>{const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:o,depth:a,onValue:i,offValue:l}=s,c=ce(r.shape),h=new Eoe(c,a,i,l),p=Ce({inputs:{x:r},backend:t,attrs:{shape:[c]}}),f=t.runWebGLProgram(h,[p],o);t.disposeIntermediateTensorInfo(p);const g=[...r.shape,a],y=Ce({inputs:{x:f},backend:t,attrs:{shape:g}});return t.disposeIntermediateTensorInfo(f),y},Aoe={kernelName:Jd,backendName:"webgl",kernelFunc:Roe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mm(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="complex64"){const r=Zh({inputs:{input:s},backend:t}),o=mm({inputs:{x:r},backend:t}),a=Dy({inputs:{input:s},backend:t}),i=mm({inputs:{x:a},backend:t}),l=$a({inputs:{real:o,imag:i},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),l}else return Jh({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:t})}const Doe={kernelName:yh,backendName:"webgl",kernelFunc:mm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d_(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Zh({inputs:{input:s},backend:t}),o=d_({inputs:{x:r},backend:t}),a=Dy({inputs:{input:s},backend:t}),i=mm({inputs:{x:a},backend:t}),l=$a({inputs:{real:o,imag:i},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),l}else return Jh({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:t})}const _oe={kernelName:Zd,backendName:"webgl",kernelFunc:d_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ooe(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return sw({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const o=e[0].shape,a=e[0].dtype;e.forEach(h=>{Sn(o,h.shape,"All tensors passed to stack must have matching shapes"),A(a===h.dtype,()=>"All tensors passed to stack must have matching dtypes")});const i=[],l=e.map(h=>{const p=sw({inputs:{input:h},backend:t,attrs:{dim:r}});return i.push(p),p}),c=YD({inputs:l,backend:t,attrs:{axis:r}});return i.forEach(h=>t.disposeIntermediateTensorInfo(h)),c}const Foe={kernelName:eh,backendName:"webgl",kernelFunc:Ooe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Loe{constructor(e,t,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((c,h)=>c[0]+e[h]+c[1]);const r=e.length,o=yt(r),a=t.map(c=>c[0]).join(","),i=t.map((c,h)=>c[0]+e[h]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${a};
        int end = ${i};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${a});
      ${o} end = ${o}(${i});

      void main() {
        ${o} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${o} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Poe{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((w,x)=>w[0]+e[x]+w[1]);const r=e.length,o=yt(r),a=t.map(w=>w[0]).join(","),i=t.map((w,x)=>w[0]+e[x]).join(","),l=Un("rc",r),c=Un("source",r),h=`${l[r-1]} < ${this.outputShape[r-1]}`,p=r===1?"source":`vec2(${c.slice(-2).join()})`,f=[`${o} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${h}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${h}) {`],g=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let y="";for(let w=0,x=r===1?2:4;w<x;w++)y+=`
        ${f[w]}
        if (${g}) {
          result[${w}] = float(value);
        } else {
          ${o} source = rc - start;
          result[${w}] = getChannel(getX(${c.join()}), ${p});
        }
      `;y+=r===1?"} ":"}}",this.userCode=`
      const ${o} start = ${o}(${a});
      const ${o} end = ${o}(${i});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${y}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h_=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,constantValue:a}=s;if(ce(r.shape)===0){const c=o.map((h,p)=>h[0]+r.shape[p]+h[1]);return Jh({backend:t,attrs:{shape:c,value:a,dtype:r.dtype}})}const i=oe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Poe(r.shape,o,a):new Loe(r.shape,o,a),l=[[a]];return t.runWebGLProgram(i,[r],r.dtype,l)},zoe={kernelName:th,backendName:"webgl",kernelFunc:h_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Moe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Boe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Li+`
  return result;
`,Voe=$n({opSnippet:Moe,packedOpSnippet:Boe}),Woe={kernelName:hu,backendName:"webgl",kernelFunc:Voe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uoe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:a}=s,i=r.shape.length,l=[],c=Qe(o,r.shape);let h=c;const p=Lt(h,i);let f=r;p!=null&&(f=jn({inputs:{x:r},backend:t,attrs:{perm:p}}),h=jt(h.length,i),l.push(f)),Cn("prod",h,i);let g;if(t.shouldExecuteOnCPU([f])){const y=t.texData.get(f.dataId).values,{outVals:w,outShape:x,outDtype:v}=VZ(f.shape,f.dtype,y,h);g=t.makeTensorInfo(x,v,w)}else{const[y,w]=mn(f.shape,h),x=ce(w),v=Ce({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),k=$g(r.dtype),I=Pi(v,k,"prod",t);g=Ce({inputs:{x:I},backend:t,attrs:{shape:y}}),l.push(v),l.push(I)}if(a){l.push(g);const y=Ut(g.shape,c);g=Ce({inputs:{x:g},backend:t,attrs:{shape:y}})}return l.forEach(y=>t.disposeIntermediateTensorInfo(y)),g}const joe={kernelName:sh,backendName:"webgl",kernelFunc:Uoe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Goe(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:o,indices:a}=e,{outputRaggedRank:i}=s,l=r.map(v=>t.readSync(v.dataId)),c=r.map(v=>v.shape),h=t.readSync(o.dataId),p=t.readSync(a.dataId),[f,g,y]=WZ(l,c,h,o.shape,o.dtype,p,a.shape,i),w=f.map(v=>t.makeTensorInfo([v.length],"int32",v)),x=t.makeTensorInfo(y,o.dtype,g);return w.concat([x])}const Hoe={kernelName:ng,backendName:"webgl",kernelFunc:Goe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qoe(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:o}=e,a=t.readSync(s.dataId),i=t.readSync(r.dataId),l=t.readSync(o.dataId),[c,h]=UZ(a,s.shape,s.dtype,i,r.shape,l,o.shape),p=t.makeTensorInfo([c.length],"int32",c),f=t.makeTensorInfo([h.length],s.dtype,h);return[p,f]}const Koe={kernelName:sg,backendName:"webgl",kernelFunc:qoe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xoe(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:o,defaultValue:a,rowPartitionTensors:i}=e,{rowPartitionTypes:l}=s,c=t.readSync(r.dataId),h=t.readSync(o.dataId),p=t.readSync(a.dataId),f=i.map(x=>t.readSync(x.dataId)),g=i.map(x=>x.shape),[y,w]=jZ(c,r.shape,h,o.shape,o.dtype,p,a.shape,f,g,l);return t.makeTensorInfo(y,o.dtype,w)}const Yoe={kernelName:rg,backendName:"webgl",kernelFunc:Xoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p_=n=>{const{backend:e,attrs:t}=n,{start:s,stop:r,step:o,dtype:a}=t,i=GZ(s,r,o,a);return e.makeTensorInfo([i.length],a,i)},Qoe={kernelName:og,backendName:"webgl",kernelFunc:p_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zoe="return 1.0 / x;",Joe=rt({opSnippet:Zoe}),eae={kernelName:pu,backendName:"webgl",kernelFunc:Joe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tae=nr+`
  return (x < 0.0) ? 0.0 : x;
`,nae=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,sae=rt({opSnippet:tae,packedOpSnippet:nae}),rae={kernelName:fu,backendName:"webgl",kernelFunc:sae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oae=nr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,aae=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,iae=rt({opSnippet:oae,packedOpSnippet:aae}),lae={kernelName:mu,backendName:"webgl",kernelFunc:iae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uae{constructor(e,t,s,r,o){this.variableNames=["A"],this.outputShape=[];const[a,i,l,c]=e;this.outputShape=[a,t,s,c];const h=[r&&t>1?i-1:i,r&&s>1?l-1:l],p=[r&&t>1?t-1:t,r&&s>1?s-1:s];let f;o?f="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/p[0]},
          ${h[1]/p[1]});
      const vec2 inputShapeRC = vec2(${i}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cae{constructor(e,t,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[a,i,l,c]=e;this.outputShape=[a,t,s,c];const h=[r&&t>1?i-1:i,r&&s>1?l-1:l],p=[r&&t>1?t-1:t,r&&s>1?s-1:s];let f;o?f="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/p[0]},
          ${h[1]/p[1]},
          ${h[1]/p[1]});
      const vec3 inputShapeRC = vec3(${i}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:a,size:i}=s,[l,c]=i,h=oe().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new cae(r.shape,l,c,o,a):new uae(r.shape,l,c,o,a);return t.runWebGLProgram(h,[r],"float32")}const hae={kernelName:ah,backendName:"webgl",kernelFunc:dae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pae{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,o]=t,[,a,i]=e,l=[s&&a>1?r-1:r,s&&i>1?o-1:o],c=[s&&a>1?a-1:a,s&&i>1?i-1:i],h=l[0]/c[0],p=l[1]/c[1],f=1/h,g=1/p,y=Math.ceil(f)*2+2,w=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${p});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${g});

        const int winHeight = int(${y});
        const int winWidth = int(${w});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${a}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${i}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${o-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:a}=s,i=new pae(o.shape,r.shape,a);return t.runWebGLProgram(i,[o],o.dtype)}const mae={kernelName:lg,backendName:"webgl",kernelFunc:fae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gae{constructor(e,t,s,r,o){this.variableNames=["A"],this.outputShape=[];const[a,i,l,c]=e;this.outputShape=[a,t,s,c];const h=[r&&t>1?i-1:i,r&&s>1?l-1:l],p=[r&&t>1?t-1:t,r&&s>1?s-1:s],f=r?"0.5":"0.0";let g;o?g="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":g="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${h[0]/p[0]},
          ${h[1]/p[1]});
      const vec2 inputShapeRC = vec2(${i}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yae{constructor(e,t,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[a,i,l,c]=e;this.outputShape=[a,t,s,c];const h=[r&&t>1?i-1:i,r&&s>1?l-1:l],p=[r&&t>1?t-1:t,r&&s>1?s-1:s],f=r?"0.5":"0.0";let g;o?g="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":g="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${h[0]/p[0]},
          ${h[1]/p[1]},
          ${h[1]/p[1]});
      const vec3 inputShapeRC = vec3(${i}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:a,size:i}=s,[l,c]=i,h=oe().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new yae(r.shape,l,c,o,a):new gae(r.shape,l,c,o,a);return t.runWebGLProgram(h,[r],r.dtype)}const bae={kernelName:oh,backendName:"webgl",kernelFunc:xae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wae{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,o]=t,[,a,i]=e,l=[s&&a>1?r-1:r,s&&i>1?o-1:o],c=[s&&a>1?a-1:a,s&&i>1?i-1:i],h=l[0]/c[0],p=l[1]/c[1],f=1/h,g=1/p,y=Math.ceil(f)*2+2,w=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${h});
        const float widthScale = float(${p});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${g});

        const int winHeight = int(${y});
        const int winWidth = int(${w});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${a}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${i}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${o}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vae(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:a}=s,i=new wae(o.shape,r.shape,a);return t.runWebGLProgram(i,[o],o.dtype)}const kae={kernelName:ig,backendName:"webgl",kernelFunc:vae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sae{constructor(e,t){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=i=>t.indexOf(i)!==-1&&e[i]!==1?`${e[i]} - coords[${i}] - 1`:`coords[${i}]`,o=e.map((i,l)=>r(l)).join(","),a=yt(s);this.userCode=`
      void main() {
        ${a} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nae{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=Un("rc",s),o=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,a=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,i=yt(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${o}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${i} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${o}){
            result.g = ${c(r.slice())};
          }
          if(${a}) {
            result.b = ${h(r.slice())};
            if(${o}) {
              result.a = ${p(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(y){return f(y)}function c(y){return y[s-1]="("+y[s-1]+" + 1)",f(y)}function h(y){return y[s-2]="("+y[s-2]+" + 1)",f(y)}function p(y){return y[s-1]="("+y[s-1]+" + 1)",y[s-2]="("+y[s-2]+" + 1)",f(y)}function f(y){const w=e.map((k,I)=>g(I,y)),x=w.join(","),v=w.slice(-2).join(",");return`getChannel(getX(${x}), vec2(${v}))`}function g(y,w){return t.indexOf(y)!==-1&&e[y]!==1?`${e[y]} - ${w[y]} - 1`:`${w[y]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cae(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:o}=s,a=r.shape.length,i=Qe(o,r.shape);if(a===0)return ws({inputs:{x:r},backend:t});const l=oe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Nae(r.shape,i):new Sae(r.shape,i);return t.runWebGLProgram(l,[r],r.dtype)}const Iae={kernelName:ih,backendName:"webgl",kernelFunc:Cae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $ae{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let o="";typeof t=="number"?o=`float outputValue = ${t.toFixed(2)};`:o=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${o}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tae={kernelName:Cg,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:o,center:a}=e,i=t,l=new $ae(s.shape,o),[c,h]=q1(a,s.shape[1],s.shape[2]),p=[[c,h,Math.sin(r),Math.cos(r)]];return i.runWebGLProgram(l,[s],s.dtype,p)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eae=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,Rae=rt({opSnippet:Eae}),Aae={kernelName:gu,backendName:"webgl",kernelFunc:Rae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dae="return inversesqrt(x);",_ae=rt({opSnippet:Dae,cpuKernelImpl:HZ}),Oae={kernelName:yu,backendName:"webgl",kernelFunc:_ae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yv{constructor(e,t,s,r,o,a,i=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;const c=yt(o.length),h=yt(a.length);let p="";s===1?p="i":s===2&&(p="i, j");const f=`getIndices(${p})`;let g="";r===1?g="i":r===2&&(g="i, coords[1]");const y=`getUpdates(${g})`;let w="";l&&(w="coords[0], coords[1]");const x=`getDefaultValue(${w})`,v=t>1?"strides[j]":"strides";this.userCode=`
        ${c} strides = ${c}(${o});

        void main() {
          ${h} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${f});
              flattenedIndex += index * ${v};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${y};
              found = true;
            }
          }
          setOutput(mix(${x}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fae{constructor(e,t,s,r,o,a,i=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=a;const c=yt(o.length),h=yt(a.length);let p="";s===1?p="i":s===2&&(p="i, j");const f=`getIndices(${p})`;let g="";r===1?g="i":r===2&&(g="i, coords[1]");const y=`getUpdates(${g})`;let w="";l&&(w="coords[0], coords[1]");const x=`getDefaultValue(${w})`,v=t>1?"strides[j]":"strides",k=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${c} strides = ${c}(${o});

        void main() {
          ${h} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${f});
              flattenedIndex += index.xz * ${v};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${k};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${y};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${x}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lae(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:o}=e,{shape:a}=s,{sliceRank:i,numUpdates:l,sliceSize:c,strides:h,outputSize:p}=Na(o,r,a),f=[p/c,c];if(p===0)return t.makeTensorInfo(a,r.dtype);const g=Ce({inputs:{x:r},backend:t,attrs:{shape:[l,i]}}),y=Ce({inputs:{x:o},backend:t,attrs:{shape:[l,c]}}),w=t.makeTensorInfo([],"float32",new Float32Array([0]));let x;oe().getBool("WEBGL_PACK")?x=new Fae(l,i,g.shape.length,y.shape.length,h,f):x=new Yv(l,i,g.shape.length,y.shape.length,h,f);const v=t.runWebGLProgram(x,[y,g,w],y.dtype),k=Ce({inputs:{x:v},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),k}const Pae={kernelName:ug,backendName:"webgl",kernelFunc:Lae};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zae{constructor(e,t,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const o="while (left < right) {",a=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,i=oe().getNumber("WEBGL_VERSION")===2?o:a,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${i}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mae(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:o}=e,{side:a}=s,i=new zae(r.shape[0],r.shape[1],o.shape[1],a),l=[[r.shape[1]]];return t.runWebGLProgram(i,[r,o],"int32",l)}const Bae={kernelName:dg,backendName:"webgl",kernelFunc:Mae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vae{constructor(e,t,s){this.variableNames=["c","a","b"],this.outputShape=t;let r,o;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)o="resRC",r="resRC";else{const i=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let h=0;h<t.length;h++)c.push(`${i[h]}`),h<e&&l.push(`${i[h]}`);r=l.join(),o=c.join()}const a=yt(s);this.userCode=`
      void main() {
        ${a} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${o}));
        } else {
          setOutput(getB(${o}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wae(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:o}=e,a=new Vae(s.shape.length,r.shape,r.shape.length);return t.runWebGLProgram(a,[s,r,o],Jn(r.dtype,o.dtype))}const Uae={kernelName:lh,backendName:"webgl",kernelFunc:Wae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jae=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${fy};
  float scale = ${my};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Gae=rt({opSnippet:jae}),Hae={kernelName:xu,backendName:"webgl",kernelFunc:Gae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qae=Hu+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,Kae=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Xae=rt({opSnippet:qae,packedOpSnippet:Kae,cpuKernelImpl:KZ}),Yae={kernelName:ku,backendName:"webgl",kernelFunc:Xae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qae=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,Zae=rt({opSnippet:Qae}),Jae={kernelName:vu,backendName:"webgl",kernelFunc:Zae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eie=Hu+`
  return sin(x);
`,tie=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Li}
  return result;
`,nie=rt({opSnippet:eie,packedOpSnippet:tie}),sie={kernelName:bu,backendName:"webgl",kernelFunc:nie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rie=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,oie=rt({opSnippet:rie}),aie={kernelName:wu,backendName:"webgl",kernelFunc:oie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iie=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,lie=rt({opSnippet:iie}),uie={kernelName:Su,backendName:"webgl",kernelFunc:lie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cie=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,paddings:a}=s;A(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const i=o.reduce((v,k)=>v*k),l=[[0,0]];l.push(...a);for(let v=1+o.length;v<r.shape.length;++v)l.push([0,0]);const c=[],h=h_({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),p=Ph(h.shape,o,i,!1),f=zh(p.length,o.length,!1),g=Mh(h.shape,o,i,!1),y=Ce({inputs:{x:h},backend:t,attrs:{shape:p}}),w=jn({inputs:{x:y},backend:t,attrs:{perm:f}}),x=Ce({inputs:{x:w},backend:t,attrs:{shape:g}});return c.push(h),c.push(y),c.push(w),c.forEach(v=>t.disposeIntermediateTensorInfo(v)),x},die={kernelName:dh,backendName:"webgl",kernelFunc:cie};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hie(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:o,defaultValue:a}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(a.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${a.shape}`);const i=t.readSync(s.dataId),l=t.readSync(r.dataId),c=t.readSync(o.dataId),h=t.readSync(a.dataId)[0],[p,f,g,y,w]=YZ(i,s.shape,s.dtype,l,r.dtype,c,h);return[t.makeTensorInfo(f,s.dtype,p),t.makeTensorInfo([f[0]],r.dtype,g),t.makeTensorInfo([y.length],"bool",new Uint8Array(y.map(x=>Number(x)))),t.makeTensorInfo([w.length],s.dtype,new Int32Array(w))]}const pie={kernelName:hg,backendName:"webgl",kernelFunc:hie};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fie(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const a=Array.from(t.readSync(r.dataId)),i=t.readSync(s.dataId),l=Array.from(t.readSync(o.dataId)),[c,h,p]=QZ(i,s.shape,s.dtype,a,l);return[t.makeTensorInfo(h,s.dtype,c),t.makeTensorInfo([p.length],o.dtype,new Int32Array(p))]}const mie={kernelName:pg,backendName:"webgl",kernelFunc:fie};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gie(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${o.shape}`);const a=t.readSync(s.dataId),i=t.readSync(r.dataId),l=t.readSync(o.dataId),[c,h]=PD(a,s.shape,s.dtype,i,l,!0);return t.makeTensorInfo(h,s.dtype,c)}const yie={kernelName:fg,backendName:"webgl",kernelFunc:gie};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xie(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${o.shape}`);const a=t.readSync(s.dataId),i=t.readSync(r.dataId),l=t.readSync(o.dataId),[c,h]=PD(a,s.shape,s.dtype,i,l);return t.makeTensorInfo(h,s.dtype,c)}const bie={kernelName:mg,backendName:"webgl",kernelFunc:xie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wie(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:o,defaultValue:a}=e,{outputShape:i}=s,{sliceRank:l,numUpdates:c,sliceSize:h,strides:p,outputSize:f}=Na(o,r,i),g=!1;if(o.dtype==="string"){const v=t.bufferSync(r),k=t.bufferSync(o),I=fo(t.readSync(a.dataId)[0]),N=qZ(v,k,i,f,h,c,l,p,I,g);return t.makeTensorInfo(i,N.dtype,N.values)}const y=new Yv(c,l,r.shape.length,o.shape.length,p,[f,1],g),w=t.runWebGLProgram(y,[o,r,a],o.dtype),x=Ce({inputs:{x:w},backend:t,attrs:{shape:i}});return t.disposeIntermediateTensorInfo(w),x}const vie={kernelName:gg,backendName:"webgl",kernelFunc:wie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kie(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:o,axis:a}=s,i=Qe(a,r.shape)[0],l=lv(r,o,i),c=r.shape.length,h=new Array(c).fill(0),p=r.shape.slice();return l.map(f=>{const g=[...p];g[i]=f;const y=qu({inputs:{x:r},backend:t,attrs:{begin:h,size:g}});return h[i]+=f,y})}const Sie={kernelName:hh,backendName:"webgl",kernelFunc:kie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jI="return sqrt(x);",Nie=rt({opSnippet:jI,packedOpSnippet:jI,cpuKernelImpl:ZZ}),Cie={kernelName:Nu,backendName:"webgl",kernelFunc:Nie};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iie="return x * x;",$ie=rt({opSnippet:Iie}),Tie={kernelName:yg,backendName:"webgl",kernelFunc:$ie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GI="return (a - b) * (a - b);",Eie=$n({opSnippet:GI,packedOpSnippet:GI}),Rie={kernelName:Cu,backendName:"webgl",kernelFunc:Eie};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aie(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const o=t.readSync(r.dataId),a=xo(o),i=JZ(a,"string",s);return t.makeTensorInfo(r.shape,"string",i)}const Die={kernelName:fh,backendName:"webgl",kernelFunc:Aie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ie({inputs:n,attrs:e,backend:t}){const{x:s}=n,r=nr+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,o=new Pr(s.shape,r);return t.runWebGLProgram(o,[s],s.dtype)}const Oie={kernelName:Ru,backendName:"webgl",kernelFunc:_ie};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fie{constructor(e,t,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,o=yt(s.length),a=yt(s.length);let i="";if(r===1)i="coords * strides + begin";else{let l=0;i=s.map((c,h)=>(l++,s.length===1?`coords * strides[${h}] + begin[${h}]`:`coords[${l-1}] * strides[${h}] + begin[${h}]`)).join(",")}this.userCode=`
      ${o} begin = ${o}(${e});
      ${o} strides = ${o}(${t});

      void main() {
        ${a} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lie(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,end:a,strides:i,beginMask:l,endMask:c,ellipsisMask:h,newAxisMask:p,shrinkAxisMask:f}=s,{finalShapeSparse:g,finalShape:y,isIdentity:w,sliceDim0:x,isSimpleSlice:v,begin:k,end:I,strides:N}=U1(r.shape,o,a,i,l,c,h,p,f);let T;if(w)T=Ce({inputs:{x:r},backend:t,attrs:{shape:y}});else if(x||v){A(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const P=B1(k,I,N),z=qu({inputs:{x:r},backend:t,attrs:{begin:k,size:P}});T=Ce({inputs:{x:z},backend:t,attrs:{shape:y}}),t.disposeIntermediateTensorInfo(z)}else if(t.shouldExecuteOnCPU([r])){const z=t.readSync(r.dataId),F=qe(r.shape,r.dtype,z),L=eJ(g,F,N,k);T=t.makeTensorInfo(y,r.dtype,L.values)}else{const z=new Fie(k,N,g);T=t.runWebGLProgram(z,[r],r.dtype)}const D=Ce({inputs:{x:T},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(T),D}const Pie={kernelName:xg,backendName:"webgl",kernelFunc:Lie};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zie(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:o,leftPad:a,rightPad:i,padWidth:l,preserveShortSequences:c}=s,{data:h,dataSplits:p}=e,f=t.readSync(h.dataId),g=t.readSync(p.dataId),[y,w]=tJ(f,g,r,o,a,i,l,c);return[t.makeTensorInfo([y.length],"string",y),t.makeTensorInfo(p.shape,"int32",w)]}const Mie={kernelName:bg,backendName:"webgl",kernelFunc:zie};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bie(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:o,delimiter:a}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(a.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${a.shape}`);const i=t.readSync(o.dataId),l=t.readSync(a.dataId)[0],[c,h,p]=nJ(i,l,r),f=h.length;return[t.makeTensorInfo([f,2],"int32",c),t.makeTensorInfo([f],"string",h),t.makeTensorInfo([2],"int32",new Int32Array(p))]}const Vie={kernelName:wg,backendName:"webgl",kernelFunc:Bie};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wie(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const a=t.readSync(o.dataId),i=sJ(a,r);return t.makeTensorInfo(o.shape,"int32",i)}const Uie={kernelName:vg,backendName:"webgl",kernelFunc:Wie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jie="return tan(x);",Gie=rt({opSnippet:jie}),Hie={kernelName:$u,backendName:"webgl",kernelFunc:Gie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qie=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Kie=rt({opSnippet:qie}),Xie={kernelName:Tu,backendName:"webgl",kernelFunc:Kie};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yie(n){const{inputs:e,backend:t,attrs:s}=n,{tensor:r,indices:o,updates:a}=e,{sliceRank:i,numUpdates:l,sliceSize:c,strides:h,outputSize:p}=Na(a,o,r.shape),f=[p/c,c];if(p===0)return t.makeTensorInfo(r.shape,o.dtype);const g=Ce({inputs:{x:o},backend:t,attrs:{shape:[l,i]}}),y=Ce({inputs:{x:a},backend:t,attrs:{shape:[l,c]}}),w=Ce({inputs:{x:r},backend:t,attrs:{shape:f}}),x=new Yv(l,i,g.shape.length,y.shape.length,h,f,!1,!0),v=t.runWebGLProgram(x,[y,g,w],w.dtype),k=Ce({inputs:{x:v},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(v),k}const Qie={kernelName:cg,backendName:"webgl",kernelFunc:Yie};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zie{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let a=0;a<s.length;a++)s[a]=e[a]*t[a];this.outputShape=s,this.rank=s.length;const r=yt(this.rank),o=Jie(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}}function Jie(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${t[r]}, ${n[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f_(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:o}=s;if(r.dtype==="string"||r.shape.length>5){const l=t.readSync(r.dataId),c=r.dtype==="string"?l.map(f=>fo(f)):l,h=qe(r.shape,r.dtype,c),p=oJ(h,o);return t.makeTensorInfo(p.shape,p.dtype,p.values)}const a=new Zie(r.shape,o);return t.runWebGLProgram(a,[r],r.dtype)}const ele={kernelName:Eu,backendName:"webgl",kernelFunc:f_};class tle{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class nle{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ja(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function HI(n){let e=1;for(;e<n;)e*=2;return e}function sle(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:o,sorted:a}=s,i=oe().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=oe().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=r.shape,h=c[c.length-1];if(t.shouldExecuteOnCPU([r])||h<i||o>l){const L=t.readSync(r.dataId),[E,j]=aJ(L,c,r.dtype,o,a);return[t.makeTensorInfo(E.shape,E.dtype,E.values),t.makeTensorInfo(j.shape,j.dtype,j.values)]}if(o===0)return c[c.length-1]=0,[t.makeTensorInfo(c,r.dtype,[]),t.makeTensorInfo(c,"int32",[])];if(h===1)return[r,Jh({attrs:{shape:c,dtype:"int32",value:0},backend:t})];const p=t.texData.get(r.dataId),f=p!==null&&p.isPacked,g=f?t.unpackTensor(r):r,w=ce(c)/h,x=Ce({inputs:{x:g},attrs:{shape:[w,h]},backend:t});f&&ja(t,g);const v=HI(o),k=HI(h);let I=null;const N=()=>I===null?[x,x]:[x,I],T=(L,E,j)=>{const Z=N(),ne=new tle(j),se=[[h],[I===null?1:0],[Number.NEGATIVE_INFINITY],[L],[E]],K=I;I=t.runWebGLProgram(ne,Z,"int32",se),ja(t,K)};for(let L=1;L<v;L*=2){const E=L*2;for(let j=L;j>=1;j/=2)T(E,j,[w,k])}for(let L=k;L>v;L/=2){const E=N(),j=new nle([w,L/2]),ne=[[h],[I===null?1:0],[v]],te=I;I=t.runWebGLProgram(j,E,"int32",ne),ja(t,te);const se=v/2,K=se*2;for(let B=se;B>=1;B/=2)T(K,B,I.shape)}let D=I;I=qu({inputs:{x:I},backend:t,attrs:{begin:0,size:[w,o]}}),ja(t,D);let P=a_({inputs:{x,indices:I},backend:t,attrs:{axis:1,batchDims:1}});ja(t,x);const z=c.slice(0,-1);z.push(o),D=I,I=Ce({inputs:{x:I},attrs:{shape:z},backend:t}),ja(t,D);const F=P;return P=Ce({inputs:{x:P},attrs:{shape:z},backend:t}),ja(t,F),[P,I]}const rle={kernelName:kg,backendName:"webgl",kernelFunc:sle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ole{constructor(e,t,s,r,o,a){this.variableNames=["Image","Transforms"],this.outputShape=a;const i=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${o});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${o});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${i} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ale(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,transforms:o}=e,{interpolation:a,fillMode:i,fillValue:l,outputShape:c}=s,[h,p,f,g]=r.shape,[y,w]=c??[p,f],x=[h,y,w,g],v=new ole(p,f,a,i,l,x);return t.runWebGLProgram(v,[r,o],"float32")}const ile={kernelName:Sg,backendName:"webgl",kernelFunc:ale};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lle(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:o}=e;Yh(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const a=s.readSync(o.dataId),{outputValues:i,outputShape:l,indices:c}=iJ(a,r,o.shape,o.dtype);return[s.makeTensorInfo(l,o.dtype,i),s.makeTensorInfo([c.length],"int32",c)]}const ule={kernelName:Ng,backendName:"webgl",kernelFunc:lle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cle(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const a=r,i=a.shape.length,l=r.shape[o],c=new Array(i-1);let h=0;for(let w=0;w<i;w++)w!==o&&(c[h++]=a.shape[w]);const p=[],f=new Array(i).fill(0),g=a.shape.slice();g[o]=1;const y=new Array(l);for(let w=0;w<y.length;w++){f[o]=w;const x=qu({inputs:{x:a},backend:t,attrs:{begin:f,size:g}}),v=Ce({inputs:{x},backend:t,attrs:{shape:c}});y[w]=v,p.push(x)}return p.forEach(w=>t.disposeIntermediateTensorInfo(w)),y}const dle={kernelName:mh,backendName:"webgl",kernelFunc:cle};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hle{constructor(e,t){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,o=e.inSize,a=e.numSegments,i=a*Math.ceil(o/s);this.outputShape=[r,i];const l="0.0",c="sumValue",h=Math.floor(s/4)*4,p=s%4,f=`
        sumValue += dot(values, segFilter);
    `;let g="";o%s>0&&(g=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `);let y="";o%s>0&&(y=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${y}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${a})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${a})));

        float sumValue = 0.0;

        for (int i = 0; i < ${h}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${f}
        }

        int inIdx = inOffset + ${h};
        if (${p===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${f}
        } else if (${p===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${f}
        } else if (${p===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${f}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ple(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:o}=e,{numSegments:a}=s,i=r.shape.length,l=[];let c=0;const h=Lt([c],i);let p=r;h!=null&&(p=jn({inputs:{x:r},backend:t,attrs:{perm:h}}),l.push(p),c=jt(1,i)[0]);const f=GT(p.shape,c,a),g=ce([p.shape[c]]),y=Ce({inputs:{x:p},backend:t,attrs:{shape:[-1,g]}});l.push(y);const w=$g(r.dtype),x=(N,T,D,P,z)=>{const F=N.shape[0],L=N.shape[1],E=jT(L,z),j={windowSize:E,inSize:L,batchSize:F,numSegments:z},Z=new hle(j,T),ne=t.compileAndRun(Z,[N,D],P);if(l.push(ne),ne.shape[1]===z)return ne;const te=p_({backend:t,attrs:{start:0,stop:z,step:1,dtype:"float32"}}),se=f_({inputs:{x:te},backend:t,attrs:{reps:[L/E]}});return l.push(te),l.push(se),x(ne,T,se,P,z)},v=x(y,"unsortedSegmentSum",o,w,a),k=Ce({inputs:{x:v},backend:t,attrs:{shape:f}});let I=k;if(h!=null){l.push(k);const N=va(h);I=jn({inputs:{x:I},backend:t,attrs:{perm:N}})}return l.forEach(N=>t.disposeIntermediateTensorInfo(N)),I}const fle={kernelName:gh,backendName:"webgl",kernelFunc:ple};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mle=[ZJ,eee,see,aee,lee,dee,pee,mee,bee,vee,Nee,$ee,Ree,Oee,Pee,Mee,Vee,Gee,qee,Xee,Jee,ate,lte,hte,fte,wte,kte,Ite,FJ,Ete,Ote,zte,jte,qte,Xte,Qte,Jte,sne,ane,une,dne,pne,mne,xne,wne,Nne,Ine,Ene,Dne,One,zne,Wne,Hne,Xne,Zne,Jne,tse,sse,ose,ise,use,pse,gse,bse,vse,Nse,$se,Ase,Fse,OJ,Pse,Dte,Bse,Use,Hse,PJ,Yse,ere,nre,are,ure,pre,gre,wre,Nre,$re,Ere,_re,Fre,Pre,Vre,Ure,Gre,qre,Xre,Jre,soe,ioe,moe,BJ,boe,koe,Coe,Toe,gte,Aoe,_oe,Foe,zoe,Woe,MJ,joe,Hoe,Koe,Yoe,Qoe,yte,doe,eae,rae,lae,WJ,hae,mae,bae,kae,Iae,Tae,Aae,Oae,Pae,Bae,Uae,Hae,Yae,Jae,sie,aie,rte,poe,uie,die,pie,mie,yie,bie,vie,Sie,Cie,Tie,Rie,Die,Oie,Pie,Mie,Vie,Uie,hoe,XJ,Hie,Xie,Qie,ele,rle,ile,YJ,ule,dle,fle,Doe];for(const n of mle)Ig(n);let Cf=null;const m_=async()=>{if(Cf)return Cf;try{return console.log("Loading MobileNet model..."),Cf=await Qj(),console.log("MobileNet model loaded successfully"),Cf}catch(n){throw console.error("Failed to load MobileNet model:",n),new Error("Failed to load AI model")}},gle=async n=>{try{if(!n||!n.complete)throw new Error("Invalid image element");const e=await m_();if(!e)throw new Error("Model not loaded");console.log("Running image classification...");const t=await e.classify(n);if(console.log("Raw predictions:",t),!t||!Array.isArray(t))return console.warn("Invalid predictions received:",t),[];const s=t.filter(r=>r&&r.probability>.1&&r.className).slice(0,5).map(r=>{const o=yle(r.className);return o?{className:o,probability:r.probability}:null}).filter(r=>r!==null);return console.log("Filtered food predictions:",s),s}catch(e){throw console.error("Image classification failed:",e),new Error("Failed to analyze image")}},yle=n=>{const e={banana:"banana",orange:"orange",apple:"apple",strawberry:"strawberry",broccoli:"broccoli",carrot:"carrot",mushroom:"mushroom","bell pepper":"bell pepper",tomato:"tomato",cucumber:"cucumber",pizza:"bread",bagel:"bread",pretzel:"bread",hotdog:"beef",hamburger:"beef",cheeseburger:"beef","meat loaf":"beef",steak:"beef","fried chicken":"chicken breast","roast chicken":"chicken breast","grilled salmon":"salmon",tuna:"fish",sushi:"fish","french fries":"potato","baked potato":"potato","mashed potato":"potato",spaghetti:"pasta",ravioli:"pasta",macaroni:"pasta","fried rice":"rice",risotto:"rice","chocolate cake":"chocolate","ice cream":"milk",cheese:"cheese",omelet:"egg","scrambled eggs":"egg","boiled egg":"egg",salad:"lettuce",soup:"broccoli",sandwich:"bread",burrito:"bread",taco:"beef",corn:"carrot",peas:"broccoli",beans:"nuts",avocado:"avocado",grapes:"grapes",watermelon:"watermelon",blueberry:"blueberry"},t=["food","fruit","vegetable","meat","chicken","beef","fish","bread","rice","potato","egg","cheese","milk","cake","cookie","pie","dish","meal","cuisine","plate","bowl","edible","nutrition"],s=n.toLowerCase();if(e[s])return e[s];for(const[a,i]of Object.entries(e))if(s.includes(a)||a.includes(s))return i;if(!t.some(a=>s.includes(a)))return null;const o=["chicken","beef","fish","bread","rice","potato","egg","cheese","milk"];for(const a of o)if(s.includes(a))return a==="chicken"?"chicken breast":a;return null};let Ga=null;const g_=async()=>{if(Ga)return Ga;try{console.log("Loading nutrition database...");const n=await fetch("/nutrition.json");if(!n.ok)throw new Error(`Failed to load nutrition database: ${n.status} ${n.statusText}`);const e=await n.json();if(!e||typeof e!="object")throw new Error("Invalid nutrition database format");return Ga=e,console.log("Nutrition database loaded successfully:",Object.keys(Ga).length,"foods"),Ga}catch(n){return console.error("Failed to load nutrition database:",n),Ga={apple:{calories:52,protein:.3,carbs:14,fat:.2},banana:{calories:89,protein:1.1,carbs:23,fat:.3},bread:{calories:265,protein:9,carbs:49,fat:3.2},"chicken breast":{calories:165,protein:31,carbs:0,fat:3.6},rice:{calories:130,protein:2.7,carbs:28,fat:.3}},console.warn("Using fallback nutrition database"),Ga}},y_=(n,e,t)=>{if(!n||!t||typeof e!="number"||e<=0)return console.warn("Invalid parameters for nutrition calculation:",{foodName:n,weightInGrams:e,database:!!t}),{calories:0,protein:0,carbs:0,fat:0};const s=t[n.toLowerCase()];if(!s)return console.warn(`Nutrition data not found for: ${n}`),{calories:100,protein:5,carbs:10,fat:3};const r=e/100;return{calories:Math.round((s.calories||0)*r),protein:Math.round((s.protein||0)*r*10)/10,carbs:Math.round((s.carbs||0)*r*10)/10,fat:Math.round((s.fat||0)*r*10)/10}},qI=n=>!n||!Array.isArray(n)||n.length===0?{calories:0,protein:0,carbs:0,fat:0}:n.reduce((e,t)=>{if(!t||!t.nutrition)return console.warn("Invalid ingredient in meal calculation:",t),e;const s=t.nutrition;return{calories:e.calories+(s.calories||0),protein:Math.round((e.protein+(s.protein||0))*10)/10,carbs:Math.round((e.carbs+(s.carbs||0))*10)/10,fat:Math.round((e.fat+(s.fat||0))*10)/10}},{calories:0,protein:0,carbs:0,fat:0}),xle=async(n,e)=>{try{if(!n||!Array.isArray(n)||n.length===0)return console.warn("No valid predictions provided"),[];if(!e||e<=0)return console.warn("Invalid total weight:",e),[];const t=await g_();if(!t)return console.error("Failed to load nutrition database"),[];const s=n.filter(o=>!o||!o.className?!1:t[o.className.toLowerCase()]);if(s.length===0)return console.warn("No valid predictions found in database"),[];const r=100/s.length;return s.map((o,a)=>{const i=e*r/100;return{id:(a+1).toString(),name:o.className,percentage:Math.round(r*10)/10,weight:Math.round(i),nutrition:y_(o.className,i,t)}})}catch(t){return console.error("Error creating ingredients from predictions:",t),[]}},Jx=async(n,e)=>{const t=await g_();return n.map(s=>{const r=e*s.percentage/100;return{...s,weight:Math.round(r),nutrition:y_(s.name,r,t)}})},ble=n=>{if(!n||!Array.isArray(n)||n.length===0)return!1;const e=n.reduce((t,s)=>!s||typeof s.percentage!="number"?t:t+s.percentage,0);return Math.abs(e-100)<.1},wle=()=>{const n=r2(),{addMeal:e}=Fl(),t=ve.useRef(null),s=ve.useRef(null),r=ve.useRef(null),[o,a]=ve.useState("photo"),[i,l]=ve.useState(""),[c,h]=ve.useState(200),[p,f]=ve.useState([]),[g,y]=ve.useState(!1),[w,x]=ve.useState(!1),[v,k]=ve.useState(""),[I,N]=ve.useState(!1),[T,D]=ve.useState(null),P=async()=>{try{k("");const K=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:640,height:480}});D(K),N(!0),s.current&&(s.current.srcObject=K)}catch(K){console.error("Camera access failed:",K),k("Camera access denied. Please use file upload instead.")}},z=()=>{T&&(T.getTracks().forEach(K=>K.stop()),D(null)),N(!1)},F=()=>{if(!s.current||!r.current)return;const K=r.current,B=s.current,J=K.getContext("2d");if(!J)return;K.width=B.videoWidth,K.height=B.videoHeight,J.drawImage(B,0,0);const X=K.toDataURL("image/jpeg",.8);l(X),z(),E(X)},L=K=>{var X;const B=(X=K.target.files)==null?void 0:X[0];if(!B)return;if(!B.type.startsWith("image/")){k("Please select an image file");return}const J=new FileReader;J.onload=M=>{var le;const H=(le=M.target)==null?void 0:le.result;l(H),E(H)},J.readAsDataURL(B)},E=async K=>{y(!0),x(!0),k("");try{if(!K||typeof K!="string")throw new Error("Invalid photo data");await m_(),x(!1);const B=new Image;B.crossOrigin="anonymous";const J=setTimeout(()=>{k("Image processing timed out. Please try again."),y(!1)},3e4);B.onload=async()=>{clearTimeout(J);try{if(!B.complete||B.naturalWidth===0)throw new Error("Image failed to load properly");const X=await gle(B);if(console.log("Food predictions:",X),!X||X.length===0){k("No food items detected. Please try a different photo."),y(!1);return}const M=await xle(X,c);if(!M||M.length===0){k("No recognized food items found. Please try a different photo or add ingredients manually."),y(!1);return}f(M),a("weight")}catch(X){console.error("Image processing failed:",X),k(X instanceof Error?X.message:"Failed to analyze image. Please try again.")}finally{y(!1)}},B.onerror=X=>{clearTimeout(J),console.error("Image load error:",X),k("Failed to load image. Please try a different image."),y(!1)},B.src=K}catch(B){console.error("Model loading failed:",B),k(B instanceof Error?B.message:"Failed to load AI model. Please check your internet connection."),y(!1),x(!1)}},j=async K=>{if(h(K),p.length>0){const B=await Jx(p,K);f(B)}},Z=async(K,B)=>{const J=p.map(X=>X.id===K?{...X,percentage:B}:X);f(await Jx(J,c))},ne=async K=>{const B=p.filter(M=>M.id!==K);if(B.length===0){f([]);return}const J=100/B.length,X=B.map(M=>({...M,percentage:J}));f(await Jx(X,c))},te=async()=>{try{if(!p||p.length===0){k("Please add at least one ingredient");return}if(!ble(p)){k("Ingredient percentages must add up to 100%");return}if(!c||c<=0){k("Please enter a valid total weight");return}const K=qI(p);if(!K){k("Failed to calculate nutrition. Please try again.");return}const B={id:Date.now().toString(),timestamp:Date.now(),photo:i||void 0,totalWeight:c,ingredients:p,nutrition:K};await e(B),n("/")}catch(K){console.error("Failed to save meal:",K),k("Failed to save meal. Please try again.")}},se=()=>{a("photo"),l(""),f([]),k(""),y(!1),z(),t.current&&(t.current.value="")};if(o==="photo")return O.jsxs("div",{className:"p-4 space-y-6",children:[O.jsxs("div",{className:"text-center",children:[O.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Add New Meal"}),O.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Take a photo or upload an image of your meal"})]}),v&&O.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:O.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:v})}),I?O.jsxs("div",{className:"space-y-4",children:[O.jsx("video",{ref:s,autoPlay:!0,playsInline:!0,className:"camera-preview mx-auto block","data-testid":"camera-preview"}),O.jsx("canvas",{ref:r,className:"hidden"}),O.jsxs("div",{className:"flex space-x-4 justify-center",children:[O.jsx("button",{onClick:F,className:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors","data-testid":"capture-photo",children:" Capture"}),O.jsx("button",{onClick:z,className:"bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:"Cancel"})]})]}):O.jsxs("div",{className:"space-y-4",children:[O.jsx("button",{onClick:P,className:"w-full bg-blue-500 hover:bg-blue-600 text-white py-4 px-6 rounded-lg font-medium transition-colors","data-testid":"start-camera",children:" Use Camera"}),O.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400",children:"or"}),O.jsxs("div",{children:[O.jsx("input",{ref:t,type:"file",accept:"image/*",onChange:L,className:"hidden","data-testid":"file-input"}),O.jsx("button",{onClick:()=>{var K;return(K=t.current)==null?void 0:K.click()},className:"w-full bg-gray-500 hover:bg-gray-600 text-white py-4 px-6 rounded-lg font-medium transition-colors","data-testid":"upload-photo",children:" Upload Photo"})]})]}),g&&O.jsxs("div",{className:"text-center space-y-4",children:[O.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto"}),O.jsx("div",{children:w?O.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading AI model..."}):O.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Analyzing your meal..."})})]})]});if(o==="weight")return O.jsxs("div",{className:"p-4 space-y-6",children:[O.jsxs("div",{className:"text-center",children:[O.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Meal Weight"}),O.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Enter the total weight of your meal"})]}),i&&O.jsx("div",{className:"flex justify-center",children:O.jsx("img",{src:i,alt:"Your meal",className:"w-48 h-36 object-cover rounded-lg"})}),O.jsxs("div",{className:"space-y-4",children:[O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium mb-2",children:"Total Weight (grams)"}),O.jsx("input",{type:"number",value:c,onChange:K=>j(Number(K.target.value)),min:"1",max:"2000",className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-800","data-testid":"weight-input"})]}),O.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[O.jsx("h3",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"Detected Ingredients:"}),O.jsx("div",{className:"space-y-1",children:p.map(K=>O.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:[" ",K.name," (",K.percentage.toFixed(1),"%)"]},K.id))})]})]}),O.jsxs("div",{className:"flex space-x-4",children:[O.jsx("button",{onClick:se,className:"flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-6 rounded-lg font-medium transition-colors",children:"Back"}),O.jsx("button",{onClick:()=>a("ingredients"),className:"flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 px-6 rounded-lg font-medium transition-colors","data-testid":"proceed-to-ingredients",children:"Next"})]})]});if(o==="ingredients"){const K=p.reduce((B,J)=>B+J.percentage,0);return O.jsxs("div",{className:"p-4 space-y-6",children:[O.jsxs("div",{className:"text-center",children:[O.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Adjust Ingredients"}),O.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Fine-tune the ingredient percentages"})]}),v&&O.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:O.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:v})}),O.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:O.jsxs("div",{className:"flex justify-between items-center",children:[O.jsxs("span",{className:"font-medium",children:["Total: ",c,"g"]}),O.jsxs("span",{className:`font-medium ${Math.abs(K-100)<.1?"text-green-600":"text-red-600"}`,children:[K.toFixed(1),"%"]})]})}),O.jsx("div",{className:"space-y-4",children:p.map(B=>O.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm","data-testid":`ingredient-${B.id}`,children:[O.jsxs("div",{className:"flex justify-between items-center mb-3",children:[O.jsx("h3",{className:"font-medium capitalize",children:B.name}),O.jsx("button",{onClick:()=>ne(B.id),className:"text-red-500 hover:text-red-700 text-sm","data-testid":`remove-ingredient-${B.id}`,children:"Remove"})]}),O.jsxs("div",{className:"space-y-2",children:[O.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400",children:[O.jsxs("span",{children:[B.percentage.toFixed(1),"%"]}),O.jsxs("span",{children:[B.weight,"g"]})]}),O.jsx("input",{type:"range",min:"0",max:"100",step:"0.1",value:B.percentage,onChange:J=>Z(B.id,Number(J.target.value)),className:"ingredient-slider","data-testid":`percentage-slider-${B.id}`}),O.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-500",children:[B.nutrition.calories," cal  P: ",B.nutrition.protein,"g  C: ",B.nutrition.carbs,"g  F: ",B.nutrition.fat,"g"]})]})]},B.id))}),O.jsxs("div",{className:"flex space-x-4",children:[O.jsx("button",{onClick:()=>a("weight"),className:"flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-6 rounded-lg font-medium transition-colors",children:"Back"}),O.jsx("button",{onClick:()=>a("review"),disabled:Math.abs(K-100)>.1,className:"flex-1 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 text-white py-3 px-6 rounded-lg font-medium transition-colors","data-testid":"proceed-to-review",children:"Review"})]})]})}if(o==="review"){const K=qI(p);return O.jsxs("div",{className:"p-4 space-y-6",children:[O.jsxs("div",{className:"text-center",children:[O.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Review Meal"}),O.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Confirm your meal details"})]}),i&&O.jsx("div",{className:"flex justify-center",children:O.jsx("img",{src:i,alt:"Your meal",className:"w-48 h-36 object-cover rounded-lg"})}),O.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:[O.jsx("h3",{className:"font-semibold mb-3",children:"Nutrition Summary"}),O.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"text-2xl font-bold text-blue-500",children:K.calories}),O.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Calories"})]}),O.jsxs("div",{className:"text-center",children:[O.jsxs("div",{className:"text-2xl font-bold text-green-500",children:[K.protein,"g"]}),O.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Protein"})]}),O.jsxs("div",{className:"text-center",children:[O.jsxs("div",{className:"text-2xl font-bold text-yellow-500",children:[K.carbs,"g"]}),O.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Carbs"})]}),O.jsxs("div",{className:"text-center",children:[O.jsxs("div",{className:"text-2xl font-bold text-red-500",children:[K.fat,"g"]}),O.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Fat"})]})]})]}),O.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:[O.jsxs("h3",{className:"font-semibold mb-3",children:["Ingredients (",c,"g total)"]}),O.jsx("div",{className:"space-y-2",children:p.map(B=>O.jsxs("div",{className:"flex justify-between items-center",children:[O.jsx("span",{className:"capitalize",children:B.name}),O.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[B.weight,"g (",B.percentage.toFixed(1),"%)"]})]},B.id))})]}),O.jsxs("div",{className:"flex space-x-4",children:[O.jsx("button",{onClick:()=>a("ingredients"),className:"flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-6 rounded-lg font-medium transition-colors",children:"Back"}),O.jsx("button",{onClick:te,className:"flex-1 bg-green-500 hover:bg-green-600 text-white py-3 px-6 rounded-lg font-medium transition-colors","data-testid":"save-meal",children:"Save Meal"})]})]})}return null},vle=()=>{var f,g,y,w;const{state:n,deleteMeal:e}=Fl(),[t,s]=ve.useState(new Date().toISOString().split("T")[0]),[r,o]=ve.useState(null),a=((n==null?void 0:n.meals)||[]).reduce((x,v)=>{if(!v||!v.timestamp)return x;try{const k=new Date(v.timestamp).toISOString().split("T")[0];x[k]||(x[k]=[]),x[k].push(v)}catch{console.warn("Invalid meal timestamp:",v)}return x},{}),i=a[t]||[],l=x=>{try{const v=new Date(x),k=new Date().toISOString().split("T")[0],I=new Date(Date.now()-864e5).toISOString().split("T")[0];return x===k?"Today":x===I?"Yesterday":v.toLocaleDateString([],{weekday:"long",month:"short",day:"numeric"})}catch{return x}},c=x=>!x||!Array.isArray(x)?{calories:0,protein:0,carbs:0,fat:0}:x.reduce((v,k)=>!k||!k.nutrition?v:{calories:v.calories+(k.nutrition.calories||0),protein:v.protein+(k.nutrition.protein||0),carbs:v.carbs+(k.nutrition.carbs||0),fat:v.fat+(k.nutrition.fat||0)},{calories:0,protein:0,carbs:0,fat:0}),h=async x=>{window.confirm("Are you sure you want to delete this meal?")&&(await e(x),(r==null?void 0:r.id)===x&&o(null))},p=Object.keys(a).sort((x,v)=>new Date(v).getTime()-new Date(x).getTime()).slice(0,30);return r?O.jsxs("div",{className:"p-4 space-y-6",children:[O.jsxs("div",{className:"flex items-center space-x-4",children:[O.jsx("button",{onClick:()=>o(null),className:"text-blue-500 hover:text-blue-600","data-testid":"back-to-history",children:" Back"}),O.jsx("h2",{className:"text-xl font-bold",children:"Meal Details"})]}),O.jsxs("div",{className:"space-y-4",children:[r.photo&&O.jsx("div",{className:"flex justify-center",children:O.jsx("img",{src:r.photo,alt:"Meal",className:"w-64 h-48 object-cover rounded-lg"})}),O.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:[O.jsxs("div",{className:"flex justify-between items-start mb-4",children:[O.jsxs("div",{children:[O.jsx("h3",{className:"font-semibold text-lg",children:(r.ingredients||[]).map(x=>(x==null?void 0:x.name)||"Unknown").join(", ")}),O.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:new Date(r.timestamp).toLocaleString()}),O.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Total weight: ",r.totalWeight||0,"g"]})]}),O.jsx("button",{onClick:()=>h(r.id),className:"text-red-500 hover:text-red-700 text-sm","data-testid":"delete-meal",children:"Delete"})]}),O.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-4",children:[O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"text-xl font-bold text-blue-500",children:((f=r.nutrition)==null?void 0:f.calories)||0}),O.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Calories"})]}),O.jsxs("div",{className:"text-center",children:[O.jsxs("div",{className:"text-xl font-bold text-green-500",children:[((g=r.nutrition)==null?void 0:g.protein)||0,"g"]}),O.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Protein"})]}),O.jsxs("div",{className:"text-center",children:[O.jsxs("div",{className:"text-xl font-bold text-yellow-500",children:[((y=r.nutrition)==null?void 0:y.carbs)||0,"g"]}),O.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Carbs"})]}),O.jsxs("div",{className:"text-center",children:[O.jsxs("div",{className:"text-xl font-bold text-red-500",children:[((w=r.nutrition)==null?void 0:w.fat)||0,"g"]}),O.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Fat"})]})]}),O.jsxs("div",{children:[O.jsx("h4",{className:"font-medium mb-2",children:"Ingredients Breakdown"}),O.jsx("div",{className:"space-y-2",children:(r.ingredients||[]).map(x=>{var v,k,I,N;return O.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded p-3",children:[O.jsxs("div",{className:"flex justify-between items-center mb-1",children:[O.jsx("span",{className:"font-medium capitalize",children:(x==null?void 0:x.name)||"Unknown"}),O.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[(x==null?void 0:x.weight)||0,"g (",((x==null?void 0:x.percentage)||0).toFixed(1),"%)"]})]}),O.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:[((v=x==null?void 0:x.nutrition)==null?void 0:v.calories)||0," cal  P: ",((k=x==null?void 0:x.nutrition)==null?void 0:k.protein)||0,"g  C: ",((I=x==null?void 0:x.nutrition)==null?void 0:I.carbs)||0,"g  F: ",((N=x==null?void 0:x.nutrition)==null?void 0:N.fat)||0,"g"]})]},(x==null?void 0:x.id)||Math.random())})})]})]})]})]}):O.jsxs("div",{className:"p-4 space-y-6",children:[O.jsxs("div",{className:"text-center",children:[O.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Meal History"}),O.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"View your past meals and nutrition"})]}),O.jsxs("div",{className:"space-y-2",children:[O.jsx("label",{className:"block text-sm font-medium",children:"Select Date"}),O.jsx("select",{value:t,onChange:x=>s(x.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-800","data-testid":"date-selector",children:p.map(x=>O.jsxs("option",{value:x,children:[l(x)," (",(a[x]||[]).length," meals)"]},x))})]}),i.length===0?O.jsx("div",{className:"text-center py-8",children:O.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:["No meals logged for ",l(t)]})}):O.jsxs("div",{className:"space-y-4",children:[O.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:[O.jsxs("h3",{className:"font-semibold mb-3",children:["Daily Summary - ",l(t)]}),O.jsx("div",{className:"grid grid-cols-4 gap-4",children:(()=>{const x=c(i);return O.jsxs(O.Fragment,{children:[O.jsxs("div",{className:"text-center",children:[O.jsx("div",{className:"text-lg font-bold text-blue-500",children:Math.round(x.calories)}),O.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Calories"})]}),O.jsxs("div",{className:"text-center",children:[O.jsxs("div",{className:"text-lg font-bold text-green-500",children:[Math.round(x.protein*10)/10,"g"]}),O.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Protein"})]}),O.jsxs("div",{className:"text-center",children:[O.jsxs("div",{className:"text-lg font-bold text-yellow-500",children:[Math.round(x.carbs*10)/10,"g"]}),O.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Carbs"})]}),O.jsxs("div",{className:"text-center",children:[O.jsxs("div",{className:"text-lg font-bold text-red-500",children:[Math.round(x.fat*10)/10,"g"]}),O.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Fat"})]})]})})()})]}),O.jsxs("div",{className:"space-y-3",children:[O.jsxs("h3",{className:"font-semibold",children:["Meals (",i.length,")"]}),i.map(x=>{var v,k,I,N;return O.jsx("div",{onClick:()=>o(x),className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm cursor-pointer hover:shadow-md transition-shadow","data-testid":`history-meal-${(x==null?void 0:x.id)||"unknown"}`,children:O.jsxs("div",{className:"flex items-center space-x-3",children:[(x==null?void 0:x.photo)&&O.jsx("img",{src:x.photo,alt:"Meal",className:"w-16 h-16 rounded-lg object-cover"}),O.jsxs("div",{className:"flex-1",children:[O.jsx("h4",{className:"font-medium",children:((x==null?void 0:x.ingredients)||[]).map(T=>(T==null?void 0:T.name)||"Unknown").join(", ")}),O.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[((v=x==null?void 0:x.nutrition)==null?void 0:v.calories)||0," cal  ",(x==null?void 0:x.totalWeight)||0,"g"]}),O.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500",children:x!=null&&x.timestamp?new Date(x.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Unknown time"})]}),O.jsxs("div",{className:"text-right",children:[O.jsxs("div",{className:"text-sm font-medium",children:["P: ",((k=x==null?void 0:x.nutrition)==null?void 0:k.protein)||0,"g"]}),O.jsxs("div",{className:"text-sm font-medium",children:["C: ",((I=x==null?void 0:x.nutrition)==null?void 0:I.carbs)||0,"g"]}),O.jsxs("div",{className:"text-sm font-medium",children:["F: ",((N=x==null?void 0:x.nutrition)==null?void 0:N.fat)||0,"g"]})]})]})},(x==null?void 0:x.id)||Math.random())})]})]}),((n==null?void 0:n.meals)||[]).length===0&&O.jsxs("div",{className:"text-center py-8",children:[O.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"No meals logged yet"}),O.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"Start tracking your nutrition by adding your first meal!"})]})]})},kle=()=>{const{state:n,updateSettings:e,toggleDarkMode:t}=Fl(),[s,r]=ve.useState(n.settings),[o,a]=ve.useState(!1),[i,l]=ve.useState(!1),[c,h]=ve.useState(!1),p=async()=>{a(!0);try{await e(s),setTimeout(()=>a(!1),500)}catch(y){console.error("Failed to save settings:",y),a(!1)}},f=async()=>{try{await z3(),l(!1),window.location.reload()}catch(y){console.error("Failed to clear data:",y)}},g=(y,w)=>{r(x=>({...x,[y]:w}))};return O.jsxs("div",{className:"p-4 space-y-6",children:[O.jsxs("div",{className:"text-center",children:[O.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Settings"}),O.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Customize your nutrition goals and preferences"})]}),O.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm space-y-4",children:[O.jsx("h3",{className:"text-lg font-semibold",children:"Daily Nutrition Goals"}),O.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium mb-1",children:"Calories"}),O.jsx("input",{type:"number",value:s.dailyCalories,onChange:y=>g("dailyCalories",Number(y.target.value)),min:"800",max:"5000",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700","data-testid":"calories-input"})]}),O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium mb-1",children:"Protein (g)"}),O.jsx("input",{type:"number",value:s.dailyProtein,onChange:y=>g("dailyProtein",Number(y.target.value)),min:"20",max:"300",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700","data-testid":"protein-input"})]}),O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium mb-1",children:"Carbs (g)"}),O.jsx("input",{type:"number",value:s.dailyCarbs,onChange:y=>g("dailyCarbs",Number(y.target.value)),min:"20",max:"500",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700","data-testid":"carbs-input"})]}),O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium mb-1",children:"Fat (g)"}),O.jsx("input",{type:"number",value:s.dailyFat,onChange:y=>g("dailyFat",Number(y.target.value)),min:"10",max:"200",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700","data-testid":"fat-input"})]})]})]}),O.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm space-y-4",children:[O.jsx("h3",{className:"text-lg font-semibold",children:"Preferences"}),O.jsxs("div",{className:"space-y-4",children:[O.jsxs("div",{children:[O.jsx("label",{className:"block text-sm font-medium mb-1",children:"Units"}),O.jsxs("select",{value:s.units,onChange:y=>g("units",y.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700","data-testid":"units-select",children:[O.jsx("option",{value:"metric",children:"Metric (g, kg)"}),O.jsx("option",{value:"imperial",children:"Imperial (oz, lb)"})]})]}),O.jsxs("div",{className:"flex items-center justify-between",children:[O.jsxs("div",{children:[O.jsx("h4",{className:"font-medium",children:"Dark Mode"}),O.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Toggle dark theme"})]}),O.jsx("button",{onClick:t,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${n.darkMode?"bg-blue-500":"bg-gray-300"}`,"data-testid":"dark-mode-toggle",children:O.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${n.darkMode?"translate-x-6":"translate-x-1"}`})})]})]})]}),O.jsx("button",{onClick:p,disabled:o,className:"w-full bg-blue-500 hover:bg-blue-600 disabled:bg-blue-400 text-white py-3 px-6 rounded-lg font-medium transition-colors","data-testid":"save-settings",children:o?"Saving...":"Save Settings"}),O.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm space-y-4",children:[O.jsx("h3",{className:"text-lg font-semibold",children:"About"}),O.jsxs("div",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400",children:[O.jsxs("p",{children:[O.jsx("strong",{children:"Food Tracker PWA"})," - AI-powered nutrition logging"]}),O.jsx("p",{children:"Version 1.0.0  All data stored locally on your device"}),O.jsx("p",{children:"Uses TensorFlow.js for offline food recognition"})]}),O.jsx("button",{onClick:()=>h(!0),className:"w-full bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded-lg text-sm font-medium transition-colors","data-testid":"show-app-status",children:" Check App Status"}),O.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3",children:O.jsxs("div",{className:"flex items-center space-x-2",children:[O.jsx("span",{className:"text-green-600 dark:text-green-400",children:""}),O.jsx("span",{className:"text-sm text-green-700 dark:text-green-300",children:"100% offline  No data tracking  Privacy first"})]})})]}),O.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm space-y-4",children:[O.jsx("h3",{className:"text-lg font-semibold",children:"Data Management"}),O.jsxs("div",{className:"space-y-3",children:[O.jsx("div",{className:"flex justify-between items-center",children:O.jsxs("div",{children:[O.jsx("p",{className:"font-medium",children:"Total Meals"}),O.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[(n.meals||[]).length," meals logged"]})]})}),O.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-3",children:[O.jsx("button",{onClick:()=>l(!0),className:"w-full bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg font-medium transition-colors","data-testid":"clear-data-button",children:"Clear All Data"}),O.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 text-center",children:"This will permanently delete all your meals and reset settings"})]})]})]}),O.jsx(U3,{isOpen:c,onClose:()=>h(!1)}),i&&O.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:O.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-sm",children:[O.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Clear All Data?"}),O.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"This will permanently delete all your meals, photos, and reset your settings. This action cannot be undone."}),O.jsxs("div",{className:"flex space-x-3",children:[O.jsx("button",{onClick:()=>l(!1),className:"flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg font-medium transition-colors",children:"Cancel"}),O.jsx("button",{onClick:f,className:"flex-1 bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg font-medium transition-colors","data-testid":"confirm-clear-data",children:"Clear Data"})]})]})})]})};function Sle(){console.log("App: Component rendering...");try{return O.jsx(W3,{children:O.jsx(V3,{children:O.jsx(w3,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:O.jsx(j3,{children:O.jsxs(p3,{children:[O.jsx(dl,{path:"/",element:O.jsx(sC,{})}),O.jsx(dl,{path:"/add",element:O.jsx(wle,{})}),O.jsx(dl,{path:"/history",element:O.jsx(vle,{})}),O.jsx(dl,{path:"/settings",element:O.jsx(kle,{})}),O.jsx(dl,{path:"*",element:O.jsx(sC,{})})]})})})})})}catch(n){return console.error("App render error:",n),O.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:O.jsxs("div",{className:"text-center max-w-md",children:[O.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"App Failed to Load"}),O.jsx("p",{className:"text-gray-600 mb-4",children:"There was an error loading the application. Please refresh the page."}),O.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium","data-testid":"reload-button",children:"Refresh Page"}),O.jsxs("div",{className:"mt-4 text-xs text-gray-500",children:["Error: ",n instanceof Error?n.message:"Unknown error",O.jsx("br",{}),"Time: ",new Date().toLocaleString()]})]})})}}window.addEventListener("error",n=>{var e,t;console.error("Global error:",{message:(e=n.error)==null?void 0:e.message,stack:(t=n.error)==null?void 0:t.stack,filename:n.filename,lineno:n.lineno,colno:n.colno})});window.addEventListener("unhandledrejection",n=>{console.error("Unhandled promise rejection:",{reason:n.reason,promise:n.promise}),n.preventDefault()});const Nle=()=>typeof window>"u"?"Window object not available":"indexedDB"in window?"fetch"in window?"Promise"in window?null:"Promises not supported":"Fetch API not supported":"IndexedDB not supported",Cle=async()=>{const n=Nle();if(n){document.body.innerHTML=`
      <div style="padding: 20px; text-align: center; font-family: Arial, sans-serif;">
        <h2 style="color: red;">Browser Not Supported</h2>
        <p>${n}</p>
        <p>Please use a modern browser like Chrome, Firefox, Safari, or Edge.</p>
      </div>
    `;return}const e=document.getElementById("root");if(!e){console.error("Root element not found!"),document.body.innerHTML=`
      <div style="padding: 20px; text-align: center; font-family: Arial, sans-serif;">
        <h2 style="color: red;">Setup Error</h2>
        <p>Root element not found. Please check HTML.</p>
      </div>
    `;return}try{console.log("Initializing React app..."),kF.createRoot(e).render(O.jsx(aw.StrictMode,{children:O.jsx(Sle,{})})),console.log("React app initialized successfully")}catch(t){console.error("React app failed to render:",t),e.innerHTML=`
      <div style="padding: 20px; text-align: center; font-family: Arial, sans-serif;">
        <h2 style="color: red;">App Failed to Load</h2>
        <p>There was an error loading the application.</p>
        <button onclick="window.location.reload()" style="background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
          Reload Page
        </button>
        <details style="margin-top: 20px; text-align: left; background: #f5f5f5; padding: 10px; border-radius: 5px;">
          <summary style="cursor: pointer;">Error Details</summary>
          <pre style="font-size: 12px; overflow: auto;">${t instanceof Error?t.stack:String(t)}</pre>
        </details>
      </div>
    `}};Cle();
